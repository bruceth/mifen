{"version":3,"sources":["tonva-react/index.ts","tonva-react/tool/left0.ts","tonva-react/tool/local.ts","tonva-react/tool/getObjPropIgnoreCase.ts","tonva-react/tool/caseString.ts","tonva-react/components/index.ts","stockinfo/GFunc.tsx","tonva-react/components/nav.tsx","tonva-react/net/netToken.ts","tonva-react/components/fetchErrorView.tsx","tonva-react/components/reloadPage.tsx","tonva-react/net/guestApi.ts","tonva-react/net/caller.ts","tonva-react/net/centerApi.ts","tonva-react/uq/build/tools.ts","tool/render.tsx","tool/renderGroup.tsx","tonva-react/components/page/page.tsx","tonva-uqui/tools/pageItems.ts","tonva-uqui/tools/timeSpan.ts","tonva-uqui/tools/parts.tsx","tonva-uqui/old/list/ListPage.tsx","tonva-uqui/old/list/CList.ts","tonva-uqui/old/list/MidList.ts","tonva-react/vm/controller.tsx","tonva-react/vm/view.tsx","tonva-react/vm/vpage.tsx","tonva-react/uq/entity.ts","tonva-uqui/props.ts","tonva-react/components/edit/itemEdit.tsx","tonva-react/res/formRes.ts","tonva-react/res/listRes.ts","tonva-react/uq/caller.ts","tonva-react/net/httpChannel.ts","tonva-react/net/httpChannelUI.ts","tonva-react/net/uqApi.ts","tonva-uqui/form/VFormView.tsx","tonva-uqui/form/CFormView.ts","tonva-uqui/form/VFormPage.tsx","tonva-uqui/form/CFormPage.ts","tonva-uqui/form/VDialog.tsx","tonva-uqui/form/CFormDialog.ts","tonva-uqui/form/FormUI.ts","tonva-uqui/base/index.ts","tonva-react/uq/query.ts","tonva-react/tool/uid.ts","tonva-react/net/appBridge.ts","tonva-react/net/wsChannel.ts","tonva-react/components/image.tsx","tonva-uqui/old/select/CIDSelect.ts","tonva-uqui/old/select/parts.tsx","tonva-uqui/old/select/CIXSelect.ts","tonva-uqui/old/select/createPickId.ts","tonva-uqui/CIDList/VIDList.tsx","tonva-uqui/CIDList/CIDList.ts","tonva-uqui/CIDEdit/VIDEdit.tsx","tonva-uqui/CIDEdit/CIDEdit.ts","tonva-uqui/CIDView/VIDView.tsx","tonva-uqui/CIDView/CIDView.ts","tonva-react/tool/user.ts","tonva-react/net/host.ts","tonva-react/components/page/scrollView.tsx","tonva-react/res/res.ts","tonva-react/uq/action.ts","tonva-react/components/simple/LMR.tsx","tonva-react/components/simple/Badge.tsx","tonva-react/components/simple/FA.tsx","tonva-react/components/simple/IconText.tsx","tonva-uqui/index.ts","tonva-react/tool/localDb.ts","tonva-react/uq/tuid/reactBoxId.tsx","tonva-react/components/loading.tsx","tonva-react/tool/env.ts","tonva-react/components/login.tsx","tonva-react/uq/index.ts","tonva-react/uq/tuid/index.ts","tonva-react/uq/ID.ts","stockinfo/SlrForEarning.ts","tonva-react/net/apiBase.ts","tonva-react/uq/uqsMan.ts","tonva-uqui/CIDSelect/VIDSelect.tsx","tonva-uqui/CIDSelect/CIDSelect.ts","tonva-uqui/CIDSelect/createPickId.ts","tonva-react/components/edit/imageItemEdit.tsx","tonva-react/tool/rules.ts","tonva-uqui/old/Mid.ts","tonva-react/tool/pageItems.ts","tonva-react/tool/62.ts","tonva-react/net/messageHub.ts","tonva-react/components/navigo.ts","tonva-react/components/page/pageHeader.tsx","tonva-react/components/page/tabs.tsx","tonva-react/components/resUploader.tsx","tonva-react/uq/uqMan.ts","tonva-react/uq/sheet.ts","tonva-react/uq/book.ts","tonva-react/uq/history.ts","tonva-react/uq/map.ts","tonva-react/uq/pending.ts","tonva-react/uq/enum.ts","uq-app/uqs/BruceYuMi/index.ts","stockinfo/VStockInfo.tsx","tonva-uqui/CXIList/VIXRight.tsx","tonva-uqui/CXIList/VXIList.tsx","tonva-uqui/CXIList/CXIList.ts","tonva-uqui/CIXList/VIXList.tsx","tonva-uqui/CIXList/CIXList.ts","tonva-react/uq/tag/tagView.tsx","tonva-react/uq/tag/tag.ts","tonva-uqui/CIDBase.ts","stockinfo/ErForEarning.ts","uq-app/CBase.ts","uq-app/bug/tester/test-times-change.ts","uq-app/bug/tester/index.ts","uq-app/bug/tester/test1.ts","uq-app/bug/tester/test2.ts","uq-app/bug/tester/test3.ts","uq-app/bug/tester/test4.ts","uq-app/bug/VBug.tsx","uq-app/bug/VConsole.tsx","uq-app/bug/CBug.ts","uq-app/res/index.ts","uq-app/res/zh.ts","uq-app/res/en.ts","uq-app/VMain.tsx","uq-app/test-uqui/VTest.tsx","uq-app/test-uqui/CTest.tsx","uq-app/appConfig.ts","me/VAbout.tsx","me/VEditMe.tsx","me/VFaq.tsx","me/VMe.tsx","me/CMe.ts","store/holdingStock.ts","store/sorter.ts","store/miAccount.ts","store/miAccounts.ts","store/mGroup.ts","store/mGroups.ts","store/market.tsx","store/store.ts","home/VHome.tsx","home/account/VAccount.tsx","home/account/VForm.tsx","home/account/VAccounts.tsx","home/account/VPickStock.tsx","home/account/CAccount.ts","home/VBlogs.tsx","home/VBlog.tsx","home/CHome.ts","find/stockPageItems.ts","find/VFind.tsx","find/VStocksPage.tsx","find/group/VGroups.tsx","find/group/VRootIndustry.tsx","find/group/VStockList.tsx","find/group/CGroup.ts","find/CFind.ts","common/VBlockStock.tsx","common/VEmpty.tsx","common/VKeepStock.tsx","common/VPinStock.tsx","common/VStockInGroup.tsx","common/VStockLink.tsx","common/CCommon.ts","track/stockPageItems.ts","track/VTrack.tsx","track/VStocksPage.tsx","track/group/VGroups.tsx","track/group/VRootIndustry.tsx","track/group/VStockList.tsx","track/group/CGroup.ts","track/CTrack.ts","uq-app/CApp.ts","uq-app/uqs/index.ts","uq-app/App.tsx","net/consts.ts","net/httpChannel.ts","net/httpChannelUI.ts","net/apiBase.ts","net/miApi.ts","net/miNet.ts","tonva-react/uq/build/fieldItem.ts","tonva-react/auth/VLogout.tsx","tonva-react/auth/VLogin.tsx","tonva-react/auth/VChangePassword.tsx","tonva-react/auth/CLogin.tsx","tonva-react/img/logo.svg","tonva-react/auth/tools.tsx","tonva-react/components/page/index.ts","tonva-react/components/schema/index.ts","tonva-react/components/dropDownActions/index.tsx","tonva-react/components/easyDate/index.tsx","tonva-react/components/media.tsx","tonva-react/components/searchBox.tsx","tonva-react/components/userIcon.tsx","tonva-react/components/ax/index.tsx","tonva-react/components/autoHideTips.tsx","tonva-react/uq/tuid/tuidsCache.ts","tonva-react/ui/index.ts","stockinfo/CStockInfo.tsx","tonva-uqui/old/ID/VEdit.tsx","tonva-uqui/old/ID/VContent.tsx","tonva-uqui/old/ID/res/index.ts","tonva-uqui/old/ID/res/zh.ts","tonva-uqui/old/ID/res/en.ts","tonva-uqui/old/ID/CID.ts","tonva-uqui/old/ID/MidIDList.ts","tonva-uqui/old/ID/MidID.ts","tonva-uqui/old/IDX/MidIDXList.ts","tonva-uqui/old/IDX/res/index.ts","tonva-uqui/old/IDX/res/zh.ts","tonva-uqui/old/IDX/res/en.ts","tonva-uqui/old/IDX/VEdit.tsx","tonva-uqui/old/IDX/VHistory.tsx","tonva-uqui/old/IDX/VView.tsx","tonva-uqui/old/IX/CIXXList.ts","tonva-uqui/old/IDX/CIDX.ts","tonva-uqui/old/IDX/MidIDX.ts","tonva-uqui/old/IX/CIXX.ts","tonva-uqui/old/IX/CIXEdit.ts","tonva-uqui/old/tag/select/VSelect.tsx","tonva-uqui/old/sheet/MidSheet.ts","tonva-uqui/old/sheet/CSheet.ts","tonva-uqui/old/sheet/VSheetEdit.tsx","tonva-uqui/old/sheet/VSheetView.tsx","tonva-uqui/old/tag/MidTag.ts","tonva-uqui/old/tag/select/CSelect.ts","tonva-uqui/old/tag/parts.tsx","tonva-uqui/old/tag/CIDTagList.ts","tonva-uqui/old/tag/VTags.tsx","tonva-uqui/old/tag/CTagIDList.ts","tonva-uqui/old/roles/VRoles.tsx","tonva-uqui/old/roles/roleAdmin/VAddUser.tsx","tonva-uqui/old/roles/roleAdmin/VRoleAdmin.tsx","tonva-uqui/old/roles/roleAdmin/CRoleAdmin.ts","tonva-uqui/old/roles/CRoles.ts","tonva-react/components/form/rules/index.ts","tonva-react/components/form/widgets/widget.tsx","tonva-react/components/form/widgets/textWidget.tsx","tonva-react/components/form/widgets/textareaWidget.tsx","tonva-react/components/form/widgets/passwordWidget.tsx","tonva-react/components/form/widgets/numberWidget.tsx","tonva-react/components/form/widgets/updownWidget.tsx","tonva-react/components/form/widgets/dateWidget.tsx","tonva-react/components/form/widgets/checkBoxWidget.tsx","tonva-react/components/form/widgets/selectWidget.tsx","tonva-react/components/form/widgets/radioWidget.tsx","tonva-react/components/form/widgets/rangeWidget.tsx","tonva-react/components/form/widgets/idWidget.tsx","tonva-react/components/form/widgets/unknown.tsx","tonva-react/components/form/widgets/buttonWidget.tsx","tonva-react/components/form/context.tsx","tonva-react/components/form/widgets/arrComponent.tsx","tonva-react/components/form/widgets/imageWidget.tsx","tonva-react/components/form/widgets/tagWidget.tsx","tonva-react/components/form/widgets/factory.tsx","tonva-react/components/form/form.tsx","tonva-react/components/form/field.tsx","tonva-react/components/edit/stringItemEdit.tsx","tonva-react/components/edit/radioItemEdit.tsx","tonva-react/components/edit/selectItemEdit.tsx","tonva-react/components/edit/idItemEdit.tsx","tonva-react/components/edit/tagItemEdit.tsx","tonva-react/components/edit/textAreaItemEdit.tsx","tonva-react/components/edit/checkBoxItemEdit.tsx","tonva-react/components/edit/rangeItemEdit.tsx","tonva-react/components/edit/numberItemEdit.tsx","tonva-react/components/edit/edit.tsx","tonva-uqui/CIDX/VIDX.tsx","tonva-uqui/CIDX/res/index.ts","tonva-uqui/CIDX/res/zh.ts","tonva-uqui/CIDX/res/en.ts","tonva-uqui/CIDX/VView.tsx","tonva-uqui/CIDX/VEdit.tsx","tonva-uqui/CIDX/CIDX.ts","tonva-react/app/vMain.tsx","tonva-react/app/CAppBase.ts","tonva-react/app/start.ts","tonva-react/app/CBase.ts","tonva-react/components/list/base.tsx","tonva-react/components/list/clickable.tsx","tonva-react/components/list/static.tsx","tonva-react/components/list/selectable.tsx","tonva-react/components/list/index.tsx","tonva-react/components/propGrid/row.tsx","tonva-react/components/propGrid/propView.tsx","tonva-react/components/propGrid/PropGrid.tsx","tonva-uqui/CIDXHistory/VIDXHistory.tsx","tonva-uqui/CIDXHistory/CIDXHistory.ts","tonva-react/auth/meInfo.tsx","tonva-react/uq/tuid/idCache.ts","tonva-react/uq/tuid/tuid.ts","tonva-uqui/CIX/CIX.ts","tonva-uqui/CXI/CXI.ts","tonva-react/uq/build/buildTsUqFolder.ts","tonva-react/uq/build/buildUQ.ts","uq-app/uqs/BruceYuMi/Market.ui.tsx","uq-app/uqs/BruceYuMi/Transaction.ui.tsx","uq-app/uqs/BruceYuMi/Group.ui.tsx","uq-app/uqs/BruceYuMi/Account.ui.tsx","uq-app/uqs/BruceYuMi/Holding.ui.tsx","uq-app/uqs/BruceYuMi/Stock.ui.tsx","uq-app/uqs/BruceYuMi/Blog.ui.tsx","uq-app/uqs/BruceYuMi/Industry.ui.tsx","uq-app/uqs/BruceYuMi/StockValue.ui.tsx","uq-app/uqs/BruceYuMi/AccountValue.ui.tsx","uq-app/uqs/BruceYuMi/Portfolio.ui.tsx","uq-app/uqs/BruceYuMi/UserBlockStock.ui.tsx","uq-app/uqs/BruceYuMi/UserAccount.ui.tsx","uq-app/uqs/BruceYuMi/UserGroup.ui.tsx","uq-app/uqs/BruceYuMi/UserAllStock.ui.tsx","uq-app/uqs/BruceYuMi/AccountHolding.ui.tsx","uq-app/uqs/BruceYuMi/GroupStock.ui.tsx","uq-app/uqs/BruceYuMi/IXIndustry.ui.tsx","stockinfo/index.ts","reportWebVitals.ts","index.tsx"],"names":["left0","num","fix","undefined","r","toString","len","length","substr","LocalData","user","env","localDb","child","guest","unit","_user","_guest","_unit","this","get","set","forEach","d","remove","getObjPropIgnoreCase","obj","prop","keys","Object","toLowerCase","key","capitalCase","s","split","map","v","firstCharUppercase","join","camelCase","parts","c","charCodeAt","ACode","ZCode","String","fromCharCode","firstCharLowercase","i","aCode","zCode","GFunc","n","w","isNaN","toFixed","Math","round","precision","toPrecision","Number","parseFloat","t","r2","iRate","e1","e2","e3","r3","z","divyield","pe","e","bonus","price","pow","ev","data","ret","funcz","p","day","floor","year","month","no","season","begin","end","arr","avg20","avg50","avg100","avg","calcuOne","count","endIndex","sum","caption","value","className","logMark","netToken","userId","token","setCenterToken","WSChannel","FetchErrorView","reApi","a","props","clearError","channel","url","options","resolve","reject","refetchApi","close","errContent","error","err","push","style","wordWrap","type","onClick","React","SystemNotifyPage","message","header","ReloadPage","timerHandler","reload","clearInterval","nav","seconds","state","setInterval","setState","title","msg","ConfirmReloadPage","back","confirm","logs","stackKey","notSupportedBrowsers","NavView","stack","waitCount","waitTimeHandler","upgradeUq","start","isHistoryBack","navBack","tick","Date","now","console","log","window","self","top","postMessage","confirmClose","pop","fetchError","browser","notSupportedBrowser","findIndex","wait","addEventListener","init","setTimeout","clearTimeout","unauthorized","showLogin","uq","version","show","view","disposer","clear","removeCeased","history","pushState","ceased","refresh","item","dispose","level","backLevel","popAndDispose","find","elWait","elError","test","testing","left","zIndex","name","index","visibility","position","navView","wsHost","local","navigo","navSettings","language","culture","resUrl","hashParam","centerHost","arrs","windowOnError","event","source","lineno","colno","windowOnUnhandledRejection","reason","windowOnClick","windowOnMouseMove","navigator","userAgent","x","y","windowOnScroll","forceDevelopment","reloadUser","curUser","id","logined","logout","navLogin","params","navLogout","showLogout","navRegister","showRegister","navForget","showForget","navPageRoutes","doneSysRoutes","sysRoutes","isWebNav","backIcon","closeIcon","pageWebNav","onChangeLogin","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","content","__html","dangerouslySetInnerHTML","createLogin","login","waiting","Promise","race","serviceWorker","ready","registration","unregister","document","location","plus","webview","webView","resetAll","ok","showReloadPage","localStorage","makeObservable","observable","lang","resOptions","district","g","messageHub","dispatch","unitJsonPath","fetch","unitRes","json","res","el","getElementById","innerText","loadUnitJson","innerHTML","JSON","parse","process","isDevelopment","getPredefinedUnitName","unitName","guestApi","unitFromName","unitId","settings","htmlTitle","html0","getElementsByTagName","getAttribute","oem","origin","pathname","endsWith","host","ws","resHost","resUrlFromHost","setCenterUrl","Error","setGuest","onerror","onunhandledrejection","onfocus","isMobile","onselectstart","oncontextmenu","startWait","userPassword","userName","password","userApi","pwd","logindUser","notLogined","endWait","Navigo","historyAPIUpdateMethod","on","navigate","navPage","queryStr","routeFromNavPage","internalOnNavRoutes","_","merge","navOns","route","absolute","alert","showPage","isUserLogin","onLogined","roles","me","icon","nick","callback","logoutApis","saveLocalUser","showAppView","internalLogined","defaultTop","loginTop","withBack","getLogin","logoutClear","showChangePassword","onError","showUpgradeUq","replace","topKey","popTo","ceaseTop","regConfirmClose","confirmBox","date","getTime","toTimeString","step","href","indexOf","text","parser","DOMParser","htmlDoc","parseFromString","elHtml","newVersion","decodeGuestToken","CenterApiBase","Caller","_params","method","centerApi","app","red","lastBuildTime","saveSrcTsFileIfNotExists","context","fileName","suffix","saveTsFileIfNotExists","uqTsSrcPath","saveTsFile","srcFile","tsFile","fs","existsSync","renameSync","writeFileSync","overrideTsFile","path","tsFilePath","buildTsHeader","entityName","getNameFromUq","uqMan","devPart","uqPart","config","dev","alias","devName","uqOwner","uqName","renderValue","valueType","vStr","_cn","cn","percent1","number","numberToMarketValue","renderStockName","stock","$market","smallPercent","renderStockRow","order","onClickName","right","roe","dvRate","miRate","volumn","ttm","inc1","inc2","inc3","inc4","preInc","smoothness","stars","rows","formatNumber","toLocaleString","nFormat0","minimumFractionDigits","maximumFractionDigits","nFormat1","nFormat2","renderGroup","IDRender","Page","observer","tabsView","tabsProps","TabsView","webNav","headerClassName","afterBack","inWebNav","pageHeaderProps","center","rph","renderPageHeader","footer","elFooter","errorInfo","onScroll","onScrollTop","onScrollBottom","children","renderHeader","renderFooter","ListPageItems","pageLoader","param","pageStart","pageSize","$page","PageItems","HistoryPageItems","field","far","near","TimeSpan","firstNear","dayValues","days","getDayArray","dv","setMinutes","getMinutes","getTimezoneOffset","span","DaySpan","WeekSpan","MonthSpan","YearSpan","_labels","setHours","toLocaleDateString","enWeek","zhWeek","firstDay","lastDay","getDay","setDate","getDate","initFromDate","getFullYear","getMonth","setMonth","listRight","renderItem","stringify","renderItemContainer","ListPage","listPageProps","renderPage","pageItems","itemClick","bottom","render","onPageScroll","scroller","onPageScrollTop","onPageScrollBottom","items","CList","midList","selectedItem","setRes","onItemClick","renderRight","first","firstParam","page","openPage","returnCall","onRightClick","Controller","MidList","renderTop","renderBottom","createPageItems","Mid","MidIDListBase","IDListPageItems","loadPageItems","_items","itemId","newItem","unshift","runInAction","assign","str","internalT","label","isDev","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","topPageKey","beforeInit","getPageWebNav","afterInit","$lang","$district","l","timeZone","vp","open","replaceOpen","onEvent","registerReceiveHandler","beforeStart","internalStart","afterStart","onClosePage","go","yes","classNames","closePage","buttons","View","controller","isMe","vm","vCall","imageClassName","textClassName","renderUser","src","replacePage","backPage","ceasePage","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","replacePageElement","ln","chars","codeBackSlash","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","cache","uqApi","fields","arrFields","returns","face","fieldMaps","localMap","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","setJName","buildFieldTuid","buildArrFieldsTuid","fieldName","arrName","entities","fn","getTuid","an","fieldArr","tuid","result","buildFieldsParams","arrResult","pa","rowResult","val","buildDateTimeParam","_tuid","getIdFromObj","dt","toISOString","packRow","arrData","packArr","row","ch","substring","escape","values","boxId","unpackRow","unpackArr","ch0","fLen","to","reverseNT","p0","vals","CUqUi","IDUI","ID","ui","isKey","required","fieldItem","importSelect","setIDUi","createPickId","widget","IDX","exFields","pickId","idField","Templet","noFieldItem","noField","readOnly","defaultValue","ItemEdit","edit","itemSchema","uiItem","_itemSchema","_uiItem","newValue","isChanged","internalEnd","divValue","labelHide","templet","list","rules","nv","Array","isArray","verifyRule","rule","formRes","integer","min","max","zh","listRes","none","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","xcall","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","uqVersion","en","rebuildSchema","buildEntities","ActionCaller","QueryQueryCaller","unpackReturns","buildParams","QueryPageCaller","methodsWithBody","HttpChannel","hostUrl","apiToken","timeout","showError","post","urlPrefix","caller","buildOptions","headers","h","encodeURI","body","innerFetch","k","innerFetchResult","buildError","ex","retErr","that","timeOutHandler","statusText","ct","then","retJson","retError","catch","startsWith","buildHeaders","CenterHttpChannel","u","isBridged","bridgeCenterApi","UqHttpChannel","HttpChannelNavUI","channelUIs","channelNoUIs","channels","logoutUqTokens","UqApi","basePath","showWaiting","buildAppUq","channelUI","uqToken","getUqToken","trim","theUser","ApiBase","UnitxApi","buildChannel","centerAppApi","CenterAppApi","unitxUq","db","urlTest","realUrl","getUrlOrTest","centerChannel","centerChannelUI","centerToken","loginedUserId","uqTokensName","UqTokenApi","un","localCache","nowTick","clone","uqParams","removeItem","uqTokenApi","callCenterapi","call","appOwner","appName","uqs","decodeUserToken","account","verify","VFormView","onSubmit","setDisabled","submit","uiSchema","fieldLabelSize","formData","onButtonClick","CFormView","formUI","submitCaption","buildItemSchema","buildUISchema","NO","uiField","uiButton","uiNumber","placeholder","VFormPage","renderForm","CFormPage","openVPage","VDialog","CFormDialog","FormUI","fieldCustoms","fieldCustom","proxy","fieldNames","splice","onChanged","onChanging","UqQuery","more","startField","isPaged","size","array","deep","pageCaller","request","queryCaller","query","table","Query","ALPHABET","uid","rtn","charAt","random","uqTokens","clearLocal","parent","subFrameStarted","evt","subWin","setSubAppWindow","hash","hidden","hideFrameBack","initSubWin","onReceiveAppApiMessage","apiName","onAppApiReturn","action","uqTokenActions","onReceive","callCenterApiFromMessage","bridgeCenterApiReturn","at","opener","brideCenterApis","callId","from","directCall","bca","subAppWindow","postWsToSubApp","win","WsBase","wsBaseSeed","wsBaseId","WebSocket","onopen","onmessage","wsMessage","onclose","receive","netThis","connect","send","Image","altImage","alt","currentTarget","CIDSelect","midIDSelectList","MidIDSelectList","onChange","defaultChecked","renderSelectItem","onSelectChange","checked","$in","CIXSelect","MidIXSelectList","IX","IDinIX","mid","cIDSelect","CIDSelectInPickId","isSelected","VIDList","listHeader","sName","onAddItem","onClickItem","CIDList","cIDEdit","CIDEdit","onItemChanged","cIDView","CIDView","update","IDPageItems","orgItem","VIDEdit","cFormView","saveID","_uiSchema","createFormView","setNO","itemProps","saveItem","Acts","retId","CIDBase","VIDView","onEditItem","V","gridProps","_props","buildGridProps","jwtDecode","uqDebugHost","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","https","fetchOptions","mode","tryLocal","getCenterHost","getResHost","promises","hostArr","fetchUrl","debugHostUrl","localCheck","all","results","j","hostValue","includes","debugHost","testProd","getUrlOrDebug","urlDebug","fetchLocalCheck","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","div","refDiv","onResize","removeEventListener","target","sh","scrollHeight","direct","Children","_$scroll","eachChild","Component","ScrollView","ref","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","resLang","languages","toUpperCase","setResOptions","resGlobal","setGlobalRes","Action","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","pack","LMR","b","badge","color","badgeAlign","badgeVertical","cursor","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","IconText","iconClass","textClass","__ls","getItem","setItem","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","LocalMap","keyForRemove","removeAll","ks","saveIndex","ls","TuidContent","tuidName","uqStringify","ReactBoxId","isUndefined","valueFromId","boxName","assureBox","tuidValue","nullUI","ttv","divObj","bi","logContent","boxIdContent","Loading","pl","search","decode","decodeURIComponent","match","exec","sUnit","tc","tt","from62","parseInt","isInteger","RegExp","initEnv","detectBrowser","tag","ms","args","global","handle","documentMode","importCLogin","CLogin","importCRegister","CRegister","CForget","IDXEntity","create","owner","SlrForEarning","slope","intercept","slopeR","endY","regress","score","xSum","ySum","xSquared","xY","numerator","ym","predict","y2","chi2","rmsd","ySquared","yi2","yi","yiyi2","sqrt","getHttpChannel","callFetch","put","delete","UQsMan","tvs","uqMans","collection","buildTVs","uqDataArr","uqConfigs","localCacheVersion","cacheVersion","load","retErrors","setTuidImportsLocal","uqConfig","ownerAlias","uqLower","_uqs","buildUQs","uqTVs","lj","uqsData","promiseInits","uqData","uqAlias","uqFullName","UqMan","lower","loadEntities","uqKey","getUqKey","createProxy","Proxy","receiver","showReload","tuidArr","isImport","setInner","tuidImport","fromName","iName","setFrom","appConfig","loadUqs","uqsConfig","tonvaAppName","uqsMan","UQsManApp","localData","uqAppData","loadAppUqs","buildUqs","getRoles","appUqs","VIDSelect","selText","ImageItemEdit","resId","onSaved","mobileRegex","emailRegex","itemObservable","loading","beforeLoad","loaded","allLoaded","topDiv","bottomDiv","isFirst","pageItemAction","itemConverter","scrollToTop","scrollIntoView","scrollToBottom","firstSize","appendPosition","sortOrder","changing","computed","divId","getPageId","loadResults","pageList","reset","isAsc","endItem","scrollToEnd","pushItem","startId","pid","setLoaded","onLoad","setPageStart","onLoaded","reverse","digits","c0","c9","A","Z","NaN","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","_cLoc","_listen","updatePageLinks","_getRoot","_historyUpdate","arg0","arg1","hooks","orderedRoutes","sort","compareUrlDepth","uses","_add","reduce","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","matched","manageHooks","_callLeave","isHashedRoot","m","slice","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","tagName","getLinkPath","preventDefault","status","pause","destroy","as","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","cleanUrl","querySelectorAll","lastRouteResolved","leave","names","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","filter","findMatchedRoutes","colonExp","routeExp","fallbackURL","matched0","cleanGETParam","exHooks","before","shouldRoute","after","onBack","vBack","debugLogout","role","rightView","Tab","selected","contentBuilder","notify","onShown","_content","TabCaptionComponent","tabBg","sep","selectedTab","tabArr","tabClick","tab","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","displayNone","pageHeader","pageFooter","tabBack","display","ResUploader","fileInput","upload","buildFormData","Headers","append","onFilesChange","files","maxSize","FormData","file","multiple","formatSize","pointLength","units","shift","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","resUploader","desImgWidth","desImgHeight","desImgSize","srcImgWidth","srcImgHeight","enableUploadButton","srcImage","desImage","fileError","uploaded","onFileChange","pos","lastIndexOf","reader","FileReader","readAsDataURL","onload","setSize","compress","img","width","height","scale","canvas","createElement","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","showOrgImage","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","disabled","levelDiv","padding","fileSize","uploading","AudioUploader","audioTypes","createBoxId","enums","actions","queries","ids","idxs","ixs","sheets","books","maps","histories","pendings","tags","tuidsCache","localEntities","localModifyMax","tuids","createBoxIdFromTVs","allRoles","actionArr","queryArr","idArr","idxArr","ixArr","enumArr","sheetArr","bookArr","mapArr","historyArr","pendingArr","tagArr","apiParam","tv","prototype","retArr","retActs","ActIX","IXs","ix","ActIXSort","ActDetail","master","detail","detail2","detail3","postParam","toScalars","QueryID","IDXToString","IDNO","IDDetailGet","KeyID","IX1","IXr","KeyIX","IDLog","IDSum","IDxID","ID2","IDTree","TuidsCache","sheet","access","buildTuids","buildAccess","newTuid","allSchemas","fromType","fromObj","defer","cacheTuids","enm","UqEnum","setEntity","TuidImport","TuidInner","book","Book","Map","Tag","History","pending","Pending","Sheet","lName","idEntity","idx","newID","newIDX","newIX","newAction","newQuery","newBook","newMap","newHistory","newSheet","newPending","newTag","newEnum","buildSheet","build","mainFields","buildTuidBox","ownerField","buildTuidDivBox","modifyMax","lk","states","ops","op","discription","SaveCaller","SaveDirectCaller","flow","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","PageStateItems","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","SheetCaller","resVerify","getStateSheets","queryApiName","BookQueryCaller","schemaFrom","actionSchema","querySchema","AddCaller","DelCaller","AllCaller","PageCaller","qc","QueryCaller","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","setUI","Market","Transaction","Group","Account","Holding","Stock","Blog","Industry","StockValue","AccountValue","Portfolio","UserBlockStock","UserAccount","UserGroup","UserAllStock","AccountHolding","GroupStock","IXIndustry","VStockInfo","input","checkLimitShow","ttmLimit","checkShowLater","openMetaView","baseItem","isLogined","code","headStr","head","pageContent","baseInfo","miratesChart","mivaluesChart","predictInfo","seasonEarning","cCommon","cApp","pinStock","renderStockLink","renderPinStock","renderBlockStock","historyChart","trackDay","market","symbol","urlweek","urlmonth","predictData","ypredict","epre","lr2","lpre","chart1","er","ErForEarning","chartdata1","labels","datasets","numberToPrecision","backgroundColor","pointStyle","borderWidth","pointRadius","fill","B","per","lr","plr","chart2","predictChartBonus","chart3","predictChartFullInfo","chart4","predictChartROE","numberToString","predictSeasonDataFull","label3","netprofit","profit","revenue","SeasonnoToYearMonth","zzFunc","eb","ei","eEnd","ed","eav","npZZ","pZZ","rZZ","chartdataFull","chartdataProfit","chartdataRevenue","shares","predictBonusData","mirates","priceList","mirate","yAxisID","scales","yAxes","gridLines","drawOnChartArea","mivalues","mivalue","predictSeasonEarning","esum","corg","eorg","esumorg","numberToFixString","percentToFixString","seasonData","capitalEarning","capital","earning","VIXRight","breakChain","VXIList","onSetIXItem","vIx","renderXi","xi","CXIList","findItem","renderView","XIPageItems","VIXIDList","renderIx","CIXList","IXIDPageItems","radioStyle","TagView","nameFromId","namesFromIds","renderRadio","renderCheck","wrapClassName","inputs","inputName","onInputChange","coll","_view","lines","line","ext","yx","exp","CUqBase","CBase","CUqSub","CSub","CUqApp","CAppBase","testTimesChange","debugItems","VBug","openDebugPage","VConsole","divBottom","autoScrollEnd","autoScroll","lastScrollTop","timeHandler","html","range","createRange","selectNode","objToHtml","createContextualFragment","appendChild","startAutoScrollToBottom","currentItem","pauseAutoScrollToBottom","arrToHtml","indent","objToString","indentVal","objToLine","CBug","getUqRoles","$zh","home","relation","discover","debug","changePassword","aboutTheApp","pleaseLogin","backend","myAll","myBlack","$en","VMain","cHome","cFind","cTrack","cMe","VTester","click","uiItems","CTester","noUnit","VAbout","VEditMe","preValue","userSetProp","onExit","gridRows","component","bk","VFaq","VMe","meInfo","showEditMe","userSpan","faq","about","aboutRows","CMe","unitOwner","rootUnits","$","cRoles","CRoles","showFaq","showAbout","BruceYuMi","HoldingStock","holdingId","quantity","cost","miValue","divident","stockObj","everBought","setQuantity","costPrice","miRateSorter","holdingMiRateSorter","stockMiRateSorter","MiAccount","store","portion","portionAmount","buyableCount","cash","holdingStocks","setPortionAmount","loadItems","buyNewHolding","buyHolding","sellHolding","autorun","yumi","noneStocks","stockFromId","loadMyAll","stockId","holdingStock","recalc","loadStock","saveHolding","addMyAll","hs","orgHs","holdingQuantity","changeCost","bookHolding","holding","accountValue","setAdd","accountHolding","portfolio","transaction","amount","setCostPrice","bookSetCost","sumMiValue","sumMarket","sumDivident","boughtCount","act","cashAct","MiAccounts","accounts","accountName","addHoldingStock","removeHoldingStock","MGroup","group","stocks","groups","internalLoadItems","MiGroup","loadGroupStocks","stockCount","MIndustry","loadIndustryStocks","MRootIndustry","loadRootIndustry","MGroups","MiGroups","calcGroupStockCount","stocksMyAll","groupIXs","groupId","groupStock","userAllStock","addStock","removeStock","MIndustries","MRootIndustries","marketElements","Store","myAllColl","markets","miAccounts","miGroups","industries","rootIndustries","stocksMyBlock","miNet","myAllCaption","myBlockCaption","MiNet","shallow","buildStockValues","SearchStock","StockUsing","accountsFromIds","groupsFromIds","unloadArr","gs","gStockId","stockArr","industryId","rootIndustryId","loadMyBlock","loadMarkets","loadGroupIXs","calcStockCount","nGroup","inGroup","inAccount","keyx","q_getnexttradedays","$orderSwitch","smooth","q_searchstock","VHome","cAccount","showBlogs","renderAccounts","manageAccounts","VAccount","actionsElement","renderPageRight","renderHolding","profitRate","showHolding","showBuy","showSell","showChangeCost","showTransactionDetail","miAccount","vBuyable","buyable","neg","nextSibling","scrollMode","behavior","fString","hideActionsElement","valueToString","holdings","holdings0","showCashIn","showCashOut","showCashAdjust","containerClass","showCashInit","nFormat","format","VForm","form","valueSchema","valueLabel","onCheckValue","onFormSubmit","renderQuantity","dec","beforeRender","onEnter","fieldLabelAlign","renderStock","renderFormTop","VStock","VBuy","checkCash","vComment","VBuyNew","renderStockPick","createPickStockId","submitBuyNew","VBuyExist","submitBuy","VSell","onClickQuantity","formContext","setValue","submitSell","VChangeCost","uiValue","oldPrice","submitChangeCost","VCash","VCashInit","submitCashInit","VCashIn","submitCashIn","VCashOut","submitCashOut","VCashAdjust","submitCashAdjust","VAccounts","onClickAccount","showAccount","renderAccount","VPickStock","onClickStock","onSearch","onSearchStock","CAccount","miGroup","listCaption","buildCIDUserAccount","renderViewRight","showStock","searchStock","cashInit","cashIn","cashOut","cashAdjust","pickStock","VBlogs","renderBlog","blog","$create","onClickBlog","blogs","VBlog","marked","CHome","onStockClick","BlogPageItems","showIntroduction","newSub","StockPageItems","$order","VFind","showA","showHK","showSH","showSZ","showUS","showAll","cGroup","cIndustries","renderButton","renderMyAll","renderGroups","renderIndustries","renderRootIndustries","renderMyBlock","showStocksAll","renderSpec","showStocksBlock","manageGroups","cnStar","VStocksPage","searchInGroup","searchParam","research","openStock","pageStocks","renderStars","initKey","changeSmooth","VGroups","fontStyle","fontSize","onGroupClick","showMiGroup","VRootIndustry","showRootIndustry","VStockList","renderRowRight","vGroups","renderVm","CGroup","_listCaption","buildCIDUserGroup","openStocksList","setStocksList","am","bm","CFind","searchOrder","loadSmooth","VBlockStock","isMyBlock","toggleBlock","VEmpty","VKeepStock","VPinStock","closeLevelWhenRemoved","isMyAll","setStockToGroup","toggleMyAll","VStockInGroup","setGroup","setStockToAccount","stockInAccounts","inAnyGroup","del","removeMyAll","iaa","btn","callbackWhenRemoved","VStockLink","mn","rel","CCommon","loadStockInAccounts","addStockToGroup","removeStockFromGroup","addStockToAccount","removeStockFromAccount","showEmptyPage","rawId","cID","hiden","mId","MidIXID","itemHeader","CID","searchTrackStock","VTrack","onSetTrackDay","onNextTrackDay","CTrack","onPickTrackDay","getNextTradedays","dif","setTime","valueOf","fday","ni","nitem","nday","keyDay","ltd","CApp","cBug","cUI","timer","gapIndex","newC","CStockInfo","App","setSettings","consts","MiApiChannel","MiApi","pbody","proc","miApi","miHost","baseURI","rets","tagId","baseId","orderSwitch","buildFieldItem","$FieldItemType","fieldItemType","VLogout","onLogout","maxLength","VLogin","onLogin","username","sender","getSender","tonvaTop","requiredFlag","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","setError","userLogined","vPage","getVChangePassword","logo","senders","regex","DropdownActions","menu","button","handleDocumentClick","dropdownOpen","toggle","isRight","itemIconClass","itemCaptionClass","hasIcon","some","data-toggle","aria-expanded","captionClass","aria-hidden","onTouchStart","timeRes","md","ymd","yesterday","today","tomorrow","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","appendTime","dPart","hm","EasyTime","SearchBox","allowEmptySearch","inputSize","autoComplete","inputClassName","onFocus","buttonText","userCache","loader","UserView","noneImage","getValue","idProp","useUser","use","Ax","axProps","aClassName","naClassName","openSysPage","cacheTimer","loadIds","clearCacheTimer","cacheIds","tuidCached","innerPullModify","tuidLists","queueModify","queue","modify","modifyIds","selectedTags","_capitalearning","_bonus","_divideInfo","_sharesArr","initLoad","q_stockallinfotrack","q_stockallinfo","arr1","arr3","barr","派息","mvArr","mvr","vlast","volume","miv","mlen","getMivalue","SeasonnoFromDay","mi","ratesArr","rates","mv","loadTTMEarning","LoadBonusData","seasonlist","minNo","seasonno","lastItem","lastShares","maxNo","sItem","yearmonth","GetSeasonnoYearMonth","ci","si","noBegin","predictSeasonData","SeasonnoFromYearMonth","dataOrg","sno","SeasonnoFromDayForBonus","getBonusPrev3","bsum","SeasonnoToBeginEnd","getTotalShares","bs","VEdit","editHeader","VContent","midID","VViewRight","onItemEdit","new","cList","midIDList","valueChanged","renderListRight","renderListTop","renderListBottom","onItemView","onItemNew","createMidIDList","createCList","MidIDList","listPageItems","MidIXIDList","MidID","MidIDXList","week","midIDX","renderStringProp","renderNumberProp","spanValues","VEditNumberField","dateInput","timeInput","onValueChange","onSave","valueAsDate","dateTicks","valueAsNumber","timeTicks","saveFieldValue","vDateTime","time","defDate","VHistory","historyItems","VHistoryPage","spans","graphOptions","maintainAspectRatio","VView","currentIndex","timeSpan","prevTimeSpan","nextTimeSpan","toJS","curProp","moveStep","spanStep","canNext","borderBottomStyle","borderBottomColor","onFieldHistory","sv","onFieldClick","setTimeSpan","showFieldHistory","setCurrentField","CIXXList","midIXList","MidIXList","MidIX","CIXX","midIX","idList","CIXXEdit","cIXList","onListRightClick","cSelect","idItem","VSelect","tagGroups","midTag","typeColl","itemTags","typeArr","midType","checks","tagGroup","sub","renderType","onTagSelectChanged","CSelect","cIDTagList","defaultRenderTags","ItemTagsListPageItems","VTags","allTags","checkInputs","showID","CShowTagIDList","MidTagIDList","VRoles","onRoleAdmin","showRoleAdmin","onAccountant","onManager","roleItems","accountant","manager","renderRoleItem","VAddUser","newUser","VRoleAdmin","userRole","rightIcon","isDeleted","roleCaptions","ixOfUsers","vUser","restoreUser","deleteUser","vCap","onRoleChange","ixUserBind","userRoles","VItem","VUserRoles","MeItem","meRoles","iRole","setUserRole","CRoleAdmin","myRolesChanged","roleCaptionMap","ixName","getIX","id2Name","getID","cIXEdit","getAllRoleUsers","allUserRoles","rolesBool","meId","ur","setUserRoles","fireMyRolesChanged","newRoles","roleNames","userFromKey","buildRolesText","deleteUserRoles","cRoleAdmin","getRes","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","Widget","fieldProps","_ui","errors","contextErrors","visible","isChanging","changeValue","container","inNode","FieldContainer","renderBody","hasError","isOk","getUiItem","buildRules","removeErrorWidget","addErrorWidget","initData","fromElement","prev","allowChange","setDataValue","setElementValue","fieldClass","FieldClass","elDiscription","discriptionClassName","uiLabel","errorList","TextWidget","inputType","hasFocus","onKeyDown","internalOnKeyDown","keyCode","blur","onBlur","checkRules","checkContextRules","clearErrors","renderTemplet","renderErrors","TextAreaWidget","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","SelectWidget","select","option","RadioWidget","rowKey","isRow","RangeWidget","IdWidget","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","observerRender","widgetType","ButtonClass","Context","subContexts","widgets","errorWidgets","arrRowContexts","itemName","getDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","ew","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","checkHasError","clearContextErrors","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","$isDeleted","editContainer","Provider","ImageWidget","imageSrc","TagWidget","stringWidget","widgetFactories","string","textarea","datetime","email","updown","checkbox","image","checkboxes","radio","tagSingle","valuesView","renderRadios","tagMulti","defaultArr","def","renderChecks","typeWidget","getItemSchema","getTypeWidget","widgetFactory","WidgetClass","Form","Container","watch","calcSelectOrDelete","DefaultContainer","DefaultFieldContainer","labelView","cnAlign","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","contextType","StringItemEdit","verifyValue","inputOptions","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","VIDX","VErrorsPage","VStartError","uqsUser","afterBuiltUQs","onNavRoutes","initUQs","resolveRoute","userFromId","getUqUserRoles","setUqRoles","isRole","_cApp","wn","getWebNav","_owner","ownerWNs","own","ListBase","Clickable","Static","Selectable","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","labelId","comp","selectItem","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","List","listBase","buildBase","prevProps","prevState","isEqual","forceUpdate","selectAll","unselectAll","waitingMore","tabIndex","isLoading","staticRow","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","_prop","col","labelFixLeft","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","PropView","buildRows","isGap","setValues","PropGrid","propView","VIDXHistory","IdCache","tuidLocal","localArr","waitingIds","tuidInner","initLocalArr","has","moveToHead","_id","useId","tuidValues","cacheIdValues","unpackTuidIds","cacheValue","cacheTuidFieldValues","loadTuidIdsOrLocal","localedValues","loadingIds","netIds","loadTuidIds","netRet","IdDivCache","divName","Tuid","noCache","typeName","idName","unique","TuidBox","id1","idValue","divs","cacheFields","idCache","tuidDiv","TuidDiv","resetCache","assureObj","IdsCaller","GetCaller","cacheFieldsInValue","arrValues","$update","stampOnMain","unpackTuidIdsOfFields","SavePropCaller","searchArr","SearchCaller","LoadArrCaller","SaveArrCaller","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","hasDiv","loadMain","save","saveProp","loadArr","saveArr","posArr","TuidBoxDiv","buildTsUqFolder","uqsFolder","uqFolder","mkdirSync","tsUq","buildUQ","saveTsIndexAndRender","imports","sets","cName","tsUI","buildFields","tsFieldArr","buildFieldArr","replaceTsFileFields","tsImportFieldItemsBegin","tsImportFieldItemsEnd","replaceTsFileString","tsIndex","buildIDFields","buildIDXFields","buildIXFields","ts","buildIDFieldArr","buildIDXFieldArr","buildIXFieldArr","readFileSync","startStr","lBrace","rBrace","fieldsText","buildFieldsFromOldText","fieldItemReplaceProps","oldText","setFieldOldProp","buildFieldText","fieldStart","fieldText","eval","sec","tsImport","appendArr","tsBuild","tsLen","uqEntityInterface","buildEnumInterface","buildTuidInterface","buildActionInterface","buildSheetInterface","buildQueryInterface","buildBookInterface","buildMapInterface","buildHistoryInterface","buildPendingInterface","buildTagInterface","buildIDInterface","buildIDXInterface","buildIDXActParamInterface","buildIXInterface","buildActsInterface","uqBlock","buildTuid","buildAction","buildBook","buildQuery","buildMap","buildHistory","buildPending","buildTag","buildID","buildIDX","buildIX","buildInterface","entityCode","isInID","buildField","fieldTypeMap","sysFields","q","repeat","buildArrs","af","buildReturns","retName","schemaKeys","others","hasTrack","hasMemo","exField","track","memo","currency","No","Name","resRaw","Portion","uno","pvolumn","incValue","gMiRate","gMiValue","gIncValue","gInc1","gInc2","gInc3","gInc4","gPreInc","gSmoothness","rMiRate","rMiValue","rIncValue","rInc1","rInc2","rInc3","rInc4","rPreInc","rSmoothness","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode"],"mappings":"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","file":"static/js/main.843f2a81.chunk.js","sourcesContent":["export * from './tool';\r\nexport * from './net';\r\nexport * from './components';\r\nexport * from './auth';\r\nexport * from './uq';\r\nexport * from './app';\r\nexport * from './vm';\r\nexport * from './res';\r\nexport * from './ui';\r\n","\r\nconst zero = '00000000000000';\r\nexport function left0(num:number, fix:number) {\r\n    if (num === undefined) return '';\r\n    let r = num.toString();\r\n    let len = fix - r.length;\r\n    if (len <= 0) return r;\r\n    return zero.substr(0, len) + r;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","export function capitalCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('');\r\n}\r\n\r\nexport function camelCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i=1; i<len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('');\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n","export * from './navigo';\r\nexport * from './nav';\r\nexport * from './page';\r\nexport * from './schema';\r\nexport * from './form';\r\nexport * from './edit';\r\nexport * from './loading';\r\nexport * from './image';\r\nexport * from './resUploader';\r\nexport * from '../tool/rules';\r\nexport * from './list';\r\nexport * from './dropDownActions';\r\nexport * from './easyDate';\r\nexport * from './propGrid';\r\nexport * from './simple';\r\nexport * from './media';\r\nexport * from './searchBox';\r\nexport * from './userIcon';\r\nexport * from './ax';\r\nexport * from './autoHideTips';\r\nexport * from './login';","import * as React from 'react';\r\n\r\nexport class GFunc {\r\n    public static numberToFixString(n: number, w = 2) {\r\n        return n === undefined ? '' :\r\n            (isNaN(n) === true ? '-' : n.toFixed(w));\r\n    }\r\n    public static number(n: number, w = 2) {\r\n        return n === undefined ? '' :\r\n            (isNaN(n) === true ? '-' : n.toFixed(w));\r\n    }\r\n\r\n    public static numberToMarketValue(n: number) {\r\n        return n === undefined || isNaN(n) ? '' : Math.round(n / 10000).toString(); // + '亿';\r\n    }\r\n\r\n    public static numberToString(n: number, precision = 2) {\r\n        return n === undefined ? '' :\r\n            (isNaN(n) === true ? '-' : n.toPrecision(precision));\r\n    }\r\n\r\n    public static numberToPrecision(n: number, precision = 4) {\r\n        return n === undefined ? undefined : Number.parseFloat(n.toPrecision(precision));\r\n    }\r\n\r\n    public static percentToFixString(n: number) {\r\n        return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(2) + '%';\r\n    }\r\n\r\n    public static percent0(n: number) {\r\n        return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(0) + '%';\r\n    }\r\n    public static percent1(n: number) {\r\n        return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(1) + '%';\r\n    }\r\n\r\n    public static warningTypeString(t: string) {\r\n        switch (t) {\r\n            case 'gt': return '大于';\r\n            case 'lt': return '小于';\r\n            default: return t;\r\n        }\r\n    }\r\n\r\n    public static predictCutRatio(r2: number) {\r\n        return r2 * 2 - r2 * r2;\r\n    }\r\n\r\n    public static evaluatePricePrice(iRate: number, e1: number, e2: number, e3: number) {\r\n        let r = 1 + iRate;\r\n        let r2 = r * r;\r\n        let r3 = r2 * r;\r\n        return (e1 / r + e2 / r2 + e3 / r3 + e3 / iRate / r3) / 2;\r\n    }\r\n\r\n    public static calculateV(z: number, divyield: number, pe: number) {\r\n        if (pe === undefined || isNaN(pe)) {\r\n            return undefined;\r\n        }\r\n\r\n        let r = 0;\r\n        if (z !== undefined) {\r\n            if (z > 0.25) {\r\n                z = 0.25;\r\n            }\r\n            r += z * 100;\r\n        }\r\n        if (divyield !== undefined) {\r\n            r += divyield * 100;\r\n        }\r\n        return r / pe;\r\n    }\r\n\r\n    public static calculateVN(z: number, e: number, bonus: number, price: number) {\r\n        if (price === undefined || isNaN(price) || e === undefined || isNaN(e)) {\r\n            return undefined;\r\n        }\r\n\r\n        let r = 0;\r\n        if (z !== undefined && e > 0) {\r\n            if (z > 0.25) {\r\n                z = 0.24 + Math.pow((z - 0.24) * 100, 0.6667) / 100;\r\n            }\r\n            z = 1 + z;\r\n            z = z * z * z - 1;\r\n            r += z * e * 100;\r\n        }\r\n        if (bonus !== undefined && !isNaN(bonus)) {\r\n            r += bonus * 100;\r\n        }\r\n        return r / price;\r\n    }\r\n\r\n    public static calculateVS(ev: number, bonus: number, price: number) {\r\n        if (price === undefined || isNaN(price)) {\r\n            return undefined;\r\n        }\r\n\r\n        if (ev === undefined || isNaN(ev)) {\r\n            if (bonus === undefined || isNaN(bonus)) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return bonus * 100 / price;\r\n            }\r\n        }\r\n        else {\r\n            if (bonus === undefined || isNaN(bonus)) {\r\n                return ev * 100 / price;\r\n            }\r\n            else {\r\n                return (bonus + ev) * 100 / price;\r\n            }\r\n        }\r\n    }\r\n\r\n    public static calculateZZ3(data: number[]) {\r\n        let ret: number[] = [undefined, undefined, undefined, undefined];\r\n        if (data === undefined)\r\n            return ret;\r\n        let len = data.length;\r\n        if (len < 5)\r\n            return ret;\r\n\r\n        let funcz = (n: number, p: number) => {\r\n            if (p <= 0 || n <= 0)\r\n                return undefined;\r\n            return ((n / p) - 1);\r\n        }\r\n        for (let i = 0; i < 4; ++i) {\r\n            ret[i] = funcz(data[i + 1], data[i]);\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public static caption = (value: string) => <span className=\"text-muted small\">{value}</span>;\r\n\r\n    public static MonthnoFromDay(day: number) {\r\n        let year = Math.floor(day / 10000);\r\n        let month = Math.floor((day % 10000) / 100) - 1;\r\n        return (year - 1995) * 12 + month;\r\n    }\r\n\r\n    public static SeasonnoFromDay(day: number) {\r\n        let year = Math.floor(day / 10000);\r\n        let month = Math.floor((day % 10000) / 100) - 1;\r\n        let season = Math.floor(month / 3);\r\n        return (year - 1995) * 4 + season;\r\n    }\r\n\r\n    public static SeasonnoFromDayForBonus(day: number) {\r\n        let year = Math.floor(day / 10000);\r\n        let month = Math.floor((day % 10000) / 100) - 1;\r\n        if (month < 4) {\r\n            month = 0;\r\n        }\r\n        else if (month < 7) {\r\n            month = 3;\r\n        }\r\n        else if (month < 10) {\r\n            month = 6;\r\n        }\r\n        let season = Math.floor(month / 3);\r\n        return (year - 1995) * 4 + season;\r\n    }\r\n    \r\n\r\n    public static SeasonnoFromYearMonth(year: number, month: number) {\r\n        let season = Math.floor((month - 1) / 3);\r\n        return (year - 1995) * 4 + season;\r\n    }\r\n\r\n    public static SeasonnoToYearMonth(no: number) {\r\n        let year = Math.floor(no / 4) + 1995;\r\n        let month = (Math.floor(no % 4) + 1) * 3;\r\n        return year * 100 + month;\r\n    }\r\n\r\n    public static GetSeasonnoYearMonth(no: number) {\r\n        let year = Math.floor(no / 4) + 1995;\r\n        let month = (Math.floor(no % 4) + 1) * 3;\r\n        return { year: year, month: month };\r\n    }\r\n\r\n    public static SeasonnoToBeginEnd(season: number) {\r\n        let year = (1995 + Math.floor(season / 4)) * 10000;\r\n        let s = season % 4;\r\n        if (s === 0) {\r\n            return { begin: year + 101, end: year + 331 };\r\n        }\r\n        else if (s === 1) {\r\n            return { begin: year + 401, end: year + 630 };\r\n        }\r\n        else if (s === 2) {\r\n            return { begin: year + 701, end: year + 930 };\r\n        }\r\n        return { begin: year + 1001, end: year + 1231 };\r\n    }\r\n\r\n    public static CalculateValueAvg(arr: { v: number }[]) {\r\n        let ret: { avg20: number, avg50: number, avg100: number, avg: number } = { avg20: undefined, avg50: undefined, avg100: undefined, avg: undefined };\r\n\r\n        let length = arr.length;\r\n        let calcuOne = (count: number): number => {\r\n            let endIndex = count;\r\n            if (count === 0 || endIndex > length)\r\n                endIndex = length;\r\n            if (endIndex >= 10) {\r\n                let sum = 0;\r\n                for (let i = 3; i < endIndex; ++i) {\r\n                    sum += arr[i].v;\r\n                }\r\n                return sum / (endIndex - 3);\r\n            }\r\n            else {\r\n                return undefined;\r\n            }\r\n        }\r\n\r\n        ret.avg20 = calcuOne(20);\r\n        ret.avg50 = calcuOne(50);\r\n        ret.avg100 = calcuOne(100);\r\n        ret.avg = calcuOne(0);\r\n        return ret;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {makeObservable, observable} from 'mobx';\r\nimport _ from 'lodash';\r\nimport {User, Guest/*, UserInNav*/} from '../tool/user';\r\nimport {Page} from './page/page';\r\nimport {netToken} from '../net/netToken';\r\nimport FetchErrorView, { SystemNotifyPage } from './fetchErrorView';\r\nimport {FetchError} from '../net/fetchError';\r\nimport {LocalData, env} from '../tool';\r\nimport {guestApi, logoutApis, setCenterUrl, setCenterToken, host, resUrlFromHost, messageHub} from '../net';\r\nimport { resOptions } from '../res/res';\r\nimport { Loading } from './loading';\r\nimport { Navigo, RouteFunc, Hooks, NamedRoute } from './navigo';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { FA } from './simple';\r\nimport { userApi } from '../net';\r\nimport { ReloadPage, ConfirmReloadPage } from './reloadPage';\r\nimport { PageWebNav } from './page';\r\nimport { createLogin, Login, showForget, showRegister } from './login';\r\n\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\nexport type NavPage = (params:any) => Promise<void>;\r\n\r\nexport interface Props\r\n{\r\n    onLogined: (isUserLogin?:boolean)=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n\tuserPassword?: () => Promise<{user:string; password:string}>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface NavViewState {\r\n\tnotSupportedBrowser: boolean;\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError\r\n}\r\n\r\nconst notSupportedBrowsers = ['IE'];\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props:Props) {\r\n        super(props);\r\n        this.stack = [];\r\n\t\tlet {browser} = env;\r\n\t\tlet notSupportedBrowser = notSupportedBrowsers.findIndex(v => v === browser) >= 0;\r\n        this.state = {\r\n\t\t\tnotSupportedBrowser,\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        nav.set(this);\r\n    }\r\n    async componentDidMount()\r\n    {\r\n\t\tif (this.state.notSupportedBrowser === true) return;\r\n\t\twindow.addEventListener('popstate', this.navBack);\r\n\t\tawait nav.init();\r\n        await nav.start();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    env.clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n\t\t\t\tawait nav.showLogin(undefined);\r\n\t\t\t\t//nav.navigateToLogin();\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await nav.showLogin(undefined);\r\n\t\t\t\t\t//nav.navigateToLogin();\r\n                    return;\r\n                case 'sheet-processing':\r\n                    nav.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.setState({\r\n            fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        nav.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length >0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len-1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey():number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len-1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n\t\tif (item === undefined) return;\r\n\t\t//if (nav.isRouting) {\r\n\t\t//\twindow.history.back();\r\n\t\t//}\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now()-tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm:boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {notSupportedBrowser, wait, fetchError} = this.state;\r\n\t\tif (notSupportedBrowser === true) {\r\n\t\t\treturn <div className=\"p-3 text-danger\">\r\n\t\t\t\t{env.browser} not supported !\r\n\t\t\t</div>;\r\n\t\t}\r\n        let {stack} = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError) {\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n\t\t\t++top;\r\n\t\t}\r\n        let test = nav.testing===true && \r\n\t\t\t<span className=\"cursor-pointer position-fixed\" style={{top:0,left:'0.2rem',zIndex:90001}}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n\t\t\t</span>;\r\n        return <>\r\n\t\t\t{stack.map((item, index) => {\r\n\t\t\t\tlet {key, view} = item;\r\n\t\t\t\treturn <div key={key} style={index<top? {visibility: 'hidden', position: 'absolute'}:undefined}>\r\n\t\t\t\t\t{view}\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t\t{elWait}\r\n\t\t\t{elError}\r\n\t\t\t{test}\r\n\t\t</>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({stack: this.stack });\r\n    }\r\n}\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n    privacy?: string;\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport class Nav {\r\n    private navView:NavView;\r\n\tprivate wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\tnavSettings: NavSettings;\r\n    user: User = null;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tuser: observable,\r\n\t\t});\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n\t\tthis.testing = false;\r\n    }\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n\r\n    set(navView:NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n\t}\r\n\t/*\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        //if (this.ws === undefined) return;\r\n        return messageHub.onReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        //if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        messageHub.endReceive(handlerId);\r\n    }\r\n\t*/\r\n    async onReceive(msg:any) {\r\n        //if (this.ws === undefined) return;\r\n        await messageHub.dispatch(msg);\r\n    }\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n    private async getPredefinedUnitName() {\t\t\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName:string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({id: unitId, name: unitName});\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n\t\tlet {htmlTitle} = settings;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\r\n    get oem():string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath():string {\r\n        let {origin, pathname} = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (pathname.endsWith(item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length-1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n\t}\r\n\r\n\tforceDevelopment:boolean;\r\n\t\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tif (this.forceDevelopment === true) {\r\n\t\t\tenv.isDevelopment = true;\r\n\t\t}\r\n\t\tawait host.start(this.testing);\r\n\t\t/*\r\n\t\tlet hash = document.location.hash;\r\n\t\tif (hash !== undefined && hash.length > 0) {\r\n\t\t\tlet pos = getExHashPos();\r\n\t\t\tif (pos < 0) pos = undefined;\r\n\t\t\tthis.hashParam = hash.substring(1, pos);\r\n\t\t}\r\n\t\t*/\r\n\t\tlet {url, ws, resHost} = host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = resUrlFromHost( resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tsetCenterUrl(url);\r\n\r\n\t\tlet guest:Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tnav.setGuest(guest);\r\n\t}\r\n\r\n\treloadUser = () => {\r\n\t\tlet user: User = this.local.user.get();\r\n\t\tlet curUser = nav.user;\r\n\t\tif (!user && !curUser) return;\r\n\t\tif (user?.id === curUser?.id) return;\r\n\t\tif (!user) {\r\n\t\t\tnav.logout();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnav.logined(user);\r\n\t\t}\r\n\t}\r\n\r\n    async start() {\r\n        try {\r\n\t\t\twindow.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n\t\t\twindow.onfocus = this.reloadUser;\r\n            if (env.isMobile === true) {\r\n                document.onselectstart = function() {return false;}\r\n                document.oncontextmenu = function() {return false;}\r\n            }\r\n            //window.setInterval(()=>console.error('tick every 5 seconds'), 5000);\r\n\t\t\tnav.clear();\r\n\t\t\t//nav.onSysNavRoutes();\r\n\t\t\tthis.startWait();\r\n            \r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                let {userPassword} = this.navView.props;\r\n\t\t\t\tif (userPassword) {\r\n\t\t\t\t\tlet ret = await userPassword();\r\n\t\t\t\t\tif (ret) {\r\n\t\t\t\t\t\tlet {user:userName, password} = ret;\r\n\t\t\t\t\t\tlet logindUser = await userApi.login({\r\n\t\t\t\t\t\t\tuser: userName,\r\n\t\t\t\t\t\t\tpwd: password,\r\n\t\t\t\t\t\t\tguest: nav.guest,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuser = logindUser;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (user === undefined) {\r\n\t\t\t\t\tlet {notLogined} = this.navView.props;\r\n\t\t\t\t\tif (notLogined !== undefined) {\r\n\t\t\t\t\t\tawait notLogined();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tawait nav.showLogin(undefined);\r\n\t\t\t\t\t\t//nav.navigateToLogin();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n            }\r\n\r\n            await nav.logined(user);\r\n        }\r\n        catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprivate navLogin:NavPage = async (params:any) => {\r\n\t\tnav.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout:NavPage = async (params:any) => {\r\n\t\tnav.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister:NavPage = async (params:any) => {\r\n\t\tnav.showRegister();\r\n\t}\r\n\r\n\tprivate navForget:NavPage = async (params:any) => {\r\n\t\tnav.showForget();\r\n\t}\r\n\r\n\tnavigateToLogin() {\r\n\t\tnav.navigate('/login');\r\n\t}\r\n\r\n\topenSysPage(url: string):boolean {\r\n\t\tlet navPage: NavPage = this.sysRoutes[url];\r\n\t\tif (navPage === undefined) {\r\n\t\t\t//alert(url + ' is not defined in sysRoutes');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tnavPage(undefined);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate navPageRoutes: {[url:string]: NavPage};\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.isWebNav) nav.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tprivate doneSysRoutes:boolean = false;\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\t/*\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\t*/\r\n\tonNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (this.doneSysRoutes === false) {\r\n\t\t\tthis.doneSysRoutes = true;\r\n\t\t\tthis.internalOnNavRoutes(this.sysRoutes);\r\n\t\t}\r\n\t\tthis.internalOnNavRoutes(navPageRoutes);\r\n\t}\r\n\r\n\tprivate internalOnNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = _.merge(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n\tisWebNav:boolean = false;\r\n\tbackIcon = <i className=\"fa fa-angle-left\" />;\r\n\tcloseIcon = <i className=\"fa fa-close\" />;\r\n\tsetIsWebNav() {\r\n\t\tthis.isWebNav = true;\r\n\t\tthis.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n\t\tthis.closeIcon = <i className=\"fa fa-close\" />;\r\n\t}\r\n\r\n\tpageWebNav: PageWebNav;\r\n\r\n\tnavigate(url:string, absolute?:boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) {\r\n\t\t\turl += '#test';\r\n\t\t}\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n    async showAppView(isUserLogin?: boolean) {\r\n        let {onLogined} = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        netToken.set(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n\tsetUqRoles(uq:string, roles:string[]) {\r\n\t\tlet {roles:userRoles} = this.user;\r\n\t\tif (!userRoles) {\r\n\t\t\tthis.user.roles = {};\r\n\t\t}\r\n\t\tthis.user.roles[uq] = roles;\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n    async loadMe() {\r\n        let me = await userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n\tprivate async internalLogined(user: User, callback: (user:User)=>Promise<void>, isUserLogin:boolean) {\r\n        logoutApis();\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n\t\tnetToken.set(user.id, user.token);\r\n\t\tnav.clear();\r\n\r\n\t\tawait this.onChangeLogin?.(this.user);\r\n        if (callback !== undefined) {\r\n            await callback(user);\r\n\t\t}\r\n        else if (this.isWebNav === true) {\r\n\t\t\tthis.navigate('/index');\r\n\t\t}\r\n\t\telse {\r\n            await this.showAppView(isUserLogin);\r\n        }\r\n\t}\r\n\r\n\tonChangeLogin: (user:User) => Promise<void>;\r\n\r\n\t// 缓冲登录\r\n    async logined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n    }\r\n\r\n\t// 用户操作之后登录\r\n    async userLogined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n    }\r\n\r\n    loginTop(defaultTop:JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent():string {\r\n        if (!this.navSettings) return;\r\n        let {privacy} = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            nav.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        //let html = await this.getPrivacy(privacy);\r\n\t\t//let content = {__html: marked(html)};\r\n\t\tlet content = {__html: htmlString};\r\n        nav.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n\tprivate createLogin = createLogin;\r\n\tsetCreateLogin(createLogin: ()=>Promise<Login>) {\r\n\t\tthis.createLogin = createLogin;\r\n\t}\r\n\r\n\tprivate login: Login;\r\n\tprivate async getLogin():Promise<Login> {\r\n\t\tif (this.login) return this.login;\r\n\t\treturn this.login = await this.createLogin();\r\n\t}\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogin(callback, withBack);\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogout(callback);\r\n\t}\r\n\t\r\n\tasync showRegister() {\r\n\t\tshowRegister();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tshowForget();\r\n\t}\r\n\r\n    async logout(callback?:()=>Promise<void>) { //notShowLogin?:boolean) {\r\n\t\tthis.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        let guest = this.local.guest.get();\r\n        setCenterToken(0, guest && guest.token);\r\n\t\tthis.clear();\r\n        if (callback === undefined)\r\n            await nav.start();\r\n        else\r\n            await callback();\r\n\t\tthis.onChangeLogin?.(undefined);\r\n\t}\r\n\r\n    async changePassword() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showChangePassword();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.navView.level;\r\n    }\r\n    startWait() {\r\n        this.navView?.startWait();\r\n    }\r\n    endWait() {\r\n        this.navView?.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.navView.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.navView.showUpgradeUq(uq, version);\r\n    }\r\n\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.navView.pop(level);\r\n    }\r\n    topKey():number {\r\n        return this.navView.topKey();\r\n    }\r\n    popTo(key:number) {\r\n        this.navView.popTo(key);\r\n    }\r\n    clear() {\r\n        this.navView?.clear();\r\n    }\r\n    navBack() {\r\n        this.navView.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.navView.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.navView.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.navView.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.navView.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.navView.confirmBox(message);\r\n\t}\r\n\t/*\r\n    async navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n            let uh = sheetId === undefined?\r\n                    appUrl(url, unitId) :\r\n                    appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={()=>this.back()}/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>, \r\n            ()=> {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n\t}\r\n\t*/\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n\t\tthis.push(<ReloadPage message={msg} seconds={seconds} />);\r\n\t\t/*\r\n\t\tif (seconds > 0) {\r\n\t\t\tenv.setTimeout(undefined, this.reload, seconds*1000);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting:Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration =await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok:boolean):Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t/*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n\t\t\t\tthis.local.saveToLocalStorage();\r\n\t\t\t\t*/\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion():Promise<string> {\r\n        let {href} = document.location;\r\n        href += (href.indexOf('?')>=0? '&':'?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n\r\nexport class TonvaView extends NavView {\r\n\r\n}\r\n","\r\nimport {setCenterToken} from './uqApi';\r\nimport {WSChannel} from './wsChannel';\r\n\r\nexport const netToken = {\r\n    set(userId:number, token:string) {\r\n        setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    },\r\n    clear() {\r\n        setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport {FetchError} from '../net/fetchError';\r\nimport { refetchApi } from '../net';\r\nimport { Page } from './page/page';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n        let errContent:any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div className=\"tv-page\">\r\n            <article>\r\n\t\t\t\t<main className=\"va-error p-3\">\r\n\t\t\t\t\t<div>网络出现问题</div>\r\n\t\t\t\t\t<div>点击重新访问</div>\r\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\r\n\t\t\t\t\t{errContent}\r\n\t\t\t\t\t<div className=\"p-3 text-center\">\r\n\t\t\t\t\t<button className=\"btn btn-primary mr-3\" type='button' onClick={this.close}>关闭</button>\r\n\t\t\t\t\t\t<button className=\"btn btn-outline-primary\" type='button' onClick={this.reApi}>重试</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler:any;\r\n    constructor(props:Props) {\r\n\t\tsuper(props);\r\n\t\tlet {seconds} = props;\r\n\t\tif (seconds===undefined) return;\r\n        this.state = {seconds};\r\n\t\tif (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n\t\t\tlet {seconds} = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({seconds: seconds});\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        nav.reload();\r\n    }\r\n    render() {\r\n\t\tlet {seconds} = this.state;\r\n\t\tlet title:string, msg:string;\t\t\r\n\t\tif (seconds > 0) {\r\n\t\t\ttitle = '程序升级中...';\r\n\t\t\tmsg = this.state.seconds + '秒钟之后自动重启动';\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttitle = '程序需要升级';\r\n\t\t\tmsg = '请点击下面按钮重启';\r\n\t\t}\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n\t\t\t\t\t<span className=\"text-danger\">{title}</span>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t{msg}\r\n                    <br/>\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean)=>Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps):JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger mr-3\" onClick={()=>props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import { decodeGuestToken } from '../tool/user';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n\r\nexport const guestApi = new GuestApi('tv/guest/', undefined);\r\n","export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, waiting: boolean) {\r\n        this._params = params;\r\n        this.waiting = waiting;\r\n    }\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","import {CenterApiBase} from './uqApi';\r\n\r\nclass CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n\t}\r\n\tasync userFromKey(userName:string):Promise<any> {\r\n\t\treturn await this.get('tie/user-from-key', {key:userName});\r\n\t}\r\n}\r\n\r\nexport const centerApi = new CenterApi('tv/', undefined);\r\n","import fs from 'fs';\r\nimport { capitalCase } from \"../../tool\";\r\nimport { UqMan } from \"../uqMan\";\r\nimport { BuildContext } from './context';\r\n\r\nexport const red = '\\x1b[41m%s\\x1b[0m';\r\nexport let lastBuildTime:number = 0;\r\n//export const uqTsSrcPath = 'src/UqApp';\r\n\r\nexport function saveSrcTsFileIfNotExists(context:BuildContext, fileName:string, suffix:string, content:string) {\r\n\tlet tsFilePath = `${context.uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tsaveTsFileIfNotExists(tsFilePath, content);\r\n\t//if (fs.existsSync(tsFile) === true) return;\r\n\t//saveTsFile(fileName, content, suffix);\r\n}\r\nexport function saveTsFile(context:BuildContext, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet {uqTsSrcPath} = context;\r\n\tlet srcFile = `${uqTsSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nexport function overrideTsFile(path:string, content:string) {\r\n\t//let tsFile = `${path}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(path, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${path} is built`);\r\n}\r\n//fileName:string, \r\n//, suffix:string = 'ts'\r\nexport function saveTsFileIfNotExists(tsFilePath:string, content:string) {\r\n\t//let tsFilePath = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFilePath) === true) return;\r\n\toverrideTsFile(tsFilePath, content);\r\n}\r\n\r\n/*\r\nfunction createTsFile(path:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet tsFile = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\n*/\r\nexport function buildTsHeader() {\r\n\treturn `//=== UqApp builder created on ${new Date()} ===//`;\r\n}\r\n\r\nexport function entityName(s:string):string {\r\n\treturn capitalCase(s);\r\n}\r\n\r\nexport function getNameFromUq(uqMan:UqMan):{devName:string; uqName:string} {\r\n\tlet {config} = uqMan;\r\n\tlet devPart:string, uqPart:string;\r\n\tif (config) {\r\n\t\tlet {dev, name, alias} = config;\r\n\t\tlet {name:devName, alias:devAlias} = dev;\r\n\t\tdevPart = devAlias || devName;\r\n\t\tuqPart = alias || name;\r\n\t}\r\n\telse {\r\n\t\tlet {uqOwner, uqName} = uqMan;\r\n\t\tdevPart = uqOwner;\r\n\t\tuqPart = uqName;\r\n\t}\r\n\treturn {\r\n\t\tdevName: capitalCase(devPart),\r\n\t\tuqName: capitalCase(uqPart),\r\n\t};\r\n}\r\n","/*eslint @typescript-eslint/no-unused-vars: [\"off\", { \"vars\": \"all\" }]*/\r\nimport { FA } from 'tonva-react';\r\nimport { Stock, StockValue } from 'uq-app/uqs/BruceYuMi';\r\nimport { NStockInfo } from '../stockinfo';\r\n\r\nfunction renderValue(caption:string, value:number, valueType:'p0'|'p1'|'n1'|'n2'|'yi'):JSX.Element {\r\n\tconst _cn = 'px-2 px-sm-3 mb-1 text-right '; \r\n\tlet cn = _cn + 'c5';\r\n\tlet cnYI = _cn + 'c5'\r\n\tlet vStr:string;\r\n\tif (isNaN(value) === true) {\r\n\t\tvStr = '-'\r\n\t}\r\n\telse {\r\n\t\tswitch (valueType) {\r\n\t\t\tcase 'p0': vStr = percent0(value); break;\r\n\t\t\tcase 'p1': vStr = percent1(value); break;\r\n\t\t\tcase 'n1': vStr = number(value, 1); break;\r\n\t\t\tcase 'n2': vStr = number(value, 2); break;\r\n\t\t\tcase 'yi': \r\n\t\t\t\tvStr = numberToMarketValue(value);\r\n\t\t\t\tcn = cnYI;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treturn <div key={caption} className={cn}>\r\n\t\t<span className=\"text-muted small\">{caption}</span><br />\r\n\t\t{vStr}\r\n\t</div>;\r\n}\r\n\r\nexport function renderStockName(stock: Stock):JSX.Element {\r\n\tlet { name, no } = stock;\r\n\tlet $market = (stock as any).$market;\r\n\treturn <>\r\n\t\t{$market && <>{$market.el}&nbsp;</>}\r\n\t\t<span className=\"text-primary\">{name}</span>\r\n\t\t&nbsp; \r\n\t\t<span className=\"text-info\">{no}</span>\r\n\t\t&nbsp;\r\n\t</>;\r\n}\r\n\r\nexport const smallPercent = <small>%</small>;\r\n\r\nexport function renderStockRow(order: number, stock: Stock&StockValue, onClickName: (stock:Stock&StockValue) => void, right:JSX.Element):JSX.Element {\r\n\tlet { roe, price, dvRate, miRate, volumn, ttm, inc1, inc2, inc3, inc4, preInc, smoothness } = stock;\r\n\tlet stars = [0,0,0,0];\r\n\tfor (let i=2; i<=smoothness; i++) stars[i-2] = 1;\r\n\tlet left = <div className=\"cursor-pointer align-self-center flex-grow-1\" onClick={()=>onClickName?.(stock)}>\r\n\t\t{order && <><small className=\"mr-2 text-danger\">{order}</small>&nbsp;</>}\r\n\t\t{renderStockName(stock)}\r\n\t\t<div className=\"bg-light px-3 small d-block d-sm-inline-block\">\r\n\t\t\t{\r\n\t\t\t\tstars.map((v, index) => v===1?\r\n\t\t\t\t\t<FA key={index} \r\n\t\t\t\t\t\tname='star-o' \r\n\t\t\t\t\t\tclassName={'small px-1 ' + (v===1? 'text-warning':'text-muted')} />\r\n\t\t\t\t\t:\r\n\t\t\t\t\tnull )\r\n\t\t\t}\r\n\t\t</div>\r\n\t</div>;\r\n\tlet rows:[string,number,'p0'|'p1'|'n1'|'n2'|'yi'][] = [\r\n\t\t// ['米息分', Math.log2(miRate), 'n1'],\r\n\t\t// ['米息率', miRate, 'n1'],\r\n\t\t['TTM', ttm, 'n1'],\r\n\t\t['股息率', dvRate/100, 'p1'],\r\n\t\t['价格', price, 'n2'],\r\n\t\t['ROE', roe, 'n1'],\r\n\t\t['均增', preInc/100, 'p0'],\r\n\t\t['现增', inc4/100, 'p0'],\r\n\t\t['增 1', inc3/100, 'p0'],\r\n\t\t['增 2', inc2/100, 'p0'],\r\n\t\t['增 3', inc1/100, 'p0'],\r\n\t\t['市值', volumn * price, 'yi'],\r\n\t];\r\n\treturn <div className=\"d-block border-top\">\r\n\t\t<div className=\"d-flex px-2 py-1 bg-light\">\r\n\t\t\t{left}\r\n\t\t\t{right}\r\n\t\t</div>\r\n\t\t<div className=\"d-flex flex-wrap p-1\" onClick={()=>onClickName?.(stock)}>\r\n\t\t\t<div className=\"px-2 px-sm-3 mb-1 text-right c5\">\r\n\t\t\t\t<span className=\"small\">米息率</span><br />\r\n\t\t\t\t{number(miRate, 1)}\r\n\t\t\t</div>\r\n\t\t\t{rows.map(v => renderValue(v[0], v[1], v[2]))}\r\n\t\t</div>\r\n\t</div>;\r\n}\r\n\r\n//const nFormat = { maximumSignificantDigits: 3 };\r\nexport function formatNumber(num: number): string {\r\n\treturn num.toLocaleString(undefined, nFormat0); // nFormat.format(num);\r\n}\r\n\r\nexport interface NFormat {\r\n\tminimumFractionDigits: number;\r\n\tmaximumFractionDigits: number;\r\n}\r\n\r\nexport const nFormat0:NFormat = {\r\n\tminimumFractionDigits: 0,\r\n\tmaximumFractionDigits: 0,\r\n};\r\nexport const nFormat1:NFormat = {\r\n\tminimumFractionDigits: 1,\r\n\tmaximumFractionDigits: 1,\r\n};\r\nexport const nFormat2:NFormat = {\r\n\tminimumFractionDigits: 2,\r\n\tmaximumFractionDigits: 2,\r\n};\r\n\r\nexport function renderStockUrl(row: NStockInfo) {\r\n    let { symbol, market, code } = row;\r\n    let url = market === 'HK' ? `https://xueqiu.com/S/${code}` : `https://finance.sina.com.cn/realstock/company/${symbol}/nc.shtml`;\r\n\treturn <a className=\"text-info\" href={url} target=\"_blank\" rel=\"noopener noreferrer\" onClick={(e)=>{e.stopPropagation();}}>\r\n\t\t<FA name=\"angle-double-right\" />\r\n\t</a>;\r\n}\r\n\r\nfunction number(n: number, w = 2) {\r\n    return n === undefined || n === null ? '-' : n.toFixed(w);\r\n}\r\n\r\nfunction numberToMarketValue(n: number) {\r\n    return n === undefined || isNaN(n) ? '' : Math.round(n / 10000).toString(); // + '亿';\r\n}\r\n\r\nfunction percent0(n: number) {\r\n    return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(0) + '%';\r\n}\r\n\r\nfunction percent1(n: number) {\r\n    return n === undefined || isNaN(n) ? '' : (n * 100).toFixed(1) + '%';\r\n}\r\n","import { Group } from \"uq-app/uqs/BruceYuMi\";\r\n\r\nexport function renderGroup(item: Group, index:number, IDRender: (item: Group, index:number)=>JSX.Element) {\r\n\tlet cn:string = '';\r\n\treturn <span className={cn}>{IDRender(item, index)}</span>;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {PageHeaderProps, renderPageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, PageWebNav, WebNavScrollView } from './scrollView';\r\nimport { nav } from '../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element|string;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst {back, header, right, headerClassName, afterBack, logout} = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps:PageHeaderProps = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet {renderPageHeader: rph} = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t\t/*\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t\t*/\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\t\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className, webNav} = this.props;\r\n\t\tlet pageWebNav:PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import { PageItems } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\n\r\nexport type IDItemsPageLoader<T> = (pageStart:any, pageSize:number) => Promise<T[]>;\r\nexport type HistoryPageLoader<T> = (id:number, field:string, far:number, near:number, pageStart:any, pageSize:number) => Promise<T[]>;\r\n\r\nexport abstract class ListPageItems<T> extends PageItems<T> {\r\n\tprivate pageLoader: IDItemsPageLoader<T>;\r\n\tconstructor(pageLoader: IDItemsPageLoader<T>) {\r\n\t\tsuper(true);\r\n\t\tthis.pageLoader = pageLoader;\r\n\t}\r\n\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.pageLoader(pageStart, pageSize);\r\n\t\treturn {$page:ret};\r\n\t}\r\n\r\n\tabstract update(item: T): Promise<void>;\r\n}\r\n\r\nexport class HistoryPageItems<T extends IDBase> extends PageItems<T> {\r\n\tprivate pageLoader: HistoryPageLoader<T>;\r\n\tconstructor(pageLoader: HistoryPageLoader<T>) {\r\n\t\tsuper(true);\r\n\t\tthis.pageLoader = pageLoader;\r\n\t}\r\n\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet {id, field, far, near} = param;\r\n\t\tlet ret = await this.pageLoader(id, field, far, near, pageStart, pageSize);\r\n\t\treturn {$page:ret};\r\n\t}\r\n\r\n\tupdate(item: T): Promise<void> {return;}\r\n}\r\n","import { env } from \"tonva-react\";\r\n\r\nexport abstract class TimeSpan {\r\n\tstatic create(span: 'day' | 'week' | 'month' | 'year'):TimeSpan {\r\n\t\tlet ret:TimeSpan;\r\n\t\tswitch (span) {\r\n\t\t\tcase 'day': ret = new DaySpan(); break;\r\n\t\t\tcase 'week': ret = new WeekSpan(); break;\r\n\t\t\tcase 'month': ret = new MonthSpan(); break;\r\n\t\t\tcase 'year': ret = new YearSpan(); break;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\tprotected firstNear: number;\r\n\tfar: number;\r\n\tnear: number;\r\n\ttype: string;\r\n\r\n\tabstract prev():void;\r\n\tabstract next():void;\r\n\tabstract get title():string;\r\n\tabstract get labels():string[];\r\n\tprotected abstract getDayArray(): Date[];\r\n\r\n\tget canNext():boolean {\r\n\t\treturn this.near < this.firstNear;\r\n\t}\r\n\tget canPrev():boolean {return true;}\r\n\r\n\tgetDayValues(dayValues:{t:string;v:number}[]): number[] {\r\n\t\tlet days = this.getDayArray();\r\n\t\tlet ret:number[] = [];\r\n\t\tlet i = 0;\r\n\t\tlet dv = dayValues[i++];\r\n\t\tfor (let day of days) {\r\n\t\t\tif (dv) {\r\n\t\t\t\tlet {t, v} = dv;\r\n\t\t\t\tlet d = new Date(t);\r\n\t\t\t\td.setMinutes(d.getMinutes() + d.getTimezoneOffset());\r\n\t\t\t\tif (d.getTime() === day.getTime()) {\r\n\t\t\t\t\tret.push(v);\r\n\t\t\t\t\tdv = dayValues[i++];\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tret.push(0);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass DaySpan extends TimeSpan {\r\n\tprivate date: Date;\r\n\tprivate readonly _labels:string[] = [];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'day';\r\n\t\tthis.date = new Date();\r\n\t\tthis.date.setHours(0, 0, 0, 0);\r\n\t\tthis.far = this.date.getTime();\r\n\t\tthis.firstNear = this.near = this.far + 24 * 3600 * 1000;\r\n\t\tfor (let i=0; i<24; i++) this._labels.push(i + ':00');\r\n\t}\r\n\tprev():void {\r\n\t\tthis.far -= 24 * 3600 * 1000;\r\n\t\tthis.near -= 24 * 3600 * 1000;\r\n\t}\r\n\tnext():void {\r\n\t\tthis.far += 24 * 3600 * 1000;\r\n\t\tthis.near += 24 * 3600 * 1000;\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.date.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {return [this.date]};\r\n}\r\n\r\n\r\nconst enWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];\r\nconst zhWeek = ['一', '二', '三', '四', '五', '六', '日', ];\r\nclass WeekSpan extends TimeSpan {\r\n\tprivate firstDay: Date;\r\n\tprivate lastDay: Date;\r\n\tprivate readonly _labels:string[];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'week';\r\n\t\tthis.firstDay = new Date();\r\n\t\tthis.firstDay.setHours(0, 0, 0, 0);\r\n\t\tlet day = this.firstDay.getDay() || 7; // Get current day number, converting Sun. to 7\r\n\t\tif (day !== 1) {                // Only manipulate the date if it isn't Mon.\r\n\t\t\tthis.firstDay.setHours(-24 * (day - 1));   // Set the hours to day number minus 1\r\n\t\t}\r\n\t\tthis.far = this.firstDay.getTime();\r\n\t\tthis.firstNear = this.near = this.far + 7 * 24 * 3600 * 1000;\r\n\t\tthis.lastDay = new Date();\r\n\t\tthis.lastDay.setDate(this.firstDay.getDate()+7);\r\n\t\tswitch (env.lang) {\r\n\t\t\tdefault:\r\n\t\t\tcase 'en': this._labels = enWeek; break;\r\n\t\t\tcase 'zh': this._labels = zhWeek; break;\r\n\t\t}\r\n\t}\r\n\tprev():void {\r\n\t\tthis.firstDay.setDate(this.firstDay.getDate()-7);\r\n\t\tthis.lastDay.setDate(this.lastDay.getDate()-7);\r\n\t\tthis.far -= 7 * 24 * 3600 * 1000;\r\n\t\tthis.near -= 7 * 24 * 3600 * 1000;\r\n\t}\r\n\tnext():void {\r\n\t\tthis.firstDay.setDate(this.firstDay.getDate()+7);\r\n\t\tthis.lastDay.setDate(this.lastDay.getDate()+7);\r\n\t\tthis.far += 7 * 24 * 3600 * 1000;\r\n\t\tthis.near += 7 * 24 * 3600 * 1000;\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.firstDay.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {\r\n\t\tlet d = new Date(this.firstDay);\r\n\t\tlet ret: Date[] = [this.firstDay];\r\n\t\tfor (;;) {\r\n\t\t\td.setDate(d.getDate() + 1);\r\n\t\t\tif (d >= this.lastDay) break;\r\n\t\t\tret.push(new Date(d));\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass MonthSpan extends TimeSpan {\r\n\tprivate firstDay: Date;\r\n\tprivate lastDay: Date;\r\n\tprivate _labels:string[];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'month';\r\n\t\tlet date = new Date();\r\n\t\tthis.initFromDate(date);\r\n\t\tthis.firstNear = this.near;\r\n\t}\r\n\tprivate initFromDate(date: Date) {\r\n\t\tlet year = date.getFullYear(), month = date.getMonth();\r\n\t\tthis.firstDay = new Date(year, month, 1);\r\n\t\tthis.lastDay = new Date(year, month + 1, 0);\r\n\t\tthis.far = this.firstDay.getTime();\r\n\t\tthis.near = new Date(year, month+1, 1).getTime();\r\n\t\tthis._labels = [];\r\n\t\tlet count = this.lastDay.getDate();\r\n\t\tfor (let i=1; i<=count; i++) this._labels.push(String(i));\r\n\t}\r\n\tprev():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() - 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tnext():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() + 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.firstDay.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {\r\n\t\tlet d = new Date(this.firstDay);\r\n\t\tlet ret: Date[] = [this.firstDay];\r\n\t\tfor (;;) {\r\n\t\t\td.setDate(d.getDate() + 1);\r\n\t\t\tif (d >= this.lastDay) break;\r\n\t\t\tret.push(new Date(d));\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nclass YearSpan extends TimeSpan {\r\n\tprivate firstDay: Date;\r\n\tprivate lastDay: Date;\r\n\tprivate readonly _labels:string[] = [];\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.type = 'year';\r\n\t\tlet date = new Date();\r\n\t\tthis.initFromDate(date);\r\n\t\tthis.firstNear = this.near;\r\n\t\tfor (let i=0; i<=12; i++) this._labels.push(String(i));\r\n\t}\r\n\tprivate initFromDate(date: Date) {\r\n\t\tlet year = date.getFullYear(), month = 0;\r\n\t\tthis.firstDay = new Date(year, month, 1);\r\n\t\tthis.lastDay = new Date(year, month + 1, 0);\r\n\t\tthis.far = this.firstDay.getTime();\r\n\t\tthis.near = new Date(year, month+1, 1).getTime();\r\n\t}\r\n\tprev():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() - 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tnext():void {\r\n\t\tlet date = new Date(this.firstDay.setMonth(this.firstDay.getMonth() + 1));\r\n\t\tthis.initFromDate(date);\r\n\t}\r\n\tget title():string {\r\n\t\treturn this.firstDay.toLocaleDateString();\r\n\t}\r\n\tget labels():string[] {return this._labels}\r\n\tprotected getDayArray(): Date[] {\r\n\t\tlet d = new Date(this.firstDay);\r\n\t\tlet ret: Date[] = [this.firstDay];\r\n\t\tfor (;;) {\r\n\t\t\td.setDate(d.getDate() + 1);\r\n\t\t\tif (d >= this.lastDay) break;\r\n\t\t\tret.push(new Date(d));\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { FA } from \"tonva-react\";\r\n\r\nexport function listRight(onClick: () => any): JSX.Element {\r\n\treturn <button className=\"btn btn-sm btn-success mr-2\" onClick={onClick}>\r\n\t\t<FA name=\"plus\" />\r\n\t</button>\r\n}\r\n\r\nexport function renderItem(item:any, index:number) {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n}\r\n\r\nexport function renderItemContainer(content:any) {\r\n\treturn <div className=\"px-3 py-2\">\r\n\t\t{content}\r\n\t</div>;\r\n}\r\n","import { List, Page, PageItems, Scroller } from \"tonva-react\";\r\n\r\nexport interface ListPageProps {\r\n\tpageItems: PageItems<any>;\r\n\titemClick: (item:any) => any;\r\n\trenderItem?: (item:any, index:number) => JSX.Element;\r\n\trenderItemContainer?: (content:any) => JSX.Element;\r\n\tkey: (item:any) => number|string;\r\n\theader: JSX.Element | string;\r\n\tright?: JSX.Element;\r\n\tfooter?: JSX.Element;\r\n\ttop?: JSX.Element;\r\n\tbottom?: JSX.Element;\r\n\tback?: 'close' | 'back' | 'none';\r\n\tclassName?: string;\r\n\theaderClassName?: string;\r\n}\r\n\r\nexport class ListPage extends Page {\r\n\tprotected listPageProps: ListPageProps;\r\n\tconstructor(listPageProps: ListPageProps) {\r\n\t\tsuper({});\r\n\t\tthis.listPageProps = listPageProps;\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tprivate renderPage():JSX.Element {\r\n\t\tlet {pageItems, itemClick, renderItem, renderItemContainer\r\n\t\t\t, key, header, footer, right\r\n\t\t\t, top, bottom, back, className, headerClassName} = this.listPageProps;\r\n\t\tif (!header) header = false as any;\r\n\t\tlet renderRow = (item:any, index:number) => {\r\n\t\t\treturn renderItemContainer(renderItem(item, index));\r\n\t\t}\r\n\t\tlet item = {\r\n\t\t\trender: renderRow,\r\n\t\t\tonClick: itemClick,\r\n\t\t\tkey,\r\n\t\t}\r\n\t\treturn <Page\r\n\t\t\theader={header} right={right} footer={footer}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={back}\r\n\t\t\theaderClassName={headerClassName}\r\n\t\t\tclassName={className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t>\r\n\t\t\t{top}\r\n\t\t\t<List items={pageItems} item={item} />\r\n\t\t\t{bottom}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n}\r\n","import { Controller } from \"tonva-react\";\r\nimport { renderItem, listRight, renderItemContainer } from \"../../tools\";\r\nimport { ListPage, ListPageProps } from \"./ListPage\";\r\nimport { MidList } from \"./MidList\";\r\n\r\nexport class CList<T> extends Controller {\r\n\tprotected readonly midList: MidList<T>;\r\n\tprotected selectedItem: T;\r\n\tprotected listPageProps: ListPageProps;\r\n\tconstructor(midList: MidList<T>) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midList.res);\r\n\t\tthis.midList = midList;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.midList.init();\r\n\t\tlet pageItems = this.midList.pageItems;\r\n\t\tlet props:ListPageProps = {\r\n\t\t\theader: this.header,\r\n\t\t\tpageItems,\r\n\t\t\tkey: this.midList.key,\r\n\t\t\titemClick: (item:any) => this.onItemClick(item),\r\n\t\t\tright: this.renderRight(),\r\n\t\t\trenderItem: (item:any, index) => this.renderItem(item, index),\r\n\t\t\trenderItemContainer: (content:any) => this.renderItemContainer(content),\r\n\t\t};\r\n\t\tpageItems.first(this.firstParam);\r\n\t\tthis.listPageProps = props;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.init();\r\n\t\tlet page = new ListPage(this.listPageProps);\r\n\t\tthis.openPage(page.render(), () => this.returnCall(this.selectedItem));\r\n\t}\r\n\r\n\tprotected get firstParam():any {return undefined;}\r\n\tprotected get header():string|JSX.Element {return this.midList.header ?? 'List'}\r\n\tprotected renderItemContainer(content:any):JSX.Element {\r\n\t\treturn renderItemContainer(content);\r\n\t}\r\n\tprotected onItemClick(item:any):void {\r\n\t\tthis.midList.onItemClick(item);\r\n\t}\r\n\r\n\tprotected renderRight():JSX.Element {\t\t\r\n\t\tlet {renderRight, onRightClick} = this.midList;\r\n\t\tif (!onRightClick) return null;\r\n\t\treturn (renderRight ?? listRight)(onRightClick);\r\n\t}\r\n\r\n\tprotected renderItem(item:any, index:number):JSX.Element {\r\n\t\treturn (this.midList.renderItem ?? renderItem)(item, index);\r\n\t}\r\n\r\n}\r\n","import { runInAction } from \"mobx\";\r\nimport { PageItems, Uq } from \"tonva-react\";\r\nimport { ListPageItems } from \"../../tools\";\r\nimport { IDBase, Mid } from \"../../base\";\r\n\r\nexport abstract class MidList<T> extends Mid {\r\n\treadonly pageItems: PageItems<T>;\r\n\tconstructor(uq:Uq, res?:any) {\r\n\t\tsuper(uq, res);\r\n\t\tthis.pageItems = this.createPageItems();\r\n\t}\r\n\r\n\tprotected abstract createPageItems():PageItems<T>;\r\n\tasync init():Promise<void> {}\r\n\tprotected abstract loadPageItems(pageStart:any, pageSize:number):Promise<T[]>;\r\n\tkey:((item:T) => number|string);\r\n\r\n\tonRightClick: ()=>any;\r\n\trenderItem: (item:T, index:number)=>JSX.Element;\r\n\tonItemClick: (item:T)=>any;\r\n\trenderRight: ()=>JSX.Element;\r\n\theader: string|JSX.Element;\r\n\trenderTop: () => JSX.Element;\r\n\trenderBottom: () => JSX.Element;\r\n}\r\n\r\nexport abstract class MidIDListBase<T extends IDBase> extends MidList<T> {\r\n\tprotected get listPageItems(): IDListPageItems<T> {return this.pageItems as IDListPageItems<T>}\r\n\tkey:((item:T) => number|string) = item => {\r\n\t\treturn item.id;\r\n\t}\r\n\tcreatePageItems():PageItems<T> {\r\n\t\tlet loader = (pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize);\r\n\t\treturn new IDListPageItems<T>(loader);\r\n\t}\r\n}\r\n\r\nexport class IDListPageItems<T extends IDBase> extends ListPageItems<T> {\r\n\titemId(item:T):number {return item.id}\r\n\tnewItem(id:number, item:T):T {return {...item, id}}\r\n\r\n\tupdate(item:T): Promise<void> {\r\n\t\tlet id = item.id;\r\n\t\tlet ret = this._items.find(v => this.itemId(v) === id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tlet data = this.newItem(id, item);\r\n\t\t\tthis._items.unshift(data);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trunInAction(() => {\r\n\t\t\t\tObject.assign(ret, item);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {nav, Page, PageHeaderProps, PageWebNav} from '../components';\r\nimport {resOptions, t} from '../res';\r\nimport { User, env } from '../tool';\r\nimport { VPage } from './vpage';\r\nimport { View } from './view';\r\nimport { messageHub } from '../net';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n\tVNavHeader?: new (controller: C) => View<C>;\r\n\tVNavRawHeader?: new (controller: C) => View<C>;\r\n\tVNavFooter?: new (controller: C) => View<C>;\r\n\tVNavRawFooter?: new (controller: C) => View<C>;\r\n\trenderPageHeader?: (props: PageHeaderProps) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n\tprotected res: any = {};\r\n\tt = (str: string): string|JSX.Element => this.internalT(str) || str;\r\n    icon: string|JSX.Element;\r\n    label:string|JSX.Element;\r\n\treadonly isDev:boolean = env.isDevelopment;\r\n\tpageWebNav: PageWebNav;\r\n    get user():User {return nav.user}\r\n    get isLogined():boolean {\r\n        let {user} = nav;\r\n        if (!user) return false;\r\n        return user.id > 0;\r\n    }\r\n\r\n\tprotected beforeInit() {}\r\n\tprotected afterInit() {}\r\n\r\n\tinit(...param: any[]) {\r\n\t\tthis.beforeInit();\r\n\t\tthis.pageWebNav = this.getPageWebNav();\r\n\t\tthis.afterInit();\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn this.res?.[str] ?? t(str);\r\n\t}\r\n\r\n\tget webNav(): WebNav<any> {return undefined;}\r\n\r\n\tgetWebNav(): WebNav<any> {return this.webNav;}\r\n\r\n\tgetPageWebNav(): PageWebNav {return undefined;}\r\n\r\n\tget isWebNav(): boolean {return nav.isWebNav}\r\n\tnavigate(url:string) {\r\n\t\tnav.navigate(url);\r\n\t}\r\n\t\r\n\tsetRes(res: any) {\r\n\t\tif (res === undefined) return;\r\n\t\tlet {$lang, $district} = resOptions;\r\n\t\t_.merge(this.res, res);\r\n\t\tif ($lang !== undefined) {\r\n\t\t\tlet l = res[$lang];\r\n\t\t\tif (l !== undefined) {\r\n\t\t\t\t_.merge(this.res, l);\r\n\t\t\t\tlet d = l[$district];\r\n\t\t\t\tif (d !== undefined) {\r\n\t\t\t\t\t_.merge(this.res, d);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\tgetRes():any {return this.res;}\r\n\r\n    private receiveHandlerId:number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n\t\t//nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n\t\tmessageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n\t}\r\n\t\r\n\tget timeZone():number { return env.timeZone; }\r\n\r\n\tisMe(id:any):boolean {\r\n\t\tif (id === null) return false;\r\n\t\tlet {user} = this;\r\n\t\tlet userId = user.id;\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: return false;\r\n\t\t\tcase 'string': return Number(id) === userId;\r\n\t\t\tcase 'number': return id === userId;\r\n\t\t\tcase 'object': return id.id === userId;\r\n\t\t}\r\n\t}\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.open(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.replaceOpen(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C)=>V, param?:any):JSX.Element {\r\n\t\tlet v = new view((this as any) as C);\r\n\t\treturn v.render(param);\r\n    }\r\n\r\n    async event(type:string, value:any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n    }\r\n\r\n    protected msg(text:string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header:string, err:any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string'? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message:any):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message:any):Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        return true;\r\n\t}\r\n\tprotected async afterStart():Promise<void> {\r\n\t}\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?:any, ...params:any[]):Promise<void>;\r\n    async start(param?:any, ...params:any[]):Promise<void> {\r\n\t\tthis.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n\t\tawait this.internalStart(param, ...params);\r\n\t\tawait this.afterStart();\r\n    }\r\n\r\n    get isCalling():boolean {return this._resolve_$ !== undefined}\r\n\r\n    private _resolve_$:((value:any) => void)[];\r\n    async call<T>(param?:any, ...params:any[]):Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value:any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page:JSX.Element, onClosePage?: (ret:any)=>void) {\r\n\t\tlet disposer: ()=>void;\r\n\t\tif (onClosePage !== undefined) {\r\n\t\t\tdisposer = () => {\r\n\t\t\t\t//if (this.disposer) this.disposer();\r\n\t\t\t\tonClosePage(undefined);\r\n\t\t\t}\r\n\t\t}\r\n\r\n        nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page:JSX.Element, onClosePage?: ()=>void) {\r\n        nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?:number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?:number) {\r\n        nav.ceaseTop(level);\r\n\t}\r\n\t\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tnav.go(showPage, url, absolute);\r\n\t}\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprivate topPageKey:any;\r\n\tprotected startAction() {\r\n\t\tthis.topPageKey = nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key:any) {\r\n        this.topPageKey = key;\r\n    }\r\n\tpublic popToTopPage() {\r\n\t\tnav.popTo(this.topPageKey);\r\n\t}\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok'|'yes'|'no'|undefined> {\r\n        return new Promise<'ok'|'yes'|'no'|undefined> (async (resolve, reject) => {\r\n            let {caption, message, ok, yes, no, classNames} = options;\r\n            let close = (res:'ok'|'yes'|'no'|undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons:any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary mr-3\" onClick={()=>close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success mr-3\" onClick={()=>close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger mr-3\" onClick={()=>close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            nav.regConfirmClose(async ():Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Image, UserView } from '../components';\r\nimport { env, User } from '../tool';\r\nimport { Controller } from './controller';\r\nimport { VPage } from './vpage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n\tprotected readonly x: any;\r\n\tprotected readonly t: (str:string)=>any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n\t\tthis.t = controller.t;\r\n    }\r\n\r\n\tprotected get isDev() {return  env.isDevelopment}\r\n\tget isWebNav(): boolean {return this.controller.isWebNav}\r\n\tnavigate(url:string) {this.controller.navigate(url)}\r\n\tprotected isMe(id:any) {return this.controller.isMe(id)}\r\n    abstract render(param?:any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (controller: C)=>View<C>, param?:any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:()=>Promise<void>):Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type:string, value?:any) {\r\n        await this.controller.event(type, value);\r\n\t}\r\n\t\r\n\tprotected go(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tthis.controller.go(showPage, url, absolute);\r\n\t}\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n\tprotected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image src={icon} className={imageClassName || 'w-1c h-1c mr-2'} />\r\n\t\t\t\t<span className={textClassName}>{nick || name}</span>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderUserText(user:any) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <>{nick || name}</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderMe(imageClassName?:string, textClassName?:string) {\r\n\t\tlet {user} = this.controller;\r\n\t\tif (!user) return;\r\n\t\treturn this.renderUser(user.id, imageClassName, textClassName);\r\n\t}\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?:any, onClosePage?:(ret:any)=>void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?:number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?:number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprotected popToTopPage() {\r\n\t\tthis.controller.popToTopPage();\r\n\t}\r\n}\r\n","import { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./view\";\r\nimport { Controller } from \"./controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import { UqApi } from '../net';\r\nimport { LocalCache } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\nimport { getObjPropIgnoreCase } from '../tool';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly cache: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n\tfields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.cache = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.cache.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n\t\t//this.buildFieldsTuid();\r\n\t\tthis.buildSchema(schema);\r\n\t\tawait this.loadValues();\r\n\t}\r\n\r\n\tbuildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\t//await this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\t\t\r\n\t\tthis.setJName(name);\r\n        this.cache.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n\t\tthis.fields = fields;\r\n        this.uq.buildFieldTuid(fields);\r\n\t\tthis.arrFields = arrs;\r\n        this.uq.buildArrFieldsTuid(arrs, fields);\r\n\t\tthis.returns = returns;\r\n        this.uq.buildArrFieldsTuid(returns, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            switch (type) {\r\n\t\t\t\tcase 'datetime':\r\n                \tval = this.buildDateTimeParam(d);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\tval = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tswitch (typeof d) {\r\n\t\t\t\t\t\tdefault: val = d; break;\r\n\t\t\t\t\t\tcase 'object':\r\n\t\t\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet tuid = field._tuid;\r\n\t\t\t\t\t\t\tif (tuid === undefined) val = d.id;\r\n\t\t\t\t\t\t\telse val = tuid.getIdFromObj(d);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n\t\t\t\tlet {name, fields} = arr;\r\n\t\t\t\tlet arrData = getObjPropIgnoreCase(data, name);\r\n\t\t\t\t//if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i), ch:string;\r\n                            switch(c) {\r\n\t\t\t\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\r\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\r\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\r\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\r\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\r\n\t\t\t\t\t\t\tp = i+1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) return;\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n\t\t\tif (data.length === 0) {\r\n\t\t\t\tresult.push(ln);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let row of data) {\r\n\t\t\t\t\tthis.packRow(result, fields, row);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tresult.push(ln);\r\n\t\t}\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) return values as any[];\r\n        //if (this.fields === undefined) return values as any[];\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\tunpackReturns(data:string, returns?:ArrFields[]):{[name:string]:any[]} {\r\n\t\tif (data === undefined) debugger;\r\n\t\tlet ret = {} as any;\r\n\t\tlet p = 0;\r\n\t\tlet arrs = returns || this.returns;\r\n\t\tif (arrs !== undefined) {\r\n\t\t\tfor (let arr of arrs) {\r\n\t\t\t\tp = this.unpackArr(ret, arr, data, p);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n\t\t\tdefault: return v;\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'char':\r\n\t\t\t\treturn this.reverseNT(v);\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'double':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n\t}\r\n\t\r\n\tprivate reverseNT(text:string):string {\r\n\t\tif (text === undefined) return;\r\n\t\tif (text === null) return;\r\n\t\tlet len = text.length;\r\n\t\tlet r = '';\r\n\t\tlet p = 0;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet c = text.charCodeAt(i);\r\n\t\t\tif (c === codeBackSlash) {\r\n\t\t\t\tif (i===len-1) break;\r\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\r\n\t\t\t\tlet ch:string;\r\n\t\t\t\tswitch (c1) {\r\n\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\r\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\r\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\r\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\r\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\r\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\r\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\r\n\t\t\t\t}\r\n\t\t\t\tr += text.substring(p, i) + ch;\r\n\t\t\t\tp = i+2;\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tr += text.substring(p, len);\r\n\t\treturn r;\r\n\t}\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n\t\tlet p0 = p;\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n\t\t\t\tif (p === p0) {\r\n\t\t\t\t\tch = data.charCodeAt(p);\r\n\t\t\t\t\tif (ch !== 10) {\r\n\t\t\t\t\t\tthrow new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t++p;\r\n\t\t\t\t}\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import { ButtonSchema, Controller, FieldCustoms, FieldItem, FieldItemId, FieldItemString, ID, IDUI, IDX, IDXEntity, IX, PickId, Prop, Schema, UiButton, UiSchema, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"./base\";\r\n\r\nexport interface UqUiProps {\r\n\tuq: Uq;\r\n}\r\n\r\nexport interface IDBaseUiProps<T extends IDBase> extends UqUiProps {\r\n\tID: ID;\r\n\theader?: string|JSX.Element;\r\n\tlistHeader?: string|JSX.Element;\r\n\trenderRight?: () => JSX.Element;\r\n\tfieldCustoms?: FieldCustoms;\r\n}\r\n\r\nexport interface IDListUiProps<T extends IDBase> extends IDBaseUiProps<T> {\r\n\trenderItem?: (item:T, index:number) => JSX.Element;\r\n\tonClickItem?: (item:T) => Promise<void>;\r\n\tonAddItem?: () => Promise<void>;\r\n}\r\n\r\nexport interface IDUiProps<T extends IDBase> extends IDBaseUiProps<T> {\r\n\tonItemChanged?: (item: T) => Promise<void>;\r\n}\r\n\r\nexport interface IDEditUiProps<T extends IDBase> extends IDUiProps<T> {\r\n\tsaveItem?: (item: T) => Promise<number>;\r\n}\r\n\r\nexport interface IDViewUiProps<T extends IDBase> extends IDUiProps<T> {\r\n\tonEditItem?: (item: T) => Promise<T>;\r\n}\r\n\r\nexport interface IXListUiProps<TIX extends IDBase, TXI extends IDBase> extends IDListUiProps<TXI> {\r\n\tIX: IX;\r\n\tix: TIX;\t\t// if undefined, then current user\r\n\trenderIx?: (ix:TIX) => JSX.Element;\r\n}\r\n\r\nexport interface IXUiProps<TIX extends IDBase, TXI extends IDBase> extends UqUiProps {\r\n\tixProps?: IDListUiProps<TIX>;\r\n\txiProps?: IXListUiProps<TIX, TXI>;\r\n}\r\n\r\nexport interface XIUiProps<TXI extends IDBase, TIX extends IDBase> extends UqUiProps {\r\n\txiProps?: IDListUiProps<TXI>;\r\n\tixProps?: XIListUiProps<TXI, TIX>;\r\n}\r\n\r\nexport interface XIListUiProps<TIX extends IDBase, TXI extends IDBase> extends IDListUiProps<TIX> {\r\n\tIX: IX;\r\n\txi: TXI;\t\t// if undefined, then current user\r\n\trenderXi?: (xi:TXI) => JSX.Element;\r\n\tonSetIXItem?: () => Promise<void>;\r\n}\r\n\r\nexport interface IDXBaseUiProps<T extends IDBase> extends UqUiProps {\r\n\treadonly IDX: IDX;\r\n\treadonly ID: ID;\r\n\treadonly timeZone: number;\r\n}\r\n\r\nexport interface IDXUiProps<T extends IDBase> extends IDXBaseUiProps<T> {\r\n}\r\n\r\nexport interface IDXHistoryUiProps<T> extends IDXBaseUiProps<T> {\r\n}\r\n\r\nexport abstract class CUqUi<P extends UqUiProps> extends Controller {\r\n\tprotected uq: Uq;\r\n\tprops: P;\r\n\r\n\tconstructor(props: P) {\r\n\t\tsuper();\r\n\t\tthis.uq = props.uq;\r\n\t\tthis.props = props;\r\n\t}\r\n\r\n\tprotected async buildItemSchema(IDUI: IDUI): Promise<Schema> {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet ret:Schema = [];\r\n\t\tlet {fieldArr} = ID.ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet {type, isKey} = f;\r\n\t\t\tlet required = isKey; // (keys as any[]).findIndex(v => v.name === name) >= 0;\r\n\t\t\tlet fieldItem = {\r\n\t\t\t\t...f,\r\n\t\t\t\trequired,\r\n\t\t\t};\r\n\t\t\tswitch (type) {\r\n\t\t\t\tdefault: ret.push(fieldItem); break;\r\n\t\t\t}\r\n\t\t\tlet {ID} = fieldItem;\r\n\t\t\tif (ID) {\r\n\t\t\t\tlet importSelect = await import('./CIDSelect');\r\n\t\t\t\tthis.setIDUi(fieldItem, importSelect.createPickId(this.uq, ID), ID.render);\r\n\t\t\t}\r\n\t\t}\r\n\t\tret.push({\r\n\t\t\tname: 'submit',\r\n\t\t\ttype: 'submit',\r\n\t\t} as ButtonSchema);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(IDUI:IDUI):UiSchema {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet {fields} = ID.ui;\r\n\t\tlet items = {...fields as any};\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\tlet ret = {items};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildGridProps(IDX: IDXEntity<any>):Prop[] {\r\n\t\tlet ret:Prop[] = [];\r\n\t\tlet {ui, t, schema} = IDX;\r\n\t\tlet {exFields} = schema;\r\n\t\tlet {fieldArr } = ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet exField = (exFields as any[]).find(v => v.field === f.name);\r\n\t\t\tif (!exField) continue;\r\n\t\t\tlet prop = {\r\n\t\t\t\t...f,\r\n\t\t\t\tlabel: t(f.label),\r\n\t\t\t};\r\n\t\t\tret.push(prop as any);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected setIDUi(fieldItem:FieldItem, pickId: PickId, render: (values:any) => JSX.Element) {\r\n\t\tif (fieldItem.type !== 'id') {\r\n\t\t\talert(`${fieldItem.name} is not id UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet idField = fieldItem as FieldItemId;\r\n\t\tidField.widget = 'id';\r\n\t\tidField.pickId = pickId;\r\n\t\t(idField as any).Templet = render;\r\n\t}\r\n\r\n\tprotected setNO(no:string, noFieldItem: FieldItem) {\r\n\t\tif (!noFieldItem) return;\r\n\t\tif (noFieldItem.type !== 'string') return;\r\n\t\tlet noField = noFieldItem as FieldItemString;\r\n\t\tnoField.readOnly = true;\r\n\t\tnoField.defaultValue = no;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { FieldRule } from '../form/rules';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\n\r\nexport abstract class ItemEdit {\r\n\tprotected edit: Edit;\r\n\tprotected name: string;\r\n\tprotected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema {return this._itemSchema}\r\n    protected _uiItem:UiItem;\r\n    get uiItem():UiItem {return this._uiItem}\r\n    value: any;\r\n\tlabel: string|JSX.Element;\r\n\tget editInRow(): boolean {return false;}\r\n    protected newValue: any;\r\n\r\n    error: string = null;\r\n    isChanged: boolean = false;\r\n\r\n    constructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terror: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t});\r\n\t\tthis.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n\t}\r\n\t\r\n\tinit() {\t\t\r\n\t}\r\n\r\n    async start():Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart():Promise<any>;\r\n\r\n    async end():Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n\trenderContent() {\r\n        let {name, type} = this._itemSchema;\r\n        let divValue:any;\r\n        let uiItem = this._uiItem;\r\n        let label:string|JSX.Element, labelHide:boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n\t\t\tlabel = uiItem.label;\r\n\t\t\tlabelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\r\n\t\t\t\t}\r\n                else {\r\n\t\t\t\t\tdivValue = {templet};\r\n\t\t\t\t}\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let {list} = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value? \r\n\t\t\t\t\t\t<b>{this.value}</b> \r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:'无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n\t\t}\r\n\t\treturn divValue;\r\n\t}\r\n\r\n    protected async internalEnd():Promise<void> {nav.pop()}\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let {rules} = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule:FieldRule, value: any):string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","//import _ from 'lodash';\r\nimport { KeyValueRes, Res } from './res';\r\n\r\nexport interface FormRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const formRes:Res<FormRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","//import _ from 'lodash';\r\nimport { Caller } from '../net';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, waiting: boolean = true) {\r\n        super(params, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            let ret = this.xresult(res);\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error('can not get right uq response schema, 5 tries');\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) {\r\n\t\t\tthis.entity.uq.buildEntities(uq);\r\n\t\t}\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {nav} from '../components/nav';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix:string, caller:Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let {headers, path, method} = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n\t\t\t\t//h.append(i, encodeURI(headers[i]));\r\n\t\t\t\th[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr:any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');       \r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true || err.startsWith('$roles') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n\t\tprivate buildOptions(): {method:string; headers:{[name:string]: string}; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n\t/*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n\t}\r\n\t*/\r\n\tprotected buildHeaders():{[name:string]: string} { \r\n        let {language, culture} = nav;\r\n        let headers:{[name:string]: string} = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n\t\t//headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n\t\theaders['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n\t\t//headers.append('Accept-Language', lang);\r\n\t\theaders['Accept-Language'] = lang;\r\n        if (this.apiToken) { \r\n\t\t\t//headers.append('Authorization', this.apiToken); \r\n\t\t\theaders['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n\t}\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import {nav} from '../components/nav';\r\nimport {FetchError} from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n    showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await nav.showUpgradeUq(uq, version);\r\n    }\r\n}\r\n\r\n","import _ from 'lodash';\r\nimport {HttpChannel, CenterHttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\nimport {getUqToken, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\nimport { host } from './host';\r\nimport { LocalMap, env } from '../tool';\r\nimport {decodeUserToken} from '../tool/user';\r\n\r\ninterface PromiseValue<T> {\r\n\tresolve: (value?: T | PromiseLike<T>) => void;\r\n\treject: (reason?: any) => void;\r\n}\r\nlet channelUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n    logoutUqTokens();\r\n}\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n\r\nexport class UqApi extends ApiBase {\r\n    //private access:string[];\r\n    //appOwner:string;\r\n    //appName:string;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(basePath:string, /*appOwner:string, appName:string, */uqOwner:string, uqName:string/*, access:string[]*/, showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        //this.appOwner = appOwner;\r\n        //this.appName = appName;\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        //this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    //setUqVersion(uqVersion:number) {this.uqVersion = undefined}\r\n\r\n    async init() {\r\n        await buildAppUq(this.uq, this.uqOwner, this.uqName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel|(PromiseValue<any>[])};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n\t\tif (channel !== undefined) {\r\n\t\t\tif (Array.isArray(channel) === false) return channel as HttpChannel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannel = channels[this.uq] = [];\r\n\t\t}\r\n\t\tlet arr = channel as PromiseValue<any>[];\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tarr.push({resolve, reject});\r\n\t\t\tif (arr.length !== 1) return;\r\n\t\t\tlet uqToken = getUqToken(this.uq); //, this.uqOwner, this.uqName);\r\n\t\t\tif (!uqToken) {\r\n\t\t\t\t//debugger;\r\n\t\t\t\tawait this.init();\r\n\t\t\t\tuqToken = getUqToken(this.uq);\r\n\t\t\t}\r\n\t\t\tlet {url, token} = uqToken;\r\n\t\t\tthis.token = token;\r\n\t\t\tchannel = new UqHttpChannel(url, token, channelUI);\r\n\t\t\tchannels[this.uq] = channel;\r\n\t\t\tfor (let pv of arr) {\r\n\t\t\t\tpv.resolve(channel);\r\n\t\t\t}\r\n\r\n\t\t});\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadEntities():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        //let acc = this.access === undefined?\r\n        //    '' :\r\n        //    this.access.join('|');\r\n\t\t//let ret = await this.get('access', {acc:acc});\r\n\t\tlet ret = await this.get('entities');\r\n        return ret;\r\n\t}\r\n\tasync getRoles():Promise<string[]> {\r\n\t\tlet ret = await this.get('get-roles',);\r\n\t\tif (!ret) return null;\r\n\t\tlet parts:string[] = (ret as string).split('|');\r\n\t\tlet s:string[] = [];\r\n\t\tfor (let p of parts) {\r\n\t\t\tp = p.trim();\r\n\t\t\tif (!p) continue;\r\n\t\t\ts.push(p);\r\n\t\t}\r\n\t\tif (s.length === 0) return null;\r\n\t\treturn s;\r\n\t}\r\n\tasync getAllRoleUsers():Promise<{user:number, admin:number, roles:string}[]> {\r\n\t\tlet ret = await this.get('get-all-role-users');\r\n\t\treturn ret;\r\n\t}\r\n\tasync setUserRoles(theUser:number, roles:string):Promise<void> {\r\n\t\tawait this.post('set-user-roles', {theUser, roles});\r\n\t}\r\n\tasync deleteUserRoles(theUser:number):Promise<void> {\r\n\t\tawait this.get('delete-user-roles', {theUser});\r\n\t}\r\n\r\n\tasync allSchemas(): Promise<any> {\r\n\t\treturn await this.get('all-schemas');\r\n\t}\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', /*undefined, undefined, */undefined, undefined/*, undefined*/, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nlet loginedUserId:number = 0;\r\nexport function setCenterToken(userId:number, t?:string) {\r\n    loginedUserId = userId;\r\n    centerToken = t;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new CenterHttpChannel(centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new CenterHttpChannel(centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n\tstatic clearLocal() {\r\n\t\tenv.localDb.removeItem(uqTokensName);\r\n\t}\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return _.clone(value);\r\n                }\r\n            }\r\n            let uqParams:any = _.clone(params);\r\n            uqParams.testing = host.testing;\r\n            let ret = await this.get('uq-token', uqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return _.clone(ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport const uqTokenApi = new UqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n\townerAlias: string;\r\n    uqName: string;\r\n\tuqAlias: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    async appUqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner, appName});\r\n        return ret;\r\n    }\r\n    async uqs(uqs: {owner:string; name:string; version:string}[]):Promise<UqData[]> {\r\n        return await this.post('tie/pure-uqs', uqs);\r\n    }\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n}\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.get('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n\r\nexport const userApi = new UserApi('tv/', undefined);\r\n","import { Context, Form, View } from \"tonva-react\";\r\nimport { CFormView } from \"./CFormView\";\r\n\r\nexport class VFormView<C extends CFormView<any>> extends View<C> {\r\n\trender(param: any) {\r\n\t\tlet {schema, uiSchema} = this.controller;\r\n\t\treturn <Form fieldLabelSize={2} formData={param}\r\n\t\t\tschema={schema}\r\n\t\t\tuiSchema={uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit} />\r\n\t}\r\n\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tcontext.setDisabled(name, true);\r\n\t\tawait this.controller.submit(name, context);\r\n\t\tcontext.setDisabled(name, false);\r\n\t}\r\n}","import { ButtonSchema, Context, Controller, FieldItem, FieldItems, FieldItemString, ID, Schema, UI, UiButton, UiIdItem, UiNumberItem, UiSchema } from \"tonva-react\";\r\nimport { FormUI } from \"./FormUI\";\r\nimport { VFormView } from \"./VFormView\";\r\n\r\nexport class CFormView<T> extends Controller {\r\n\tprotected readonly ui: UI;\r\n\tschema: Schema;\r\n\tuiSchema: UiSchema;\r\n\tlabel: string|JSX.Element;\r\n\tsubmitCaption: string|JSX.Element;\r\n\tonSubmit: (name:string, context: Context) => Promise<void>;\r\n\r\n\tconstructor(formUI: FormUI) {\r\n\t\tsuper();\r\n\t\tlet {label, fieldArr, fields, submitCaption, t} = formUI;\r\n\t\tthis.t = t;\r\n\t\tthis.schema = this.buildItemSchema(fieldArr);\r\n\t\tthis.uiSchema = this.buildUISchema(fields);\r\n\t\tthis.label = t(label);\r\n\t\tthis.submitCaption = t(submitCaption);\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync setNO(ID: ID, fieldName:string = 'no') {\r\n\t\tlet field = this.schema.find(v => v.name === fieldName);\r\n\t\tif (!field) return;\r\n\t\tif (field.type !== 'string') return;\r\n\t\tlet noField = field as FieldItemString;\r\n\t\tlet no = await ID.NO();\r\n\t\tnoField.readOnly = true;\r\n\t\tnoField.defaultValue = no;\r\n\t\tlet uiField = this.uiSchema.items[fieldName];\r\n\t\tif (uiField) {\r\n\t\t\tuiField.readOnly = true;\r\n\t\t\tuiField.defaultValue = no;\r\n\t\t}\r\n\t}\r\n\r\n\tasync submit(name:string, context: Context) {\r\n\t\tawait this.onSubmit?.(name, context);\r\n\t}\r\n\r\n\tprotected buildItemSchema(fieldArr: FieldItems): Schema {\r\n\t\tlet ret:Schema = [];\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet {type, isKey} = f;\r\n\t\t\tlet required = isKey; // (keys as any[]).findIndex(v => v.name === name) >= 0;\r\n\t\t\tlet fieldItem = {\r\n\t\t\t\t...f,\r\n\t\t\t\trequired,\r\n\t\t\t};\r\n\t\t\tswitch (type) {\r\n\t\t\t\tdefault: ret.push(fieldItem); break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tret.push({\r\n\t\t\tname: 'submit',\r\n\t\t\ttype: 'submit',\r\n\t\t} as ButtonSchema);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(fields: {[name:string]:FieldItem}):UiSchema {\r\n\t\tlet items = {...fields as any};\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: this.submitCaption ?? '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tlet {type} = field;\r\n\t\t\tif (type === 'id') {\r\n\t\t\t\tlet uiId = field as UiIdItem;\r\n\t\t\t\tlet {pickId} = uiId;\r\n\t\t\t\tif (pickId === undefined) {\r\n\t\t\t\t\tlet uiNumber = field as UiNumberItem;\r\n\t\t\t\t\tuiNumber.widget = 'number';\r\n\t\t\t\t\tuiNumber.placeholder = 'ID number, only on debugging';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = {items};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\trenderForm(item:T):JSX.Element {\r\n\t\tlet v = new VFormView(this);\r\n\t\treturn v.render(item);\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CFormPage } from \"./CFormPage\";\r\n\r\nexport class VFormPage<C extends CFormPage<any>> extends VPage<C> {\r\n\theader() {return this.controller.label}\r\n\tprotected get back(): 'close' | 'back' | 'none' {\r\n\t\treturn 'close';\r\n\t}\r\n\t\r\n\tcontent() {\r\n\t\t/*let {param, schema, uiSchema} = this.controller;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t<Form fieldLabelSize={2} formData={param}\r\n\t\t\t\tschema={schema}\r\n\t\t\t\tuiSchema={uiSchema}\r\n\t\t\t\tonButtonClick={this.onSubmit} />\r\n\t\t</div>*/\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{this.controller.renderForm(this.controller.item)}\r\n\t\t</div>;\r\n\t}\r\n\t/*\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tthis.controller.submit(context.data);\r\n\t}\r\n\t*/\r\n}\r\n","import { CFormView } from \"./CFormView\";\r\nimport { FormUI } from \"./FormUI\";\r\nimport { VFormPage } from \"./VFormPage\";\r\n\r\nexport class CFormPage<T> extends CFormView<T> {\r\n\titem: T;\r\n\tconstructor(formUI: FormUI, item: T) {\r\n\t\tsuper(formUI);\r\n\t\tthis.item = item;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage<any, any>(VFormPage);\r\n\t}\r\n}\r\n","import { CFormDialog } from \"./CFormDialog\";\r\nimport { VFormPage } from \"./VFormPage\";\r\n\r\nexport class VDialog extends VFormPage<CFormDialog<any>> {\r\n\tprotected afterBack():void {\r\n\t\tthis.controller.close();\r\n\t}\r\n}\r\n","import { CFormPage } from \"./CFormPage\";\r\nimport { VDialog } from \"./VDialog\";\r\n\r\nexport class CFormDialog<T> extends CFormPage<T> {\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VDialog)\r\n\t}\r\n\r\n\tclose() {\r\n\t\tthis.returnCall(null);\r\n\t}\r\n\r\n\tasync submit(data:any) {\r\n\t\tlet item: any;\r\n\t\tif (!this.item) item = this.item;\r\n\t\telse item = {};\r\n\t\tObject.assign(item, data);\r\n\t\tthis.returnCall(item);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","import { ChangedHandler, ChangingHandler, FieldCustoms, FieldItem, FieldItemId, FieldItemString, ID, PickId, TFunc, UI } from \"tonva-react\";\r\nimport { createPickId } from '../CIDSelect';\r\n\r\nexport class FormUI {\r\n\tlabel: string|JSX.Element;\r\n\treadonly fieldArr: FieldItem[];\r\n\treadonly fields: {[name:string]: FieldItem};\r\n\tsubmitCaption: string;\r\n\tt: TFunc;\r\n\r\n\tconstructor(ui: UI, fieldCustoms:FieldCustoms, t?: TFunc) {\r\n\t\tthis.t = t ?? ((str:string|JSX.Element) => str);\r\n\t\tlet {label, fieldArr, fields} = ui;\r\n\t\tthis.label = label;\r\n\t\tthis.fieldArr = [];\r\n\t\tthis.fields = {};\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tlet fieldCustom = fieldCustoms?.[i];\r\n\t\t\tlet index = fieldArr.findIndex(v => v === field);\r\n\t\t\tlet f:FieldItem;\r\n\t\t\tif (fieldCustom) {\r\n\t\t\t\tlet label = this.t(fieldCustom.label ?? field.label);\r\n\t\t\t\tf = {...field, ...fieldCustom, label};\r\n\t\t\t\tlet {ID} = field;\r\n\t\t\t\tif (ID) {\r\n\t\t\t\t\tlet idField = f as FieldItemId;\r\n\t\t\t\t\tidField.widget = 'id';\r\n\t\t\t\t\tidField.pickId = createPickId(ID.uq.proxy, ID);\r\n\t\t\t\t\t(idField as any).Templet = ID.render;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet label = this.t(field.label);\r\n\t\t\t\tf = {...field, label};\r\n\t\t\t}\r\n\t\t\tthis.fields[i] = f;\r\n\t\t\tthis.fieldArr[index] = f;\r\n\t\t}\r\n\t\t/*\r\n\t\tif (fieldCustoms) {\r\n\t\t\tfor (let i in fieldCustoms) {\r\n\t\t\t\tlet field = fieldCustoms[i];\r\n\t\t\t\tlet {ID} = field;\r\n\t\t\t\tif (ID) {\r\n\t\t\t\t\tthis.setIDUi(i, createPickId(ID.uq.proxy, ID), ID.render);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t}\r\n\r\n\tsetIDUi(fieldName:string, pickId: PickId, render: (values:any) => JSX.Element) {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (field === undefined) {\r\n\t\t\talert(`${fieldName} not defined in UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (field.type !== 'id') {\r\n\t\t\talert(`${fieldName} is not id UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet idField = field as FieldItemId;\r\n\t\tidField.widget = 'id';\r\n\t\tidField.pickId = pickId;\r\n\t\t(idField as any).Templet = render;\r\n\t}\r\n\r\n\tasync setNO(ID:ID, fieldName:string = 'no'):Promise<void> {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (!field) return;\r\n\t\tif (field.type !== 'string') return;\r\n\t\tlet noField = field as FieldItemString;\r\n\t\tnoField.readOnly = true;\r\n\t\tlet no = await ID.NO();\r\n\t\tnoField.defaultValue = no;\r\n\t}\r\n\r\n\thideField(...fieldNames:string[]) {\r\n\t\tfor (let fieldName of fieldNames) {\r\n\t\t\tlet index = this.fieldArr.findIndex(v => v.name === fieldName);\r\n\t\t\tif (index >= 0) this.fieldArr.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\tsetFieldChanged(fieldName: string, onChanged: ChangedHandler) {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (field) field.onChanged = onChanged;\r\n\t}\r\n\r\n\tsetFieldChanging(fieldName: string, onChanging: ChangingHandler) {\r\n\t\tlet field = this.fields[fieldName];\r\n\t\tif (field) field.onChanging = onChanging;\r\n\t}\r\n}\r\n","export * from '../old/Mid';\r\nexport * from './IDBase';\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray} from 'mobx';\r\nimport { PageItems } from '../tool';\r\nimport {Field, ArrFields} from './uqMan';\r\nimport {Entity} from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class QueryPager<T extends any> extends PageItems<T> {\r\n\tprivate query: Query;\r\n\tprivate $page: any;\r\n\tprotected idFieldName: any;\r\n    constructor(query: Query, pageSize?: number, firstSize?: number, itemObservable?:boolean) {\r\n        super(itemObservable);\r\n        this.query = query;\r\n        if (pageSize !== undefined) this.pageSize = pageSize;\r\n\t\tif (firstSize !== undefined) this.firstSize = firstSize;\r\n\t}\r\n\r\n\tsetReverse() {\r\n\t\tthis.appendPosition = 'head';\r\n\t}\r\n\r\n    protected async onLoad() {\r\n\t\tif (this.$page) return;\r\n        let {schema} = this.query;\r\n        if (schema === undefined) {\r\n\t\t\tawait this.query.loadSchema();\r\n\t\t\tschema = this.query.schema;\r\n\t\t}\r\n\t\tif (schema === undefined) return;\r\n\t\tlet $page = this.$page = (schema.returns as any[]).find(v => v.name === '$page');\r\n\t\tif ($page === undefined) return;\r\n\t\tthis.sortOrder = $page.order;\r\n\t\tlet fields = $page.fields;\r\n\t\tif (fields !== undefined) {\r\n\t\t\tlet field = fields[0];\r\n\t\t\tif (field) this.idFieldName = field.name;\r\n\t\t}\r\n    }\r\n\r\n    protected async loadResults(param:any, pageStart:number, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.query.page(param, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\tif (item === undefined) return;\r\n\t\tif (typeof item === 'number') return item;\r\n\t\tlet start = (item as any)[this.idFieldName];\r\n\t\tif (start === null) return;\r\n\t\tif (start === undefined) return;\r\n\t\tif (typeof start === 'object') {\r\n\t\t\tlet id = start.id;\r\n\t\t\tif (id !== undefined) return id;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\tasync refreshItems(item:T) {\r\n\t\tlet index = this._items.indexOf(item);\r\n\t\tif (index < 0) return;\r\n\t\tlet startIndex:number;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\tstartIndex = index - 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartIndex = index + 1;\r\n\t\t}\r\n\t\tlet pageStart = this.getPageId(this._items[startIndex]);\r\n\t\tlet pageSize = 1;\r\n        let ret = await this.load(\r\n\t\t\tthis.param, \r\n\t\t\tpageStart,\r\n\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tif (len === 0) {\r\n\t\t\tthis._items.splice(index, 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet newItem = ret[i];\r\n\t\t\tif (!newItem) continue;\r\n\t\t\tlet newId = newItem[this.idFieldName];\r\n\t\t\tif (newId === undefined || newId === null) continue;\r\n\t\t\tif (typeof newId === 'object') newId = newId.id;\r\n\t\t\tlet oldItem = this._items.find(v => {\r\n\t\t\t\tlet oldId = (v as any)[this.idFieldName];\r\n\t\t\t\tif (oldId === undefined || oldId === null) return false;\r\n\t\t\t\tif (typeof oldId === 'object') oldId = oldId.id;\r\n\t\t\t\treturn oldId = newId;\r\n\t\t\t});\r\n\t\t\tif (oldItem) {\r\n\t\t\t\t_.merge(oldItem, newItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    list:IObservableArray; // = observable.array([], {deep: false});\r\n    returns: ArrFields[];\r\n\tisPaged: boolean;\r\n\t\r\n\t/*\r\n\tconstructor(uq:UqMan, name:string, typeId:number) {\r\n\t\tsuper(uq, name, typeId);\r\n\t\tmakeObservable(this, {\r\n\t\t\tlist: observable,\r\n\t\t})\r\n\t}\r\n\t*/\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        this.list = undefined;\r\n    }\r\n    get hasMore() {return this.more;}\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\r\n        let data = await this.unpackReturns(res);\r\n        let page = data['$page'] as any[];\r\n        */\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n        //this.loaded = true;\r\n    }\r\n\r\n    protected pageCaller(params: any, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, showWaiting);\r\n    }\r\n    async query(params:P, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import _ from 'lodash';\r\nimport {nav} from '../components';\r\nimport {uid} from '../tool/uid';\r\nimport {uqTokenApi, callCenterapi, centerToken, setCenterToken, UqTokenApi} from './uqApi';\r\nimport {setSubAppWindow} from './wsChannel';\r\nimport { host } from './host';\r\nimport { env } from '../tool';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\nconst uqTokens:{[uqName:string]: UqToken}  = {};\r\nexport function logoutUqTokens() {\r\n    for (let i in uqTokens) {\r\n        uqTokens[i] = undefined;\r\n    }\r\n\tUqTokenApi.clearLocal();\r\n}\r\n\r\nexport function isBridged():boolean {\r\n    return window.self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n\tif (!message) return;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            window.console.log('///\\\\\\\\\\\\ pop-app');\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                db: ret.db,\r\n                url: ret.url,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n\t\t\tif ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n            window.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    let user = nav.user = message; // message.user;\r\n    setCenterToken(user.id, user.token);\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n\tlet {unit} = env;\r\n    if (!unit) {\r\n        console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n    }\r\n    let parts = apiName.split('/');\r\n    let param = {unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n    console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n    let ret = await uqTokenApi.uq(param);\r\n    let {db, url, token} = ret;\r\n    return {name: apiName, db:db, url: url, token: token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, db, url, urlTest, token} = message;\r\n    let action = uqTokenActions[apiName];\r\n    if (action === undefined) {\r\n        throw new Error('error app api return');\r\n        //return;\r\n    }\r\n    let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n    //action.url = realUrl;\r\n    //action.token = token;\r\n    action.resolve({\r\n        name: apiName,\r\n        db: db,\r\n        url: realUrl,\r\n        token: token,\r\n    } as UqToken);\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\nexport async function buildAppUq(uq:string, uqOwner:string, uqName:string):Promise<void> {\r\n    if (!isBridged()) {\r\n\t\t//let unit = getUnit();\r\n\t\tlet {unit} = env;\r\n        let uqToken = await uqTokenApi.uq({unit,  uqOwner, uqName});\r\n        if (uqToken.token === undefined) uqToken.token = centerToken;\r\n        let {db, url, urlTest} = uqToken;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n    //console.log(\"**** before buildAppUq ****\", appInFrame);\r\n    let bp = uqTokenActions[uq];\r\n    if (bp !== undefined) return;\r\n    return new Promise<void>((resolve, reject) => {\r\n        uqTokenActions[uq] = {\r\n            resolve: async (at:any) => {\r\n                let {db, url, token} = await at;\r\n                uqTokens[uq] = {\r\n                    name: uq,\r\n                    db: db,\r\n                    url: url,\r\n                    token: token,\r\n                };\r\n                uqTokenActions[uq] = undefined;\r\n                //console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                resolve();\r\n            },\r\n            reject: reject,\r\n        };\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: uq,\r\n            //hash: appInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\nexport function getUqToken(uq:string):UqToken {\r\n    let uts = uqTokens;\r\n    return uts[uq];\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","import { messageHub } from \"./messageHub\";\r\n\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n\tprivate messageHub = messageHub;\r\n\t/*\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\t*/\r\n\t/*\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n\t}\r\n\t*/\r\n    async receive(msg:any) {\r\n\t\tthis.messageHub.dispatch(msg);\r\n\t\t/*\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport const wsBridge = new WsBridge();\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(wsHost: string, token: string) {\r\n        super();\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\n\r\nexport interface ImageProps {\r\n    src: string;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n}\r\n\r\n// src = .src, 表示fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet {className, style, src, altImage} = props;\r\n\tlet icon:string;\r\n    if (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = nav.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt=>{\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src=altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","import { ID, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../../base\";\r\nimport { CList, IDListPageItems, MidList } from \"../list\";\r\nimport { renderSelectItem } from \"./parts\";\r\n\r\nexport class CIDSelect<T extends IDBase, P extends MidIDSelectList<T>> extends CList<T> {\r\n\tmidIDSelectList: P;\r\n\tconstructor(midIDSelectList: P) {\r\n\t\tsuper(midIDSelectList);\r\n\t\tthis.setRes(midIDSelectList.res);\r\n\t\tthis.midIDSelectList = midIDSelectList;\r\n\t}\r\n\r\n\tprotected createMidList(): MidList<T> {\r\n\t\treturn new MidIDSelectList(this.midIDSelectList.uq, this.midIDSelectList.ID);\r\n\t}\r\n\r\n\tprotected onItemClick(item:any):void {\r\n\t\treturn; //this.props.onItemClick(item);\r\n\t}\r\n\r\n\tprotected renderRight():JSX.Element {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected renderItem(item:any, index:number):JSX.Element {\r\n\t\tlet onChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\t\tlet {onSelectChange} = this.midIDSelectList;\r\n\t\t\tonSelectChange?.(item, evt.currentTarget.checked);\r\n\t\t}\r\n\t\tlet {renderItem, ID} = this.midIDSelectList;\r\n\t\tlet content = (renderItem ?? ID.render)(item, index);\r\n\t\tlet {$in} = item;\r\n\t\treturn renderSelectItem(onChange, content, $in===1);\r\n\t}\r\n}\r\n\r\nexport class MidIDSelectList<T extends IDBase> extends MidList<T> {\r\n\treadonly ID:ID;\r\n\tonSelectChange: (item:T, isSelected:boolean)=>any;\r\n\r\n\tconstructor(uq:Uq, ID:ID) {\r\n\t\tsuper(uq);\r\n\t\tthis.ID = ID;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.ID.loadSchema();\r\n\t}\r\n\tkey:((item:T) => number|string) = item => item.id;\r\n\r\n\tprotected createPageItems() {\r\n\t\tlet listPageItems = new IDListPageItems<T>(\r\n\t\t\t(pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize)\r\n\t\t);\r\n\t\treturn listPageItems;\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","export function renderSelectItem(\r\n\tonChange:(evt:React.ChangeEvent<HTMLInputElement>)=>void, \r\n\tcontent:any,\r\n\tdefaultChecked:boolean):JSX.Element {\r\n\treturn <label className=\"mx-3 my-2 d-flex mb-0\">\r\n\t\t<input type=\"checkbox\" onChange={onChange} className=\"mr-3\" defaultChecked={defaultChecked} />\r\n\t\t{content}\r\n\t</label>;\r\n}","import { ID, IX, Uq } from \"tonva-react\";\r\nimport { IDListPageItems } from \"../list\";\r\nimport { IXBase } from \"../../base\";\r\nimport { CIDSelect, MidIDSelectList } from \"./CIDSelect\";\r\n\r\nexport class CIXSelect<T extends IXBase> extends CIDSelect<T, MidIXSelectList<T>> {\r\n}\r\n\r\nexport class MidIXSelectList<T extends IXBase> extends MidIDSelectList<T> {\r\n\treadonly IX:IX;\r\n\treadonly id:number;\r\n\tconstructor(uq:Uq, ID:ID, IX:IX, id:number) {\r\n\t\tsuper(uq, ID);\r\n\t\tthis.IX = IX;\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait super.init();\r\n\t\tawait this.IX.loadSchema();\r\n\t}\r\n\r\n\tkey:((item:T) => number|string) = item => item.id;\r\n\r\n\tprotected createPageItems() {\r\n\t\tlet listPageItems = new IDListPageItems<T>(\r\n\t\t\t(pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize)\r\n\t\t);\r\n\t\treturn listPageItems;\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.IDinIX<T>({\r\n\t\t\tID: this.ID,\r\n\t\t\tIX: this.IX,\r\n\t\t\tid: this.id,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret as any[];\r\n\t}\r\n}\r\n","import { Context, ID, PickId, Uq } from \"tonva-react\";\r\nimport { CIDSelect,MidIDSelectList } from \"./CIDSelect\";\r\n\r\nexport function createPickId(uq: Uq, ID: ID): PickId {\r\n\tasync function pickId(context:Context, name: string, value: number):Promise<any> {\r\n\t\tlet mid: MidIDSelectList<any> = new MidIDSelectList(uq, ID);\r\n\t\tlet cIDSelect = new CIDSelectInPickId(mid);\r\n\t\tlet ret = await cIDSelect.call<any>();\r\n\t\treturn ret;\r\n\t}\r\n\treturn pickId;\r\n}\r\n\r\nexport class CIDSelectInPickId extends CIDSelect<any, MidIDSelectList<any>> {\r\n\tconstructor(mid: MidIDSelectList<any>) {\r\n\t\tsuper(mid);\r\n\t\tmid.onSelectChange = this.onSelectChange;\r\n\t}\r\n\r\n\tprivate onSelectChange = (item:any, isSelected:boolean) => {\r\n\t\tthis.selectedItem = item;\r\n\t\tthis.closePage();\r\n\t\t// closePage时，returnCall已经被调用了\r\n\t\t// this.returnCall(item);\r\n\t}\r\n}\r\n","import { FA, List, Scroller, VPage } from \"tonva-react\";\r\nimport { CIDList } from \"./CIDList\";\r\n\r\nexport class VIDList extends VPage<CIDList<any>> {\r\n\theader() {\r\n\t\tlet {props} = this.controller;\r\n\t\tlet {listHeader, header} = props;\r\n\t\tif (listHeader) return listHeader;\r\n\t\tif (header) {\r\n\t\t\tswitch (typeof header) {\r\n\t\t\t\tdefault: return header;\r\n\t\t\t\tcase 'string': return header + ' ' + this.t('list');\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet {ID} = this.controller.props;\r\n\t\tlet ret = ID.t(ID.sName);\r\n\t\tif (typeof ret === 'string') return ret + ' ' + this.t('list');\r\n\t\treturn  <>{ret} {this.t('list')}</>;\r\n\t}\r\n\tright():JSX.Element {\r\n\t\tlet {props, onAddItem} = this.controller;\r\n\t\tlet {renderRight} = props;\r\n\t\tif (renderRight === null) return null;\r\n\t\tif (renderRight !== undefined) return renderRight();\r\n\t\treturn <button className=\"btn btn-sm btn-success mr-1\" \r\n\t\t\tonClick={onAddItem}>\r\n\t\t\t<FA name=\"plus\" />\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {props, onClickItem} = this.controller;\r\n\t\tlet {renderItem} = props;\r\n\t\treturn <div>\r\n\t\t\t<List items={this.controller.pageItems} \r\n\t\t\t\titem={{\r\n\t\t\t\t\trender: renderItem ?? this.renderItem,\r\n\t\t\t\t\tonClick: onClickItem,\r\n\t\t\t\t}} />\r\n\t\t</div>\r\n\t}\t\r\n\r\n\tprivate renderItem = (item:any, index:number) => {\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{this.controller.props.ID.render(item)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {\r\n\t\tawait this.controller.pageItems.more();\r\n\t\treturn;\r\n\t}\r\n\tprotected afterBack():void {}\r\n}\r\n","import { ID, PageItems, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { CIDEdit } from \"../CIDEdit\";\r\nimport { CIDView } from \"../CIDView\";\r\nimport { CUqUi, IDListUiProps } from \"../props\";\r\nimport { VIDList } from \"./VIDList\";\r\n\r\nexport class CIDList<T extends IDBase> extends CUqUi<IDListUiProps<T>> {\r\n\tpageItems: IDPageItems<T>;\r\n\r\n\tprotected async beforeStart(): Promise<boolean> {\r\n\t\tthis.pageItems = new IDPageItems<T>(this.uq, this.props.ID);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.pageItems.first({});\r\n\t\tthis.openVPage(VIDList);\r\n\t}\r\n\r\n\tonAddItem = async () => {\r\n\t\tlet {onAddItem} = this.props;\r\n\t\tif (onAddItem === null) return;\r\n\t\tif (onAddItem !== undefined) {\r\n\t\t\tawait onAddItem();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet cIDEdit = new CIDEdit({\r\n\t\t\t...this.props, \r\n\t\t\trenderRight: undefined,\r\n\t\t\tonItemChanged: this.onItemChanged\r\n\t\t});\r\n\t\tawait cIDEdit.start();\r\n\t}\r\n\r\n\tonClickItem = async (item:any) => {\r\n\t\tlet {props} = this;\r\n\t\tlet {onClickItem} = props;\r\n\t\tif (onClickItem === null) return;\r\n\t\tif (onClickItem !== undefined) return await onClickItem(item);\r\n\t\tlet cIDView = new CIDView<any>({\r\n\t\t\t...props, \r\n\t\t\trenderRight: undefined,\r\n\t\t\tonItemChanged: this.onItemChanged\r\n\t\t});\r\n\t\tawait cIDView.start(item);\r\n\t}\r\n\r\n\tprivate onItemChanged = async (item:T) => {\r\n\t\tthis.pageItems.update(item);\r\n\t}\r\n}\r\n\r\nclass IDPageItems<T extends IDBase> extends PageItems<T> {\r\n\tprivate uq:Uq;\r\n\tprivate ID: ID;\r\n\tconstructor(uq:Uq, ID: ID) {\r\n\t\tsuper(true);\r\n\t\tthis.uq = uq;\r\n\t\tthis.ID = ID;\r\n\t}\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn {$page:ret};\r\n\t}\r\n\tupdate(item:T) {\r\n\t\tlet orgItem = this._items.find(v => v.id === item.id);\r\n\t\tif (orgItem) {\r\n\t\t\tObject.assign(orgItem, item);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._items.unshift(item);\r\n\t\t}\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CIDEdit } from \"./CIDEdit\";\r\n\r\nexport class VIDEdit extends VPage<CIDEdit<any>> {\r\n\theader() {\r\n\t\tlet {ID} = this.controller.props;\r\n\t\treturn ID.t(ID.sName);\r\n\t}\r\n\tcontent() {\r\n\t\tlet {cFormView, item} = this.controller;\r\n\t\t//let {IDUI} = midID;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{cFormView.renderForm(item)}\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { runInAction } from \"mobx\";\r\nimport { Context } from \"node:vm\";\r\nimport { ButtonSchema, FieldItem, FieldItemId, FieldItemString, PickId, Schema, UiButton, UiItemCollection, UiSchema } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { CFormView, FormUI } from \"../form\";\r\nimport { CIDBase } from \"../CIDBase\";\r\nimport { IDEditUiProps } from \"../props\";\r\nimport { VIDEdit } from \"./VIDEdit\";\r\n\r\nexport class CIDEdit<T extends IDBase> extends CIDBase<T, IDEditUiProps<T>> {\r\n\tcFormView: CFormView<T>;\r\n\r\n\tprotected async internalStart(item: T) {\r\n\t\tlet {ID} = this.props;\r\n\t\tthis.item = item;\r\n\t\tawait this.loadSchema();\r\n\t\tthis._itemSchema = await this.buildItemSchema();\r\n\t\tthis._uiSchema = this.buildUISchema();\r\n\t\tthis.createFormView();\r\n\t\tawait this.cFormView.setNO(ID);\r\n\t\tthis.openVPage(VIDEdit);\r\n\t}\r\n\r\n\tprotected createFormView() {\r\n\t\tlet {ID, fieldCustoms} = this.props;\r\n\t\tlet formUI = new FormUI(ID.ui, fieldCustoms, ID.t);\r\n\t\tthis.cFormView = new CFormView(formUI);\r\n\t\tthis.cFormView.onSubmit = this.onSubmit;\r\n\t}\r\n\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tawait this.saveID(context.data);\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tasync saveID(itemProps:any) {\r\n\t\tlet {ID, onItemChanged, saveItem} = this.props;\r\n\t\tlet id = this.item?.id;\r\n\t\tlet item = {\r\n\t\t\t...itemProps,\r\n\t\t\tid,\r\n\t\t}\r\n\r\n\t\tif (!saveItem) {\r\n\t\t\tsaveItem = async (item: T) => {\r\n\t\t\t\tlet param: any = {};\r\n\t\t\t\tparam[ID.name] = [item];\r\n\t\t\t\tlet ret = await this.uq.Acts(param);\r\n\t\t\t\tlet row = ret[ID.name];\r\n\t\t\t\tif (row) {\r\n\t\t\t\t\tid = row[0];\r\n\t\t\t\t\treturn id;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet retId = await saveItem(item);\r\n\t\tif (retId) {\r\n\t\t\titem.id = retId;\r\n\t\t}\r\n\r\n\t\tif (onItemChanged) {\r\n\t\t\tawait onItemChanged(item);\r\n\t\t}\r\n\t\trunInAction(() => {\r\n\t\t\tif (this.item)\r\n\t\t\t\tObject.assign(this.item, item);\r\n\t\t\telse\r\n\t\t\t\tthis.item = item;\r\n\t\t});\r\n\t\t//this.valueChanged = true;\r\n\t\t//return ret;\r\n\t}\r\n\r\n\tprotected async buildItemSchema(): Promise<Schema> {\r\n\t\tlet {ID} = this.props;\r\n\t\tlet ret:Schema = [];\r\n\t\tlet {fieldArr} = ID.ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet {type, isKey} = f;\r\n\t\t\tlet required = isKey; // (keys as any[]).findIndex(v => v.name === name) >= 0;\r\n\t\t\tlet fieldItem = {\r\n\t\t\t\t...f,\r\n\t\t\t\trequired,\r\n\t\t\t};\r\n\t\t\tswitch (type) {\r\n\t\t\t\tdefault: ret.push(fieldItem); break;\r\n\t\t\t}\r\n\t\t\tlet {ID} = fieldItem;\r\n\t\t\tif (ID) {\r\n\t\t\t\t//let importSelect = await import('../select');\r\n\t\t\t\t//this.setIDUi(fieldItem, importSelect.createPickId(this.uq, ID), ID.render);\r\n\t\t\t}\r\n\t\t}\r\n\t\tret.push({\r\n\t\t\tname: 'submit',\r\n\t\t\ttype: 'submit',\r\n\t\t} as ButtonSchema);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema():UiSchema {\r\n\t\tlet {ID} = this.props;\r\n\t\tlet items:UiItemCollection = {};\r\n\t\tthis._uiSchema = {items};\r\n\t\tlet {fields} = ID.ui;\r\n\t\tif (fields) {\r\n\t\t\tfor (let f of this._itemSchema) {\r\n\t\t\t\tlet {name} = f;\r\n\t\t\t\tObject.assign(f, (fields as any)[name]);\r\n\t\t\t\t(items as any)[name] = f;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\treturn this._uiSchema;\r\n\t}\r\n\tprotected async loadSchema() {\r\n\t\tawait this.props.ID.loadSchema();\r\n\t}\r\n\r\n\tprivate _itemSchema: Schema;\r\n\tget itemSchema(): Schema {return this._itemSchema;}\r\n\r\n\tprivate _uiSchema: UiSchema;\r\n\tget uiSchema(): UiSchema {return this._uiSchema;}\r\n\r\n\tprotected setIDUi(fieldItem:FieldItem, pickId: PickId, render: (values:any) => JSX.Element) {\r\n\t\tif (fieldItem.type !== 'id') {\r\n\t\t\talert(`${fieldItem.name} is not id UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet idField = fieldItem as FieldItemId;\r\n\t\tidField.widget = 'id';\r\n\t\tidField.pickId = pickId;\r\n\t\t(idField as any).Templet = render;\r\n\t}\r\n\r\n\tprotected setNO(no:string, noFieldItem: FieldItem) {\r\n\t\tif (!noFieldItem) return;\r\n\t\tif (noFieldItem.type !== 'string') return;\r\n\t\tlet noField = noFieldItem as FieldItemString;\r\n\t\tnoField.readOnly = true;\r\n\t\tnoField.defaultValue = no;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, PropGrid, VPage } from \"tonva-react\";\r\nimport { CIDView } from \"./CIDView\";\r\n\r\nexport class VIDView extends VPage<CIDView<any>> {\r\n\theader() {\r\n\t\tlet {ID} = this.controller.props;\r\n\t\treturn ID.t(ID.sName);\r\n\t}\r\n\tright() {\r\n\t\tlet {props, onEditItem: onAddItem} = this.controller;\r\n\t\tlet {renderRight} = props;\r\n\t\tif (renderRight === null) return null;\r\n\t\tif (renderRight !== undefined) return renderRight();\r\n\t\treturn <button className=\"btn btn-sm btn-info mr-1\" \r\n\t\t\tonClick={onAddItem}>\r\n\t\t\t<FA name=\"pencil\" />\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {item, gridProps} = this.controller;\r\n\t\t\treturn <div className=\"py-3\">\r\n\t\t\t\t<PropGrid rows={gridProps}\r\n\t\t\t\t\tvalues={item} />\r\n\t\t\t</div>;\t\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n}\r\n","import { Prop } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { CIDBase } from \"../CIDBase\";\r\nimport { CIDEdit } from \"../CIDEdit\";\r\nimport { IDViewUiProps } from \"../props\";\r\nimport { VIDView } from \"./VIDView\";\r\n\r\nexport class CIDView<T extends IDBase> extends CIDBase<T, IDViewUiProps<T>> {\r\n\tprotected async internalStart(item: T) {\r\n\t\tthis.item = item;\r\n\t\tawait this.props.ID.loadSchema();\r\n\t\tthis.buildGridProps();\r\n\t\tthis.openVPage(VIDView);\r\n\t}\r\n\r\n\tprivate _props: Prop[];\r\n\tget gridProps():Prop[] {\r\n\t\tif (this._props !== undefined) return this._props;\r\n\t\treturn this._props = this.buildGridProps();\r\n\t}\r\n\r\n\tprotected buildGridProps():Prop[] {\r\n\t\tlet ret:Prop[] = [];\r\n\t\tlet {ui, t, schema} = this.props.ID;\r\n\t\t//let {exFields} = schema;\r\n\t\tlet {fieldArr } = ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\t//let exField = (exFields as any[]).find(v => v.field === f.name);\r\n\t\t\t//if (!exField) continue;\r\n\t\t\tlet prop = {\r\n\t\t\t\t...f,\r\n\t\t\t\tlabel: t(f.label),\r\n\t\t\t};\r\n\t\t\tret.push(prop as any);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tonEditItem = async () => {\r\n\t\tlet {onEditItem, onItemChanged} = this.props;\r\n\t\tif (onEditItem === null) return;\r\n\t\tif (onEditItem !== undefined) {\r\n\t\t\tthis.item = await onEditItem(this.item);\r\n\t\t\tonItemChanged?.(this.item);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cIDEdit = new CIDEdit({\r\n\t\t\t\t...this.props, \r\n\t\t\t\trenderRight: undefined, \r\n\t\t\t\tonItemChanged: async (item: T) => {\r\n\t\t\t\t\tonItemChanged?.(item);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tawait cIDEdit.start(this.item);\r\n\t\t}\r\n\t}\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n\ticon?: string;\r\n\troles?: {[uq:string]: string[]}\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = process.env['REACT_APP_RES_HOST'] || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n\tlocal: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: process.env['REACT_APP_CENTER_DEBUG_HOST'] || centerDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    reshost: {\r\n        value: process.env['REACT_APP_RES_DEBUG_HOST'] || resDebugHost,\r\n\t\tlocal: false,\r\n    },\r\n    uqhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    unitxhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST'] || uqDebugBuilderHost, \r\n\t\tlocal: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n\tif (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nclass Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n\t\tif (!centerHost) debugger;\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n\t\tthis.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n\t\tif (!urlTest) {\r\n\t\t\turlTest = url;\r\n\t\t\tif (!urlTest) {\r\n\t\t\t\tconsole.error('no server set for ' + db);\r\n\t\t\t\tdebugger;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (!url) {\r\n\t\t\turl = urlTest;\r\n\t\t}\r\n\t\tlet testProd:string;\r\n        if (this.testing === true) {\r\n\t\t\tif (urlTest !== '-') url = urlTest;\r\n\t\t\ttestProd = 'test';\r\n        }\r\n        else {\r\n\t\t\ttestProd = 'prod';\r\n        }\r\n\t\turl = this.getUrlOrDebug(url);\r\n\t\tif (url.endsWith('/') === false) {\r\n\t\t\turl += '/';\r\n\t\t}\r\n        return `${url}uq/${testProd}/${db}/`;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nexport const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n\t\tawait fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","import React from 'react';\r\nimport { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop():void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom():void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n\tonScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n\tclassName?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nconst scrollEdgeGap = 30;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime:number = 0;\r\n\tprivate topTime:number = 0;\r\n\tprivate div: HTMLDivElement;\r\n\r\n\tprotected refDiv = (div:HTMLDivElement) => {\r\n\t\tif (!div) {\r\n\t\t\tif (this.div) {\r\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.div = div;\r\n\t\tthis.div.addEventListener('resize', this.onResize);\r\n\t}\r\n\r\n\tprivate onResize = (ev:UIEvent) => {\r\n\t\tconsole.error('div resize');\r\n\t};\r\n\r\n    protected onScroll = async (e:any) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < scrollEdgeGap) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\r\n\t\t\t\t\t\t // has more\r\n\t\t\t\t\t\tif (ret === true) {\r\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\r\n\t\t\t\t\t\t\tlet top = 200;\r\n\t\t\t\t\t\t\tif (top > sh) top = sh;\r\n\t\t\t\t\t\t\tel.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - scrollEdgeGap) {\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n\t}\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style} = this.props;\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\nexport interface PageWebNav {\r\n\tnavHeader?: JSX.Element; \r\n\tnavRawHeader?: JSX.Element; \r\n\tnavFooter?: JSX.Element; \r\n\tnavRawFooter?: JSX.Element; \r\n\trenderPageHeader?: (props:PageHeaderProps)=>JSX.Element;\r\n}\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n\twebNav: PageWebNav;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style, webNav} = this.props;\r\n\t\tlet {navHeader, navRawHeader, navFooter, navRawFooter} = webNav;\r\n\t\tlet vHeader:any, vFooter:any;\r\n\t\tif (navRawHeader) vHeader = navRawHeader;\r\n\t\telse if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n\t\tif (navRawFooter) vFooter = navRawFooter;\r\n\t\telse if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t{vHeader}\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t\t{vFooter}\r\n\t\t</div>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nexport interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    _.merge(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    _.merge(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    _.merge(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nconst resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\t_.merge(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\t_.merge(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\t_.merge(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\nexport function t(str:string):string|JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str:string|JSX.Element) => string|JSX.Element;\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data).request();\r\n    }\r\n    async submitConvert(data:P) {\r\n        return await new SubmitConvertCaller(this, data).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {data: this.entity.pack(this.params)}\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)} onClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string | JSX.Element;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","export * from './form';\r\nexport * from './base';\r\nexport * from './tools';\r\nexport * from './props';\r\nexport * from './CIDEdit';\r\nexport * from './CIDView';\r\nexport * from './CIDList';\r\nexport * from './CIXList';\r\nexport * from './CIX';\r\nexport * from './CXIList';\r\nexport * from './CXI';\r\nexport {CIDX as CIDXX } from './CIDX';\r\nexport {CIDXHistory as CIDXXHistory } from './CIDXHistory';\r\n\r\nexport * from './old';\r\n","import _ from 'lodash';\r\n\r\nclass _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { BoxId } from './boxId';\r\nimport { Tuid } from './tuid';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst TuidContent = (tuidName:string, values:any, x?:any) => {\r\n    return <>{tuidName}: {uqStringify(values)}</>;\r\n};\r\n\r\nexport function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n\r\nexport class ReactBoxId implements BoxId {\r\n    readonly id: number;\r\n    protected tuid: Tuid;\r\n    protected ui: (values:any) => JSX.Element;\r\n    readonly isUndefined:boolean;\r\n    constructor(id: number, tuid: Tuid, ui: (values:any) => JSX.Element) {\r\n        this.id = Number(id);\r\n        this.tuid = tuid;\r\n        this.ui = ui;\r\n        this.isUndefined = (this.tuid === undefined);\r\n    }\r\n\r\n    get obj():any {\r\n        return this.tuid.valueFromId(this.id);\r\n    }\r\n\r\n    equ(id:BoxId|number): boolean {\r\n        if (id === undefined || id === null) return false;\r\n        if (typeof id === 'object') return this.id === id.id;\r\n        return this.id === id;\r\n    }\r\n\r\n    render(ui:TvTemplet, x:any):JSX.Element {\r\n        if (this.id === undefined || this.id === null || isNaN(this.id) === true) return;\r\n        let boxName = this.boxName; // this.tuid.name;\r\n        let val = this.obj; // this.tuid.valueFromId(this.id);\r\n        if (this.isUndefined === true) {\r\n            if (ui !== undefined) return ui(val, x);\r\n            return TuidContent(boxName, val, x);\r\n        }\r\n        switch (typeof val) {\r\n            case 'undefined':\r\n                return <span className=\"text-black-50\">{boxName} undefined</span>;\r\n            case 'number':\r\n                return <span className=\"text-light\">{boxName} {this.id}</span>;\r\n        }\r\n        if (ui === undefined) {\r\n            ui = this.ui;\r\n        }\r\n        if (ui !== undefined) {\r\n            if (typeof ui !== 'function') {\r\n                ui = (ui as any).content;\r\n            }\r\n            if (ui !== undefined) {\r\n                let ret = ui(val/*, this.tuidUR.res*/);\r\n                if (ret !== undefined) return ret;\r\n                return <span className=\"text-danger\">{boxName} {this.id}</span>;\r\n            }\r\n        }\r\n\r\n        return TuidContent(boxName, val);\r\n    }\r\n\r\n    get boxName():string {return this.tuid.name}\r\n    // ui(): TvTemplet {return this.tuid.ui}\r\n    // res(): any {return this.tuid.res}\r\n\r\n    async assure(): Promise<BoxId> {\r\n        await this.tuid.assureBox(this.id);\r\n        return this;\r\n    }\r\n}\r\n\r\nfunction boxIdContent(bi: number|BoxId, ui:TvTemplet, x:any) {\r\n    let logContent:any;\r\n    let boxId:ReactBoxId = bi as ReactBoxId;\r\n    switch(typeof bi) {\r\n        case 'undefined': logContent = <>boxId undefined</>; break;\r\n        case 'number': logContent = <>id:{bi}</>; break;\r\n        default:\r\n            if (typeof boxId.render !== 'function') {\r\n                if (ui === undefined) {\r\n                    logContent = TuidContent(boxId.boxName, bi, x);\r\n                }\r\n                else {\r\n                    return ui(bi, x);\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    if (logContent !== undefined) {\r\n        return <del className=\"text-danger\">{logContent}</del>;\r\n    }\r\n    return boxId.render(ui, x);\r\n}\r\n\r\nexport type TvTemplet = (values?:any, x?:any) => JSX.Element;\r\n\r\ninterface Props {\r\n    tuidValue: number|BoxId, \r\n    ui?: TvTemplet,\r\n    x?: any,\r\n    nullUI?: ()=>JSX.Element\r\n}\r\n\r\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\r\n    if (tuidValue === undefined) {\r\n        if (nullUI === undefined) return <small className=\"text-muted\">[无]</small>;\r\n        return nullUI();\r\n    }\r\n    if (tuidValue === null) {\r\n        if (nullUI === undefined) return <>[null]</>;\r\n        return nullUI();\r\n    }\r\n    let ttv = typeof tuidValue;\r\n    switch (ttv) {\r\n        default:\r\n            if (ui === undefined)\r\n                return <>{ttv}-{tuidValue}</>;\r\n            else {\r\n                let ret = ui(tuidValue, x);\r\n                if (ret !== undefined) return ret;\r\n                return <>{tuidValue}</>;\r\n            }\r\n        case 'object':\r\n            let divObj = boxIdContent(tuidValue, ui, x);\r\n            if (divObj !== undefined) return divObj;\r\n            return nullUI === undefined? <>id null</>: nullUI();\r\n        case 'number':\r\n            return <>id...{tuidValue}</>;\r\n    }\r\n});\r\n\r\nexport const tv = (tuidValue:number|BoxId, ui?:TvTemplet, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\r\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\r\n};\r\n","import * as React from 'react';\r\n\r\nexport function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import { from62 } from './62';\r\nimport { LocalMap } from './localDb';\r\n\r\nexport const env = (function () {\r\n\tlet {unit, testing, params, lang, district, timeZone, isMobile} = initEnv();\r\n    return {\r\n\t\tunit,\r\n\t\ttesting,\r\n\t\tparams,\r\n\t\tlang, \r\n\t\tdistrict,\r\n\t\ttimeZone,\r\n\t\tbrowser: detectBrowser(), \r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n\t\tisMobile,\r\n        localDb: new LocalMap(testing===true? '$$':'$'),\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n\r\nfunction initEnv(): {\r\n\tunit: number; \r\n\ttesting: boolean; \r\n\tparams: {[key:string]: string}; \r\n\tlang: string; \r\n\tdistrict: string;\r\n\ttimeZone: number;\r\n\tisMobile: boolean;\r\n}\r\n{\r\n\tlet pl     = /\\+/g,  // Regex for replacing addition symbol with a space\r\n        search = /([^&=]+)=?([^&]*)/g,\r\n        decode = function (s:any) { return decodeURIComponent(s.replace(pl, \" \")); },\r\n        query  = window.location.search.substring(1);\r\n    let params:{[key:string]:string} = {};\r\n    for (;;) {\r\n\t   let match = search.exec(query);\r\n\t   if (!match) break;\r\n       params[decode(match[1])] = decode(match[2]);\t\r\n\t}\r\n\r\n\tlet testing:boolean; // = isTesting();\r\n\tlet unit:number;\r\n\r\n\tlet sUnit = params['u'] || params['unit'];\r\n\tif (sUnit) {\r\n\t\tlet p = sUnit.indexOf('-');\t\t\r\n\t\tif (p>=0) {\r\n\t\t\tlet tc = sUnit.charCodeAt(p+1);\r\n\t\t\tconst tt = 'tT';\r\n\t\t\ttesting = tc === tt.charCodeAt(0) || tc === tt.charCodeAt(1);\r\n\t\t\tsUnit = sUnit.substr(0, p);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttesting = false;\r\n\t\t}\r\n\t\tif (sUnit[0] === '0') {\r\n\t\t\tunit = Number(sUnit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tunit = from62(sUnit);\r\n\t\t}\r\n\t\tif (isNaN(unit) === true) unit = undefined;\r\n\t}\r\n\telse {\r\n\t\t// 下面都是为了兼容以前的操作。\r\n\t\t// 整个url上，只要有test作为独立的字符串出现，就是testing\r\n\t\ttesting = /(\\btest\\b)/i.test(document.location.href);\r\n\t\tlet unitName:string;\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\tunitName = el.innerText;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tel = document.getElementById('unit.json');\r\n\t\t\tif (el) {\r\n\t\t\t\tlet json = el.innerHTML;\r\n\t\t\t\tif (json) {\r\n\t\t\t\t\tlet res = JSON.parse(json);\r\n\t\t\t\t\tunitName = res?.unit;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unitName) {\r\n\t\t\tunitName = process.env.REACT_APP_UNIT;\r\n\t\t}\r\n\r\n\t\tif (unitName) {\r\n\t\t\tunit = Number.parseInt(unitName);\r\n\t\t\tif (Number.isInteger(unit) === false) {\r\n\t\t\t\tif (unitName === '百灵威') {\r\n\t\t\t\t\tunit = 24;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unit) unit = 0;\r\n\t}\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n\tlet timeZone = -new Date().getTimezoneOffset() / 60;\r\n\tconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\n\tconst isMobile = regEx.test(navigator.userAgent);\r\n\treturn {unit, testing, params, lang, district, timeZone, isMobile};\r\n}\r\n\r\nfunction detectBrowser() { \r\n    if((navigator.userAgent.indexOf(\"Opera\") || navigator.userAgent.indexOf('OPR')) >= 0 )\r\n        return 'Opera';\r\n\tif(navigator.userAgent.indexOf(\"Chrome\") >= 0 )\r\n        return 'Chrome';\r\n\tif(navigator.userAgent.indexOf(\"Safari\") >= 0)\r\n        return 'Safari';\r\n\tif(navigator.userAgent.indexOf(\"Firefox\") >= 0 )\r\n        return 'Firefox';\r\n\tif((navigator.userAgent.indexOf(\"MSIE\") >= 0 ) || (!!(document as any).documentMode === true ))\r\n        return 'IE'; //crap\r\n    return 'Unknown';\r\n}\r\n","import { User } from '../tool';\r\n\r\nexport interface Login {\r\n\tshowLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean):void;\r\n\tshowLogout(callback?: ()=>Promise<void>):void\r\n\t//showRegister():void\r\n\t//showForget():void\r\n\tshowChangePassword():void\r\n}\r\n\r\nexport async function createLogin():Promise<Login> {\r\n\tlet importCLogin = await import('../auth/CLogin');\r\n\treturn new importCLogin.CLogin();\r\n}\r\n\r\nexport async function showRegister():Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CRegister();\r\n\tc.start();\r\n}\r\n\r\nexport async function showForget():Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CForget();\r\n\tc.start();\r\n}\r\n","export * from './uqMan';\r\nexport * from './entity';\r\nexport * from './action';\r\nexport * from './query';\r\nexport * from './sheet';\r\nexport * from './tuid';\r\nexport * from './book';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\nexport * from './uqsMan';\r\nexport * from './tag/tag';\r\nexport * from './enum';\r\nexport * from './build';\r\nexport * from './ID';\r\n","\r\nexport * from './boxId';\r\nexport * from './tuid';\r\nexport { TuidsCache } from './tuidsCache';\r\nexport { tv, ReactBoxId, uqStringify } from './reactBoxId';","import { TFunc } from \"../res\";\r\nimport { Entity } from \"./entity\";\r\nimport { Render, UI } from '../ui';\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport abstract class IDXEntity<M> extends Entity {\r\n\treadonly ui: UI;\r\n\treadonly render: Render<M>;\r\n\treadonly t: TFunc;\r\n}\r\n\r\nexport class UqID<M> extends IDXEntity<M> {\r\n\tget typeName() {return 'id'}\r\n\tcreate: boolean;\r\n\tupdate: boolean;\r\n\towner: boolean;\r\n\tasync NO(): Promise<string> {\r\n\t\tlet ret = await this.uqApi.post('id-no', {ID:this.name});\r\n\t\treturn ret;\r\n\t};\r\n}\r\n\r\nexport class ID extends UqID<any> {\t\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIDX<M> extends IDXEntity<M> {\r\n\tget typeName() {return 'idx'}\r\n}\r\n\r\nexport class IDX extends UqIDX<any> {\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIX<M> extends IDXEntity<M> {\r\n\tget typeName() {return 'ix'}\r\n}\r\n\r\nexport class IX extends UqIX<any> {\r\n}\r\n\r\n/* eslint-enable no-unused-vars */\r\n","export class SlrForEarning {\r\n  slope: number;\r\n  intercept: number;\r\n  y: number[];\r\n  slopeR: number;\r\n  endY: number;\r\n  r2: number;\r\n\r\n  constructor(y:number[]) {\r\n    this.y = y;\r\n    this.regress();\r\n    let score = this.score();\r\n    this.r2 = score.r2;\r\n  }\r\n\r\n  regress() {\r\n    const n = this.y.length;\r\n    let xSum = 0;\r\n    let ySum = 0;\r\n  \r\n    let xSquared = 0;\r\n    let xY = 0;\r\n  \r\n    for (let x = 0; x < n; ++x) {\r\n      xSum += x;\r\n      ySum += this.y[x];\r\n      xSquared += x * x;\r\n      xY += x * this.y[x];\r\n    }\r\n  \r\n    const numerator = n * xY - xSum * ySum;\r\n    this.slope = numerator / (n * xSquared - xSum * xSum);\r\n    this.intercept = (1 / n) * ySum - this.slope * (1 / n) * xSum;\r\n\r\n    let ym = this.slope > 0 ? this.predict(n-2) : this.predict(1);\r\n    this.slopeR = ym < 0.01 ? undefined : this.slope / ym;\r\n  }\r\n\r\n  score() {\r\n    const n = this.y.length;\r\n    const y2 = new Array(n);\r\n    for (let i = 0; i < n; i++) {\r\n      y2[i] = this.predict(i);\r\n    }\r\n\r\n    let xSum = 0;\r\n    let ySum = 0;\r\n    let chi2 = 0;\r\n    let rmsd = 0;\r\n    let xSquared = 0;\r\n    let ySquared = 0;\r\n    let xY = 0;\r\n    for (let i = 0; i < n; i++) {\r\n      let yi2 = y2[i];\r\n      xSum += yi2;\r\n      let yi = this.y[i];\r\n      ySum += yi;\r\n      xSquared += yi2 * yi2;\r\n      ySquared += yi * yi;\r\n      xY += yi2 * yi;\r\n      let yiyi2 = yi - yi2;\r\n      if (yi !== 0) {\r\n        chi2 += (yiyi2 * yiyi2) / yi;\r\n      }\r\n      rmsd += yiyi2 * yiyi2;\r\n    }\r\n\r\n    const r =\r\n      (n * xY - xSum * ySum) /\r\n      Math.sqrt((n * xSquared - xSum * xSum) * (n * ySquared - ySum * ySum));\r\n\r\n    return {\r\n      r: r,\r\n      r2: r * r,\r\n      chi2: chi2,\r\n      rmsd: Math.sqrt(rmsd / n)\r\n    };\r\n  }\r\n\r\n\r\n  predict(x:number) {\r\n    return this.slope * x + this.intercept;\r\n  }\r\n\r\n  computeX(y:number) {\r\n    return (y - this.intercept) / this.slope;\r\n  }\r\n}\r\n","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, CenterAppApi } from '../net';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { nav } from '../components';\r\nimport { AppConfig, UqConfig } from '../app';\r\n\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n\r\nexport class UQsMan {\r\n\tstatic _uqs: any;\r\n\tstatic value: UQsMan;\r\n\r\n\tstatic async build(appConfig: AppConfig) {\r\n\t\tlet {app, uqs, tvs, version} = appConfig;\r\n\t\tlet retErrors:string[];\r\n\t\tif (app) {\r\n\t\t\tlet {dev, name, version} = app;\r\n\t\t\tretErrors = await UQsMan.load(`${dev.name}/${name}`, version, tvs);\r\n\t\t}\r\n\t\telse if (uqs) {\r\n\t\t\tretErrors = await UQsMan.loadUqs(uqs, version, tvs);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\tstatic async buildUQs(uqsConfig: AppConfig) {\r\n\t\tlet {uqs, tvs, version} = uqsConfig;\r\n\t\tlet retErrors:string[];\r\n\t\tif (uqs) {\r\n\t\t\tretErrors = await UQsMan.loadUqs(uqs, version, tvs);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tprivate static async load(tonvaAppName:string, version:string, tvs:TVs):Promise<string[]> {\r\n\t\tlet uqsMan = UQsMan.value = new UQsManApp(tonvaAppName, tvs);\r\n        let {appOwner, appName} = uqsMan;\r\n        let {localData} = uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await loadAppUqs(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n\t\tuqsMan.id = id;\r\n\t\t//console.error(uqAppData);\r\n\t\t//let ownerProfixMap: {[owner: string]: string};\r\n\t\treturn uqsMan.buildUqs(uqs, version);\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tprivate static async loadUqs(uqConfigs: UqConfig[], version:string, tvs:TVs):Promise<string[]> {\r\n\t\tlet uqsMan = UQsMan.value = new UQsMan(tvs);\r\n\t\tlet uqs = await loadUqs(uqConfigs);\r\n\t\treturn uqsMan.buildUqs(uqs, version, uqConfigs);\r\n\t}\r\n\r\n\tprivate uqMans: UqMan[] = [];\r\n    private collection: {[uqLower: string]: UqMan};\r\n    private readonly tvs: TVs;\r\n\r\n    protected constructor(tvs:TVs) {\r\n        this.tvs = tvs || {};\r\n\t\tthis.buildTVs();\r\n\t\tthis.uqMans = [];\r\n        this.collection = {};\r\n    }\r\n\r\n\tprivate async buildUqs(uqDataArr:UqData[], version:string, uqConfigs?:UqConfig[]):Promise<string[]> {\r\n        await this.init(uqDataArr);\r\n\r\n\t\tlet localMap = env.localDb.map('$app');\r\n\t\tlet localCacheVersion = localMap.child('version');\r\n\t\tlet cacheVersion = localCacheVersion.get();\r\n\t\tif (version !== cacheVersion) {\r\n\t\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t\tuqMan.localMap.removeAll();\r\n\t\t\t}\r\n\t\t\tlocalCacheVersion.set(version);\r\n\t\t}\r\n\r\n        let retErrors = await this.load();\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tretErrors.push(...this.setTuidImportsLocal());\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (uqConfigs) {\r\n\t\t\tfor (let uqConfig of uqConfigs) {\r\n\t\t\t\tlet {dev, name, alias} = uqConfig;\r\n\t\t\t\tlet {name:owner, alias:ownerAlias} = dev;\r\n\t\t\t\tlet uqLower = (ownerAlias??owner).toLowerCase() + '/' + (alias??name).toLowerCase();\r\n\t\t\t\tlet uq = this.collection[uqLower];\r\n\t\t\t\tuq.config = uqConfig;\r\n\t\t\t}\r\n\t\t}\r\n\t\tUQsMan._uqs = this.buildUQs();\r\n\t}\r\n\r\n\tstatic uq(uqName: string): UqMan {\r\n\t\treturn UQsMan.value.collection[uqName.toLowerCase()];\r\n\t}\r\n\t\r\n\tstatic async getUqUserRoles(uqLower:string):Promise<string[]> {\r\n\t\tlet uqMan = UQsMan.value.collection[uqLower];\r\n\t\tif (uqMan === undefined) return null;\r\n\t\tlet roles = await uqMan.getRoles();\r\n\t\treturn roles;\r\n\t}\r\n\r\n    private buildTVs() {\r\n\t\tif (!this.tvs) return;\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = [];\r\n\t\tfor (let uqData of uqsData) {\r\n\t\t\tlet {uqOwner, ownerAlias, uqName, uqAlias} = uqData;\r\n\r\n\t\t\t// 原名加入collection\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\tif (this.collection[uqFullName]) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet uq = new UqMan(this, uqData, undefined, this.tvs[uqFullName] || this.tvs[uqName]);\r\n\t\t\tthis.uqMans.push(uq);\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\r\n\t\t\t// 别名加入collection\r\n\t\t\tif (uqAlias) uqName = uqAlias;\r\n\t\t\tif (ownerAlias) uqOwner = ownerAlias;\r\n\t\t\tuqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\t\t\tpromiseInits.push(uq.init());\r\n\t\t}\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n\t\tlet promises: PromiseLike<string>[] = [];\r\n\t\t//let lowerUqNames:string[] = [];\r\n\t\t// collection有小写名字，还有正常名字\r\n        //for (let i in this.collection) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t//let lower = (i as string).toLowerCase();\r\n\t\t\t//if (lowerUqNames.indexOf(lower) >= 0) continue;\r\n\t\t\t//lowerUqNames.push(lower);\r\n            //let uq = this.collection[i];\r\n            promises.push(uqMan.loadEntities());\r\n\t\t}\r\n\t\tlet results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    buildUQs(): any {\r\n        //let that = this;\r\n        let uqs:any = {};\r\n        for (let uqMan of this.uqMans) {\r\n            let uqKey = uqMan.getUqKey();\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tlet proxy = uqMan.createProxy();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n        }\r\n        return new Proxy(uqs, {\r\n            get: (target, key, receiver) => {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                /*\r\n                for (let i in uqs) {\r\n                    if (i.toLowerCase() === lk) {\r\n                        return uqs[i];\r\n                    }\r\n                }*/\r\n                debugger;\r\n                console.error('error in uqs');\r\n                this.showReload(`新增 uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n\t}\r\n\t\r\n\tgetUqMans() {\r\n\t\treturn this.uqMans;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tuqMan.localMap.removeAll();\r\n\t\t}\r\n        nav.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let uqMan of this.uqMans) {\r\n            for (let tuid of uqMan.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n\r\nclass UQsManApp extends UQsMan {\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n\tconstructor(tonvaAppName:string, tvs:TVs) {\r\n\t\tsuper(tvs);\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n\t}\r\n}\r\n\r\nasync function loadAppUqs(appOwner:string, appName:string): Promise<UqAppData> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    let ret = await centerAppApi.appUqs(appOwner, appName);\r\n    return ret;\r\n}\r\n\r\nasync function loadUqs(uqConfigs: UqConfig[]): Promise<UqData[]> {\r\n\tlet uqs: {owner:string; ownerAlias: string; name:string; alias:string; version:string}[] = uqConfigs.map(\r\n\t\tv => {\r\n\t\t\tlet {dev, name, version, alias} =v;\r\n\t\t\tlet {name:owner, alias:ownerAlias} = dev;\r\n\t\t\treturn {owner, ownerAlias, name, version, alias};\r\n\t\t}\r\n\t);\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    let ret:UqData[] = await centerAppApi.uqs(uqs);\r\n\tfor (let i=0; i<uqs.length; i++) {\r\n\t\tlet {ownerAlias, alias} = uqs[i];\r\n\t\tret[i].ownerAlias = ownerAlias;\r\n\t\tret[i].uqAlias = alias;\r\n\t}\r\n    return ret;\r\n}\r\n","import { List, Scroller, VPage } from \"tonva-react\";\r\nimport { CIDSelect } from \"./CIDSelect\";\r\n\r\nexport class VIDSelect extends VPage<CIDSelect<any>> {\r\n\theader() {\r\n\t\tlet selText = this.t('select');\r\n\t\tlet {props} = this.controller;\r\n\t\tlet {listHeader, header} = props;\r\n\t\tif (listHeader) return listHeader;\r\n\t\tif (header) {\r\n\t\t\tswitch (typeof header) {\r\n\t\t\t\tdefault: return header;\r\n\t\t\t\tcase 'string': return selText + ' ' + header + ' ';\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet {ID} = this.controller.props;\r\n\t\tlet ret = ID.t(ID.sName);\r\n\t\tif (typeof ret === 'string') return selText + ' ' + ret;\r\n\t\treturn  <>{selText} {ret}</>;\r\n\t}\r\n\tright():JSX.Element {\r\n\t\treturn null;\r\n\t\t/*\r\n\t\tlet {props, onAddItem} = this.controller;\r\n\t\tlet {renderRight} = props;\r\n\t\tif (renderRight === null) return null;\r\n\t\tif (renderRight !== undefined) return renderRight();\r\n\t\treturn <button className=\"btn btn-sm btn-success mr-1\" \r\n\t\t\tonClick={onAddItem}>\r\n\t\t\t<FA name=\"plus\" />\r\n\t\t</button>;\r\n\t\t*/\r\n\t}\r\n\tcontent() {\r\n\t\tlet {props, onClickItem} = this.controller;\r\n\t\tlet {renderItem} = props;\r\n\t\treturn <div>\r\n\t\t\t<List items={this.controller.pageItems} \r\n\t\t\t\titem={{\r\n\t\t\t\t\trender: renderItem ?? this.renderItem,\r\n\t\t\t\t\tonClick: onClickItem,\r\n\t\t\t\t}} />\r\n\t\t</div>\r\n\t}\t\r\n\r\n\tprivate renderItem = (item:any, index:number) => {\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{this.controller.props.ID.render(item)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {\r\n\t\tawait this.controller.pageItems.more();\r\n\t\treturn;\r\n\t}\r\n\tprotected afterBack():void {}\r\n}\r\n","import { IDBase } from \"../base\";\r\nimport { CIDList } from \"../CIDList\";\r\nimport { VIDSelect } from \"./VIDSelect\";\r\n\r\nexport class CIDSelect<T extends IDBase> extends CIDList<T> {\r\n\tprotected async internalStart() {\r\n\t\tawait this.pageItems.first({});\r\n\t\tthis.openVPage(VIDSelect);\r\n\t}\r\n\r\n\tonClickItem = async (item:any) => {\r\n\t\tthis.returnCall(item);\r\n\t}\r\n}\r\n","import { Context, ID, PickId, Uq } from \"tonva-react\";\r\nimport { CIDSelect } from \"./CIDSelect\";\r\n\r\nexport function createPickId(uq: Uq, ID: ID): PickId {\r\n\tasync function pickId(context:Context, name: string, value: number):Promise<any> {\r\n\t\t//let mid: MidIDSelectList<any> = new MidIDSelectList(uq, ID);\r\n\t\tlet props = {\r\n\t\t\tuq,\r\n\t\t\tID,\r\n\t\t};\r\n\t\tlet cIDSelect = new CIDSelectInPickId(props);\r\n\t\tlet ret = await cIDSelect.call<any>();\r\n\t\treturn ret;\r\n\t}\r\n\treturn pickId;\r\n}\r\n\r\nexport class CIDSelectInPickId extends CIDSelect<any> {\r\n\t/*\r\n\tconstructor(mid: MidIDSelectList<any>) {\r\n\t\tsuper(mid);\r\n\t\tmid.onSelectChange = this.onSelectChange;\r\n\t}\r\n\t*/\r\n\r\n\tprivate onSelectChange = (item:any, isSelected:boolean) => {\r\n\t\t//this.selectedItem = item;\r\n\t\tthis.closePage();\r\n\t\t// closePage时，returnCall已经被调用了\r\n\t\t// this.returnCall(item);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { ItemSchema, UiImageItem, UiItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\nimport { nav } from '../nav';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { Edit } from './edit';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem {return this._uiItem as UiImageItem}\r\n\tresId: string = null;\r\n\t\r\n\tconstructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) {\r\n\t\tsuper(edit, itemSchema, uiItem, label, value);\r\n\t\tmakeObservable(this, {\r\n\t\t\tresId: observable\r\n\t\t})\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            nav.push(React.createElement(this.page, {resolve:resolve, reject:reject}), ()=>reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let size:any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader \r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId):Promise<void>=>{resolve(resId); return;}} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c mr-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import { ButtonSchema, FieldItem, FieldItemId, FieldItemString, IDUI, IDXEntity, PickId, Prop, Schema, UiButton, UiSchema, Uq } from \"tonva-react\";\r\n\r\nexport abstract class Mid {\r\n\treadonly uq: Uq;\r\n\treadonly res: any;\r\n\tconstructor(uq: Uq, res?: any) {\r\n\t\tthis.uq = uq;\r\n\t\tthis.res = res;\r\n\t}\r\n\r\n\tabstract init():Promise<void>;\r\n\r\n\tprotected async buildItemSchema(IDUI: IDUI): Promise<Schema> {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet ret:Schema = [];\r\n\t\tlet {fieldArr} = ID.ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet {type, isKey} = f;\r\n\t\t\tlet required = isKey; // (keys as any[]).findIndex(v => v.name === name) >= 0;\r\n\t\t\tlet fieldItem = {\r\n\t\t\t\t...f,\r\n\t\t\t\trequired,\r\n\t\t\t};\r\n\t\t\tswitch (type) {\r\n\t\t\t\tdefault: ret.push(fieldItem); break;\r\n\t\t\t}\r\n\t\t\tlet {ID} = fieldItem;\r\n\t\t\tif (ID) {\r\n\t\t\t\tlet importSelect = await import('./select');\r\n\t\t\t\tthis.setIDUi(fieldItem, importSelect.createPickId(this.uq, ID), ID.render);\r\n\t\t\t}\r\n\t\t}\r\n\t\tret.push({\r\n\t\t\tname: 'submit',\r\n\t\t\ttype: 'submit',\r\n\t\t} as ButtonSchema);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(IDUI:IDUI):UiSchema {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet {fields} = ID.ui;\r\n\t\tlet items = {...fields as any};\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\tlet ret = {items};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildGridProps(IDX: IDXEntity<any>):Prop[] {\r\n\t\tlet ret:Prop[] = [];\r\n\t\tlet {ui, t, schema} = IDX;\r\n\t\tlet {exFields} = schema;\r\n\t\tlet {fieldArr } = ui;\r\n\t\tfor (let f of fieldArr) {\r\n\t\t\tlet exField = (exFields as any[]).find(v => v.field === f.name);\r\n\t\t\tif (!exField) continue;\r\n\t\t\tlet prop = {\r\n\t\t\t\t...f,\r\n\t\t\t\tlabel: t(f.label),\r\n\t\t\t};\r\n\t\t\tret.push(prop as any);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected setIDUi(fieldItem:FieldItem, pickId: PickId, render: (values:any) => JSX.Element) {\r\n\t\tif (fieldItem.type !== 'id') {\r\n\t\t\talert(`${fieldItem.name} is not id UI`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet idField = fieldItem as FieldItemId;\r\n\t\tidField.widget = 'id';\r\n\t\tidField.pickId = pickId;\r\n\t\t(idField as any).Templet = render;\r\n\t}\r\n\r\n\tprotected setNO(no:string, noFieldItem: FieldItem) {\r\n\t\tif (!noFieldItem) return;\r\n\t\tif (noFieldItem.type !== 'string') return;\r\n\t\tlet noField = noFieldItem as FieldItemString;\r\n\t\tnoField.readOnly = true;\r\n\t\tnoField.defaultValue = no;\r\n\t}\r\n\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed, makeObservable, runInAction} from 'mobx';\r\n\r\nexport abstract class PageItems<T> {\r\n    loading: boolean = false;\r\n    beforeLoad: boolean = true;\r\n    loaded: boolean = false;\r\n    _items:IObservableArray<T> = null;\r\n    allLoaded: boolean = false;\r\n    get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n    topDiv:string = '$$top';\r\n\tbottomDiv:string = '$$bottom';\r\n\r\n    constructor(itemObservable:boolean = false) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloading: observable,\r\n\t\t\tbeforeLoad: observable,\r\n\t\t\tloaded: observable,\r\n\t\t\t_items: observable,\r\n\t\t\tallLoaded: observable,\r\n\t\t\titems: computed,\r\n\t\t\ttopDiv: observable,\r\n\t\t\tbottomDiv: observable,\r\n\t\t});\r\n\t\tif (itemObservable === undefined) itemObservable = false;\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n\t\t\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.isFirst = true;\r\n\t\t\tthis.beforeLoad = true;\r\n\t\t\tthis.loaded = false;\r\n\t\t\tthis.param = undefined;\r\n\t\t\tthis.allLoaded = false;\r\n\t\t\tthis.pageStart = undefined;\r\n\t\t\tthis._items.clear();\r\n\t\t\t//this.setPageStart(undefined);\r\n\t\t});\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('没有定义增减序，无法attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.loading = true;\r\n\t\t\tthis.changing = true;\r\n\t\t});\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tlet allLoaded:boolean;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            allLoaded = true;\r\n\t\t}\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.onLoaded();\r\n\t\trunInAction(() => {\r\n\t\t\tthis.loaded = true;\r\n\t\t\tthis.allLoaded = allLoaded;\r\n\t\t\tthis.isFirst = false;\r\n\t\t\tthis.changing = false;\r\n\t\t\tthis.loading = false;\r\n\t\t});\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\treturn this._items[index];\r\n\t}\r\n\r\n\tremoveItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\tlet ret = this._items.splice(index, 1);\r\n\t\treturn ret[0];\r\n\t}\r\n}\r\n","const digits = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\nconst c0 = digits.charCodeAt(0);\r\nconst c9 = digits.charCodeAt(9);\r\nconst A = digits.charCodeAt(10);\r\nconst Z = digits.charCodeAt(35);\r\nconst a = digits.charCodeAt(36);\r\nconst z = digits.charCodeAt(61);\r\nexport function from62(v:string):number {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'string') return Number.NaN;\r\n\tlet len = v.length;\r\n\tif (len === 0) return Number.NaN;\r\n\tlet ret = 0;\r\n\tfor (let i=0; i<len; i++) {\r\n\t\tlet c = v.charCodeAt(i);\r\n\t\tlet n:number;\r\n\t\tif (c < c0) return Number.NaN;\r\n\t\tif (c <= c9) {\r\n\t\t\tn = c - c0;\r\n\t\t}\r\n\t\telse if (c < A) {\r\n\t\t\treturn Number.NaN;\r\n\t\t} \r\n\t\telse if (c <= Z) {\r\n\t\t\tn = c - A + 10;\r\n\t\t}\r\n\t\telse if (c < a) {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\telse if (c <= z) {\r\n\t\t\tn = c - a + 36;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\tret *= 62;\r\n\t\tret += n;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nexport function to62(v:number):string {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'number') return '';\r\n\tif (v < 0) return '';\r\n\tlet ret = '';\r\n\tfor (;;) {\r\n\t\tret = digits[v % 62] + ret;\r\n\t\tv = Math.floor(v / 62);\r\n\t\tif (v === 0) break;\r\n\t}\r\n\treturn ret;\r\n}\r\n","class MessageHub {\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\r\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\r\n    registerReceiveHandler(...args:any[]):number {\r\n\t\tlet seed = this.handlerSeed++;\r\n\t\tlet args0 = args[0];\r\n\t\tlet handler:(msg:any)=>Promise<void>;\r\n\t\tswitch (typeof args0) {\r\n\t\t\tcase 'string':\r\n\t\t\t\thandler = args[1];\r\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis.anyHandlers[seed] = args0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n\r\nexport const messageHub = new MessageHub();\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done:()=>void, params:object) => void;\r\n\tafter: (params:object) => void;\r\n\tleave: (params:object) => void;\r\n\talready: (params:object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: {[name:string]:string};\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string|RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t  typeof window !== 'undefined' &&\r\n\t\t  window.history &&\r\n\t\t  window.history.pushState\r\n\t\t);\r\n\t}\r\n\t\r\n\tprivate static clean(s:string|RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s:string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t  .slice(1, match.length)\r\n\t\t  .reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t  }, null);\r\n\t}\r\n\t  \r\n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\r\n\t\tlet paramNames:string[] = [], regexp:RegExp;\r\n\t  \r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\t  \r\n\tprivate static getUrlDepth(url:string):number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\t  \r\n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\t  \r\n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\t  \r\n\tprivate static match(url:string, routes:Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\t  \r\n\tprivate static root(url:string, routes:Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/(\\\\w|%|[\\u4E00-\\u9FCC])+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\t  \r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\t  \r\n\tprivate static extractGETParameters(url:string):string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\t  \r\n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\r\n\t\tlet onlyURL = url, split:string[];\r\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\r\n\t  \r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\t  \r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\t  \r\n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\t  \r\n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tif (!url.match(hash)) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tlet split = url.split(hash);\r\n\t  \r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\t\r\n\tprivate root:string;\r\n\tprivate _routes:Route[] = [];\r\n\tprivate _useHash:boolean;\r\n\tprivate _hash:string;\r\n\tprivate _paused:boolean;\r\n\tprivate _destroyed:boolean;\r\n\tprivate _lastRouteResolved:LastResolved;\r\n\tprivate _notFoundHandler:Handler;\r\n\tprivate _defaultHandler:Handler;\r\n\tprivate _usePushState:boolean;\r\n\tprivate _genericHooks:Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash)? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\t\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n  \r\n\tnavigate(path:string, absolute:boolean = false):Navigo {\r\n\t\tlet to:string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tto = to.replace('/#test/', '/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet {location} = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = { \r\n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler:RouteFunc):Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?:string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\t\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\t\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\tif (onlyURL.startsWith('/') === false) {\r\n\t\t\tonlyURL = '/' + onlyURL;\r\n\t\t}\r\n\t\r\n\t\tif (this._paused) return false;\r\n\t\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\t\r\n\t\tlet manageHooks = (handler:Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: React.MouseEvent<HTMLElement>) => {\r\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\t\t\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name:string, data:any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\t\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path:string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status:boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link:any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks:Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler: handler.uses,\r\n\t\t\t\tname: handler.as,\r\n\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t} \r\n\t\t\t:\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler, \r\n\t\t\t\tname: undefined,\r\n\t\t\t\thooks,\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root === null) {\r\n\t\t\tlet cLoc = this._cLoc();\r\n\t\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\t}\r\n\t\tlet root = this.root.replace('#test', '');\r\n\t\treturn root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\t\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\tlet {href} = window.location;\r\n\t\t\treturn Navigo.cleanUrl(href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet {params, hooks} = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//export default Navigo;\r\nexport const navigo = new Navigo();\r\n","import * as React from 'react';\r\nimport {nav} from '../nav';\r\n\r\nexport interface PageHeaderProps {\r\n    back?: 'back' | 'close' | 'none';\r\n    center: string | JSX.Element;\r\n    right?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n    className?: string;\r\n\tafterBack?: () => void;\r\n\tex?: JSX.Element;\r\n}\r\n\r\nexport function renderPageHeader(props: PageHeaderProps, inWebNav?: boolean) {\r\n    let onBack = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    let onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet {logout} = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout(); \r\n\t\t\t}\r\n\t\t\tawait nav.logout(undefined);\r\n\t\t}\r\n\t\tnav.showLogout(logout);\r\n    }\r\n\r\n\tlet b = nav.level > 1 || window.self !== window.top;\r\n\tlet {back, right, center, logout, className, ex} = props;\r\n\tif (inWebNav === true &&  !back && !right && !center) return;\r\n\tlet vBack:any, debugLogout:any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function')\r\n\t\t{\r\n\t\t\tlet {user} = nav;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{nav.closeIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps> {\r\n\trender() {return renderPageHeader(this.props)}\r\n\t/*\r\n    private back = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    openWindow() {\r\n        window.open(document.location.href);\r\n    }\r\n    private logoutClick = () => {\r\n        nav.showLogout(this.logout);\r\n    }\r\n    private logout = async () => {\r\n        let {logout} = this.props;\r\n        if (typeof logout === 'function') {\r\n            await logout(); \r\n        }\r\n        await nav.logout(undefined);\r\n    }\r\n    render() {\r\n        let b = nav.level > 1 || window.self !== window.top;\r\n        let {right, center, logout, className, ex} = this.props;\r\n        let back:any, debugLogout:any;\r\n        if (logout !== undefined && window.self === window.top) {\r\n            if ((typeof logout === 'boolean' && logout === true)\r\n                || typeof logout === 'function')\r\n            {\r\n                let {user} = nav;\r\n                if (user !== undefined) {\r\n                    let {nick, name} = user;\r\n                    debugLogout = <div className=\"d-flex align-items-center\">\r\n                        <small className=\"text-light\">{nick || name}</small>\r\n                        {\r\n                            // eslint-disable-next-line\r\n                            <div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n                                role=\"button\"\r\n                                onClick={this.logoutClick}>\r\n                                <i className=\"fa fa-sign-out fa-lg\" />\r\n                            </div>\r\n                        }\r\n                    </div>;\r\n                }\r\n            }\r\n        }\r\n        if (b) {\r\n            switch (this.props.back) {\r\n                case 'none':\r\n                    back = undefined;\r\n                    break;\r\n                default:\r\n                case 'back':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n                    break;\r\n                case 'close':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n                    break;\r\n            }\r\n        }\r\n        if (window.self !== window.top) {\r\n            console.log(document.location.href);\r\n            // pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n        }\r\n        if (back === undefined && typeof center === 'string') {\r\n            center = <div className=\"px-3\">{center}</div>;\r\n        }\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n        return <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\tloaded: boolean = false;\r\n\tselected: boolean = false;\r\n\t\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n\tprivate _content: JSX.Element;\r\n\t\r\n\tconstructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloaded: observable, \r\n\t\t\tselected: observable, \r\n\t\t});\r\n\t}\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\trunInAction(() => {\r\n\t\t\t\t\tthis.loaded = true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string|JSX.Element, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    private sep: string;\r\n    selectedTab: Tab;\r\n    tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n\t\tmakeObservable(this, {\r\n\t\t\tselectedTab: observable, \r\n\t\t\ttabArr: observable,\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabClick(this.selectedTab);\r\n\t\t}, 100);\t\t\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trunInAction(() => {\r\n\t\t\tthis.selectedTab.selected = false;\r\n\t\t\ttab.selected = true;\r\n\t\t\tthis.selectedTab = tab;\r\n\t\t});\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = typeof notify === 'number'? notify : notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} style={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { LMR } from './simple';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n\tfileName: string = null;\r\n\t\r\n\tconstructor(props: ResUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tfileName: observable,\r\n\t\t});\r\n\t}\r\n\r\n    buildFormData():FormData {\r\n        let {maxSize} = this.props;\r\n        if (maxSize === undefined || maxSize <= 0) \r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files:FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i=0; i<len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData):Promise<string|{error:any}> => {\r\n        let resUrl = nav.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return {error:err};\r\n        }\r\n        finally {\r\n            nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let {onFilesChange} = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names:string[] = [];\r\n        for (let i=0; i<len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let {className, multiple, label} = this.props;\r\n        return <div>\r\n                <label className=\"btn btn-outline-success\">\r\n                    {label || '选择文件'} \r\n                    <input \r\n                        className={className}\r\n                        ref={t=>this.fileInput=t} \r\n                        onChange={this.onFilesChange}\r\n                        type='file' name='file' \r\n                        multiple={multiple} style={{display:'none'}} />\r\n                </label>\r\n                &nbsp;\r\n                {this.fileName}\r\n            </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size:number, pointLength:number=2, units?:string[]) {\r\n    var unit;\r\n    units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\r\n    while ( (unit = units.shift()) && size > 1024 ) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed( pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n\tonSaved?: (imageId:string) => Promise<void>;\r\n\timageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n\tprivate static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n\tprivate imgBaseSize: number;\r\n\tprivate imageTypes: string[];\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\t\r\n    file: File = null;\r\n    desImgWidth: number = null;\r\n    desImgHeight: number = null;\r\n    desImgSize: number = null;\r\n    srcImgWidth: number = null;\r\n    srcImgHeight: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    srcImage: string = null;\r\n    desImage: string = null;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tfile: observable,\r\n\t\t\tdesImgWidth: observable,\r\n\t\t\tdesImgHeight: observable,\r\n\t\t\tdesImgSize: observable,\r\n\t\t\tsrcImgWidth: observable,\r\n\t\t\tsrcImgHeight: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\tresId: observable,\r\n\t\t\tenableUploadButton: observable,\r\n\t\t\tsrcImage: observable,\r\n\t\t\tdesImage: observable,\r\n\t\t\tfileError: observable,\r\n\t\t\tuploaded: observable,\r\n\t\t});\r\n\t\tthis.resId = props.id;\r\n\t\tthis.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(this.imageTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.srcImage = reader.result as string;\r\n\t\t\t\tswitch (this.suffix ) {\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tawait this.setSize(this.props.size);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'svg':\r\n\t\t\t\t\t\tthis.imgBaseSize = mediumSize;\r\n\t\t\t\t\t\tthis.desImgSize = this.srcImage.length;\r\n\t\t\t\t\t\tthis.desImage = this.srcImage;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n\t\t\t\tthis.imgBaseSize = largeSize; break;\r\n\t\t\tcase 'xl':\r\n\t\t\t\tthis.imgBaseSize = xlargeSize; break;\r\n\t\t\tcase 'raw':\r\n\t\t\t\tthis.imgBaseSize = -1; break;\r\n\t\t}\r\n\t\tthis.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = ():Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let {width, height} = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n\t\t\t\tlet w:number, h:number;\r\n\t\t\t\tif (this.imgBaseSize < 0) {\r\n\t\t\t\t\tw = width;\r\n\t\t\t\t\th = height;\r\n\t\t\t\t}\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix , quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3*1024*1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{caption:'小图', size:'sm'}];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({caption:'中图', size:'md'});\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({caption:'大图', size:'lg'});\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n\t\t\tarr.push({caption:'超大图', size:'xl'});\r\n\t\t\tarr.push({caption:'原图', size:'raw'});\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let {caption, size} = v;\r\n            return <label key={index} className=\"mr-3\"><input type=\"radio\" name=\"size\" \r\n                onChange={()=>this.setSize(size as any)}\r\n                defaultChecked={index===0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n                            :\r\n                            this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                <div className=\"mr-5\">\r\n                                    {this.levelDiv()}\r\n                                    <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                    &nbsp; &nbsp;\r\n                                    文件大小：{formatSize(this.desImgSize)}\r\n                                    </div>\r\n                                </div>\r\n                                <button className=\"btn btn-primary\" \r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                    }\r\n                    right={this.desImage && \r\n                        <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                            原图大小: {formatSize(this.file.size)}<br/>\r\n                            分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                        </button>\r\n                    }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\" \r\n                    style={{\r\n                        border: (this.uploaded===true? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId:string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n\tprivate static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\r\n\tcontent: string = null;\r\n\tfile: File = null;\r\n\tfileSize: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    fileError: string = null;\r\n\tuploaded: boolean = false;\r\n\tuploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tcontent: observable,\r\n\t\t\tfile: observable,\r\n\t\t\tfileSize: observable,\r\n\t\t\r\n\t\t\tisChanged: observable,\r\n\t\t\tresId: observable,\r\n\t\t\tenableUploadButton: observable,\r\n\t\t\tfileError: observable,\r\n\t\t\tuploaded: observable,\r\n\t\t\tuploading: observable,\r\n\t\t});\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(AudioUploader.audioTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.content = reader.result as string;\r\n\t\t\t\tthis.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n\t\tif (!this.resUploader) return;\r\n\t\tthis.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t\t<LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tthis.uploading === true?\r\n\t\t\t\t\t\t\t\t<div className=\"m-3\"><Loading /></div>\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tthis.file && this.content && <div className=\"m-3\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t\t\t\t\t\t\t文件大小：{formatSize(this.fileSize)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn btn-primary\" \r\n\t\t\t\t\t\t\t\t\t\tdisabled={!this.enableUploadButton}\r\n\t\t\t\t\t\t\t\t\t\tonClick={this.upload}>上传</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t/>\r\n        </Page>;\r\n    }\r\n}\r\n","import { UqApi, UqData, UnitxApi } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache, env, capitalCase } from '../tool';\r\nimport { UQsMan } from './uqsMan';\r\nimport { ReactBoxId } from './tuid/reactBoxId';\r\nimport { Tag } from './tag/tag';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\nimport { UqConfig } from '../app';\r\nimport { ID, IX, IDX } from './ID';\r\nimport { nav } from '../components';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'float' | 'double' | 'char' | 'text'\r\n\t| 'datetime' | 'date' | 'time' | 'timestamp';\r\n\r\nexport function fieldDefaultValue(type: FieldType) {\r\n\tswitch (type) {\r\n\t\tcase 'tinyint':\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\t\treturn 0;\r\n\t\tcase 'char':\r\n\t\tcase 'text':\r\n\t\t\treturn '';\r\n\t\tcase 'datetime':\r\n\t\tcase 'date':\r\n\t\t\treturn '2000-1-1';\r\n\t\tcase 'time':\r\n\t\t\treturn '0:00';\r\n\t}\r\n}\r\n\r\nexport interface Field {\r\n\tname: string;\r\n\ttype: FieldType;\r\n\ttuid?: string;\r\n\tarr?: string;\r\n\tnull?: boolean;\r\n\tsize?: number;\r\n\towner?: string;\r\n\t_tuid?: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n\tname: string;\r\n\tfields: Field[];\r\n\tid?: string;\r\n\torder?: string;\r\n}\r\nexport interface FieldMap {\r\n\t[name: string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n\towner: string;\r\n\tuq: string;\r\n}\r\nexport interface TuidModify {\r\n\tmax: number;\r\n\tseconds: number;\r\n}\r\n\r\ninterface ParamPage {\r\n\tstart: number;\r\n\tend?: number;\r\n\tsize: number;\r\n}\r\n\r\nexport interface ParamActIX<T> {\r\n\tIX: IX;\r\n\tID?: ID;\r\n\tIXs?: { IX: IX, ix: number }[];\t\t\t\t// 一次写入多个IX\r\n\tvalues: { ix: number, xi: number | T }[];\r\n}\r\n\r\nexport interface ParamActIXSort {\r\n\tIX: IX;\r\n\tix: number;\r\n\tid: number;\t\t\t\t\t// id to be moved\r\n\tafter: number;\t\t\t\t// insert after id. if before first, then 0\r\n}\r\n\r\nexport interface ParamActDetail<M, D> {\r\n\tmaster: {\r\n\t\tID: ID;\r\n\t\tvalue: M;\r\n\t};\r\n\tdetail: {\r\n\t\tID: ID;\r\n\t\tvalues: D[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail {\r\n\tmaster: number;\r\n\tdetail: number[];\r\n}\r\n\r\nexport interface ParamActDetail2<M, D, D2> extends ParamActDetail<M, D> {\r\n\tdetail2: {\r\n\t\tID: ID;\r\n\t\tvalues: D2[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail2 extends RetActDetail {\r\n\tdetail2: number[];\r\n}\r\n\r\nexport interface ParamActDetail3<M, D, D2, D3> extends ParamActDetail2<M, D, D2> {\r\n\tdetail3: {\r\n\t\tID: ID;\r\n\t\tvalues: D3[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail3 extends RetActDetail2 {\r\n\tdetail3: number[];\r\n}\r\n\r\nexport interface ParamQueryID {\r\n\tID?: ID;\r\n\tIX?: (IX | string)[];\r\n\tIDX?: (ID | IDX)[];\r\n\tid?: number | number[];\r\n\tkey?: { [key: string]: string | number };\r\n\tix?: number;\r\n\tidx?: number | number[];\r\n\tkeyx?: { [key: string]: string | number };\r\n\tpage?: ParamPage;\r\n\torder?: 'desc' | 'asc';\r\n}\r\n\r\nexport interface ParamIDNO {\r\n\tID: ID;\r\n}\r\n\r\nexport interface ParamIDDetailGet {\r\n\tid: number;\r\n\tmaster: ID;\r\n\tdetail: ID;\r\n\tdetail2?: ID;\r\n\tdetail3?: ID;\r\n}\r\n\r\nexport interface ParamID {\r\n\tIDX: (ID | IDX) | (ID | IDX)[];\r\n\tid: number | number[];\r\n\torder?: 'asc' | 'desc',\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyID {\r\n\tID: ID;\r\n\tIDX?: (ID | IDX)[];\r\n\tIX?: IX[];\r\n\tkey: { [key: string]: string | number };\r\n\tix?: number;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIX {\r\n\tIX: IX;\r\n\tIX1?: IX;\r\n\tix: number | number[];\r\n\tIDX?: (ID | IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyIX {\r\n\tID: ID;\r\n\tkey: { [key: string]: string | number };\r\n\tIX: IX;\r\n\tIDX?: (ID | IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDLog {\r\n\tIDX: (ID | IDX);\r\n\tfield: string;\r\n\tid: number;\r\n\tlog: 'each' | 'day' | 'week' | 'month' | 'year';\r\n\ttimeZone?: number;\r\n\tfar?: number;\r\n\tnear?: number;\r\n\tpage: ParamPage;\r\n}\r\n\r\nexport interface ParamIDSum {\r\n\tIDX: IDX;\r\n\tfield: string[];\r\n\tid: number | number[];\r\n\tfar?: number;\t\t\t\t// 以前\r\n\tnear?: number;\t\t\t\t// 最近\r\n}\r\n\r\nexport interface ParamIDxID {\r\n\tID: ID;\r\n\tIX: IX;\r\n\tID2: ID;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface IDXValue {\r\n\tvalue: number;\r\n\ttime?: number | Date;\r\n\tsetAdd: '=' | '+';\r\n}\r\n\r\nexport interface ParamIDinIX {\r\n\tID: ID;\r\n\tid: number;\r\n\tIX: IX;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDTree {\r\n\tID: ID;\r\n\tparent: number;\r\n\tkey: string | number;\r\n\tlevel?: number;\t\t\t\t// 无值，默认1一级\r\n\tpage?: ParamPage;\r\n}\r\n\r\nfunction IDPath(path: string): string { return path; }\r\n\r\nexport interface Uq {\r\n\t$: UqMan;\r\n\tActs(param: any): Promise<any>;\r\n\tActIX<T>(param: ParamActIX<T>): Promise<number[]>;\r\n\tActIXSort(param: ParamActIXSort): Promise<void>;\r\n\tActDetail<M, D>(param: ParamActDetail<M, D>): Promise<RetActDetail>;\r\n\tActDetail<M, D, D2>(param: ParamActDetail2<M, D, D2>): Promise<RetActDetail2>;\r\n\tActDetail<M, D, D2, D3>(param: ParamActDetail3<M, D, D2, D3>): Promise<RetActDetail3>;\r\n\tQueryID<T>(param: ParamQueryID): Promise<T[]>;\r\n\tIDNO(param: ParamIDNO): Promise<string>;\r\n\tIDDetailGet<M, D>(param: ParamIDDetailGet): Promise<[M[], D[]]>;\r\n\tIDDetailGet<M, D, D2>(param: ParamIDDetailGet): Promise<[M[], D[], D2[]]>;\r\n\tIDDetailGet<M, D, D2, D3>(param: ParamIDDetailGet): Promise<[M[], D[], D2[], D3[]]>;\r\n\tID<T>(param: ParamID): Promise<T[]>;\r\n\tKeyID<T>(param: ParamKeyID): Promise<T[]>;\r\n\tIX<T>(param: ParamIX): Promise<T[]>;\r\n\tIXr<T>(param: ParamIX): Promise<T[]>; // IX id 反查IX list\r\n\tKeyIX<T>(param: ParamKeyIX): Promise<T[]>;\r\n\tIDLog<T>(param: ParamIDLog): Promise<T[]>;\r\n\tIDSum<T>(param: ParamIDSum): Promise<T[]>;\r\n\tIDxID<T, T2>(param: ParamIDxID): Promise<[T[], T2[]]>; // ID list with IX 对应的子集\r\n\tIDinIX<T>(param: ParamIDinIX): Promise<T & { $in: boolean }[]>;\r\n\tIDTree<T>(param: ParamIDTree): Promise<T[]>;\r\n}\r\n\r\nexport class UqMan {\r\n\tprivate readonly entities: { [name: string]: Entity } = {};\r\n\tprivate readonly enums: { [name: string]: UqEnum } = {};\r\n\tprivate readonly actions: { [name: string]: Action } = {};\r\n\tprivate readonly queries: { [name: string]: Query } = {};\r\n\tprivate readonly ids: { [name: string]: ID } = {};\r\n\tprivate readonly idxs: { [name: string]: IDX } = {};\r\n\tprivate readonly ixs: { [name: string]: IX } = {};\r\n\r\n\tprivate readonly sheets: { [name: string]: Sheet } = {};\r\n\tprivate readonly books: { [name: string]: Book } = {};\r\n\tprivate readonly maps: { [name: string]: Map } = {};\r\n\tprivate readonly histories: { [name: string]: History } = {};\r\n\tprivate readonly pendings: { [name: string]: Pending } = {};\r\n\tprivate readonly tags: { [name: string]: Tag } = {};\r\n\tprivate readonly tuidsCache: TuidsCache;\r\n\tprivate readonly localEntities: LocalCache;\r\n\tprivate readonly tvs: { [entity: string]: (values: any) => JSX.Element };\r\n\tproxy: any;\r\n\treadonly localMap: LocalMap;\r\n\treadonly localModifyMax: LocalCache;\r\n\treadonly tuids: { [name: string]: Tuid } = {};\r\n\treadonly createBoxId: CreateBoxId;\r\n\treadonly newVersion: boolean;\r\n\treadonly uqOwner: string;\r\n\treadonly uqName: string;\r\n\treadonly name: string;\r\n\treadonly uqApi: UqApi;\r\n\treadonly id: number;\r\n\r\n\tuqVersion: number;\r\n\t//ownerProfix: string;\r\n\tconfig: UqConfig;\r\n\r\n\tconstructor(uqs: UQsMan, uqData: UqData, createBoxId: CreateBoxId, tvs: { [entity: string]: (values: any) => JSX.Element }) {\r\n\t\tthis.createBoxId = createBoxId;\r\n\t\tif (createBoxId === undefined) {\r\n\t\t\tthis.createBoxId = this.createBoxIdFromTVs;\r\n\t\t\tthis.tvs = tvs || {};\r\n\t\t}\r\n\t\tlet { id, uqOwner, uqName, /*access, */newVersion } = uqData;\r\n\t\tthis.newVersion = newVersion;\r\n\t\tthis.uqOwner = uqOwner;\r\n\t\tthis.uqName = uqName;\r\n\t\tthis.id = id;\r\n\t\tthis.name = uqOwner + '/' + uqName;\r\n\t\tthis.uqVersion = 0;\r\n\t\t//this.localMap = uqs.localMap.map(this.name);\r\n\t\tthis.localMap = env.localDb.map(this.name);\r\n\t\tthis.localModifyMax = this.localMap.child('$modifyMax');\r\n\t\tthis.localEntities = this.localMap.child('$access');\r\n\t\tlet baseUrl = 'tv/';\r\n\r\n\t\t/*\r\n\t\tlet acc: string[];\r\n\t\tif (access === null || access === undefined || access === '*') {\r\n\t\t\tacc = [];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tacc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n\t\t}\r\n\t\t*/\r\n\t\tif (this.name === '$$$/$unitx') {\r\n\t\t\t// 这里假定，点击home link之后，已经设置unit了\r\n\t\t\t// 调用 UnitxApi会自动搜索绑定 unitx service\r\n\t\t\tthis.uqApi = new UnitxApi(env.unit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//let {appOwner, appName} = uqs;\r\n\t\t\tthis.uqApi = new UqApi(baseUrl, /*appOwner, appName, */uqOwner, uqName/*, acc*/, true);\r\n\t\t}\r\n\t\tthis.tuidsCache = new TuidsCache(this);\r\n\t}\r\n\r\n\tgetID(name: string): ID { return this.ids[name.toLowerCase()]; };\r\n\tgetIDX(name: string): IDX { return this.idxs[name.toLowerCase()]; };\r\n\tgetIX(name: string): IX { return this.ixs[name.toLowerCase()]; };\r\n\r\n\tprivate createBoxIdFromTVs: CreateBoxId = (tuid: Tuid, id: number): BoxId => {\r\n\t\tlet { name } = tuid;\r\n\t\t/*\r\n\t\tlet tuidUR = this.tuidURs[name];\r\n\t\tif (tuidUR === undefined) {\r\n\t\t\tlet {ui, res} = this.getUI(tuid);\r\n\t\t\tthis.tuidURs[name] = tuidUR = new TuidWithUIRes(tuid, ui, res);\r\n\t\t}\r\n\t\t*/\r\n\t\treturn new ReactBoxId(id, tuid, this.tvs[name]);\r\n\t}\r\n\r\n\tprivate roles: string[];\r\n\tasync getRoles(): Promise<string[]> {\r\n\t\tif (this.roles !== undefined) return this.roles;\r\n\t\tthis.roles = await this.uqApi.getRoles();\r\n\t\treturn this.roles;\r\n\t}\r\n\r\n\ttuid(name: string): Tuid { return this.tuids[name.toLowerCase()] }\r\n\ttuidDiv(name: string, div: string): TuidDiv {\r\n\t\tlet tuid = this.tuids[name.toLowerCase()]\r\n\t\treturn tuid && tuid.div(div.toLowerCase());\r\n\t}\r\n\taction(name: string): Action { return this.actions[name.toLowerCase()] }\r\n\tsheet(name: string): Sheet { return this.sheets[name.toLowerCase()] }\r\n\tquery(name: string): Query { return this.queries[name.toLowerCase()] }\r\n\tbook(name: string): Book { return this.books[name.toLowerCase()] }\r\n\tmap(name: string): Map { return this.maps[name.toLowerCase()] }\r\n\thistory(name: string): History { return this.histories[name.toLowerCase()] }\r\n\tpending(name: string): Pending { return this.pendings[name.toLowerCase()] }\r\n\r\n\tsheetFromTypeId(typeId: number): Sheet {\r\n\t\tfor (let i in this.sheets) {\r\n\t\t\tlet sheet = this.sheets[i];\r\n\t\t\tif (sheet.typeId === typeId) return sheet;\r\n\t\t}\r\n\t}\r\n\r\n\tallRoles: string[];\r\n\treadonly tuidArr: Tuid[] = [];\r\n\treadonly actionArr: Action[] = [];\r\n\treadonly queryArr: Query[] = [];\r\n\treadonly idArr: ID[] = [];\r\n\treadonly idxArr: IDX[] = [];\r\n\treadonly ixArr: IX[] = [];\r\n\treadonly enumArr: UqEnum[] = [];\r\n\treadonly sheetArr: Sheet[] = [];\r\n\treadonly bookArr: Book[] = [];\r\n\treadonly mapArr: Map[] = [];\r\n\treadonly historyArr: History[] = [];\r\n\treadonly pendingArr: Pending[] = [];\r\n\treadonly tagArr: Tag[] = [];\r\n\r\n\tasync init() {\r\n\t\tawait this.uqApi.init();\r\n\t}\r\n\r\n\tasync loadEntities(): Promise<string> {\r\n\t\ttry {\r\n\t\t\tlet entities = this.localEntities.get();\r\n\t\t\tif (!entities) {\r\n\t\t\t\tentities = await this.uqApi.loadEntities();\r\n\t\t\t}\r\n\t\t\tif (!entities) return;\r\n\t\t\tthis.buildEntities(entities);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\treturn err as string;\r\n\t\t}\r\n\t}\r\n\r\n\tbuildEntities(entities: any) {\r\n\t\tif (entities === undefined) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tthis.localEntities.set(entities);\r\n\t\tlet { access, tuids, role, version } = entities;\r\n\t\tthis.uqVersion = version;\r\n\t\tthis.allRoles = role?.names;\r\n\t\tthis.buildTuids(tuids);\r\n\t\tthis.buildAccess(access);\r\n\t}\r\n\r\n\tprivate buildTuids(tuids: any) {\r\n\t\tfor (let i in tuids) {\r\n\t\t\tlet schema = tuids[i];\r\n\t\t\tlet { typeId, from } = schema;\r\n\t\t\tlet tuid = this.newTuid(i, typeId, from);\r\n\t\t\ttuid.sys = true;\r\n\t\t}\r\n\t\tfor (let i in tuids) {\r\n\t\t\tlet schema = tuids[i];\r\n\t\t\tlet tuid = this.getTuid(i);\r\n\t\t\ttuid.setSchema(schema);\r\n\t\t}\r\n\t\tfor (let i in this.tuids) {\r\n\t\t\tlet tuid = this.tuids[i];\r\n\t\t\ttuid.buildFieldsTuid();\r\n\t\t}\r\n\t}\r\n\r\n\tasync loadEntitySchema(entityName: string): Promise<any> {\r\n\t\treturn await this.uqApi.schema(entityName);\r\n\t}\r\n\r\n\tasync loadAllSchemas(): Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr,\r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.tagArr,\r\n\t\t\tthis.idArr,\r\n\t\t\tthis.idxArr,\r\n\t\t\tthis.ixArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tgetTuid(name: string): Tuid {\r\n\t\treturn this.tuids[name];\r\n\t}\r\n\r\n\tprivate buildAccess(access: any) {\r\n\t\tfor (let a in access) {\r\n\t\t\tlet v = access[a];\r\n\t\t\tswitch (typeof v) {\r\n\t\t\t\tcase 'string': this.fromType(a, v); break;\r\n\t\t\t\tcase 'object': this.fromObj(a, v); break;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcacheTuids(defer: number) {\r\n\t\tthis.tuidsCache.cacheTuids(defer);\r\n\t}\r\n\r\n\tprivate setEntity(name: string, entity: Entity) {\r\n\t\tthis.entities[name] = entity;\r\n\t\tthis.entities[name.toLowerCase()] = entity;\r\n\t}\r\n\r\n\tnewEnum(name: string, id: number): UqEnum {\r\n\t\tlet enm = this.enums[name];\r\n\t\tif (enm !== undefined) return enm;\r\n\t\tenm = this.enums[name] = new UqEnum(this, name, id);\r\n\t\tthis.setEntity(name, enm);\r\n\t\tthis.enumArr.push(enm);\r\n\t\treturn enm;\r\n\t}\r\n\tnewAction(name: string, id: number): Action {\r\n\t\tlet action = this.actions[name];\r\n\t\tif (action !== undefined) return action;\r\n\t\taction = this.actions[name] = new Action(this, name, id);\r\n\t\tthis.setEntity(name, action);\r\n\t\tthis.actionArr.push(action);\r\n\t\treturn action;\r\n\t}\r\n\tprivate newTuid(name: string, id: number, from: SchemaFrom): Tuid {\r\n\t\tlet tuid = this.tuids[name];\r\n\t\tif (tuid !== undefined) return tuid;\r\n\t\tif (from !== undefined)\r\n\t\t\ttuid = new TuidImport(this, name, id, from);\r\n\t\telse\r\n\t\t\ttuid = new TuidInner(this, name, id);\r\n\t\tthis.tuids[name] = tuid;\r\n\t\tthis.setEntity(name, tuid);\r\n\t\tthis.tuidArr.push(tuid);\r\n\t\treturn tuid;\r\n\t}\r\n\tnewQuery(name: string, id: number): Query {\r\n\t\tlet query = this.queries[name];\r\n\t\tif (query !== undefined) return query;\r\n\t\tquery = this.queries[name] = new Query(this, name, id)\r\n\t\tthis.setEntity(name, query);\r\n\t\tthis.queryArr.push(query);\r\n\t\treturn query;\r\n\t}\r\n\tprivate newBook(name: string, id: number): Book {\r\n\t\tlet book = this.books[name];\r\n\t\tif (book !== undefined) return book;\r\n\t\tbook = this.books[name] = new Book(this, name, id);\r\n\t\tthis.setEntity(name, book);\r\n\t\tthis.bookArr.push(book);\r\n\t\treturn book;\r\n\t}\r\n\tprivate newMap(name: string, id: number): Map {\r\n\t\tlet map = this.maps[name];\r\n\t\tif (map !== undefined) return map;\r\n\t\tmap = this.maps[name] = new Map(this, name, id)\r\n\t\tthis.setEntity(name, map);\r\n\t\tthis.mapArr.push(map);\r\n\t\treturn map;\r\n\t}\r\n\tprivate newTag(name: string, id: number): Tag {\r\n\t\tlet tag = this.tags[name];\r\n\t\tif (tag !== undefined) return tag;\r\n\t\ttag = this.tags[name] = new Tag(this, name, id)\r\n\t\tthis.setEntity(name, tag);\r\n\t\tthis.tagArr.push(tag);\r\n\t\treturn tag;\r\n\t}\r\n\tprivate newHistory(name: string, id: number): History {\r\n\t\tlet history = this.histories[name];\r\n\t\tif (history !== undefined) return;\r\n\t\thistory = this.histories[name] = new History(this, name, id)\r\n\t\tthis.setEntity(name, history);\r\n\t\tthis.historyArr.push(history);\r\n\t\treturn history;\r\n\t}\r\n\tprivate newPending(name: string, id: number): Pending {\r\n\t\tlet pending = this.pendings[name];\r\n\t\tif (pending !== undefined) return;\r\n\t\tpending = this.pendings[name] = new Pending(this, name, id)\r\n\t\tthis.setEntity(name, pending);\r\n\t\tthis.pendingArr.push(pending);\r\n\t\treturn pending;\r\n\t}\r\n\tprivate newSheet(name: string, id: number): Sheet {\r\n\t\tlet sheet = this.sheets[name];\r\n\t\tif (sheet !== undefined) return sheet;\r\n\t\tsheet = this.sheets[name] = new Sheet(this, name, id);\r\n\t\tthis.setEntity(name, sheet);\r\n\t\tthis.sheetArr.push(sheet);\r\n\t\treturn sheet;\r\n\t}\r\n\tprivate newID(name: string, id: number): ID {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet idEntity = this.ids[lName];\r\n\t\tif (idEntity !== undefined) return idEntity;\r\n\t\tidEntity = this.ids[lName] = new ID(this, name, id);\r\n\t\tthis.setEntity(name, idEntity);\r\n\t\tthis.idArr.push(idEntity);\r\n\t\treturn idEntity;\r\n\t}\r\n\tprivate newIDX(name: string, id: number): IDX {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet idx = this.idxs[lName];\r\n\t\tif (idx !== undefined) return idx;\r\n\t\tidx = this.idxs[lName] = new IDX(this, name, id);\r\n\t\tthis.setEntity(name, idx);\r\n\t\tthis.idxArr.push(idx);\r\n\t\treturn idx;\r\n\t}\r\n\tprivate newIX(name: string, id: number): IX {\r\n\t\tlet lName = name.toLowerCase();\r\n\t\tlet ix = this.ixs[lName];\r\n\t\tif (ix !== undefined) return ix;\r\n\t\tix = this.ixs[lName] = new IX(this, name, id);\r\n\t\tthis.setEntity(name, ix);\r\n\t\tthis.ixArr.push(ix);\r\n\t\treturn ix;\r\n\t}\r\n\tprivate fromType(name: string, type: string) {\r\n\t\tlet parts = type.split('|');\r\n\t\ttype = parts[0];\r\n\t\tlet id = Number(parts[1]);\r\n\t\tswitch (type) {\r\n\t\t\t//case 'uq': this.id = id; break;\r\n\t\t\tcase 'tuid':\r\n\t\t\t\t// Tuid should not be created here!;\r\n\t\t\t\t//let tuid = this.newTuid(name, id);\r\n\t\t\t\t//tuid.sys = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'id': this.newID(name, id); break;\r\n\t\t\tcase 'idx': this.newIDX(name, id); break;\r\n\t\t\tcase 'ix': this.newIX(name, id); break;\r\n\t\t\tcase 'action': this.newAction(name, id); break;\r\n\t\t\tcase 'query': this.newQuery(name, id); break;\r\n\t\t\tcase 'book': this.newBook(name, id); break;\r\n\t\t\tcase 'map': this.newMap(name, id); break;\r\n\t\t\tcase 'history': this.newHistory(name, id); break;\r\n\t\t\tcase 'sheet': this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'tag': this.newTag(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n\t\t}\r\n\t}\r\n\tprivate fromObj(name: string, obj: any) {\r\n\t\tswitch (obj['$']) {\r\n\t\t\tcase 'sheet': this.buildSheet(name, obj); break;\r\n\t\t}\r\n\t}\r\n\tprivate buildSheet(name: string, obj: any) {\r\n\t\tlet sheet = this.sheets[name];\r\n\t\tif (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n\t\tsheet.build(obj);\r\n\t}\r\n\tbuildFieldTuid(fields: Field[], mainFields?: Field[]) {\r\n\t\tif (fields === undefined) return;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { tuid } = f;\r\n\t\t\tif (tuid === undefined) continue;\r\n\t\t\tlet t = this.getTuid(tuid);\r\n\t\t\tif (t === undefined) continue;\r\n\t\t\tf._tuid = t.buildTuidBox();\r\n\t\t}\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet { owner } = f;\r\n\t\t\tif (owner === undefined) continue;\r\n\t\t\tlet ownerField = fields.find(v => v.name === owner);\r\n\t\t\tif (ownerField === undefined) {\r\n\t\t\t\tif (mainFields !== undefined) {\r\n\t\t\t\t\townerField = mainFields.find(v => v.name === owner);\r\n\t\t\t\t}\r\n\t\t\t\tif (ownerField === undefined) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tthrow new Error(`owner field ${owner} is undefined`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet { arr, tuid } = f;\r\n\t\t\tlet t = this.getTuid(ownerField._tuid.tuid.name);\r\n\t\t\tif (t === undefined) continue;\r\n\t\t\tlet div = t.div(arr || tuid);\r\n\t\t\tf._tuid = div && div.buildTuidDivBox(ownerField);\r\n\t\t\t/*\r\n\t\t\tif (f._tuid === undefined) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthrow new Error(`owner field ${owner} is not tuid`);\r\n\t\t\t}\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\tbuildArrFieldsTuid(arrFields: ArrFields[], mainFields: Field[]) {\r\n\t\tif (arrFields === undefined) return;\r\n\t\tfor (let af of arrFields) {\r\n\t\t\tlet { fields } = af;\r\n\t\t\tif (fields === undefined) continue;\r\n\t\t\tthis.buildFieldTuid(fields, mainFields);\r\n\t\t}\r\n\t}\r\n\r\n\tpullModify(modifyMax: number) {\r\n\t\tthis.tuidsCache.pullModify(modifyMax);\r\n\t}\r\n\r\n\tgetUqKey() {\r\n\t\tlet uqKey: string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\tif (this.config) {\r\n\t\t\tlet { dev, alias } = this.config;\r\n\t\t\tuqKey = capitalCase(dev.alias || dev.name) + capitalCase(alias ?? uqKey);\r\n\t\t}\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\tcreateProxy(): any {\r\n\t\tlet ret = new Proxy(this.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tif (lk === '$') {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tswitch (key) {\r\n\t\t\t\t\tdefault: debugger; break;\r\n\t\t\t\t\tcase 'Acts': return this.Acts;\r\n\t\t\t\t\tcase 'ActIX': return this.ActIX;\r\n\t\t\t\t\tcase 'ActIXSort': return this.ActIXSort;\r\n\t\t\t\t\tcase 'QueryID': return this.QueryID;\r\n\t\t\t\t\tcase 'IDDetail': return this.ActDetail;\r\n\t\t\t\t\tcase 'IDNO': return this.IDNO;\r\n\t\t\t\t\tcase 'IDDetailGet': return this.IDDetailGet;\r\n\t\t\t\t\tcase 'ID': return this.ID;\r\n\t\t\t\t\tcase 'KeyID': return this.KeyID;\r\n\t\t\t\t\tcase 'IX': return this.IX;\r\n\t\t\t\t\tcase 'IXr': return this.IXr;\r\n\t\t\t\t\tcase 'KeyIX': return this.KeyIX;\r\n\t\t\t\t\tcase 'IDLog': return this.IDLog;\r\n\t\t\t\t\tcase 'IDSum': return this.IDSum;\r\n\t\t\t\t\tcase 'IDinIX': return this.IDinIX;\r\n\t\t\t\t\tcase 'IDxID': return this.IDxID;\r\n\t\t\t\t\tcase 'IDTree': return this.IDTree;\r\n\t\t\t\t}\r\n\t\t\t\tlet err = `entity ${this.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t\tthis.showReload('UQ错误：' + err);\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.proxy = ret;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate showReload(msg: string) {\r\n\t\tthis.localMap.removeAll();\r\n\t\tnav.showReloadPage(msg);\r\n\t}\r\n\r\n\t//private coms:any;\r\n\t//private setComs = (coms: any) => {this.coms = coms;}\r\n\tprivate Acts = async (param: any): Promise<any> => {\r\n\t\t// 这边的obj属性序列，也许会不一样\r\n\t\tlet arr: string[] = [];\r\n\t\tlet apiParam: any = {};\r\n\t\tfor (let i in param) {\r\n\t\t\tarr.push(i);\r\n\t\t\tapiParam[i] = (param[i] as any[]).map(v => {\r\n\t\t\t\tlet obj: any = {};\r\n\t\t\t\tfor (let j in v) {\r\n\t\t\t\t\tlet val = v[j];\r\n\t\t\t\t\tif (typeof val === 'object') {\r\n\t\t\t\t\t\tlet nv: any = {};\r\n\t\t\t\t\t\tfor (let n in val) {\r\n\t\t\t\t\t\t\tlet tv = val[n];\r\n\t\t\t\t\t\t\tif (tv && typeof tv === 'object') {\r\n\t\t\t\t\t\t\t\tif (n === 'time') {\r\n\t\t\t\t\t\t\t\t\tif (Object.prototype.toString.call(tv) === '[object Date]') {\r\n\t\t\t\t\t\t\t\t\t\ttv = (tv as Date).getTime();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tlet id = tv['id'];\r\n\t\t\t\t\t\t\t\t\ttv = id;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnv[n] = tv;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[j] = nv;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tobj[j] = val;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn obj;\r\n\t\t\t});\r\n\t\t}\r\n\t\tapiParam['$'] = arr;\r\n\t\tlet ret = await this.uqApi.post(IDPath('acts'), apiParam);\r\n\t\tlet retArr = (ret[0].ret as string).split('\\n');\r\n\t\tlet retActs: { [key: string]: number[] } = {};\r\n\t\tfor (let i = 0; i < arr.length; i++) {\r\n\t\t\tretActs[arr[i]] = ids(retArr[i].split('\\t'));\r\n\t\t}\r\n\t\treturn retActs;\r\n\t}\r\n\r\n\tprivate ActIX = async (param: ParamActIX<any>): Promise<number[]> => {\r\n\t\tlet { IX, ID, values, IXs } = param;\r\n\t\tlet apiParam: any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIXs: IXs?.map(v => ({ IX: entityName(v.IX), ix: v.ix })),\r\n\t\t\tvalues,\r\n\t\t};\r\n\t\tlet ret = await this.uqApi.post(IDPath('act-ix'), apiParam);\r\n\t\treturn (ret[0].ret as string).split('\\t').map(v => Number(v));\r\n\t}\r\n\r\n\tprivate ActIXSort = async (param: ParamActIXSort): Promise<void> => {\r\n\t\tlet { IX, ix, id, after } = param;\r\n\t\tlet apiParam: any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tix,\r\n\t\t\tid,\r\n\t\t\tafter,\r\n\t\t};\r\n\t\tawait this.uqApi.post(IDPath('act-ix-sort'), apiParam);\r\n\t}\r\n\r\n\tprivate ActDetail = async (param: ParamActDetail<any, any>): Promise<any> => {\r\n\t\tlet { master, detail, detail2, detail3 } = param as unknown as ParamActDetail3<any, any, any, any>;\r\n\t\tlet postParam: any = {\r\n\t\t\tmaster: {\r\n\t\t\t\tname: entityName(master.ID),\r\n\t\t\t\tvalue: toScalars(master.value),\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tname: entityName(detail.ID),\r\n\t\t\t\tvalues: detail.values?.map(v => toScalars(v)),\r\n\t\t\t},\r\n\t\t}\r\n\t\tif (detail2) {\r\n\t\t\tpostParam.detail2 = {\r\n\t\t\t\tname: entityName(detail2.ID),\r\n\t\t\t\tvalues: detail2.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (detail3) {\r\n\t\t\tpostParam.detail3 = {\r\n\t\t\t\tname: entityName(detail3.ID),\r\n\t\t\t\tvalues: detail3.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.uqApi.post(IDPath('act-detail'), postParam);\r\n\t\tlet val: string = ret[0].ret;\r\n\t\tlet parts = val.split('\\n');\r\n\t\tlet items = parts.map(v => v.split('\\t'));\r\n\t\tret = {\r\n\t\t\tmaster: ids(items[0])[0],\r\n\t\t\tdetail: ids(items[1]),\r\n\t\t\tdetail2: ids(items[2]),\r\n\t\t\tdetail3: ids(items[3]),\r\n\t\t};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate QueryID = async (param: ParamQueryID): Promise<any[]> => {\r\n\t\tlet { ID, IX, IDX } = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('query-id'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: IX?.map(v => entityName(v)),\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\tlet { ID } = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-no'), { ID: entityName(ID) });\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate IDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\tlet { id, master, detail, detail2, detail3 } = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-detail-get'), {\r\n\t\t\tid,\r\n\t\t\tmaster: entityName(master),\r\n\t\t\tdetail: entityName(detail),\r\n\t\t\tdetail2: entityName(detail2),\r\n\t\t\tdetail3: entityName(detail3),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\t//private checkParam(ID:ID, IDX:(ID|IDX)|(ID|IDX)[], IX:IX, id:number|number[], key:{[key:string]:string|number}, page: ParamPage) {\r\n\t//}\r\n\tprivate IDXToString(p: ID | IDX | ((ID | IDX)[])): string | string[] {\r\n\t\tif (Array.isArray(p) === true) return (p as (ID | IDX)[]).map(v => entityName(v));\r\n\t\treturn entityName(p as ID | IDX);\r\n\t}\r\n\tprivate ID = async (param: ParamID): Promise<any[]> => {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id'), {\r\n\t\t\t...param,\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate KeyID = async (param: ParamKeyID): Promise<any[]> => {\r\n\t\tlet { ID, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, null, key, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('key-id'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IX = async (param: ParamIX): Promise<any[]> => {\r\n\t\tlet { IX, IX1, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('ix'), {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\tlet { IX, IX1, IDX } = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('ixr'), {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\tlet { ID, IX, IDX } = param;\r\n\t\t//this.checkParam(ID, IDX, IX, null, key, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('key-ix'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDLog = async (param: ParamIDLog): Promise<any[]> => {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-log'), {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDSum = async (param: ParamIDSum): Promise<any[]> => {\r\n\t\tlet { IDX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-sum'), {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDinIX = async (param: ParamIDinIX): Promise<any | { $in: boolean }[]> => {\r\n\t\tlet { ID, IX } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-in-ix'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprivate IDxID = async (param: ParamIDxID): Promise<any[]> => {\r\n\t\tlet { ID, IX, ID2 } = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-x-id'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID2: entityName(ID2),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate IDTree = async (param: ParamIDTree): Promise<any[]> => {\r\n\t\tlet { ID } = param;\r\n\t\tlet ret = await this.uqApi.post(IDPath('id-tree'), {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nfunction ids(item: string[]): number[] {\r\n\tif (!item) return;\r\n\tlet len = item.length;\r\n\tif (len <= 1) return;\r\n\tlet ret: number[] = [];\r\n\tfor (let i = 0; i < len - 1; i++) ret.push(Number(item[i]));\r\n\treturn ret;\r\n}\r\n\r\nfunction entityName(entity: Entity | string): string {\r\n\tif (!entity) return;\r\n\tif (typeof entity === 'string') return entity;\r\n\treturn entity.name;\r\n}\r\n\r\nfunction toScalars(value: any): any {\r\n\tif (!value) return value;\r\n\tlet ret: any = {};\r\n\tfor (let i in value) {\r\n\t\tlet v = value[i];\r\n\t\tif (typeof v === 'object') v = v['id'];\r\n\t\tret[i] = v;\r\n\t}\r\n\treturn ret;\r\n}","import { Entity } from './entity';\r\nimport { PageItems } from '../tool/pageItems';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n\tid: number;\r\n\tflow: number;\r\n\tstate: string;\r\n\tverify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n\tbrief: any;\r\n\tdata: M;\r\n\tflows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n\tstates: SheetState[];\r\n\tverify: {returns: ArrFields[]};\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n\t\tthis.states = schema.states;\r\n\t\tthis.verify = schema.verify;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription:string, data:M):Promise<SheetSaveReturnV<V>> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription:string, data:M):Promise<SheetSaveReturn> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    async actionDebugDirect(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionDirectCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res:any):any {\r\n\t\tlet {verify} = this.entity;\r\n\t\tif (verify === undefined) return res;\r\n\t\tlet resVerify = res.verify;\r\n\t\tif (resVerify === undefined || resVerify.length === 0) {\r\n\t\t\tres.verify = undefined;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\tlet {returns} = verify;\r\n\t\tres.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\t/*\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return ret;\r\n\t}\r\n\t*/\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n\t/*\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n\t}\r\n\t*/\r\n}\r\n","import { UqQuery} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class UqBook<P, R> extends UqQuery<P, R> {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class Book extends UqBook<any, any> {\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqHistory<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n\r\nexport class History extends UqHistory<any, any> {\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class UqMap extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Map extends UqMap {\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqPending<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n\r\nexport class Pending extends UqPending<any, any> {\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","import { UqExt as Uq } from './BruceYuMi';\r\nimport * as Market from './Market.ui';\r\nimport * as Transaction from './Transaction.ui';\r\nimport * as Group from './Group.ui';\r\nimport * as Account from './Account.ui';\r\nimport * as Holding from './Holding.ui';\r\nimport * as Stock from './Stock.ui';\r\nimport * as Blog from './Blog.ui';\r\nimport * as Industry from './Industry.ui';\r\nimport * as StockValue from './StockValue.ui';\r\nimport * as AccountValue from './AccountValue.ui';\r\nimport * as Portfolio from './Portfolio.ui';\r\nimport * as UserBlockStock from './UserBlockStock.ui';\r\nimport * as UserAccount from './UserAccount.ui';\r\nimport * as UserGroup from './UserGroup.ui';\r\nimport * as UserAllStock from './UserAllStock.ui';\r\nimport * as AccountHolding from './AccountHolding.ui';\r\nimport * as GroupStock from './GroupStock.ui';\r\nimport * as IXIndustry from './IXIndustry.ui';\r\n\r\nexport function setUI(uq: Uq) {\r\n\tObject.assign(uq.Market, Market);\r\n\tObject.assign(uq.Transaction, Transaction);\r\n\tObject.assign(uq.Group, Group);\r\n\tObject.assign(uq.Account, Account);\r\n\tObject.assign(uq.Holding, Holding);\r\n\tObject.assign(uq.Stock, Stock);\r\n\tObject.assign(uq.Blog, Blog);\r\n\tObject.assign(uq.Industry, Industry);\r\n\tObject.assign(uq.StockValue, StockValue);\r\n\tObject.assign(uq.AccountValue, AccountValue);\r\n\tObject.assign(uq.Portfolio, Portfolio);\r\n\tObject.assign(uq.UserBlockStock, UserBlockStock);\r\n\tObject.assign(uq.UserAccount, UserAccount);\r\n\tObject.assign(uq.UserGroup, UserGroup);\r\n\tObject.assign(uq.UserAllStock, UserAllStock);\r\n\tObject.assign(uq.AccountHolding, AccountHolding);\r\n\tObject.assign(uq.GroupStock, GroupStock);\r\n\tObject.assign(uq.IXIndustry, IXIndustry);\r\n}\r\nexport * from './BruceYuMi';\r\n","/*eslint @typescript-eslint/no-unused-vars: [\"off\", { \"vars\": \"all\" }]*/\r\nimport * as React from 'react';\r\nimport { VPage, Page, List } from 'tonva-react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport RC2 from 'react-chartjs-2'\r\nimport { GFunc } from './GFunc';\r\nimport { CStockInfo } from './CStockInfo'\r\nimport { StockCapitalearning, StockBonus } from './StockInfoType';\r\nimport { renderStockRow } from 'tool';\r\nimport { ErForEarning } from './ErForEarning';\r\nimport { SlrForEarning } from './SlrForEarning';\r\n\r\nexport class VStockInfo extends VPage<CStockInfo> {\r\n    private input: HTMLInputElement;\r\n    private key: string = undefined;\r\n\r\n    async open(param?: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    @observable protected ttmLimit: boolean = false;\r\n\r\n    render(param: any): JSX.Element {\r\n        return this.page();\r\n    }\r\n\r\n    checkLimitShow = (e: any) => {\r\n        let check = e.target.checked as boolean;\r\n        this.ttmLimit = check;\r\n    }\r\n\r\n    checkShowLater = (e: any) => {\r\n        let check = e.target.checked as boolean;\r\n    }\r\n\r\n    private page = observer(() => {\r\n        let { openMetaView, baseItem, isLogined } = this.controller;\r\n        let { name, code, day } = baseItem;\r\n        let viewMetaButton = <></>;\r\n        if (isLogined) {\r\n            viewMetaButton = <button type=\"button\" className=\"btn w-100\" onClick={openMetaView}>view</button>\r\n        }\r\n\r\n        let headStr = name + ' ' + code;\r\n        if (day !== undefined) {\r\n            headStr += ' - ' + day;\r\n        }\r\n        let head = <div >{headStr}</div>\r\n        return <Page header={head}\r\n            headerClassName='bg-primary'>\r\n            {React.createElement(this.pageContent)}\r\n        </Page>;\r\n    })\r\n\r\n    private pageContent = observer(() => {\r\n        return <>\r\n            {React.createElement(this.baseInfo)}\r\n            {React.createElement(this.miratesChart)}\r\n            {React.createElement(this.mivaluesChart)}\r\n            {React.createElement(this.predictInfo)}\r\n            {React.createElement(this.seasonEarning)}\r\n            {React.createElement(this.bonus)}\r\n        </>\r\n    });\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        let v = evt.target.value;\r\n        let n = Number(v);\r\n        if (isNaN(n) === true || !Number.isInteger(n)) {\r\n            if (this.input) {\r\n                this.input.value = this.key;\r\n            }\r\n            return;\r\n        }\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n    }\r\n\r\n    private baseInfo = observer(() => {\r\n        let { stock, baseItem } = this.controller;\r\n        let { cCommon } = this.controller.cApp;\r\n        let pinStock = <div className=\"d-flex align-self-stretch align-items-center\">\r\n            {cCommon.renderStockLink(stock)}\r\n            &nbsp;\r\n            {cCommon.renderPinStock(stock, 2)}\r\n            &nbsp;\r\n            {cCommon.renderBlockStock(stock)}\r\n        </div>;\r\n        return <div className=\"bg-white\">{renderStockRow(undefined, stock, undefined, pinStock)}</div>;\r\n    });\r\n\r\n    private historyChart = () => {\r\n        let { baseItem } = this.controller;\r\n        if (baseItem.trackDay !== undefined) {\r\n            return <></>\r\n        }\r\n        let { market, code, symbol } = baseItem;\r\n        if (market === 'sh' || market === 'sz') {\r\n            let urlweek = `https://image.sinajs.cn/newchart/weekly/n/${symbol}.gif`;\r\n            let urlmonth = `https://image.sinajs.cn/newchart/monthly/n/${symbol}.gif`\r\n            return <div className=\"row\">\r\n                <div className=\"col-md\"><img className=\"w-100\" alt=\"\" src={urlweek} /></div>\r\n                <div className=\"col-md\"><img className=\"w-100\" alt=\"\" src={urlmonth} /></div>\r\n            </div>;\r\n        }\r\n    }\r\n\r\n    // protected historyChart = observer(() => {\r\n    // \tlet {historyData, baseItem} = this.controller;\r\n    // \tif (historyData === undefined) \r\n    // \treturn <></>;\r\n    // \tlet chartHistory = <></>;\r\n    // \tlet labelList:any[] = [];\r\n    // \tlet priceList:number[] = [];\r\n    // \tlet ttmList:number[] = [];\r\n    // \tfor (let item of historyData) {\r\n    // \tlet {day, price, ttm} = item;\r\n    // \tlabelList.push(day);\r\n    // \tpriceList.push(GFunc.numberToPrecision(price, 4));\r\n    // \tif (ttm <= 0) \r\n    // \t\tttmList.push(undefined);\r\n    // \telse {\r\n    // \t\tif (this.ttmLimit && ttm >= 35) {\r\n    // \t\tttmList.push(35);\r\n    // \t\t}\r\n    // \t\telse {\r\n    // \t\tttmList.push(GFunc.numberToPrecision(ttm, 4));\r\n    // \t\t}\r\n    // \t}\r\n    // \t}\r\n    // \tlet chartdata1 = {\r\n    // \tlabels: labelList,\r\n    // \tdatasets: [\r\n    // \t\t{\r\n    // \t\tlabel: '价格',\r\n    // \t\tdata: priceList,\r\n    // \t\tborderColor:'blue',\r\n    // \t\tbackgroundColor:'skyBlue',\r\n    // \t\tborderWidth: 1,\r\n    // \t\tfill: false,\r\n    // \t\tyAxisID: 'y-axis-1',\r\n    // \t\t},\r\n    // \t\t{\r\n    // \t\tlabel: 'TTM',\r\n    // \t\tdata: ttmList,\r\n    // \t\tborderColor:'red',\r\n    // \t\tbackgroundColor:'pink',\r\n    // \t\tborderWidth: 1,\r\n    // \t\tfill: false,\r\n    // \t\tyAxisID: 'y-axis-2',\r\n    // \t\t}\r\n    // \t]\r\n    // \t};\r\n    // \tlet options = {\r\n    // \tscales:{\r\n    // \t\tyAxes: [{\r\n    // \t\t\ttype: 'linear',\r\n    // \t\t\tdisplay: true,\r\n    // \t\t\tposition: 'left',\r\n    // \t\t\tid: 'y-axis-1',\r\n    // \t\t}, {\r\n    // \t\t\ttype: 'linear',\r\n    // \t\t\tdisplay: true,\r\n    // \t\t\tposition: 'right',\r\n    // \t\t\tid: 'y-axis-2',\r\n    // \t\t\tgridLines: {\r\n    // \t\t\t\tdrawOnChartArea: false\r\n    // \t\t\t}\r\n    // \t\t}],       \r\n    // \t}\r\n    // \t}\r\n    // \tchartHistory = <RC2 data={chartdata1} type='line' options={options} />;\r\n    // \tlet right = <></>;\r\n    // \tif (baseItem.day !== undefined) {\r\n    // \tright = <><label className=\"px-3\"> <input type=\"checkbox\" name=\"showLater\" defaultChecked={false}\r\n    // \t\t\tonChange={this.checkShowLater} />显示后面数据</label>\r\n    // \t\t<label className=\"px-3\"> <input type=\"checkbox\" name=\"selectType\" defaultChecked={this.ttmLimit}\r\n    // \t\tonChange={this.checkLimitShow} />限制TTM显示范围</label>\r\n    // \t\t</>;\r\n\r\n    // \t}\r\n    // \telse {\r\n    // \tright = <label className=\"px-3\"> <input type=\"checkbox\" name=\"selectType\" defaultChecked={this.ttmLimit}\r\n    // \t\tonChange={this.checkLimitShow} />限制TTM显示范围</label>;\r\n    // \t}\r\n    // \treturn <><LMR className=\"px-3 py-2 bg-white\" left={'历史走势'} right={right}></LMR>\r\n    // \t<div className=\"px-3\" style={{width:'95%'}}>{chartHistory}</div>\r\n    // \t</>;\r\n    // });\r\n\r\n    protected predictInfo = observer(() => {\r\n        let { predictData, ypredict } = this.controller;\r\n        if (predictData === undefined)\r\n            return <></>;\r\n        let { e, b, r2, epre, l, lr2, lpre } = predictData;\r\n        let chart1 = <></>;\r\n        if (ypredict.length === 5) {\r\n            let er = new ErForEarning(ypredict);\r\n            let chartdata1 = {\r\n                labels: ['0', '1', '2', '3', '4'],\r\n                datasets: [\r\n                    {\r\n                        label: '收益原值',\r\n                        data: ypredict.map(v => GFunc.numberToPrecision(v)),\r\n                        borderColor: 'black',\r\n                        backgroundColor: 'skyBlue',\r\n                        pointStyle: \"crossRot\",\r\n                        borderWidth: 1,\r\n                        pointRadius: 5,\r\n                        fill: false,\r\n                    } as any\r\n                ]\r\n            };\r\n            if (!(isNaN(er.B) || isNaN(er.A))) {\r\n                let per: number[] = [];\r\n                for (let i = 0; i < 5; ++i) {\r\n                    per.push(GFunc.numberToPrecision(er.predict(i), 4));\r\n                }\r\n                chartdata1.datasets.push(\r\n                    {\r\n                        label: '指数回归',\r\n                        data: per,\r\n                        borderColor: 'red',\r\n                        backgroundColor: 'pink',\r\n                        borderWidth: 1,\r\n                        fill: false,\r\n                    });\r\n            }\r\n            let lr = new SlrForEarning(ypredict);\r\n            if (!(isNaN(lr.slope) || isNaN(lr.intercept))) {\r\n                let plr: number[] = [];\r\n                for (let i = 0; i < 5; ++i) {\r\n                    plr.push(GFunc.numberToPrecision(lr.predict(i), 4));\r\n                }\r\n                chartdata1.datasets.push(\r\n                    {\r\n                        label: '线性回归',\r\n                        data: plr,\r\n                        borderColor: 'blue',\r\n                        backgroundColor: 'pink',\r\n                        borderWidth: 1,\r\n                        fill: false,\r\n                    });\r\n            }\r\n            chart1 = <RC2 data={chartdata1} type='line' />;\r\n        }\r\n        let chart2 = this.predictChartBonus();\r\n        let chart3 = this.predictChartFullInfo();\r\n        let chart4 = this.predictChartROE();\r\n        return <><div className=\"px-3 py-2 bg-white\">指数回归预测</div>\r\n            <div className=\"d-flex flex-wrap\">\r\n                <div className=\"px-3 c12\">{GFunc.caption('e')}{GFunc.numberToString(e, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('指数b')}{GFunc.numberToString(b, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('r2')}{GFunc.numberToString(r2, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('e预测')}{GFunc.numberToString(epre)}</div>\r\n            </div>\r\n            <div className=\"px-3 py-2 bg-white\">线性回归预测</div>\r\n            <div className=\"d-flex flex-wrap\">\r\n                <div className=\"px-3 c12\">{GFunc.caption('e')}{GFunc.numberToString(e, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('增长率')}{GFunc.numberToString(l, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('r2')}{GFunc.numberToString(lr2, 4)}</div>\r\n                <div className=\"px-3 c12\">{GFunc.caption('e预测')}{GFunc.numberToString(lpre)}</div>\r\n            </div>\r\n            <div className=\"row\">\r\n                <div className=\"col\">{chart1}</div>\r\n                <div className=\"col\">{chart2}</div>\r\n            </div>\r\n            <div className=\"row\">\r\n                <div className=\"col\">{chart3}</div>\r\n                <div className=\"col\">{chart4}</div>\r\n            </div>\r\n        </>;\r\n    });\r\n\r\n    protected predictChartFullInfo = () => {\r\n        let { predictSeasonDataFull } = this.controller;\r\n        let len = predictSeasonDataFull.length;\r\n        if (len <= 0)\r\n            return <></>;\r\n        let label = [];\r\n        let label3 = []\r\n        let netprofit: number[] = [];\r\n        let profit: number[] = [];\r\n        let revenue: number[] = [];\r\n\r\n        for (let i = len - 1; i >= 0; --i) {\r\n            let item = predictSeasonDataFull[i];\r\n            if (item.netprofit === undefined)\r\n                continue;\r\n            let l = GFunc.SeasonnoToYearMonth(item.season);\r\n            label.push(l);\r\n            if (i < len - 1) {\r\n                label3.push(l);\r\n            }\r\n            netprofit.push(item.netprofit);\r\n            profit.push(item.profit);\r\n            revenue.push(item.revenue);\r\n        }\r\n\r\n        let zzFunc = (e: number[]) => {\r\n            let len = e.length;\r\n            let r: number[] = [];\r\n            let eb = e[0];\r\n            for (let ei = 1; ei < len; ++ei) {\r\n                let eEnd = e[ei];\r\n                let ed = eEnd - eb;\r\n                let eav = (eEnd + eb) / 2;\r\n                if (eav > 0.0001) {\r\n                    r.push(ed * 100 / eav);\r\n                }\r\n                else {\r\n                    r.push(undefined);\r\n                }\r\n                eb = eEnd;\r\n            }\r\n            return r;\r\n        }\r\n\r\n        let npZZ = zzFunc(netprofit);\r\n        let pZZ = zzFunc(profit);\r\n        let rZZ = zzFunc(revenue);\r\n\r\n        let chartdataFull = {\r\n            labels: label3,\r\n            datasets: [\r\n                {\r\n                    label: '净利润',\r\n                    data: npZZ.map(v => GFunc.numberToPrecision(v)),\r\n                    borderColor: 'black',\r\n                    backgroundColor: 'skyBlue',\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 1,\r\n                    pointRadius: 5,\r\n                    fill: false,\r\n                } as any\r\n            ]\r\n        };\r\n        chartdataFull.datasets.push(\r\n            {\r\n                label: '营业利润',\r\n                data: pZZ.map(v => GFunc.numberToPrecision(v)),\r\n                borderColor: 'red',\r\n                backgroundColor: 'pink',\r\n                borderWidth: 1,\r\n                fill: false,\r\n            });\r\n        chartdataFull.datasets.push(\r\n            {\r\n                label: '营业收入',\r\n                data: rZZ.map(v => GFunc.numberToPrecision(v)),\r\n                borderColor: 'blue',\r\n                backgroundColor: 'skyBlue',\r\n                borderWidth: 1,\r\n                fill: false,\r\n            });\r\n\r\n\r\n        let chartdataProfit = {\r\n            labels: label,\r\n            datasets: [\r\n                {\r\n                    label: '净利润',\r\n                    data: netprofit.map(v => GFunc.numberToPrecision(v)),\r\n                    borderColor: 'black',\r\n                    backgroundColor: 'skyBlue',\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 1,\r\n                    pointRadius: 5,\r\n                    fill: false,\r\n                } as any\r\n            ]\r\n        };\r\n\r\n        chartdataProfit.datasets.push(\r\n            {\r\n                label: '营业利润',\r\n                data: profit,\r\n                borderColor: 'red',\r\n                backgroundColor: 'pink',\r\n                borderWidth: 1,\r\n                fill: false,\r\n            });\r\n\r\n        let chartdataRevenue = {\r\n            labels: label,\r\n            datasets: [\r\n                {\r\n                    label: '营业收入',\r\n                    data: revenue,\r\n                    borderColor: 'blue',\r\n                    backgroundColor: 'skyBlue',\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 1,\r\n                    pointRadius: 5,\r\n                    fill: false,\r\n                } as any\r\n            ]\r\n        };\r\n\r\n        return <>\r\n            <RC2 data={chartdataFull} type='line' />\r\n            <RC2 data={chartdataProfit} type='line' />\r\n            <RC2 data={chartdataRevenue} type='line' />\r\n        </>;\r\n    };\r\n\r\n    protected predictChartROE = () => {\r\n        let { predictSeasonDataFull } = this.controller;\r\n        let len = predictSeasonDataFull.length;\r\n        if (len <= 0)\r\n            return <></>;\r\n        let label = [];\r\n        let y: number[] = [];\r\n        for (let i = len - 1; i >= 0; --i) {\r\n            let item = predictSeasonDataFull[i];\r\n            if (item.netprofit === undefined)\r\n                continue;\r\n            label.push(GFunc.SeasonnoToYearMonth(item.season));\r\n            y.push(item.netprofit / item.shares / item.c);\r\n        }\r\n\r\n        let chartdataFull = {\r\n            labels: label,\r\n            datasets: [\r\n                {\r\n                    label: 'ROE原值',\r\n                    data: y.map(v => GFunc.numberToPrecision(v)),\r\n                    borderColor: 'black',\r\n                    backgroundColor: 'skyBlue',\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 1,\r\n                    pointRadius: 5,\r\n                    fill: false,\r\n                } as any\r\n            ]\r\n        };\r\n        let lr = new SlrForEarning(y);\r\n        if (!(isNaN(lr.slope) || isNaN(lr.intercept))) {\r\n            let plr: number[] = [];\r\n            for (let i = 0; i < len; ++i) {\r\n                plr.push(Number.parseFloat(lr.predict(i).toPrecision(4)));\r\n            }\r\n            chartdataFull.datasets.push(\r\n                {\r\n                    label: '线性 R2:' + GFunc.numberToString(lr.r2, 4),\r\n                    data: plr,\r\n                    borderColor: 'blue',\r\n                    backgroundColor: 'pink',\r\n                    borderWidth: 1,\r\n                    fill: false,\r\n                });\r\n        }\r\n        return <RC2 data={chartdataFull} type='line' />;\r\n    };\r\n\r\n    protected predictChartBonus = () => {\r\n        let { predictBonusData } = this.controller;\r\n        let len = predictBonusData.length;\r\n        if (len <= 0)\r\n            return <></>;\r\n        let label = [];\r\n        let y: number[] = [];\r\n        for (let i = 0; i < len; ++i) {\r\n            let item = predictBonusData[i];\r\n            if (item.bonus === undefined)\r\n                continue;\r\n            label.push(item.year);\r\n            y.push(item.bonus);\r\n        }\r\n\r\n        let chartdataFull = {\r\n            labels: label,\r\n            datasets: [\r\n                {\r\n                    label: '分红原值',\r\n                    data: y.map(v => GFunc.numberToPrecision(v)),\r\n                    borderColor: 'black',\r\n                    backgroundColor: 'skyBlue',\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 1,\r\n                    pointRadius: 5,\r\n                    fill: false,\r\n                } as any\r\n            ]\r\n        };\r\n        if (y.length >= 3) {\r\n            let lr = new SlrForEarning(y);\r\n            if (!(isNaN(lr.slope) || isNaN(lr.intercept))) {\r\n                let plr: number[] = [];\r\n                for (let i = 0; i < len; ++i) {\r\n                    plr.push(Number.parseFloat(lr.predict(i).toPrecision(4)));\r\n                }\r\n                chartdataFull.datasets.push(\r\n                    {\r\n                        label: '线性 R2:' + GFunc.numberToString(lr.r2, 4),\r\n                        data: plr,\r\n                        borderColor: 'blue',\r\n                        backgroundColor: 'pink',\r\n                        borderWidth: 1,\r\n                        fill: false,\r\n                    });\r\n            }\r\n        }\r\n        return <RC2 data={chartdataFull} type='line' />;\r\n    };\r\n\r\n    protected miratesChart = observer(() => {\r\n        let { mirates } = this.controller;\r\n        let len = mirates.length;\r\n        if (len <= 0)\r\n            return <></>;\r\n        let label = [];\r\n        let y: number[] = [];\r\n        let priceList: number[] = [];\r\n        for (let i = 0; i < len; ++i) {\r\n            let item = mirates[i];\r\n            if (item.day === undefined)\r\n                continue;\r\n            label.push(item.day);\r\n            y.push(GFunc.numberToPrecision(item.mirate));\r\n            priceList.push(GFunc.numberToPrecision(item.price));\r\n        }\r\n\r\n        // let chartdataFull = {\r\n        //     labels: label,\r\n        //     datasets: [\r\n        //         {\r\n        //             label: '米息率',\r\n        //             data: y,\r\n        //             borderColor: 'black',\r\n        //             backgroundColor: 'skyBlue',\r\n        //             pointStyle: \"crossRot\",\r\n        //             borderWidth: 1,\r\n        //             pointRadius: 1,\r\n        //             fill: false,\r\n        //         } as any\r\n        //     ]\r\n        // };\r\n        let chartdataFull = {\r\n            labels: label,\r\n            datasets: [\r\n                {\r\n                    label: '米息率',\r\n                    data: y,\r\n                    borderColor: 'magenta',\r\n                    backgroundColor: 'skyBlue',\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 3,\r\n                    pointRadius: 1,\r\n                    fill: false,\r\n                    yAxisID: 'y-axis-1',\r\n                },\r\n                {\r\n                    label: '价格',\r\n                    data: priceList,\r\n                    borderColor: 'navy',\r\n                    backgroundColor: 'pink',\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 1,\r\n                    pointRadius: 1,\r\n                    fill: false,\r\n                    yAxisID: 'y-axis-2',\r\n                }\r\n            ]\r\n        };\r\n        let options = {\r\n            scales: {\r\n                yAxes: [{\r\n                    type: 'linear',\r\n                    display: true,\r\n                    position: 'right',\r\n                    id: 'y-axis-1',\r\n                }, {\r\n                    type: 'linear',\r\n                    display: true,\r\n                    position: 'left',\r\n                    id: 'y-axis-2',\r\n                    gridLines: {\r\n                        drawOnChartArea: false\r\n                    }\r\n                }],\r\n            }\r\n        }\r\n\r\n        return <RC2 data={chartdataFull} type='line'  options={options} />;\r\n    });\r\n\r\n    protected mivaluesChart = observer(() => {\r\n        let { mivalues } = this.controller;\r\n        let len = mivalues.length;\r\n        if (len <= 0)\r\n            return <></>;\r\n        let label = [];\r\n        let y: number[] = [];\r\n        for (let i = 0; i < len; ++i) {\r\n            let item = mivalues[i];\r\n            if (item.season === undefined)\r\n                continue;\r\n            label.push(GFunc.SeasonnoToYearMonth(item.season));\r\n            y.push(item.mivalue);\r\n        }\r\n\r\n        let chartdataFull = {\r\n            labels: label,\r\n            datasets: [\r\n                {\r\n                    label: '米息',\r\n                    data: y.map(v => GFunc.numberToPrecision(v)),\r\n                    borderColor: 'black',\r\n                    backgroundColor: 'skyBlue',\r\n                    pointStyle: \"crossRot\",\r\n                    borderWidth: 1,\r\n                    pointRadius: 5,\r\n                    fill: false,\r\n                } as any\r\n            ]\r\n        };\r\n        return <RC2 data={chartdataFull} type='line' />;\r\n    });\r\n\r\n    private predictSeasonEarning = observer(() => {\r\n        //let items = this.controller.predictSeasonData;\r\n        let items: any[] = [];\r\n        let header = <div className=\"px-3\">\r\n            <div className=\"px-3 c6\">年月</div>\r\n            <div className=\"px-3 c6 text-right\">股本</div>\r\n            <div className=\"px-3 c6 text-right\">季收益</div>\r\n            <div className=\"px-3 c6 text-right\">年收益</div>\r\n            <div className=\"px-3 c6 text-right\">ROE</div>\r\n            <div className=\"px-3 c6 text-right\">股本o</div>\r\n            <div className=\"px-3 c6 text-right\">季收益o</div>\r\n            <div className=\"px-3 c6 text-right\">年收益o</div>\r\n        </div>;\r\n        return <>\r\n            <div className=\"px-3 py-1\">历年股本收益-用于回归计算</div>\r\n            <List header={header} loading=\"...\"\r\n                items={items}\r\n                item={{\r\n                    render: (row: { season: number, c: number, e: number, esum: number, corg: number, eorg: number, esumorg: number }) => {\r\n                        let { season, c, e, esum, corg, eorg, esumorg } = row;\r\n                        let ym = GFunc.SeasonnoToYearMonth(season);\r\n                        let a = 0;\r\n                        return <div className=\"px-3 py-2 d-flex flex-wrap\">\r\n                            <div className=\"px-3 c6\">{ym.toString()}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(c)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(e)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(esum)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.percentToFixString(esum / c)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(corg)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(eorg)}</div>\r\n                            <div className=\"px-3 c6 text-right\">{GFunc.numberToFixString(esumorg)}</div>\r\n                        </div>\r\n                    }\r\n                }}\r\n            />\r\n        </>\r\n    });\r\n\r\n\r\n    private seasonEarning = observer(() => {\r\n        let items = this.controller.seasonData;\r\n        //let items:any[] = [];\r\n        let header = <div className=\"px-3\">\r\n            <div className=\"px-3 c8\">年月</div>\r\n            <div className=\"px-3 c8 text-right\">股本</div>\r\n            <div className=\"px-3 c8 text-right\">营业收入</div>\r\n            <div className=\"px-3 c8 text-right\">营业利润</div>\r\n            <div className=\"px-3 c8 text-right\">净利润</div>\r\n        </div>;\r\n        return <>\r\n            <div className=\"px-3 py-1\">历年利润表</div>\r\n            <List header={header} loading=\"...\"\r\n                items={items}\r\n                item={{\r\n                    render: (row: { season: number, revenue: number, profit: number, netprofit: number, shares: number, c: number, corg: number }) => {\r\n                        let { season, revenue, profit, netprofit, shares } = row;\r\n                        let ym = GFunc.SeasonnoToYearMonth(season);\r\n                        let a = 0;\r\n                        return <div className=\"px-3 py-2 d-flex flex-wrap\">\r\n                            <div className=\"px-3 c8\">{ym.toString()}</div>\r\n                            <div className=\"px-3 c8 text-right\">{GFunc.numberToFixString(shares, 0)}</div>\r\n                            <div className=\"px-3 c8 text-right\">{GFunc.numberToFixString(revenue, 0)}</div>\r\n                            <div className=\"px-3 c8 text-right\">{GFunc.numberToFixString(profit, 0)}</div>\r\n                            <div className=\"px-3 c8 text-right\">{GFunc.numberToFixString(netprofit, 0)}</div>\r\n                        </div>\r\n                    }\r\n                }}\r\n            />\r\n        </>\r\n    });\r\n\r\n\r\n    private capitalEarning = observer(() => {\r\n        //let items = this.controller.capitalearning;\r\n        let items: any[] = [];\r\n        let header = <div className=\"px-3\">\r\n            <div className=\"px-3 c6\">年</div>\r\n            <div className=\"px-3 c6 text-right\">股本</div>\r\n            <div className=\"px-3 c6 text-right\">收益</div>\r\n            <div className=\"px-3 c6 text-right\">ROE</div>\r\n        </div>;\r\n        return <>\r\n            <div className=\"px-3 py-1\">历年股本收益</div>\r\n            <List header={header} loading=\"...\"\r\n                items={items}\r\n                item={{\r\n                    render: (row: StockCapitalearning) => {\r\n                        let { capital, earning } = row;\r\n                        let roe = (earning / capital * 100);\r\n                        return <div className=\"px-3 py-2 d-flex flex-wrap\">\r\n                            <div className=\"px-3 c6\">{row.year}</div>\r\n                            <div className=\"px-3 c6 text-right\"> {capital?.toFixed(2)}</div>\r\n                            <div className=\"px-3 c6 text-right\"> {earning?.toFixed(2)}</div>\r\n                            <div className=\"px-3 c6 text-right\"> {isNaN(roe) === true ? '-' : roe.toFixed(1) + '%'}</div>\r\n                        </div>\r\n                    }\r\n                }}\r\n            />\r\n        </>\r\n    });\r\n\r\n    private bonus = observer(() => {\r\n        let items = this.controller.bonus;\r\n        let header = <div className=\"px-3\">\r\n            <div className=\"px-3 c8\">日期</div>\r\n            <div className=\"px-3 c6 text-right\">分红</div>\r\n        </div>;\r\n        return <>\r\n            <div className=\"px-3 py-1\">历年分红</div>\r\n            <List header={header} loading=\"...\"\r\n                items={items}\r\n                item={{\r\n                    render: (row: StockBonus) => {\r\n                        return <div className=\"px-3 py-2 d-flex flex-wrap\">\r\n                            <div className=\"px-3 c8\">{row.day}</div>\r\n                            <div className=\"px-3 c6 text-right\"> {row.bonus.toFixed(2)}</div>\r\n                        </div>\r\n                    }\r\n                }}\r\n            />\r\n        </>\r\n    });\r\n}","import { FA, View } from \"tonva-react\";\r\nimport { CXIList } from \"./CXIList\";\r\n\r\nexport class VIXRight extends View<CXIList<any, any>> {\r\n\trender(item: any) {\r\n\t\treturn <button className=\"btn btn-sm btn-light\" onClick={() => this.controller.breakChain(item)}>\r\n\t\t\t<FA name=\"chain-broken\" />\r\n\t\t</button>;\r\n\t}\r\n}","import { FA, List, Scroller, VPage } from \"tonva-react\";\r\nimport { CXIList } from \"./CXIList\";\r\n\r\nexport class VXIList extends VPage<CXIList<any, any>> {\r\n\theader() {\r\n\t\tlet {props} = this.controller;\r\n\t\tlet {listHeader, header} = props;\r\n\t\tif (listHeader) return listHeader;\r\n\t\tif (header) {\r\n\t\t\tswitch (typeof header) {\r\n\t\t\t\tdefault: return header;\r\n\t\t\t\tcase 'string': return header + ' ' + this.t('list');\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet {ID} = this.controller.props;\r\n\t\tlet ret = ID.t(ID.sName);\r\n\t\tif (typeof ret === 'string') return ret + ' ' + this.t('list');\r\n\t\treturn  <>{ret} {this.t('list')}</>;\r\n\t}\r\n\tright():JSX.Element {\r\n\t\tlet {props, onSetIXItem} = this.controller;\r\n\t\tlet {renderRight} = props;\r\n\t\tif (renderRight === null) return null;\r\n\t\tif (renderRight !== undefined) return renderRight();\r\n\t\treturn <button className=\"btn btn-sm btn-success mr-1\" \r\n\t\t\tonClick={onSetIXItem}>\r\n\t\t\t<FA name=\"chain\" />\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {props, onClickItem} = this.controller;\r\n\t\tlet {renderItem, renderXi, xi} = props;\r\n\t\tlet vIx: any;\r\n\t\tif (renderXi) {\r\n\t\t\tvIx = renderXi(xi);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvIx = <div className=\"p-3\">{JSON.stringify(xi)}</div>;\r\n\t\t}\r\n\t\treturn <div>\r\n\t\t\t{vIx}\r\n\t\t\t<List items={this.controller.pageItems} \r\n\t\t\t\titem={{\r\n\t\t\t\t\trender: renderItem ?? this.renderItem,\r\n\t\t\t\t\tonClick: onClickItem,\r\n\t\t\t\t}} />\r\n\t\t</div>\r\n\t}\t\r\n\r\n\tprivate renderItem = (item:any, index:number) => {\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{this.controller.props.ID.render(item)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {\r\n\t\tawait this.controller.pageItems.more();\r\n\t\treturn;\r\n\t}\r\n\tprotected afterBack():void {}\r\n}\r\n","import { ID, IX, PageItems, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { CIDSelect } from \"../CIDSelect\";\r\nimport { CIDView } from \"../CIDView\";\r\nimport { CUqUi, XIListUiProps } from \"../props\";\r\nimport { VIXRight } from \"./VIXRight\";\r\nimport { VXIList } from \"./VXIList\";\r\n\r\nexport class CXIList<TIX extends IDBase, TXI extends IDBase> extends CUqUi<XIListUiProps<TIX, TXI>> {\r\n\tpageItems: XIPageItems<TIX, TXI>;\r\n\r\n\tprotected async internalStart() {\r\n\t\tlet {ID, IX, xi} = this.props;\r\n\t\tthis.pageItems = new XIPageItems<TIX, TXI>(this.uq, ID, IX, xi);\r\n\t\tawait this.pageItems.first({});\r\n\t\tthis.openVPage(VXIList);\r\n\t}\r\n\r\n\t// 增加所属的IX\r\n\tonSetIXItem = async () => {\r\n\t\tlet {onSetIXItem} = this.props;\r\n\t\tif (onSetIXItem === null) return;\r\n\t\tif (onSetIXItem !== undefined) {\r\n\t\t\tawait onSetIXItem();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {uq, ID, IX, xi} = this.props;\r\n\t\tlet cIDSelect = new CIDSelect({\r\n\t\t\tuq,\r\n\t\t\tID,\r\n\t\t});\r\n\t\tlet ret:TIX = await cIDSelect.call();\r\n\t\tif (!this.pageItems.findItem(ret)) {\r\n\t\t\tawait uq.ActIX({\r\n\t\t\t\tIX,\r\n\t\t\t\tvalues: [{ix:ret.id, xi: xi.id}]\r\n\t\t\t});\r\n\t\t\tthis.pageItems.append(ret);\r\n\t\t}\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tonClickItem = async (item:any) => {\r\n\t\tlet {props} = this;\r\n\t\tlet {onClickItem} = props;\r\n\t\tif (onClickItem === null) return;\r\n\t\tif (onClickItem !== undefined) return await onClickItem(item);\r\n\t\tlet cIDView = new CIDView<any>({\r\n\t\t\t...props, \r\n\t\t\trenderRight: () => this.renderView(VIXRight, item),\r\n\t\t\tonItemChanged: null, //this.onItemChanged\r\n\t\t});\r\n\t\tawait cIDView.start(item);\r\n\t}\r\n\r\n\tbreakChain = async (item: TIX) => {\r\n\t\tlet {uq, IX, xi} = this.props;\r\n\t\tawait uq.ActIX({\r\n\t\t\tIX,\r\n\t\t\tvalues: [{ix:item.id, xi: -xi.id}]\r\n\t\t});\r\n\t\tthis.pageItems.removeItem(item);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n\r\nclass XIPageItems<TIX extends IDBase, TXI extends IDBase> extends PageItems<TIX> {\r\n\tprivate uq:Uq;\r\n\tprivate ID: ID;\r\n\tprivate IX: IX;\r\n\tprivate xi: TXI;\r\n\tconstructor(uq:Uq, ID:ID, IX:IX, xi:TXI) {\r\n\t\tsuper(true);\r\n\t\tthis.uq = uq;\r\n\t\tthis.ID = ID;\r\n\t\tthis.IX = IX;\r\n\t\tthis.xi = xi;\r\n\t}\r\n\tgetPageId(item:TIX) {return item?.id}\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.uq.QueryID<TXI>({\r\n\t\t\tIX: ['!' + this.IX.name],\r\n\t\t\tIDX: [this.ID],\r\n\t\t\tix: this.xi?.id,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn {$page:ret};\r\n\t}\r\n\tupdate(item:TIX) {\r\n\t\tlet orgItem = this._items.find(v => v.id === item.id);\r\n\t\tif (orgItem) {\r\n\t\t\tObject.assign(orgItem, item);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._items.unshift(item);\r\n\t\t}\r\n\t}\r\n}\r\n","import { FA, List, Scroller, VPage } from \"tonva-react\";\r\nimport { CIXList } from \"./CIXList\";\r\n\r\nexport class VIXIDList extends VPage<CIXList<any, any>> {\r\n\theader() {\r\n\t\tlet {props} = this.controller;\r\n\t\tlet {listHeader, header} = props;\r\n\t\tif (listHeader) return listHeader;\r\n\t\tif (header) {\r\n\t\t\tswitch (typeof header) {\r\n\t\t\t\tdefault: return header;\r\n\t\t\t\tcase 'string': return header + ' ' + this.t('list');\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet {ID} = this.controller.props;\r\n\t\tlet ret = ID.t(ID.sName);\r\n\t\tif (typeof ret === 'string') return ret + ' ' + this.t('list');\r\n\t\treturn  <>{ret} {this.t('list')}</>;\r\n\t}\r\n\tright():JSX.Element {\r\n\t\tlet {props, onAddItem} = this.controller;\r\n\t\tlet {renderRight} = props;\r\n\t\tif (renderRight === null) return null;\r\n\t\tif (renderRight !== undefined) return renderRight();\r\n\t\treturn <button className=\"btn btn-sm btn-success mr-1\" \r\n\t\t\tonClick={onAddItem}>\r\n\t\t\t<FA name=\"plus\" />\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {props, onClickItem} = this.controller;\r\n\t\tlet {renderItem, renderIx, ix} = props;\r\n\t\tlet vIx: any;\r\n\t\tif (renderIx) {\r\n\t\t\tvIx = renderIx(ix);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvIx = <div className=\"p-3\">{JSON.stringify(ix)}</div>;\r\n\t\t}\r\n\t\treturn <div>\r\n\t\t\t{vIx}\r\n\t\t\t<List items={this.controller.pageItems} \r\n\t\t\t\titem={{\r\n\t\t\t\t\trender: renderItem ?? this.renderItem,\r\n\t\t\t\t\tonClick: onClickItem,\r\n\t\t\t\t}} />\r\n\t\t</div>\r\n\t}\t\r\n\r\n\tprivate renderItem = (item:any, index:number) => {\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{this.controller.props.ID.render(item)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {\r\n\t\tawait this.controller.pageItems.more();\r\n\t\treturn;\r\n\t}\r\n\tprotected afterBack():void {}\r\n}\r\n","import { ID, IX, PageItems, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../base\";\r\nimport { CIDEdit } from \"../CIDEdit\";\r\nimport { CIDView } from \"../CIDView\";\r\nimport { CUqUi, IXListUiProps } from \"../props\";\r\nimport { VIXIDList } from \"./VIXList\";\r\n\r\nexport class CIXList<TIX extends IDBase, TXI extends IDBase> extends CUqUi<IXListUiProps<TIX, TXI>> {\r\n\tpageItems: IXIDPageItems<TIX, TXI>;\r\n\r\n\tprotected async internalStart() {\r\n\t\tlet {ID, IX, ix} = this.props;\r\n\t\tthis.pageItems = new IXIDPageItems<TIX, TXI>(this.uq, ID, IX, ix);\r\n\t\tawait this.pageItems.first({});\r\n\t\tthis.openVPage(VIXIDList);\r\n\t}\r\n\r\n\tonAddItem = async () => {\r\n\t\tlet {onAddItem} = this.props;\r\n\t\tif (onAddItem === null) return;\r\n\t\tif (onAddItem !== undefined) {\r\n\t\t\tawait onAddItem();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet saveItem = async (item: TXI):Promise<number> => {\r\n\t\t\tlet {IX, ID, ix} = this.props;\r\n\t\t\tlet ret = await this.uq.ActIX({\r\n\t\t\t\tIX,\r\n\t\t\t\tID,\r\n\t\t\t\tvalues: [{ix:ix?.id, xi:item}]\r\n\t\t\t});\r\n\t\t\treturn ret[0];\r\n\t\t}\r\n\t\tlet cIDEdit = new CIDEdit({\r\n\t\t\t...this.props, \r\n\t\t\trenderRight: undefined,\r\n\t\t\tonItemChanged: this.onItemChanged,\r\n\t\t\tsaveItem,\r\n\t\t});\r\n\t\tawait cIDEdit.start();\r\n\t}\r\n\r\n\tonClickItem = async (item:any) => {\r\n\t\tlet {props} = this;\r\n\t\tlet {onClickItem} = props;\r\n\t\tif (onClickItem === null) return;\r\n\t\tif (onClickItem !== undefined) return await onClickItem(item);\r\n\t\tlet cIDView = new CIDView<any>({\r\n\t\t\t...props, \r\n\t\t\trenderRight: undefined,\r\n\t\t\tonItemChanged: this.onItemChanged\r\n\t\t});\r\n\t\tawait cIDView.start(item);\r\n\t}\r\n\r\n\tprivate onItemChanged = async (item:TXI) => {\r\n\t\tthis.pageItems.update(item);\r\n\t}\r\n}\r\n\r\nclass IXIDPageItems<TIX extends IDBase, TXI extends IDBase> extends PageItems<TXI> {\r\n\tprivate uq:Uq;\r\n\tprivate ID: ID;\r\n\tprivate IX: IX;\r\n\tprivate ix: TIX;\r\n\tconstructor(uq:Uq, ID:ID, IX:IX, ix:TIX) {\r\n\t\tsuper(true);\r\n\t\tthis.uq = uq;\r\n\t\tthis.ID = ID;\r\n\t\tthis.IX = IX;\r\n\t\tthis.ix = ix;\r\n\t}\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.uq.QueryID<TXI>({\r\n\t\t\tIX: [this.IX],\r\n\t\t\tIDX: [this.ID],\r\n\t\t\tix: this.ix?.id,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn {$page:ret};\r\n\t}\r\n\tupdate(item:TXI) {\r\n\t\tlet orgItem = this._items.find(v => v.id === item.id);\r\n\t\tif (orgItem) {\r\n\t\t\tObject.assign(orgItem, item);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._items.unshift(item);\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { IValuesView, IValuesViewRenderOptions } from '../../components';\r\nimport { Tag, TagValue } from './tag';\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class TagView implements IValuesView {\r\n\tprivate tag: Tag;\r\n\tconstructor(tag: Tag) {\r\n\t\tthis.tag = tag;\r\n\t}\r\n\trender(values: number|string):JSX.Element {\r\n\t\tlet names:string[];\r\n\t\tif (typeof values === 'number') {\r\n\t\t\tnames = [this.tag.nameFromId(values)];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnames = this.tag.namesFromIds(values);\r\n\t\t}\r\n\t\treturn <div className=\"d-flex flex-wrap \">{names.map((name, index)=>{\r\n\t\t\treturn <div key={index} className=\"mx-2 border border-muted rounded px-3 bg-light\">{name}</div>\r\n\t\t})}</div>;\r\n\t}\r\n\trenderRadios(value: number, options: IValuesViewRenderOptions): JSX.Element {\r\n        let content = this.tag.values.map((item,index) => {\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderRadio(item, value, options)}</div>;\r\n        });\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\trenderChecks(values: string, options: IValuesViewRenderOptions): JSX.Element {\r\n\t\tlet arr = values===undefined? undefined : values.split('|').map(v => Number(v));\r\n\t\tlet content = this.tag.values.map((item,index) => {\r\n\t\t\tlet checked: boolean = arr===undefined? undefined : arr.indexOf(item.id)>=0;\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderCheck(item, checked, options)}</div>\r\n\t\t});\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\tprivate renderView(options: IValuesViewRenderOptions, content:any) {\r\n\t\tlet {className, wrapClassName} = options;\r\n\t\twrapClassName = wrapClassName?\r\n\t\t\t'row ' + wrapClassName\r\n\t\t\t:\r\n\t\t\t'row row-cols-2 row-cols-sm-3 row-cols-md-4';\r\n\t\treturn <div className={className} style={radioStyle}>\r\n\t\t\t<div className={wrapClassName}>\r\n                {content}\r\n\t\t\t</div>\r\n        </div>;\r\n\t}\r\n\tprivate renderRadio(item:TagValue, value: number, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, inputName, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"radio\" name={inputName}\r\n\t\t\t\tvalue={id} defaultChecked={value===id}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n\r\n\tprivate renderCheck(item:TagValue, checked: boolean, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"checkbox\"\r\n\t\t\t\tvalue={id} defaultChecked={checked}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n}\r\n","import { Entity } from \"../entity\";\r\nimport { TagView } from \"./tagView\";\r\n\r\nexport interface TagValue {\r\n\tid: number;\r\n\tname: string;\r\n\text: string;\r\n}\r\n\r\nexport class UqTag extends Entity {\r\n    get typeName(): string { return 'tag';}\r\n\tvalues: TagValue[];\r\n\tprivate coll: {[id:number]: TagValue} = {};\r\n\r\n\tprivate _view: TagView;\r\n\tget view(): TagView { \r\n\t\tif (this._view !== undefined) return this._view; \r\n\t\treturn this._view = new TagView(this);\r\n\t}\r\n\r\n\tnameFromId(id:number) {\r\n\t\tlet c = this.coll[id]; \r\n\t\treturn c===undefined? undefined : c.name;\r\n\t}\r\n\r\n\tnamesFromIds(ids:string):string[] {\r\n\t\tlet ret:string[] = [];\r\n\t\tfor (let id of ids.split('|')) {\r\n\t\t\tlet c = this.coll[Number(id)];\r\n\t\t\tlet name = c===undefined? undefined : c.name;\r\n\t\t\tif (name !== undefined) ret.push(name);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadValues():Promise<TagValue[]> {\r\n\t\tif (this.values !== undefined) return this.values;\r\n\t\tthis.values = [];\r\n\t\tlet ret = await this.uqApi.get('tag/values/' + this.name);\r\n\t\tif (ret === undefined) return;\r\n\t\tlet lines = (ret as string).split('\\n');\r\n\t\tfor (let line of lines) {\r\n\t\t\tif (line.length === 0) continue;\r\n\t\t\tlet parts = line.split('\\t');\r\n\t\t\tlet id = Number(parts[0]);\r\n\t\t\tlet val = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: parts[1],\r\n\t\t\t\text: parts[2],\r\n\t\t\t};\r\n\t\t\tthis.values.push(val);\r\n\t\t\tthis.coll[id] = val;\r\n\t\t}\r\n\t\treturn this.values;\r\n\t}\r\n}\r\n\r\nexport class Tag extends UqTag {\r\n}","import { makeObservable, observable } from \"mobx\";\r\nimport { IDBase } from \"tonva-uqui\";\r\nimport { CUqUi, IDBaseUiProps } from \"./props\";\r\n\r\nexport abstract class CIDBase<T extends IDBase, P extends IDBaseUiProps<T>> extends CUqUi<P> {\r\n\titem: T;\r\n\tconstructor(props: P) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\titem: observable,\r\n\t\t})\r\n\t}\r\n}\r\n","export class ErForEarning {\r\n  A:number;\r\n  B:number;\r\n  y: number[];\r\n  r2: number;\r\n\r\n  constructor(y:number[]) {\r\n    this.y = y;\r\n    this.regress();\r\n    let score = this.score();\r\n    this.r2 = score.r2;\r\n  }\r\n\r\n  regress() {\r\n    const n = this.y.length;\r\n    let xSum = 0;\r\n    let ySum = 0;\r\n  \r\n    let xSquared = 0;\r\n    let xY = 0;\r\n  \r\n    for (let x = 0; x < n; ++x) {\r\n      xSum += x;\r\n      let yx = Math.log(this.y[x]);\r\n      ySum += yx;\r\n      xSquared += x * x;\r\n      xY += x * yx;\r\n    }\r\n  \r\n    const numerator = n * xY - xSum * ySum;\r\n    let slope = numerator / (n * xSquared - xSum * xSum);\r\n    let intercept = (1 / n) * ySum - slope * (1 / n) * xSum;\r\n    this.A = Math.exp(intercept);\r\n    this.B = slope;\r\n  }\r\n\r\n  score() {\r\n    const n = this.y.length;\r\n    const y2 = new Array(n);\r\n    for (let i = 0; i < n; i++) {\r\n      y2[i] = this.predict(i);\r\n    }\r\n\r\n    let xSum = 0;\r\n    let ySum = 0;\r\n    let chi2 = 0;\r\n    let rmsd = 0;\r\n    let xSquared = 0;\r\n    let ySquared = 0;\r\n    let xY = 0;\r\n    for (let i = 0; i < n; i++) {\r\n      let yi2 = y2[i];\r\n      xSum += yi2;\r\n      let yi = this.y[i];\r\n      ySum += yi;\r\n      xSquared += yi2 * yi2;\r\n      ySquared += yi * yi;\r\n      xY += yi2 * yi;\r\n      let yiyi2 = yi - yi2;\r\n      if (yi !== 0) {\r\n        chi2 += (yiyi2 * yiyi2) / yi;\r\n      }\r\n      rmsd += yiyi2 * yiyi2;\r\n    }\r\n\r\n    const r =\r\n      (n * xY - xSum * ySum) /\r\n      Math.sqrt((n * xSquared - xSum * xSum) * (n * ySquared - ySum * ySum));\r\n\r\n    return {\r\n      r: r,\r\n      r2: r * r,\r\n      chi2: chi2,\r\n      rmsd: Math.sqrt(rmsd / n)\r\n    };\r\n  }\r\n\r\n  predict(x:number) {\r\n    return this.A * Math.exp(x * this.B);\r\n  }\r\n}\r\n","//=== UqApp builder created on Thu Jan 06 2022 23:34:04 GMT-0500 (北美东部标准时间) ===//\r\nimport { CSub, CBase, CAppBase, IConstructor } from 'tonva-react';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase<CApp, UQs> {\r\n}\r\n\r\nexport abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A,U>> extends CSub<A, U, T> {\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase<UQs> {\r\n\tprotected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n\t\tlet c = new type(this);\r\n\t\tc.init();\r\n\t\treturn c;\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testTimesChange = {\r\n\tname: 'TimesChange', \r\n\tdiscription: 'Test Times Change hours', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet tc = uqs.BzTimesChange;\r\n\t\tlet ret = await tc.IDActs({\r\n\t\t\tstaff: [\r\n\t\t\t\t{id: undefined, no: '101', firstName: 'Song', lastName: 'Sha'}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(ret);\r\n\t\tlet id = 13369344;\r\n\t\tlet r1 = await tc.IDActs({\r\n\t\t\thours: [\r\n\t\t\t\t{id, onsite:{value: 3, time: new Date(2021, 0, 1)}}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(r1);\r\n\r\n\t\tlet month = await tc.IDLog({\r\n\t\t\tIDX: tc.Hours,\r\n\t\t\tfield: 'onsite',\r\n\t\t\tid,\r\n\t\t\tlog: 'month',\r\n\t\t\ttimeZone: -5,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: undefined,\r\n\t\t\t\tend: new Date(2021,0,1).getTime(),\r\n\t\t\t\tsize: 10,\r\n\t\t\t}\r\n\t\t});\r\n\t\tlog(month);\r\n\r\n\t\tlet sum = await tc.IDSum({\r\n\t\t\tIDX: tc.Hours,\r\n\t\t\tfield: ['onsite'],\r\n\t\t\tid: [id],\r\n\t\t\tfar: undefined,\r\n\t\t\tnear: new Date().getTime(),\r\n\t\t});\r\n\t\tlog(sum);\r\n\t\t*/\r\n\t}\r\n}\r\n","import { DebugItem } from \"../CBug\";\r\nimport { testTimesChange } from \"./test-times-change\";\r\nimport { testItem1 } from \"./test1\";\r\nimport { testItem2 } from \"./test2\";\r\nimport { testItem3 } from \"./test3\";\r\nimport { testItem4 } from \"./test4\";\r\n\r\nexport const debugItems: DebugItem[] = [\r\n\ttestItem1,\r\n\ttestItem2,\r\n\ttestItem3,\r\n\ttestItem4,\r\n\ttestTimesChange,\r\n];\r\n","import { DebugItem } from \"../CBug\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\n//BzTest, BzHelloTonva, BzCustomerPayment, \r\n\r\nexport const testItem1:DebugItem = {\r\n\tname: 'HelloTonva.GetProductStock',\r\n\tdiscription: '{product: 1}',\r\n\ttest: async ( log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet a = await uqs.BzTest.ID({\r\n\t\t\tIDX: uqs.BzTest.X1,\r\n\t\t\tid: 7077888,\r\n\t\t});\r\n\t\tfor (let item of a) {\r\n\t\t\tlog(item);\r\n\t\t}\r\n\r\n\t\tlet e = await uqs.BzTest.IDActs({\r\n\t\t\ttag: [\r\n\t\t\t\t{id: undefined, type: 'a', name: 'b'},\r\n\t\t\t\t{id: undefined, type: 'a', name: 'c'},\r\n\t\t\t\t{id: undefined, type: 'd', name: 'c'},\r\n\t\t\t],\r\n\t\t\tx1: [\r\n\t\t\t\t{id: undefined, a1: 1, a2: 3, a3:5, n5: 7},\r\n\t\t\t\t{id: undefined, a1: 1, a2: 7, a3:51, n5: 71},\r\n\t\t\t],\r\n\t\t\tassign1: [\r\n\t\t\t\t{ix: 3, id: 5, val: 3},\r\n\t\t\t\t{ix: 3, id: 6, val: 30},\r\n\t\t\t],\r\n\t\t\tiBook1: [\r\n\t\t\t\t{id: 7, f1: 3.5, f2: 7.2, b: 'bbbb', c: 1},\r\n\t\t\t\t{id: 8, f1: 3.5, f2: 7.2, b: 'bbbbc', c: 2},\r\n\t\t\t],\r\n\t\t});\r\n\t\tlog(e);\r\n\r\n\t\tlet b = await uqs.BzTest.IDDetail<BzTest.OrderMaster, BzTest.OrderDetail>\r\n\t\t({\r\n\t\t\tmaster: {\r\n\t\t\t\tID: uqs.BzTest.OrderMaster,\r\n\t\t\t\tvalue: {customer: 1 },\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tID: uqs.BzTest.OrderDetail,\r\n\t\t\t\tvalues: [\r\n\t\t\t\t\t{product:11, price:2.0, quantity:3.0, amount:6.0},\r\n\t\t\t\t\t{product:12, price:2.0, quantity:5.0, amount:10.0},\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tlog(b);\r\n\r\n\t\tlet c = await uqs.BzTest.IDDetailGet<BzTest.OrderMaster, BzTest.OrderDetail>({\r\n\t\t\tid: 8716325,\r\n\t\t\tmaster: uqs.BzTest.OrderMaster,\r\n\t\t\tdetail: uqs.BzTest.OrderDetail,\r\n\t\t});\r\n\r\n\t\tfor (let ci of c) {\r\n\t\t\tlog(ci);\r\n\t\t}\r\n\r\n\t\t//let u: BzHelloTonva.Return$pokedRet;\r\n\t\t//u.poke = 1;\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet f = BzCustomerPayment.EnumCustomerAction.confirm;\r\n\r\n\t\tlet ret = await uqs.BzHelloTonva.GetProductStock.query({product: 1});\r\n\t\tlog(ret);\r\n\t\t*/\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t}\r\n}","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem2 = {\r\n\tname: '第二测试', \r\n\tdiscription: 'second test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet ret = await uqs.BzHelloTonva.TestArr.submitReturns({rows: [\r\n\t\t\t{a: 1, b: 2}, \r\n\t\t\t{a: 3, b: 4}, \r\n\t\t]});\r\n\t\tlog(ret);\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\t*/\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem3 = {\r\n\tname: '第三测试', \r\n\tdiscription: 'third test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet a = await uqs.BzTest.IDLog({\r\n\t\t\tIDX: uqs.BzTest.IBook1,\r\n\t\t\tfield: 'f2',\r\n\t\t\tid: 7,\r\n\t\t\tlog: 'each',\r\n\t\t\tpage: {start:undefined, size: 50},\r\n\t\t});\r\n\t\tlog(a);\r\n\r\n\t\tlet b = await uqs.BzTest.KeyID({\r\n\t\t\tID: uqs.BzTest.X1,\r\n\t\t\tkey: {a1: 1, a2: undefined},\r\n\t\t});\r\n\t\tlog(b);\r\n\r\n\t\tlet c = await uqs.BzTest.IX({\r\n\t\t\tIX: uqs.BzTest.Assign1,\r\n\t\t\tid: 3,\r\n\t\t});\r\n\t\tlog(c);\r\n\r\n\t\tlet d = await uqs.BzTest.KeyIX({\r\n\t\t\tID: uqs.BzTest.X1,\r\n\t\t\tkey: {a1: 1, a2: undefined},\r\n\t\t\tIX: uqs.BzTest.Assign1,\r\n\t\t});\r\n\t\tlog(d);\r\n\r\n\t\tlet e = await uqs.BzTest.IDActs({\r\n\t\t\tiBook1: [\r\n\t\t\t\t{id: -7, f1: 3.5, f2: 7.2, b: 'bbbb', c: 1},\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(e);\r\n\r\n\t\tlet ret = await uqs.BzHelloTonva.TestArr.submitReturns({rows: [\r\n\t\t\t{a: 1, b: 2}, \r\n\t\t\t{a: 3, b: 4}, \r\n\t\t]});\r\n\t\tlog(ret);\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\t*/\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem4 = {\r\n\tname: 'Tag测试', \r\n\tdiscription: 'Tag Test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet ret = await uqs.BzTest.IX({\r\n\t\t\tIX: uqs.BzTest.CustomerTag,\r\n\t\t\tid: 1,\r\n\t\t\tIDX: [uqs.BzTest.Tag],\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\tlog(ret);\r\n\t\t*/\r\n\t}\r\n}\r\n","import { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CBug, DebugItem } from \"./CBug\";\r\n\r\nexport class VBug extends VPage<CBug> {\r\n\theader() {\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\tDebug\r\n\t\t\t<small className=\"text-muted\"> - 本页仅调试状态可见</small>\r\n\t\t</div>\r\n\t}\r\n\tcontent() {\r\n        return <div>\r\n\t\t\t<div>\r\n\t\t\t\t{this.controller.debugItems.map(this.renderItem)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"px-3 py-2\">\r\n\t\t\t\t<button className=\"btn btn-primary\" onClick={this.controller.test}>test</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (item:DebugItem, index:number):JSX.Element => {\r\n\t\tlet {name, discription} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={() => this.controller.openDebugPage(item)}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{name} <small className=\"text-muted\">{discription}</small></div>\r\n\t\t</LMR>;\r\n\t}\r\n}","import { VPage } from \"tonva-react\";\r\nimport { CBug } from \"./CBug\";\r\n\r\nexport class VConsole extends VPage<CBug> {\r\n\tprivate div: HTMLDivElement;\r\n\tprivate divBottom: HTMLDivElement;\r\n\tinit() {\r\n\t\tthis.startAutoScrollToBottom();\r\n\t}\r\n\theader() {\r\n\t\treturn this.controller.currentItem.name;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {currentItem} = this.controller;\r\n\t\tlet {name, discription} = currentItem;\r\n\t\treturn <div>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div>{discription}</div>\r\n\t\t\t</div>\r\n\t\t\t<div ref={t => this.div = t} className=\"p-3 border-top border-primary bg-light\" />\r\n\t\t\t<div ref={t => this.divBottom = t} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate autoScrollEnd:boolean = false;\r\n\tprivate autoScroll = true;\r\n    private lastScrollTop = 0;\r\n    private timeHandler:any;\r\n    private startAutoScrollToBottom() {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n\t\tthis.autoScroll = true;\r\n\t\tif (this.timeHandler !== undefined) return;\r\n        this.timeHandler = setInterval(() => {\r\n\t\t\tif (this.autoScroll === false) return;\r\n            this.divBottom?.scrollIntoView();\r\n        }, 100);\r\n    }\r\n    private endAutoScrollToBottom() {\r\n        setTimeout(() => {\r\n\t\t\tthis.autoScroll = false;\r\n\t\t\tthis.autoScrollEnd = true;\r\n\t\t\tif (this.timeHandler === undefined) return;\r\n\t\t\tclearInterval(this.timeHandler);\r\n\t\t\tthis.timeHandler = undefined;\r\n\t\t}, 300);\r\n\t}\r\n\tprivate pauseAutoScrollToBottom() {\r\n\t\tthis.autoScroll = false;\r\n\t}\r\n\tprotected onPageScroll(e:any) {\r\n        let el = e.target as HTMLBaseElement;\r\n        let {scrollTop, scrollHeight, offsetHeight} = el;\r\n        if (scrollTop <= this.lastScrollTop) {\r\n            this.pauseAutoScrollToBottom();\r\n        }\r\n        else if (scrollTop + offsetHeight > scrollHeight - 30) {\r\n            this.startAutoScrollToBottom();\r\n        }\r\n\r\n        this.lastScrollTop = scrollTop;\r\n\t}\r\n\r\n\tlog = (message?: any):void => {\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNode(this.div);\r\n\t\tlet html:string;\r\n\t\tif (!message) {\r\n\t\t\thtml = '<div>&nbsp;</div>';\r\n\t\t}\r\n\t\telse if (typeof message === 'object') {\r\n\t\t\thtml = this.objToHtml(message);\r\n\t\t}\r\n\t\telse {\r\n\t\t\thtml = '<div>' + message + '</div>';\r\n\t\t}\r\n\t\tconst child = range.createContextualFragment(html);\r\n\t\tthis.div.appendChild(child);\r\n\t}\r\n\r\n\tprivate objToHtml(obj: any) {\r\n\t\tif (obj === null) return '<div>null</div>';\r\n\t\tif (obj === undefined) return '<div>undefined</div>';\r\n\t\tif (Array.isArray(obj) === true) {\r\n\t\t\treturn this.arrToHtml(0, obj);\r\n\t\t}\r\n\t\tlet ret = '<div>{</div>';\r\n\t\tfor (let i in obj) {\r\n\t\t\tret += this.indent(1) + i + ': ';\r\n\t\t\tlet v = obj[i];\r\n\t\t\tif (Array.isArray(v) === true) {\r\n\t\t\t\tret += this.arrToHtml(1, v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tret += this.objToString(v);\r\n\t\t\t}\r\n\t\t}\r\n\t\tret += '<div>}</div>';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate indent(n:number) {\r\n\t\tif (!n) return '';\r\n\t\tlet ret = '';\r\n\t\tn = n*2;\r\n\t\tfor (let i=0; i<n; i++) ret += '&emsp;';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate objToString(obj: any) {\r\n\t\tif (obj === null) {\r\n\t\t\treturn 'null';\r\n\t\t}\r\n\t\tif (Array.isArray(obj) === true) {\r\n\t\t\treturn 'array[' + obj.length + ']';\r\n\t\t}\r\n\t\tswitch (typeof obj) {\r\n\t\tdefault: return obj.toString();\r\n\t\tcase 'undefined': return 'undefined';\r\n\t\tcase 'object':\r\n\t\t\tif (obj.tuid === undefined) {\r\n\t\t\t\treturn 'obj';\r\n\t\t\t}\r\n\t\t\treturn obj.id;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate objToLine(indent:number, obj:any) {\r\n\t\tlet first = true;\r\n\t\tlet ret = '<div>' + this.indent(indent) + '{ ';\r\n\t\tfor (let i in obj) {\r\n\t\t\tif (first === false) {\r\n\t\t\t\tret += ', ';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tret += i + ':' + this.objToString(obj[i]);\r\n\t\t}\r\n\t\tret += ' }</div>';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate indentVal(indent:number, val:any):string {\r\n\t\treturn '<div>' + this.indent(indent) + val + '</div>'\r\n\t}\r\n\tprivate arrToHtml(indent:number, arr:any[]) {\r\n\t\tlet ret = '<div>' + this.indent(indent) + '[</div>';\r\n\t\tfor (let item of arr) {\r\n\t\t\tlet t:string|number;\r\n\t\t\tswitch (typeof item) {\r\n\t\t\t\tdefault: t = this.indentVal(indent+1, item); break;\r\n\t\t\t\tcase 'object': t = this.objToLine(indent+1, item); break;\r\n\t\t\t\tcase 'string': t = this.indentVal(indent+1, `'${item}'`); break;\r\n\t\t\t}\r\n\t\t\tret += t;\r\n\t\t}\r\n\t\tret += '<div>' + this.indent(indent) + ']</div>';\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { CUqBase, UQs } from \"uq-app\";\r\nimport { Log } from \"./Logger\";\r\nimport { debugItems } from \"./tester\";\r\nimport { VBug } from \"./VBug\";\r\nimport { VConsole } from \"./VConsole\";\r\n\r\nexport interface DebugItem {\r\n\tname: string;\r\n\tdiscription?: string;\r\n\ttest: (log:Log, uqs: UQs) => Promise<void>;\r\n}\r\n\r\nexport class CBug extends CUqBase {\r\n\tdebugItems = [...debugItems];\r\n\tcurrentItem: DebugItem;\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VBug);\r\n\t}\r\n\r\n\ttab = () => this.renderView(VBug);\r\n\r\n\tload = async () => {\r\n\r\n\t}\r\n\r\n\topenDebugPage = async (item:DebugItem) => {\r\n\t\tthis.currentItem = item;\r\n\t\tlet console = await this.openVPage(VConsole);\r\n\t\tlet {test} = item;\r\n\t\tlet start = new Date();\r\n\t\tconsole.log(`=== test start at ${start} ===`);\r\n\t\tconsole.log();\r\n\t\tawait test(console.log, this.uqs);\r\n\t\tlet span = Date.now() - start.getTime();\r\n\t\tlet ms = (1000 + (span % 1000)).toString().substr(1);\r\n\t\tlet s = Math.floor(span / 1000);\r\n\t\tlet m = Math.floor(s / 60);\r\n\t\tlet t = '';\r\n\t\tif (m > 0) t += ms + '\\'';\r\n\t\tt += s + '\"' + ms;\r\n\t\tconsole.log();\r\n\t\tconsole.log(`=== test end: ${t} ===`);\r\n\t}\r\n\r\n\ttest = async () => {\r\n\t\tlet uqName = 'BizDev/hello-tonva';\r\n\t\tlet roles = await this.getUqRoles(uqName);\r\n\t\talert(roles);\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\thome: '首页',\r\n\trelation: '关系',\r\n\tdiscover: '发现',\r\n\ttest: '测试',\r\n\tdebug: 'Debug',\r\n\tme: '我',\r\n\r\n\tchangePassword: '修改密码',\r\n\taboutTheApp: '关于本APP',\r\n\tlogout: '退出登录',\r\n\tpleaseLogin: '登录',\r\n\r\n\tcontent: '内容',\r\n\tbackend: '后台管理',\r\n\r\n\tmyAll: '自选股',\r\n\tmyBlack: '黑名单',\r\n\r\n\t\r\n}\r\n","export const en = {\r\n\thome: 'Home',\r\n\trelation: 'Relation',\r\n\tdiscover: 'Discover',\r\n\ttest: 'Test',\r\n\tdebug: 'Debug',\r\n\tme: 'Me',\r\n\r\n\tchangePassword: 'Change password',\r\n\taboutTheApp: 'About the APP',\r\n\tlogout: 'Logout',\r\n\tpleaseLogin: 'Login',\r\n\r\n\tcontent: 'Content',\r\n\tbackend: 'Backend Management',\r\n\r\n\tmyAll: 'All My Stock',\r\n\tmyBlack: 'Block List',\r\n}\r\n","//=== UqApp builder created on Tue Jan 05 2021 18:41:24 GMT-0500 (GMT-05:00) ===//\r\nimport { VPage, TabProp, TabCaptionComponent, TabsProps } from 'tonva-react';\r\nimport { CApp } from './CApp';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\n/*\r\nfunction caption(label:string|JSX.Element, icon:string) {\r\n\treturn (selected: boolean) => TabCaptionComponent(label, icon, color(selected));\r\n}\r\n*/\r\nexport class VMain extends VPage<CApp> {\r\n\theader() {return false;}\r\n\r\n\tprotected get tabsProps(): TabsProps {\r\n\t\t/*\r\n\t\tlet { cHome, cBug, cMe, cUI } = this.controller;\r\n\t\tlet tabs: TabProp[] = [\r\n\t\t\t{name: 'home', caption: caption(t('home'), 'home'), content: cHome.tab},\r\n\t\t\t{name: 'me', caption: caption(t('me'), 'user-o'), content: cMe.tab, load: cMe.load},\r\n\t\t];\r\n\t\tif (this.isDev === true) {\r\n\t\t\ttabs.push({\r\n\t\t\t\tname: 'UI', caption: caption(t('UI'), 'television'), content: cUI.tab\r\n\t\t\t});\r\n\t\t\ttabs.push({\r\n\t\t\t\tname: 'debug', caption: caption(t('debug'), 'bug'), content: cBug.tab, onShown: cBug.load\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn {tabs};\r\n\t\t*/\r\n\t\tlet { cHome, cFind, cTrack, cMe } = this.controller;\r\n\t\tlet tabs: TabProp[] = [\r\n\t\t\t/*{ \r\n\t\t\t\tname: 'home', label: '首页', icon: 'home', content: cHome.tab, \r\n\t\t\t\tnotify: undefined, \r\n\t\t\t\tload: cHome.load, \r\n\t\t\t\tonShown: cHome.load,\r\n\t\t\t},*/\r\n\t\t\t{\r\n\t\t\t\tname: 'home', label: '首页', icon: 'money', \r\n\t\t\t\tnotify: undefined,\r\n\t\t\t\tcontent: cHome.tab, //load: cGroup.load, onShow: cGroup.load,\r\n\t\t\t},\r\n\t\t\t/*{\r\n\t\t\t\tname: 'explorer', label: '持仓', icon: 'money', content: cHolding.tab, // load: cHolding.load \r\n\t\t\t},*/\r\n\t\t\t{\r\n\t\t\t\tname: 'find', label: '发现', icon: 'search', content: cFind.tab, load: cFind.load\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tname: 'track', label: '回溯', icon: 'history', content: cTrack.tab, load: cTrack.load\r\n\t\t\t},\r\n\t\t\t/*\r\n\t\t\t{\r\n\t\t\t\tname: 'explorer', label: '选股', icon: 'search', content: cExporer.tab, load: cExporer.load\r\n\t\t\t},*/\r\n\t\t\t{\r\n\t\t\t\tname: 'me', label: '我的', icon: 'user', content: cMe.tab, onShown: undefined, load: cMe.load\r\n\t\t\t}\r\n\t\t].map(v => {\r\n\t\t\tlet { name, label, icon, content, notify, load, onShown } = v;\r\n\t\t\treturn {\r\n\t\t\t\tname,\r\n\t\t\t\tcaption: (selected: boolean) => TabCaptionComponent(label, icon, color(selected)),\r\n\t\t\t\tcontent,\r\n\t\t\t\tnotify,\r\n\t\t\t\tload,\r\n\t\t\t\tonShown,\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn {tabs};\r\n\t}\r\n\r\n\t/*\r\n\tprotected get webNav(): PageWebNav {\r\n\t\treturn {\r\n\t\t\tnavHeader: <div>webNav header</div>, \r\n\t\t\tnavFooter: <div>webNav footer</div>,\r\n\t\t};\r\n\t}\r\n\t*/\r\n}\r\n","import { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CTester, UIItem } from \"./CTest\";\r\n\r\nexport class VTester extends VPage<CTester> {\r\n\theader() {\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\tUI\r\n\t\t\t<small className=\"text-muted\"> - 本页仅调试状态可见</small>\r\n\t\t</div>\r\n\t}\r\n\tcontent() {\r\n        return <div>\r\n\t\t\t<div>\r\n\t\t\t\t{this.controller.uiItems.map(this.renderItem)}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (item:UIItem, index:number):JSX.Element => {\r\n\t\tlet {name, discription, click} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={click}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{name} <small className=\"text-muted\">{discription}</small></div>\r\n\t\t</LMR>;\r\n\t}\r\n}\r\n","import { CBase } from \"tonva-react\";\r\n/*\r\nimport { CID, MidID, CIDX, MidIDX, MidTag, CIDTagList, CTagIDList\r\n\t, SheetUI, MidIDTagList, CSheetNew, MidSheet } from \"tonva-uqui\";\r\n*/\r\nimport { CApp, UQs } from \"uq-app\";\r\n//import { OrderDetail, OrderMaster } from \"uq-app/uqs/BzHelloTonva\";\r\nimport { VTester } from \"./VTest\";\r\n//import { isNumber } from \"lodash\";\r\n\r\nexport interface UIItem {\r\n\tname: string;\r\n\tdiscription?: string;\r\n\tclick: () => Promise<void>;\r\n}\r\n\r\nexport class CTester extends CBase<CApp,UQs> {\r\n\treadonly uiItems:UIItem[] = [\r\n\t\t/*\r\n\t\t{\r\n\t\t\tname: 'customer',\r\n\t\t\tdiscription: '客户信息',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidID(uq, {ID:uq.Customer});\r\n\t\t\t\tlet cID = new CID(mid);\r\n\t\t\t\tawait cID.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'tag',\r\n\t\t\tdiscription: '客户标签',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet midTag = new MidTag(uq, uq.Customer, uq.CustomerTag, uq.Tag, 'customer');\r\n\t\t\t\tlet midIDTagList = new MidIDTagList(midTag);\r\n\t\t\t\tlet cIDTagList = new CIDTagList(midIDTagList);\r\n\t\t\t\tawait cIDTagList.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'tagCustomer',\r\n\t\t\tdiscription: '标签客户',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet midTag = new MidTag(uq, uq.Customer, uq.CustomerTag, uq.Tag, 'customer');\r\n\t\t\t\tlet cTagIDList = new CTagIDList(midTag);\r\n\t\t\t\tawait cTagIDList.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'staff',\r\n\t\t\tdiscription: 'TimeChange Staff',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidID(uq, {ID:uq.Staff});\r\n\t\t\t\tlet cStaff = new CID(mid);\r\n\t\t\t\tcStaff.renderItem = (item:any, index:number): JSX.Element => {\r\n\t\t\t\t\treturn <div className=\"\">{uq.Staff.render(item)}</div>\r\n\t\t\t\t};\r\n\t\t\t\tawait cStaff.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'hours',\r\n\t\t\tdiscription: 'TimeChange Hours',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidIDX(uq, uq.Hours, uq.Staff, this.timeZone);\r\n\t\t\t\tlet cHours = new CIDX(mid);\r\n\t\t\t\tawait cHours.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'sheet-order',\r\n\t\t\tdiscription: 'Sheet Order Hello Tonva',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet onChanged = async (context:Context, value:any, prev:any) => {\r\n\t\t\t\t\tlet quantity = context.getValue('quantity');\r\n\t\t\t\t\tlet price = context.getValue('price');\r\n\t\t\t\t\tif (isNumber(quantity) && isNumber(value)) {\r\n\t\t\t\t\t\tcontext.setValue('amount', (price*quantity).toFixed(2));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet sheetUI:SheetUI = {\r\n\t\t\t\t\tmaster: {\r\n\t\t\t\t\t\tID: uq.OrderMaster,\r\n\t\t\t\t\t\tfieldCustoms: {\r\n\t\t\t\t\t\t\tcustomer: {ID: uq.Customer},\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdetail: {\r\n\t\t\t\t\t\tID: uq.OrderDetail,\r\n\t\t\t\t\t\tfieldCustoms: {\r\n\t\t\t\t\t\t\tproduct: { ID: uq.Customer },\r\n\t\t\t\t\t\t\tprice: { onChanged },\r\n\t\t\t\t\t\t\tquantity: { onChanged },\r\n\t\t\t\t\t\t\tamount: { readOnly: true, }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet mid = new MidSheet<OrderMaster, OrderDetail>(uq, sheetUI, this.res);\r\n\t\t\t\tlet cSheetNew = new CSheetNew(mid);\r\n\t\t\t\tawait cSheetNew.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t*/\r\n\t];\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VTester);\r\n\t}\r\n\r\n\ttab = () => this.renderView(VTester);\r\n}\r\n","//=== UqApp builder created on Tue Jan 12 2021 23:14:51 GMT-0500 (GMT-05:00) ===//\r\nimport { AppConfig, DevConfig } from \"tonva-react\";\r\n\r\n/*\r\nconst bz: DevConfig = {\r\n\tname: 'bizdev',\r\n\talias: 'bz',\r\n}\r\n*/\r\n\r\nconst bruce: DevConfig = {\r\n\tname: 'bruce',\r\n\talias: undefined,\r\n}\r\n\r\nexport const appConfig: AppConfig = {\r\n\tversion: '0.1.5',\r\n\tapp: undefined,\r\n\tuqs: [\r\n\t\t/*\r\n\t\t{\r\n\t\t\tdev: bz,\r\n\t\t\tname: 'hello-tonva',\r\n\t\t\talias: 'HelloTonva',\r\n\t\t\tversion: '0.1.0',\r\n\t\t},\r\n\t\t*/\r\n\t\t{\r\n\t\t\tdev: bruce,\r\n\t\t\tname: 'yumi',\r\n\t\t\talias: 'YuMi',\r\n\t\t\tversion: '0.1.0',\r\n\t\t},\r\n\t],\r\n\tnoUnit: true,\r\n    tvs: {},\r\n\toem: undefined,\r\n\thtmlTitle: '鱼米乡 - 私享投资圈',\r\n};\r\n","import { VPage } from \"tonva-react\";\r\nimport { appConfig } from \"../uq-app/appConfig\";\r\nimport { CMe } from \"./CMe\";\r\n\r\nexport class VAbout extends VPage<CMe> {\r\n\theader() {return '关于APP';}\r\n\tcontent() {\r\n\t\treturn <div className=\"py-5 px-3 my-3 w-max-30c mx-auto bg-white\">\r\n\t\t\t<div className=\"text-center mb-5 position-relative\">\r\n\t\t\t\t<small className=\"text-muted position-absolute\"\r\n\t\t\t\t\tstyle={{right:'0', top:'-2.8rem'}}>\r\n\t\t\t\t\t版本: {appConfig.version}\r\n\t\t\t\t</small>\r\n\t\t\t\t<i className=\"text-danger position-absolute top-0 start-0 fa fa-fire fa-2x\" \r\n\t\t\t\t\tstyle={{left:'2rem', top:'0.5rem'}} />\r\n\t\t\t\t<b className=\"text-danger h5 mb-0\">\r\n\t\t\t\t\t<span className=\"text-primary\">鱼</span>\r\n\t\t\t\t\t<b className=\"mx-1\">米</b>\r\n\t\t\t\t\t<span className=\"text-success\">乡</span>\r\n\t\t\t\t</b>\r\n\t\t\t\t<br/>\r\n\t\t\t\t<small className=\"text-info\">私享投资圈</small>\r\n\t\t\t</div>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>跟家人和好友一起分享投资思考。</li>\r\n\t\t\t\t<li>世界级投资大师年化收益率11%。</li>\r\n\t\t\t\t<li>全球最大的成长经济体GDP增长率高于5%。</li>\r\n\t\t\t\t<li>以10%为基础，期待<b className=\"text-danger mx-1\">15%以上</b>的高水平。</li>\r\n\t\t\t</ul>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<small className=\"text-muted mr-2\">by</small>\r\n\t\t\t\t同花\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { makeObservable, observable, runInAction } from 'mobx';\r\nimport {\r\n    userApi, ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem, nav, Page,\r\n    Edit, UiSchema, VPage, Prop, FA, IconText, PropGrid\r\n} from 'tonva-react';\r\nimport { CMe } from './CMe';\r\n\r\nexport class VEditMe extends VPage<CMe>{\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    data: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        let { nick, icon } = nav.user;\r\n        this.data = {\r\n            nick,\r\n            icon,\r\n        };\r\n\t\tmakeObservable(this, {\r\n\t\t\tdata: observable,\r\n\t\t})\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        await userApi.userSetProp(name, newValue);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.data[name] = newValue;\r\n\t\t\t(nav.user as any)[name] = newValue;\r\n\t\t\tnav.saveLocalUser();\r\n\t\t});\r\n    }\r\n\r\n\tprivate onExit = () => {\r\n        nav.showLogout();\r\n    }\r\n\r\n\tprivate changePassword = async () => {\r\n        await nav.changePassword();\r\n    }\r\n\r\n    private page = () => {\r\n\t\tlet { schema, uiSchema, data, onItemChanged } = this;\r\n\t\tlet gridRows: Prop[] = [\r\n\t\t\t'',\r\n\t\t\t{\r\n\t\t\t\ttype: 'component',\r\n\t\t\t\tcomponent: <IconText iconClass=\"text-info mr-2\" icon=\"key\" text={this.t('changePassword')} />,\r\n\t\t\t\tonClick: this.changePassword\r\n\t\t\t},\r\n\t\t\t'',\r\n\t\t\t'',\r\n\t\t\t{\r\n\t\t\t\ttype: 'component',\r\n\t\t\t\tbk: '',\r\n\t\t\t\tcomponent: <div className=\"w-100 text-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger w-100 w-max-20c\" onClick={this.onExit}>\r\n\t\t\t\t\t\t<FA name=\"sign-out\" size=\"lg\" /> {this.t('logout')}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t},\r\n\t\t];\r\n\r\n\r\n\t\t/*\r\n\t\tlet vAdmin: any;\r\n\t\t\r\n\t\tlet { role } = this.controller;\r\n\t\tif ((role & 2) === 2) {\r\n\t\t\tvAdmin = <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\" onClick={this.controller.showAdmin}>管理员</div>;\r\n\t\t}\r\n\t\t{vAdmin}\r\n\t\t*/\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={schema} uiSchema={uiSchema}\r\n                data={data}\r\n                onItemChanged={onItemChanged} />\r\n\t\t\t<PropGrid rows={gridRows} values={{}} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport const webUserSchema: ItemSchema[] = [\r\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\r\n    { name: 'gender', type: 'string' } as StringSchema,\r\n    { name: 'salutation', type: 'string' } as StringSchema,\r\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\r\n    { name: 'departmentName', type: 'string' } as StringSchema,\r\n];\r\n\r\n","import { VPage } from \"tonva-react\";\r\nimport { CMe } from \"./CMe\";\r\n\r\nexport class VFaq extends VPage<CMe> {\r\n\theader() {return '米投体系'}\r\n\tcontent() {\r\n\t\treturn <ul>\r\n\t\t\t<li className=\"my-3\">\r\n\t\t\t\t<div className=\"my-2\">基本公理</div>\r\n\t\t\t\t<ul className=\"px-3 text-info\">\r\n\t\t\t\t\t<li><span className=\"mr-3\">公理1: </span>进步是社会的必然</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">公理2: </span>信任是经济的基石</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">公理3: </span>价值是价格的准心</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">公理4: </span>发展是企业的基因</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</li>\r\n\t\t\t<li className=\"my-3\">\r\n\t\t\t\t<div className=\"my-2\">米投定律</div>\r\n\t\t\t\t<ul className=\"px-3 text-info\">\r\n\t\t\t\t\t<li><span className=\"mr-3\">定律1: </span>投资无风险</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</li>\r\n\t\t\t<li className=\"my-3\">\r\n\t\t\t\t<div className=\"my-2\">米投原则</div>\r\n\t\t\t\t<ul className=\"px-3 text-info\">\r\n\t\t\t\t\t<li><span className=\"mr-3\">原则1: </span>低估</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">原则2: </span>分散</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">原则3: </span>不深研</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</li>\r\n\t\t\t<li className=\"my-3\">\r\n\t\t\t\t<div className=\"my-2\">米息定义</div>\r\n\t\t\t\t<ul className=\"px-3 text-info\">\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义1: </span>米息 = 增息 + 股息</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义2: </span>增息 = 企业未来三年利润增长值</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义3: </span>米息率 = 米息 / 股价</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义4: </span>米息率大一倍，米息分加1</li>\r\n\t\t\t\t\t<li><span className=\"mr-3\">定义5: </span>PE = 股价 / 利润</li>\r\n\t\t\t\t</ul>\r\n\t\t\t</li>\r\n\t\t</ul>\r\n\t}\r\n}","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Image, VPage, nav, IconText, PropGrid, LMR, FA, Prop } from 'tonva-react';\r\nimport { CMe } from './CMe';\r\nimport { appConfig } from \"../uq-app/appConfig\";\r\nimport { VFaq } from './VFaq';\r\nimport { VAbout } from './VAbout';\r\n\r\nexport class VMe extends VPage<CMe> {\r\n\theader() {return this.t('me')}\r\n\r\n\tcontent() {\r\n        const { user } = nav;\r\n        let aboutRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"w-100\" onClick={this.faq}\r\n\t\t\t\t\tright={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                    <IconText iconClass=\"text-info mr-2\" icon=\"comments-o\" text={this.t('米投体系')} />                    \r\n                </LMR>,\r\n            },\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"w-100\" onClick={this.about}\r\n\t\t\t\t\tright={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                    <IconText iconClass=\"text-info mr-2\" \r\n\t\t\t\t\t\ticon=\"smile-o\" \r\n\t\t\t\t\t\ttext={<>{this.t('aboutTheApp')} <small>版本 {appConfig.version}</small></>} />                    \r\n                </LMR>,\r\n            },\r\n        ];\r\n\r\n        let rows: Prop[];\r\n        if (user === undefined) {\r\n            rows = aboutRows;\r\n            rows.push(\r\n                {\r\n                    type: 'component',\r\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => nav.logout()}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.t('pleaseLogin')}\r\n                    </button>\r\n                },\r\n            );\r\n        }\r\n        else {\r\n            let logOutRows: Prop[] = [\r\n            ];\r\n\r\n            rows = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: React.createElement(this.meInfo)\r\n                },\r\n\t\t\t\t'',\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'component',\r\n\t\t\t\t\tcomponent: <LMR className=\"w-100\" onClick={this.controller.backend}\r\n\t\t\t\t\t\tright={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n\t\t\t\t\t\t<IconText iconClass=\"text-info mr-2\" icon=\"comments-o\" text={this.t('用户角色')} />\r\n\t\t\t\t\t</LMR>,\r\n\t\t\t\t},\t\r\n            ]\r\n            rows.push(...aboutRows, ...logOutRows);\r\n        }\r\n        return <PropGrid rows={[...rows]} values={{}} />;\r\n\t}\r\n\r\n\tprivate meInfo = observer(() => {\r\n        let { user } = nav;\r\n        if (!user) return null;\r\n        let { id, name, nick, icon } = user;\r\n        return <LMR className=\"py-2 cursor-pointer w-100\"\r\n            left={<Image className=\"w-3c h-3c mr-3\" src={icon || '.user-o'} />}\r\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\r\n            onClick={this.controller.showEditMe}>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </LMR>;\r\n    });\r\n\r\n\tprivate faq = () => {\r\n\t\tthis.openVPage(VFaq);\r\n\t}\r\n\r\n\tprivate about = () => {\r\n\t\tthis.openVPage(VAbout);\r\n\t}\r\n}\r\n\r\nfunction userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import { QueryPager, Uq, User } from \"tonva-react\";\r\nimport { CRoles } from \"tonva-uqui\";\r\nimport { CApp, CUqBase } from \"../uq-app\";\r\nimport { VAbout } from \"./VAbout\";\r\nimport { VEditMe } from \"./VEditMe\";\r\nimport { VFaq } from \"./VFaq\";\r\nimport { VMe } from \"./VMe\";\r\n\r\nexport interface RootUnitItem {\r\n\tid: number;\t\t\t\t\t// root unit id\r\n\towner: any;\r\n\tname: string;\t\t\t\t// 唯一\r\n\tcontent: string;\r\n\ttonvaUnit: number;\t\t\t// 跟tonva机构对应的值\r\n\tx: number;\r\n}\r\n\r\nexport class CMe extends CUqBase {\r\n\tprivate uq: Uq;\r\n\trole: number;\r\n\tunitOwner: User;\r\n\trootUnits: QueryPager<any>;\r\n\troles: string[] = null;\r\n\r\n\tconstructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tthis.uq = this.uqs.BruceYuMi;\r\n\t}\r\n\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VMe);\r\n\r\n\tload = async () => {\r\n\t\tthis.roles = await this.getUqRoles(this.uq.$.name);\r\n\t}\r\n\r\n\tshowEditMe = async () => {\r\n\t\tthis.role = undefined; // result.ret[0]?.role;\r\n\t\tthis.openVPage(VEditMe);\r\n\t}\r\n\r\n\tbackend = async () => {\r\n\t\tlet cRoles = new CRoles(this.uq);\r\n\t\tawait cRoles.start();\r\n\t\t/*\r\n\t\tlet paramActs: ParamActs = {\r\n\t\t\tblog: [{caption: 'test', content: 'bbb'}]\r\n\t\t};\r\n\t\tawait this.uq.Acts(paramActs);\r\n\t\t*/\r\n\t}\r\n\r\n\tshowFaq = () => {\r\n\t\tthis.openVPage(VFaq);\r\n\t}\r\n\r\n\tshowAbout = () => {\r\n\t\tthis.openVPage(VAbout);\r\n\t}\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { Holding, Portfolio, Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\n\r\nexport class HoldingStock implements Holding, Portfolio {\r\n\tid: number;\r\n\taccount: number;\r\n\tstock: number;\r\n\tprice: number;\r\n\tquantity: number;\r\n\tcost: number;\r\n\tmiValue: number;\t\t\t\t// 米息\r\n\tmarket: number;\t\t\t// 市值\r\n\tdivident: number;\t\t// 股息\r\n\tstockObj: Stock & StockValue;\r\n\teverBought: number;\r\n\r\n\tconstructor(holdingId: number, stock: Stock & StockValue, quantity: number, cost: number) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tcost: observable,\r\n\t\t});\r\n\t\tthis.id = holdingId;\r\n\t\tthis.stock = stock.id;\r\n\t\tthis.stockObj = stock;\r\n\t\tthis.price = stock.price;\r\n\t\tthis.cost = cost? cost : quantity * this.price;\r\n\t\tthis.setQuantity(quantity);\r\n\t}\r\n\r\n\tsetQuantity(quantity: number) {\r\n\t\tthis.quantity = quantity;\r\n\t\tlet {divident, miRate} = this.stockObj;\r\n\t\tif (miRate === undefined) miRate = 0;\r\n\t\tif (divident === undefined) divident = 0;\r\n\t\tthis.market = quantity * this.price;\r\n\t\tthis.miValue = this.market * miRate / 100;\r\n\t\tthis.divident = quantity * (divident ?? 0);\r\n\t}\r\n\r\n\tchangeCost(price: number, quantity: number) {\r\n\t\tthis.cost = this.cost + price * quantity;\r\n\t}\r\n\r\n\tsetCostPrice(costPrice: number) {\r\n\t\tthis.cost = this.quantity * costPrice;\r\n\t}\r\n}\r\n","import { StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { HoldingStock } from \"./holdingStock\";\r\n\r\nfunction miRateSorter(a:number, b:number): number {\r\n\tif (a === null || a === undefined) return 1;\r\n\tif (b === null || b === undefined) return -1;\r\n\tif (a < b) return 1;\r\n\tif (a > b) return -1;\r\n\treturn 0;\r\n}\r\n\r\nexport const holdingMiRateSorter = (a:HoldingStock, b:HoldingStock) => {\r\n\treturn miRateSorter(a.stockObj.miRate, b.stockObj.miRate);\r\n}\r\n\r\nexport const stockMiRateSorter = (a:StockValue, b:StockValue) => {\r\n\treturn miRateSorter(a.miRate, b.miRate);\r\n}\r\n","import { action, autorun, IObservableArray, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { Account, AccountValue, Holding, Portfolio } from \"uq-app/uqs/BruceYuMi\";\r\nimport { HoldingStock } from \"./holdingStock\";\r\nimport { holdingMiRateSorter } from \"./sorter\";\r\nimport { Store } from \"./store\";\r\n\r\nexport class MiAccount  implements Account, AccountValue {\r\n\tprotected store: Store;\r\n\tid: number;\r\n\tno: string;\r\n\tname: string;\r\n\tportion: number = 20;\r\n\tportionAmount: number = null;\r\n\tcount: number = 0; \r\n\tbuyableCount: number = 0;\r\n\tmiValue: number = 0;\r\n\tmarket: number = 0;\r\n\tdivident: number = 0;\r\n\tcash: number = null;\r\n\r\n\tholdingStocks: IObservableArray<HoldingStock> = null;\r\n\r\n\tconstructor(store: Store, account: Account&AccountValue) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tname: observable,\r\n\t\t\tportion: observable,\r\n\t\t\tportionAmount: observable,\r\n\t\t\tholdingStocks: observable,\r\n\t\t\tcount: observable,\r\n\t\t\tmiValue: observable,\r\n\t\t\tmarket: observable,\r\n\t\t\tdivident: observable,\r\n\t\t\tcash: observable,\r\n\t\t\tloadItems: action,\r\n\t\t\tbuyNewHolding: action,\r\n\t\t\tbuyHolding: action,\r\n\t\t\tsellHolding: action,\r\n\t\t\tbuyableCount: observable,\r\n\t\t})\r\n\t\tthis.store = store;\r\n\t\tObject.assign(this, account);\r\n\t\tautorun(this.setPortionAmount);\r\n\t}\r\n\r\n\tasync loadItems() {\r\n\t\tif (this.holdingStocks) {\r\n\t\t\tthis.holdingStocks.sort(holdingMiRateSorter);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet ret = await yumi.IX<Holding&Portfolio>({\r\n\t\t\tIX: yumi.AccountHolding,\r\n\t\t\tix: this.id,\r\n\t\t\tIDX: [yumi.Holding, yumi.Portfolio]\r\n\t\t});\r\n\t\tlet noneStocks = ret.filter(v => !this.store.stockFromId(v.stock));\r\n\t\tif (noneStocks.length > 0) {\r\n\t\t\tawait yumi.ActIX({\r\n\t\t\t\tIX: yumi.UserAllStock,\r\n\t\t\t\tvalues: noneStocks.map(v => ({ix:undefined, xi: v.stock}))\r\n\t\t\t});\r\n\t\t\tawait this.store.loadMyAll();\r\n\t\t}\r\n\t\trunInAction(() => {\r\n\t\t\tlet list = ret.map(v => {\r\n\t\t\t\tlet {id, stock:stockId, cost, everBought} = v;\r\n\t\t\t\tlet stock = this.store.stockFromId(stockId);\r\n\t\t\t\tlet holdingStock = new HoldingStock(id, stock, v.quantity, cost);\r\n\t\t\t\tholdingStock.everBought = everBought;\r\n\t\t\t\treturn holdingStock;\r\n\t\t\t});\r\n\t\t\tlist.sort(holdingMiRateSorter);\r\n\t\t\tthis.holdingStocks = observable(list);\r\n\t\t\tthis.count = this.holdingStocks.length;\t\r\n\t\t\tthis.recalc();\r\n\t\t\tthis.setPortionAmount();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate setPortionAmount = () => {\r\n\t\tlet v = (this.market + (this.cash??0));\r\n\t\tlet p = v / this.portion;\r\n\t\tp = Math.round(p / 1000) * 1000;\r\n\t\tif (p > 0) {\r\n\t\t\tthis.portionAmount = p;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.portion = 5;\r\n\t\tp = v / this.portion;\r\n\t\tp = Math.round(p / 1000) * 1000;\r\n\t\tif (p > 0) {\r\n\t\t\tthis.portionAmount = p;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.portion = 1;\r\n\t\tthis.portionAmount = undefined;\r\n\t}\r\n\r\n\tasync buyNewHolding(stockId: number, price: number, quantity: number) {\r\n\t\tlet holdingId: number;\r\n\t\tlet stock = this.store.stockFromId(stockId);\r\n\t\tif (!stock) {\r\n\t\t\tstock = await this.store.loadStock(stockId);\r\n\t\t\tif (!stock) throw new Error(`stock ${stockId} not exists`);\r\n\t\t}\r\n\t\tlet index = this.holdingStocks.findIndex(v => v.stock === stockId);\r\n\t\tif (index < 0) {\r\n\t\t\tholdingId = await this.saveHolding(stockId);\r\n\t\t\tawait this.store.addMyAll(stock);\r\n\t\t\tlet hs = new HoldingStock(holdingId, stock, quantity, price*quantity);\r\n\t\t\ths.setQuantity(quantity);\r\n\t\t\t// 新买，cost已经有了，不需要再changeCost\r\n\t\t\t// hs.changeCost(price, quantity);\r\n\t\t\tthis.holdingStocks.push(hs);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet orgHs = this.holdingStocks[index];\r\n\t\t\tholdingId = orgHs.id;\r\n\t\t\tlet holdingQuantity = orgHs.quantity + quantity;\r\n\t\t\torgHs.setQuantity(holdingQuantity);\r\n\t\t\torgHs.changeCost(price, quantity);\r\n\t\t}\r\n\t\tif (this.cash) {\r\n\t\t\tthis.cash -= price * quantity;\r\n\t\t}\r\n\t\tawait this.bookHolding(holdingId, price, quantity);\r\n\t}\r\n\r\n\tasync buyHolding(stockId: number, price: number, quantity: number) {\r\n\t\tlet index = this.holdingStocks.findIndex(v => v.stock === stockId);\r\n\t\tif (index < 0) return;\r\n\t\tlet orgHs = this.holdingStocks[index];\r\n\t\tlet holdingId = orgHs.id;\r\n\t\tlet holdingQuantity = orgHs.quantity + quantity;\r\n\t\torgHs.setQuantity(holdingQuantity);\r\n\t\torgHs.changeCost(price, quantity);\r\n\t\tif (this.cash) {\r\n\t\t\tthis.cash -= price * quantity;\r\n\t\t}\r\n\t\tawait this.bookHolding(holdingId, price, quantity);\r\n\t}\r\n\r\n\tprivate async saveHolding(stock:number): Promise<number> {\r\n\t\tlet ret = await this.store.yumi.Acts({\r\n\t\t\tholding: [{account: this.id, stock, everBought: 1}]\r\n\t\t});\r\n\t\treturn ret.holding[0];\r\n\t}\r\n\r\n\tprivate async bookHolding(holdingId:number, price:number, quantity:number): Promise<void> {\r\n\t\tthis.recalc();\r\n\t\tawait this.store.yumi.Acts({\r\n\t\t\taccountValue: [{\r\n\t\t\t\tid: this.id,\r\n\t\t\t\tmiValue: this.miValue,\r\n\t\t\t\tmarket: this.market,\r\n\t\t\t\tcount: this.count,\r\n\t\t\t\tcash: {value: this.cash, setAdd: '='},\r\n\t\t\t}],\r\n\t\t\taccountHolding: [{\r\n\t\t\t\tix: this.id,\r\n\t\t\t\txi: holdingId\r\n\t\t\t}],\r\n\t\t\tportfolio: [{\r\n\t\t\t\tid: holdingId,\r\n\t\t\t\tquantity: quantity,\r\n\t\t\t\tcost: price * quantity,\r\n\t\t\t}],\r\n\t\t\ttransaction: [{\r\n\t\t\t\tholding: holdingId,\r\n\t\t\t\ttick: undefined,\r\n\t\t\t\tprice, \r\n\t\t\t\tquantity,\r\n\t\t\t\tamount: price * quantity,\r\n\t\t\t}],\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async bookSetCost(holdingId:number, cost:number): Promise<void> {\r\n\t\tthis.recalc();\r\n\t\tawait this.store.yumi.Acts({\r\n\t\t\taccountValue: [{\r\n\t\t\t\tid: this.id,\r\n\t\t\t\tmiValue: this.miValue,\r\n\t\t\t\tmarket: this.market,\r\n\t\t\t\tcount: this.count,\r\n\t\t\t}],\r\n\t\t\tportfolio: [{\r\n\t\t\t\tid: holdingId,\r\n\t\t\t\tcost: {value:cost, setAdd: '='},\r\n\t\t\t}],\r\n\t\t});\r\n\t}\r\n\r\n\tasync sellHolding(stockId: number, price: number, quantity: number) {\r\n\t\tlet holding = this.holdingStocks.find(v => v.stock === stockId);\r\n\t\tif (holding === undefined) return;\r\n\t\tholding.setQuantity(holding.quantity - quantity);\r\n\t\tholding.changeCost(-price, quantity);\r\n\t\tif (this.cash) {\r\n\t\t\tthis.cash += price * quantity;\r\n\t\t}\r\n\t\tawait this.bookHolding(holding.id, price, -quantity);\r\n\t}\r\n\r\n\tasync changeCost(stockId: number, costPrice: number) {\r\n\t\tlet holding = this.holdingStocks.find(v => v.stock === stockId);\r\n\t\tif (holding === undefined) return;\r\n\t\tholding.setCostPrice(costPrice);\r\n\t\tawait this.bookSetCost(holding.id, costPrice * holding.quantity);\r\n\t}\r\n\r\n\taddHoldingStock(holdingStock: HoldingStock) {\r\n\t\tif (this.holdingStocks) {\r\n\t\t\tthis.holdingStocks.push(holdingStock);\r\n\t\t\tthis.recalc();\r\n\t\t}\r\n\t}\r\n\r\n\tremoveHoldingStock(stockId: number) {\r\n\t\tif (this.holdingStocks) {\r\n\t\t\tlet index = this.holdingStocks.findIndex(v => v.stock === stockId);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\tthis.holdingStocks.splice(index, 1);\r\n\t\t\t\tthis.recalc();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate recalc() {\r\n\t\tthis.count = this.holdingStocks.length;\r\n\t\tlet sumMiValue = 0, sumMarket = 0, sumDivident = 0, boughtCount = 0;\r\n\t\tfor (let hs of this.holdingStocks) {\r\n\t\t\tlet {stockObj, market, divident, quantity, everBought} = hs;\r\n\t\t\tif (everBought === 0) continue;\r\n\t\t\tlet {miRate} = stockObj;\r\n\t\t\tlet miValue = (miRate??0) * market / 100;\r\n\t\t\ths.miValue = miValue;\r\n\t\t\tsumMiValue += miValue;\r\n\t\t\tsumMarket += market;\r\n\t\t\tsumDivident += divident;\r\n\t\t\tif (quantity > 0) ++boughtCount;\r\n\t\t}\r\n\t\tthis.miValue = sumMiValue;\r\n\t\tthis.market = sumMarket;\r\n\t\tthis.divident = sumDivident;\r\n\t\tthis.buyableCount = this.portion - boughtCount;\r\n\t}\r\n\r\n\tprivate async cashAct(amount: number, act: string):Promise<void> {\r\n\t\tawait this.store.yumi.Acts({\r\n\t\t\taccountValue: [{id: this.id, cash: amount}]\r\n\t\t});\r\n\t}\r\n\r\n\tasync cashInit(amount: number) {\r\n\t\tawait this.cashAct(amount, 'init');\r\n\t\trunInAction(() => {\r\n\t\t\tif (typeof this.cash !== 'number') this.cash = amount;\r\n\t\t});\r\n\t}\r\n\r\n\tasync cashIn(amount: number) {\r\n\t\tawait this.cashAct(amount, 'in');\r\n\t\trunInAction(() => {\r\n\t\t\tif (!this.cash) this.cash = amount;\r\n\t\t\telse this.cash += amount;\r\n\t\t});\r\n\t}\r\n\r\n\tasync cashOut(amount: number) {\r\n\t\tawait this.cashAct(-amount, 'out');\r\n\t\trunInAction(() => {\r\n\t\t\tthis.cash -= amount;\r\n\t\t});\r\n\t}\r\n\r\n\tasync cashAdjust(amount: number) {\r\n\t\tawait this.cashAct(amount, 'adjust');\r\n\t\trunInAction(() => {\r\n\t\t\tif (!this.cash) this.cash = amount;\r\n\t\t\telse this.cash += amount;\r\n\t\t});\r\n\t}\r\n}\r\n","import { action, IObservableArray, makeObservable, observable } from \"mobx\";\r\nimport { ParamIX } from \"tonva-react\";\r\nimport { AccountValue, Account, Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { HoldingStock } from \"./holdingStock\";\r\nimport { MiAccount } from \"./miAccount\";\r\nimport { Store } from \"./store\";\r\n\r\nexport class MiAccounts {\r\n\tprivate store: Store;\r\n\taccounts: IObservableArray<MiAccount> = null;\r\n\r\n\tconstructor(store: Store) {\r\n\t\tmakeObservable(this, {\r\n\t\t\taccounts: observable,\r\n\t\t\tload: action,\r\n\t\t});\r\n\t\tthis.store = store;\r\n\t}\r\n\r\n\tasync load() {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet {UserAccount, Account, AccountValue} = yumi;\r\n\t\tlet param:ParamIX = {\r\n\t\t\tIX: UserAccount,\r\n\t\t\tIDX: [Account, AccountValue],\r\n\t\t\tix: undefined,\t\t\t// auto userId\r\n\t\t};\r\n\t\tlet ret = await yumi.IX<Account&AccountValue>(param);\r\n\t\tif (ret.length === 0) {\r\n\t\t\t// 没有持仓账号，则创建默认账号\r\n\t\t\t//let accountNO = await Account.NO();\r\n\t\t\tlet accountName = '我的持仓组合';\r\n\t\t\tlet retActs = await yumi.ActIX({\r\n\t\t\t\tIX: UserAccount,\r\n\t\t\t\tID: Account,\r\n\t\t\t\tvalues: [{\r\n\t\t\t\t\tix: undefined, \r\n\t\t\t\t\txi: {\r\n\t\t\t\t\t\tname: accountName, \r\n\t\t\t\t\t}\r\n\t\t\t\t}]\r\n\t\t\t});\r\n\t\t\t//ret = await this.yumi.IDinIX(param);\r\n\t\t\tret.push({\r\n\t\t\t\tid: retActs[0],\r\n\t\t\t\tname: accountName,\r\n\t\t\t} as any);\r\n\t\t}\r\n\t\tlet accounts = ret.map(v => new MiAccount(this.store, v));\r\n\t\tthis.accounts = observable(accounts);\r\n\t}\r\n\r\n\taccountsFromIds(ids: number[]): MiAccount[] {\r\n\t\tlet ret:MiAccount[] = [];\r\n\t\tlet len = this.accounts.length;\r\n\t\tfor (let i=0; i<len; i++) {\t\t\t\r\n\t\t\tlet account = this.accounts[i];\r\n\t\t\tif (ids.findIndex(v => v === account.id) >= 0) {\r\n\t\t\t\tret.push(account);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync addStockToAccount(stock: Stock & StockValue, account: MiAccount) {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet {holdingStocks} = account;\r\n\t\tif (holdingStocks) {\r\n\t\t\tlet index = holdingStocks.findIndex(v => v.stock === stock.id);\r\n\t\t\tif (index >= 0) return;\r\n\t\t}\r\n\t\tlet ret = await yumi.ActIX({\r\n\t\t\tIX: yumi.AccountHolding,\r\n\t\t\tID: yumi.Holding,\r\n\t\t\tvalues: [{ix: account.id, xi: {account:account.id, stock:stock.id, everBought: 0}}],\r\n\t\t});\r\n\t\tlet hs = new HoldingStock(ret[0], stock, 0, 0);\r\n\t\ths.everBought = 0;\r\n\t\taccount.addHoldingStock(hs);\r\n\t}\r\n\r\n\tasync removeStockFromAccount(stock: Stock & StockValue, account: MiAccount) {\r\n\t\tlet {yumi} = this.store;\r\n\t\tawait yumi.ActIX({\r\n\t\t\tIX: yumi.AccountHolding,\r\n\t\t\tvalues: [{ix: account.id, xi: -stock.id}],\r\n\t\t});\r\n\t\taccount.removeHoldingStock(stock.id);\r\n\t}\r\n}\r\n","import { IObservableArray, makeObservable, observable, runInAction} from \"mobx\";\r\nimport { Group, Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { Store } from \"./store\";\r\n\r\nexport abstract class MGroup implements Group {\r\n\tprotected readonly store: Store;\r\n\tid: number;\r\n\tname: string = null;\r\n\tcount: number = null;\r\n\tstocks: IObservableArray<Stock & StockValue> = null;\r\n\tgroups: IObservableArray<MGroup> = null;\r\n\r\n\tconstructor(store:Store, group:Group) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tstocks: observable,\r\n\t\t\tcount: observable,\r\n\t\t\tname: observable,\r\n\t\t});\r\n\t\tthis.store = store;\r\n\t\tObject.assign(this, group);\r\n\t}\r\n\r\n\tabstract get type(): string;\r\n\r\n\tasync loadItems() {\r\n\t\tif (this.stocks) return;\r\n\t\tlet ret = await this.internalLoadItems();\r\n\t\tlet [groups, stocks] = ret;\r\n\t\trunInAction(() => {\r\n\t\t\tif (groups) this.groups = observable(groups, {deep: false});\r\n\t\t\tthis.stocks = observable(stocks, {deep: false});\r\n\t\t\tthis.count = this.stocks.length;\r\n\t\t});\r\n\t}\r\n\r\n\tprotected abstract internalLoadItems(): Promise<[any[], any[]]>;\r\n}\r\n\r\nexport class MiGroup extends MGroup {\r\n\tget type(): string {return 'group'}\r\n\r\n\tprotected async internalLoadItems(): Promise<[any[], any[]]> {\r\n\t\tlet ret = await this.store.loadGroupStocks(this.id);\r\n\t\treturn [undefined, ret];\r\n\t}\r\n\r\n\taddStock(stock: Stock & StockValue, stockCount: number) {\r\n\t\tif (this.stocks) {\r\n\t\t\tthis.stocks.push(stock);\r\n\t\t\tthis.count = this.stocks.length + 1;\r\n\t\t}\r\n\t}\r\n\r\n\tremoveStock(stock: Stock & StockValue, stockCount: number) {\r\n\t\tif (this.stocks) {\r\n\t\t\tlet stockId = stock.id;\r\n\t\t\tlet index = this.stocks.findIndex(v => v.id === stockId);\r\n\t\t\tif (index >= 0) this.stocks.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\texists(stockId: number) {\r\n\t\treturn this.stocks?.findIndex(v => v.id === stockId) \r\n\t}\r\n}\r\n\r\nexport class MIndustry extends MGroup {\r\n\tget type(): string {return 'industry'}\r\n\tprotected async internalLoadItems(): Promise<[any[], any[]]> {\r\n\t\tlet ret = await this.store.loadIndustryStocks(this.id);\r\n\t\treturn [undefined, ret];\r\n\t}\r\n}\r\n\r\nexport class MRootIndustry extends MIndustry {\r\n\tget type(): string {return 'industry'}\r\n\tprotected async internalLoadItems(): Promise<[any[], any[]]> {\r\n\t\tlet ret = await this.store.loadRootIndustry(this.id);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { BruceYuMi } from \"uq-app\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { MGroup, MiGroup, MIndustry, MRootIndustry } from \"./mGroup\";\r\nimport { Store } from \"./store\";\r\n\r\nexport abstract class MGroups<T extends MGroup> {\r\n\tprotected store: Store;\r\n\t//private readonly ID: ID;\r\n\tgroups: T[];\r\n\r\n\tconstructor(store: Store) {\r\n\t\tthis.store = store;\r\n\t\t//this.ID = store.yumi.Group;\r\n\t\tmakeObservable(this, {\r\n\t\t\tgroups: observable,\r\n\t\t})\r\n\t}\r\n\r\n\tabstract load(): Promise<void>;\r\n\r\n\tgroupsFromIds(ids: number[]): MGroup[] {\r\n\t\tlet ret:MGroup[] = [];\r\n\t\tlet len = this.groups.length;\r\n\t\tfor (let i=0; i<len; i++) {\t\t\t\r\n\t\t\tlet group = this.groups[i];\r\n\t\t\tif (ids.findIndex(v => v === group.id) >= 0) {\r\n\t\t\t\tret.push(group);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tcalcStockCount() {}\r\n}\r\n\r\nexport class MiGroups extends MGroups<MiGroup> {\r\n\tasync load(): Promise<void> {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet ret = await yumi.IX<BruceYuMi.Group>({\r\n\t\t\tIX: yumi.UserGroup,\r\n\t\t\tIDX: [yumi.Group],\r\n\t\t\tix: undefined,\r\n\t\t});\r\n\t\tthis.groups = ret.map(v => new MiGroup(this.store, v));\r\n\t}\r\n\r\n\tcalcStockCount() {\r\n\t\tthis.groups.forEach(v => {\r\n\t\t\tlet stockCount = this.store.calcGroupStockCount(v.id);\r\n\t\t\tv.count = stockCount;\r\n\t\t});\r\n\t}\r\n\r\n\tasync addStockToGroup(stock:Stock&StockValue, group: MiGroup) {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet {stocksMyAll, groupIXs} = this.store;\r\n\t\tlet stockId = stock.id;\r\n\t\tlet groupId = group.id;\r\n\t\tawait yumi.Acts({\r\n\t\t\tgroupStock: [{ix: groupId, xi: stockId, order: undefined}],\r\n\t\t\tuserAllStock: [{ix: undefined, xi: stockId}],\r\n\t\t});\r\n\t\tgroupIXs.push({ix:groupId, xi:stockId});\r\n\t\tlet index = stocksMyAll.findIndex(v => v.id === stockId);\r\n\t\tif (index < 0) stocksMyAll.push(stock);\r\n\t\tlet stockCount = this.store.calcGroupStockCount(groupId);\r\n\t\tgroup.addStock(stock, stockCount);\r\n\t}\r\n\r\n\tasync removeStockFromGroup(stock:Stock&StockValue, group: MiGroup) {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet stockId = stock.id;\r\n\t\tlet groupId = group.id;\r\n\t\tawait yumi.Acts({\r\n\t\t\tgroupStock: [{ix: groupId, xi: -stockId, order: undefined}],\r\n\t\t});\r\n\t\tlet {groupIXs} = this.store;\r\n\t\tfor (let i=0; i<groupIXs.length; i++) {\r\n\t\t\tlet {ix, xi} = groupIXs[i];\r\n\t\t\tif (xi !== stockId) continue;\r\n\t\t\tif (ix !== groupId) continue;\r\n\t\t\tgroupIXs.splice(i, 1);\r\n\t\t\tlet stockCount = this.store.calcGroupStockCount(groupId);\r\n\t\t\tgroup.removeStock(stock, stockCount);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class MIndustries extends MGroups<MIndustry> {\r\n\tasync load(): Promise<void> {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet ret = await yumi.ID<BruceYuMi.Group>({\r\n\t\t\tIDX: [yumi.Industry],\r\n\t\t\tid: undefined,\r\n\t\t});\r\n\t\tthis.groups = ret.map(v => new MIndustry(this.store, v));\r\n\t}\r\n}\r\n\r\nexport class MRootIndustries extends MGroups<MRootIndustry> {\r\n\tasync load(): Promise<void> {\r\n\t\tlet {yumi} = this.store;\r\n\t\tlet ret = await yumi.IX<BruceYuMi.Group>({\r\n\t\t\tIX: yumi.IXIndustry,\r\n\t\t\tIDX: [yumi.Industry],\r\n\t\t\tix: 0,\r\n\t\t});\r\n\t\tthis.groups = ret.map(v => new MRootIndustry(this.store, v));\r\n\t}\r\n}\r\n","export const marketElements:{[name:string]:JSX.Element} = {\r\n\t'sz': <small className=\"text-danger\">[深]</small>,\r\n\t'sh': <small className=\"text-danger\">[沪]</small>,\r\n\t'hk': <small className=\"text-warning\">[港]</small>,\r\n}\r\n","import { IObservableArray, makeObservable, observable } from \"mobx\";\r\nimport { IXBase } from \"tonva-uqui\";\r\nimport { UQs } from \"uq-app\";\r\nimport { MiAccounts } from \"./miAccounts\";\r\nimport { MIndustries, MiGroups, MRootIndustries } from \"./mGroups\";\r\nimport { Holding, Industry, Market, Stock, StockValue, UqExt } from \"uq-app/uqs/BruceYuMi\";\r\nimport { MGroup, MIndustry } from \"./mGroup\";\r\nimport { MiAccount } from \"./miAccount\";\r\nimport { marketElements } from \"./market\";\r\nimport { stockMiRateSorter } from \"./sorter\";\r\nimport { MiNet } from \"../net\";\r\nimport { User } from \"tonva-react\";\r\n\r\nexport class Store {\r\n\treadonly myAllColl: {[id:number]: boolean} = {};\r\n\treadonly yumi: UqExt;\r\n\treadonly markets: {[id:number]: {id?:number;name:string;currency:string;el:JSX.Element}} = {};\r\n\tmiAccounts: MiAccounts;\r\n\tmiGroups: MiGroups;\r\n\tindustries: MIndustries;\r\n\trootIndustries: MRootIndustries;\r\n\r\n\tstocksMyAll: IObservableArray<Stock & StockValue> = null;\r\n\tstocksMyBlock: IObservableArray<Stock & StockValue> = null;\r\n\tgroupIXs: IXBase[];\r\n\r\n    private miNet: MiNet;\r\n    private user: User;\r\n\r\n\tconstructor(uqs: UQs, user: User) {\r\n        this.user = user;\r\n        this.miNet = new MiNet(user);\r\n\t\tmakeObservable(this, {\r\n\t\t\tmyAllColl: observable,\r\n\t\t\tstocksMyAll: observable.shallow,\r\n\t\t\tstocksMyBlock: observable.shallow,\r\n\t\t});\r\n\t\tthis.yumi = uqs.BruceYuMi;\r\n\t\tthis.miAccounts = new MiAccounts(this);\r\n\t\tthis.miGroups = new MiGroups(this);\r\n\t\tthis.industries = new MIndustries(this);\r\n\t\tthis.rootIndustries = new MRootIndustries(this);\r\n\t}\r\n\r\n\tstockFromId(stockId: number): Stock&StockValue {\r\n\t\treturn this.stocksMyAll.find(v => v.id === stockId);\r\n\t}\r\n\r\n\tasync loadStock(stockId: number): Promise<Stock&StockValue> {\r\n\t\tlet ret = await this.yumi.ID<Stock&StockValue>({\r\n\t\t\tIDX: [this.yumi.Stock, this.yumi.StockValue],\r\n\t\t\tid: stockId,\r\n\t\t});\r\n\t\tlet stock = ret[0];\r\n\t\tthis.buildStockValues(stock);\r\n\t\treturn stock;\r\n\t}\r\n\r\n\tprivate buildStockValues(stock: Stock & StockValue) {\r\n\t\tif (stock === undefined) return;\r\n\t\tlet {market} = stock;\r\n\t\t(stock as any).$market = this.markets[market];\r\n\t}\r\n\t\r\n\tasync searchStock(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.yumi.SearchStock.page(param, pageStart, pageSize, true);\r\n\t\tlet {$page} = ret;\r\n\t\t$page.forEach(v => this.buildStockValues(v as unknown as (Stock & StockValue)));\r\n\t\treturn ret as any;\r\n\t}\r\n\r\n\tisMyAll(stock: Stock): boolean {\r\n\t\treturn this.myAllColl[stock.id] === true;\r\n\t}\r\n\t\r\n\tasync addMyAll(stock:Stock&StockValue) {\r\n\t\tif (!stock) return;\r\n\t\tawait this.yumi.ActIX({\r\n\t\t\tIX: this.yumi.UserAllStock, \r\n\t\t\tvalues: [\r\n\t\t\t\t{ix: undefined, xi: stock.id}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlet stockId = stock.id;\r\n\t\tif (this.stocksMyAll.findIndex(v => v.id === stockId) < 0) {\r\n\t\t\tthis.stocksMyAll.push(stock);\r\n\t\t}\r\n\t\tthis.myAllColl[stockId] = true;\r\n\t}\r\n\r\n\tasync removeMyAll(stock: Stock&StockValue): Promise<{miAccounts: MiAccount[], miGroups: MGroup[]}> {\r\n\t\tif (!stock) return;\r\n\t\tlet stockId = stock.id;\r\n\t\tlet ret = await this.yumi.StockUsing.query({stock: stockId});\r\n\t\tlet {groups, accounts} = ret;\r\n\t\tif (groups.length > 0 || accounts.length > 0) {\r\n\t\t\tlet miAccounts = this.miAccounts.accountsFromIds(accounts.map(v => v.account));\r\n\t\t\tlet miGroups = this.miGroups.groupsFromIds(groups.map(v => v.group));\r\n\t\t\treturn {miAccounts, miGroups};\r\n\t\t}\r\n\r\n\t\tawait this.yumi.ActIX({\r\n\t\t\tIX: this.yumi.UserAllStock, \r\n\t\t\tvalues: [\r\n\t\t\t\t{ix: undefined, xi: -stockId}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlet index = this.stocksMyAll.findIndex(v => v.id === stockId);\r\n\t\tif (index >= 0) this.stocksMyAll.splice(index, 1);\r\n\t\tdelete this.myAllColl[stockId];\r\n\t}\r\n\r\n\tmyAllCaption: string = '自选股';\r\n\tmyBlockCaption: string = '黑名单';\r\n\r\n\tasync loadMyAll() {\r\n\t\tlet ret = await this.yumi.IX<(Stock&StockValue)>({\r\n\t\t\tIX: this.yumi.UserAllStock,\r\n\t\t\tIDX: [this.yumi.Stock, this.yumi.StockValue],\r\n\t\t\tix: undefined,\r\n\t\t});\r\n\t\tret.forEach(v => {\r\n\t\t\tthis.buildStockValues(v);\r\n\t\t\tthis.myAllColl[v.id] = true;\r\n\t\t});\r\n\t\tthis.stocksMyAll = observable(ret, {deep: false});\r\n\t}\r\n\r\n\tasync loadMyBlock() {\r\n\t\tif (this.stocksMyBlock) return;\r\n\t\tlet {yumi} = this;\r\n\t\tlet ret = await yumi.IX<(Stock&StockValue)>({\r\n\t\t\tIX: yumi.UserBlockStock,\r\n\t\t\tIDX: [yumi.Stock, yumi.StockValue],\r\n\t\t\tix: undefined,\r\n\t\t});\r\n\t\tret.forEach(v => this.buildStockValues(v));\r\n\t\tthis.stocksMyBlock = observable(ret, {deep: false});\r\n\t}\r\n\r\n\tasync loadGroupStocks(groupId: number):Promise<(Stock&StockValue)[]> {\r\n\t\tlet unloadArr: number[] = [];\r\n\t\tlet ret: (Stock&StockValue)[] = [];\r\n\t\tthis.groupIXs.forEach(gs => {\r\n\t\t\tlet {ix, xi:gStockId} = gs;\r\n\t\t\tif (ix !== groupId) return;\r\n\t\t\tlet stock = this.stocksMyAll.find(v => v.id === gStockId);\r\n\t\t\tif (stock) ret.push(stock);\r\n\t\t\telse unloadArr.push(gStockId);\r\n\t\t});\r\n\t\tif (unloadArr.length > 0) {\r\n\t\t\tlet stockArr = await this.yumi.ID<Stock&StockValue>({\r\n\t\t\t\tIDX: [this.yumi.Stock, this.yumi.StockValue],\r\n\t\t\t\tid: unloadArr,\r\n\t\t\t});\r\n\t\t\tfor (let stock of stockArr) {\r\n\t\t\t\tthis.buildStockValues(stock);\r\n\t\t\t\tthis.stocksMyAll.push(stock);\r\n\t\t\t\tret.push(stock);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadIndustryStocks(industryId: number):Promise<(Stock&StockValue)[]> {\r\n\t\tlet stockArr = await this.yumi.IX<Stock&StockValue>({\r\n\t\t\tIX: this.yumi.GroupStock,\r\n\t\t\tIDX: [this.yumi.Stock, this.yumi.StockValue],\r\n\t\t\tix: industryId,\r\n\t\t});\r\n\t\tstockArr.forEach(v => this.buildStockValues(v));\r\n\t\tstockArr.sort(stockMiRateSorter);\r\n\t\treturn stockArr;\r\n\t}\r\n\r\n\tasync loadRootIndustry(rootIndustryId: number): Promise<[Industry[], (Stock&StockValue)[]]> {\r\n\t\tlet ret = await Promise.all([\r\n\t\t\tthis.yumi.IX<Stock&StockValue>({\r\n\t\t\t\tIX: this.yumi.IXIndustry,\r\n\t\t\t\tIDX: [this.yumi.Industry],\r\n\t\t\t\tix: rootIndustryId,\r\n\t\t\t}),\r\n\t\t\tthis.yumi.IX<Stock&StockValue>({\r\n\t\t\t\tIX: this.yumi.IXIndustry,\r\n\t\t\t\tIX1: this.yumi.GroupStock,\r\n\t\t\t\tIDX: [this.yumi.Stock, this.yumi.StockValue],\r\n\t\t\t\tix: rootIndustryId,\r\n\t\t\t}),\r\n\t\t]);\r\n\t\tlet [industries, stockArr] = ret;\r\n\t\tstockArr.forEach(v => this.buildStockValues(v));\r\n\t\tstockArr.sort(stockMiRateSorter);\r\n\t\tlet miGroups = industries.map(v => new MIndustry(this, v));\r\n\t\treturn [miGroups, stockArr];\r\n\t}\r\n\r\n\tasync loadMarkets() {\r\n\t\tlet {yumi} = this;\r\n\t\tlet ret = await yumi.ID<Market>({\r\n\t\t\tIDX: [yumi.Market],\r\n\t\t\tid: undefined,\r\n\t\t});\r\n\t\tfor (let m of ret) {\r\n\t\t\tlet {id, name} = m;\r\n\t\t\tthis.markets[id] = {...m, el: marketElements[name]};\r\n\t\t}\r\n\t}\r\n\r\n\tisMyBlock(stock: Stock): boolean {\r\n\t\tlet index = this.stocksMyBlock.findIndex(v => v.id === stock.id);\r\n\t\treturn index >= 0;\r\n\t}\r\n\r\n\tasync toggleBlock(stock: Stock&StockValue) {\r\n\t\tif (!stock) return;\r\n\t\tawait this.loadMyBlock();\r\n\t\tlet {id} = stock;\r\n\t\tlet index = this.stocksMyBlock.findIndex(v => v.id === id);\r\n\t\tif (index >= 0) {\r\n\t\t\tawait this.yumi.ActIX({\r\n\t\t\t\tIX: this.yumi.UserBlockStock,\r\n\t\t\t\tvalues: [{ix:undefined, xi: -id}]\r\n\t\t\t})\r\n\t\t\tthis.stocksMyBlock.splice(index, 1);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait this.yumi.ActIX({\r\n\t\t\t\tIX: this.yumi.UserBlockStock,\r\n\t\t\t\tvalues: [{ix:undefined, xi: id}]\r\n\t\t\t})\r\n\t\t\tthis.stocksMyBlock.push(stock);\r\n\t\t}\r\n\t}\r\n\r\n\tasync load() {\r\n\t\tawait this.loadMarkets();\r\n\t\tawait Promise.all([\r\n\t\t\tthis.miAccounts.load(),\r\n\t\t\tthis.loadMyAll(),\r\n\t\t\tthis.loadGroupIXs(),\r\n\t\t\tthis.miGroups.load(),\r\n\t\t\tthis.industries.load(),\r\n\t\t\tthis.rootIndustries.load(),\r\n\t\t]);\r\n\t\tthis.miGroups.calcStockCount();\r\n\t}\r\n\r\n\tprivate async loadGroupIXs() {\r\n\t\tlet {yumi} = this;\r\n\t\tlet ret = await yumi.IX<IXBase>({\r\n\t\t\tIX: yumi.UserGroup,\r\n\t\t\tIX1: yumi.GroupStock,\r\n\t\t\tix: undefined,\r\n\t\t});\r\n\t\tthis.groupIXs = ret;\r\n\t}\r\n\r\n\tstockInNGroup(stock:Stock): number {\r\n\t\tlet nGroup = 0;\r\n\t\tlet {groupIXs} = this;\r\n\t\tlet stockId = stock.id;\r\n\t\tfor (let i=0; i<groupIXs.length; i++) {\r\n\t\t\tlet {xi} = groupIXs[i];\r\n\t\t\tif (xi === stockId) ++nGroup;\r\n\t\t}\r\n\t\treturn nGroup;\r\n\t}\r\n\r\n\tcalcGroupStockCount(groupId: number): number {\r\n\t\tif (!this.groupIXs) return;\r\n\t\tlet count = 0;\r\n\t\tfor (let gs of this.groupIXs) {\r\n\t\t\tlet {ix} = gs;\r\n\t\t\tif (ix === groupId) ++count;\r\n\t\t}\r\n\t\treturn count;\r\n\t}\r\n\r\n\tinAnyGroup(stockId: number): {[groupId:number]:boolean} {\r\n\t\tlet inGroup:{[groupId:number]:boolean} = {};\r\n\t\tfor (let gs of this.groupIXs) {\r\n\t\t\tlet {ix, xi} = gs;\r\n\t\t\tif (xi === stockId) inGroup[ix] = true;\r\n\t\t}\r\n\t\treturn inGroup;\r\n\t}\r\n\r\n\tinAnyAccount(stockId: number): {[accountId:number]:[inAccount:boolean, everBought:boolean]} {\r\n\t\tlet inAccount:{[accountId:number]:[inAccount:boolean, everBought:boolean]} = {};\r\n\t\tthis.miAccounts.accounts.forEach(v => {\r\n\t\t\tlet {holdingStocks} = v;\r\n\t\t\tif (!holdingStocks) return;\r\n\t\t\tlet len = holdingStocks.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet hs = holdingStocks[i];\r\n\t\t\t\tif (hs.stock === stockId) {\r\n\t\t\t\t\tinAccount[v.id] = [true, hs.everBought > 0];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn inAccount;\r\n\t}\r\n\r\n\tasync loadStockInAccounts(stockId: number): Promise<{[accountId:number]:[inAccount:boolean, everBought:boolean]}> {\r\n\t\tlet ret = await this.yumi.QueryID<Holding>({\r\n\t\t\tIX: [this.yumi.UserAccount, this.yumi.AccountHolding],\r\n\t\t\tIDX: [this.yumi.Holding],\r\n\t\t\tix: undefined,\r\n\t\t\tkeyx: {account:undefined, stock: stockId},\r\n\t\t});\r\n\t\tlet val:{[accountId:number]:[inAccount:boolean, everBought:boolean]} = {};\r\n\t\tfor (let r of ret) {\r\n\t\t\tlet {account, everBought} = r;\r\n\t\t\tval[account] =[true, everBought>0];\r\n\t\t}\r\n\t\treturn val;\r\n\t}\r\n\r\n    async getNextTradedays(day: number) {\r\n        return await this.miNet.q_getnexttradedays(day);\r\n    }\r\n\r\n\tasync searchTrackStock(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n        let { day, key, market, $orderSwitch, smooth} = param as { day: number, key: string, market: string, $orderSwitch?: any, smooth?: number, }\r\n\t\tlet ret = await this.miNet.q_searchstock(day, this.user.id, pageStart, pageSize, $orderSwitch, key, market, smooth);\r\n\t\tlet {$page} = ret;\r\n\t\t$page.forEach(v => this.buildStockValues(v as unknown as (Stock & StockValue)));\r\n\t\treturn ret as any;\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { DropdownAction, DropdownActions, FA, LMR, VPage } from \"tonva-react\";\r\nimport { CHome } from \"./CHome\";\r\n\r\nexport class VHome extends VPage<CHome> {\r\n\theader() { return '首页'; }\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {cAccount} = this.controller;\r\n\t\t\tlet left = <FA name=\"envelope-o\" className=\"text-info align-self-center ml-2 ml-sm-3\" size=\"lg\" fixWidth={true} />\r\n\t\t\treturn <div className=\"pb-3\">\r\n\t\t\t\t<LMR className=\"d-flex pr-3 py-2 my-2 cursor-pointer bg-white\"\r\n\t\t\t\t\tleft={left}\r\n\t\t\t\t\tonClick={this.controller.showBlogs}>\r\n\t\t\t\t\t<div className=\"px-2 px-sm-3\">\r\n\t\t\t\t\t\t米投博客\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</LMR>\r\n\t\t\t\t{cAccount.renderAccounts()}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tright() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {cCommon} = this.controller.cApp;\r\n\t\t\tlet actions: DropdownAction[] = [\r\n\t\t\t\t{\r\n\t\t\t\t\tcaption: '管理持仓账户',\r\n\t\t\t\t\taction: cCommon.manageAccounts,\r\n\t\t\t\t\ticon: 'money',\r\n\t\t\t\t},\r\n\t\t\t];\r\n\t\t\treturn <DropdownActions actions={actions} icon=\"bars\" className=\"mr-2 text-white bg-transparent border-0\" />;\r\n\t\t}));\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport scrollIntoView from 'scroll-into-view-if-needed';\r\nimport { DropdownAction, DropdownActions, FA, List, LMR, VPage } from \"tonva-react\";\r\nimport { NFormat, nFormat0, nFormat1, nFormat2, smallPercent } from \"tool\";\r\nimport { HoldingStock } from \"../../store\";\r\nimport { CAccount } from \"./CAccount\";\r\n\r\nexport class VAccount extends VPage<CAccount> {\r\n\tprivate actionsElement: ChildNode;\r\n\tprivate renderPageRight: () => JSX.Element;\r\n\tinit(param: {\r\n\t\trenderPageRight: () => JSX.Element;\r\n\t}) {\r\n\t\tlet {renderPageRight} = param;\r\n\t\tthis.renderPageRight = renderPageRight;\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn React.createElement(observer(() => <>{this.controller.miAccount.name}</>));\r\n\t}\r\n\tright() {return this.renderPageRight?.()}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tfunction valueToString(value:number, suffix: string|JSX.Element = undefined):JSX.Element {\r\n\t\t\t\tif (isNaN(value) === true) return <>-</>;\r\n\t\t\t\treturn <>{(value??0).toLocaleString(undefined, nFormat1)}{suffix}</>;\r\n\t\t\t}\r\n\t\t\tfunction renderValue(caption:string, content:string|JSX.Element, cn:string = '') {\r\n\t\t\t\treturn <div className={'my-1 mx-1 mx-sm-2 border rounded w-min-5c px-1 px-sm-2 py-2 ' + cn}>\r\n\t\t\t\t\t<small className=\"text-muted\">{caption}</small>\r\n\t\t\t\t\t<div>{content}</div>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t\tlet renderCash = (value:number) => {\r\n\t\t\t\tlet caption = '现金';\r\n\t\t\t\tif (typeof value === 'number') return renderValue(caption, valueToString(value));\r\n\t\t\t\treturn <div className=\"my-1 mx-1 mx-sm-2 border rounded w-min-5c px-1 px-sm-2 py-2\">\r\n\t\t\t\t\t<small className=\"text-muted\">{caption}</small>\r\n\t\t\t\t\t<div className=\"text-danger small mt-1\">[无]</div>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t\tlet {miAccount, showBuy, showCashIn, showCashOut, showCashAdjust} = this.controller;\r\n\t\t\tlet {no, name, miValue, market, cash, holdingStocks, portion, portionAmount, buyableCount} = miAccount;\r\n\r\n\t\t\tlet holdings:HoldingStock[], holdings0:HoldingStock[];\r\n\t\t\tif (holdingStocks) {\r\n\t\t\t\tholdings = [];\r\n\t\t\t\tholdings0 = [];\r\n\t\t\t\tlet len = holdingStocks.length;\r\n\t\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\t\tlet holding = holdingStocks[i];\r\n\t\t\t\t\tif (holding.quantity === 0) holdings0.push(holding);\r\n\t\t\t\t\telse holdings.push(holding);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet actions: DropdownAction[] = [\r\n\t\t\t\t{ caption: '调入资金', action: showCashIn, icon: 'sign-in' },\r\n\t\t\t\t{ caption: '调出资金', action: showCashOut, icon: 'sign-out' },\r\n\t\t\t\t{ caption: '调整资金', action: showCashAdjust, icon: 'adjust' },\r\n\t\t\t];\r\n\t\t\treturn <div className=\"pb-3\">\r\n\t\t\t\t<div className=\"mb-3 px-3 py-2 bg-white\">\r\n\t\t\t\t\t<LMR right={<small className=\"text-muted\">组合编号: {no}</small>}>\r\n\t\t\t\t\t\t{name}\r\n\t\t\t\t\t</LMR>\r\n\t\t\t\t\t<div className=\"my-3 text-center d-flex justify-content-center flex-wrap\">\r\n\t\t\t\t\t\t{renderValue('米息率', valueToString(miValue*100/market, smallPercent))}\r\n\t\t\t\t\t\t{renderValue('市值', valueToString(market))}\r\n\t\t\t\t\t\t{renderCash(cash)}\r\n\t\t\t\t\t\t{renderValue('米息', valueToString(miValue), 'd-none d-sm-block')}\r\n\t\t\t\t\t\t{cash > 0 && renderValue('总值', valueToString(market + cash), 'd-none d-sm-block')}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<ul className=\"small text-muted mb-0\">\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcash?\r\n\t\t\t\t\t\tportionAmount &&\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<li>\r\n\t\t\t\t\t\t\t\t<small className=\"\">份数:</small> {portion} &nbsp; \r\n\t\t\t\t\t\t\t\t<small className=\"\">份额:</small> <span className=\"text-danger\">{portionAmount}</span> &nbsp; \r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tbuyableCount > 0?\r\n\t\t\t\t\t\t\t\t\t<><small className=\"\">可加</small>{buyableCount}只</>\r\n\t\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-danger\"> &nbsp; 已超{-buyableCount}只</span>\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li className=\"\">\r\n\t\t\t\t\t\t\t\t<small className=\"text-info\">保持分散，单只股票不超资金份额</small>\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<li className=\"\">设置资金后，会根据分散要求，提供股数建议</li>\r\n\t\t\t\t\t}\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"mb-3 mx-3 d-flex\">\r\n\t\t\t\t\t<button className=\"btn btn-outline-primary mr-3\" onClick={() => showBuy()}>买股</button>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttypeof cash === 'number'?\r\n\t\t\t\t\t\t\t<DropdownActions className=\"btn btn-outline-warning\"\r\n\t\t\t\t\t\t\t\tcontainerClass=\"ml-auto\"\r\n\t\t\t\t\t\t\t\tactions={actions} icon=\"money\" content=\"资金\" />\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t<button className=\"btn btn-outline-info ml-auto\" onClick={this.controller.showCashInit}>\r\n\t\t\t\t\t\t\t\t<FA name=\"cog\" className=\"small text-info\" /> 初始资金\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"px-2 px-sm-3 py-1 container\">\r\n\t\t\t\t\t<div className=\"small text-muted row mx-0\">\r\n\t\t\t\t\t\t<div className=\"col-3 px-0\">持仓市值</div>\r\n\t\t\t\t\t\t<div className=\"col px-0 text-right\">持仓</div>\r\n\t\t\t\t\t\t<div className=\"col px-0 text-right\">米息率</div>\r\n\t\t\t\t\t\t<div className=\"col px-0 text-right\">\r\n\t\t\t\t\t\t\t市价<br/>\r\n\t\t\t\t\t\t\t成本\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"col px-0 text-right\">\r\n\t\t\t\t\t\t\t盈亏<br/>\r\n\t\t\t\t\t\t\t比例\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<List items={holdings}\r\n\t\t\t\t\titem={{render: this.renderHolding}} />\r\n\t\t\t\t{\r\n\t\t\t\t\tholdings0 && holdings0.length > 0 && <>\r\n\t\t\t\t\t\t<div className=\"small text-muted px-3 py-1 mt-3\">空仓</div>\r\n\t\t\t\t\t\t<List items={holdings0}\r\n\t\t\t\t\t\t\titem={{render: this.renderHolding}} />\r\n\t\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate fString(v:number, nFormat:NFormat, suffix:string|JSX.Element = ''):string|JSX.Element {\r\n\t\tif (v === null || v === undefined || isNaN(v) === true) return '-';\r\n\t\treturn <>{v.toLocaleString(undefined, nFormat)}{suffix}</>;\r\n\t}\r\n\r\n\tprivate hideActionsElement() {\r\n\t\tif (this.actionsElement) {\r\n\t\t\t(this.actionsElement as HTMLDivElement).className = 'd-none';\r\n\t\t\tthis.actionsElement = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHolding = (holding: HoldingStock, index: number) => {\r\n\t\tlet {showHolding, showBuy, showSell, showChangeCost, showTransactionDetail, miAccount} = this.controller;\r\n\t\tlet {portionAmount, cash} = miAccount;\r\n\t\tlet {stockObj, quantity, market, cost} = holding;\r\n\t\tlet {name, no} = stockObj;\r\n\t\tlet profit: number, profitRate: number, costPrice: number;\r\n\t\tif (quantity < 1) { // = 0\r\n\t\t\tprofit = -cost;\r\n\t\t\tif (profit>=-0.01 && profit <= 0.01) profit = 0;\r\n\t\t\tprofitRate = 0;\r\n\t\t\tcostPrice = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tprofit = market - cost;\r\n\t\t\tprofitRate = cost<0.1? 999: profit*100/cost;\r\n\t\t\tcostPrice = cost/quantity;\r\n\t\t}\r\n\t\tif (profit>=-0.01 && profit <= 0.01) {\r\n\t\t\tprofit = 0;\r\n\t\t\tprofitRate = 0;\r\n\t\t}\r\n\r\n\t\tlet onClick = (evt: React.MouseEvent) => {\r\n\t\t\tif (this.actionsElement) {\r\n\t\t\t\t(this.actionsElement as HTMLDivElement).className = 'd-none';\r\n\t\t\t}\r\n\t\t\tlet actionsElement = evt.currentTarget.nextSibling;\r\n\t\t\tif (actionsElement !== this.actionsElement) {\r\n\t\t\t\tthis.actionsElement = actionsElement;\r\n\t\t\t\t(this.actionsElement as HTMLDivElement).className = 'd-block';\r\n\t\t\t\tscrollIntoView(this.actionsElement as HTMLDivElement, { scrollMode: 'if-needed', behavior: 'smooth' });\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.actionsElement = undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet {miRate, price} = stockObj;\r\n\t\tlet cn: string;\r\n\t\tif (profit < 0) {\r\n\t\t\tcn = 'text-success';\r\n\t\t}\r\n\t\telse if (profit > 0) {\r\n\t\t\tcn = 'text-danger';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcn = '';\r\n\t\t}\r\n\t\tlet vBuyable: any;\r\n\t\tif (cash) {\r\n\t\t\tlet buyable: number = (portionAmount - market) / price;\r\n\t\t\tlet neg: boolean = false;\r\n\t\t\tif (buyable < 0) {\r\n\t\t\t\tneg = true;\r\n\t\t\t\tbuyable = -buyable;\r\n\t\t\t}\r\n\t\t\tif (buyable < 10) {\r\n\t\t\t\tbuyable = Math.round(buyable);\r\n\t\t\t}\r\n\t\t\telse if (buyable < 100) {\r\n\t\t\t\tbuyable = Math.round(buyable / 10) * 10;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbuyable = Math.round(buyable / 100) * 100;\r\n\t\t\t}\r\n\t\t\tif (market < portionAmount * 0.9) {\r\n\t\t\t\tif (quantity > 0) {\r\n\t\t\t\t\tif (neg === false) {\r\n\t\t\t\t\t\tvBuyable = <span className=\"text-warning\">{buyable} <FA name=\"plus-square-o\" /></span>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (market > portionAmount * 1.1) {\r\n\t\t\t\tif (neg === true) {\r\n\t\t\t\t\tvBuyable = <span className=\"text-muted\">{buyable} <FA name=\"minus-square-o\" /></span>;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvBuyable = <FA name=\"check-circle-o\" className=\"text-warning\" />;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"d-block px-2 px-sm-3 py-1 container\">\r\n\t\t\t<div className={'row mx-0 cursor-pointer ' + cn}\r\n\t\t\t\tonClick={onClick}>\r\n\t\t\t\t<div className=\"col-3 px-0\">\r\n\t\t\t\t\t<div>{name}</div>\r\n\t\t\t\t\t<div>{no}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"col px-0 text-right\">\r\n\t\t\t\t\t<div>{this.fString(quantity, nFormat0)}</div>\r\n\t\t\t\t\t<div className=\"small\">{this.fString(market, nFormat1)}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"col px-0 text-right\">{this.fString(miRate, nFormat1, smallPercent)}</div>\r\n\t\t\t\t<div className=\"col px-0 text-right\">\r\n\t\t\t\t\t<div className=\"\">{this.fString(price, nFormat2)}</div>\r\n\t\t\t\t\t<div className=\"small\">{this.fString(costPrice, nFormat2)}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"col px-0 text-right\">\r\n\t\t\t\t\t<div className=\"\">{this.fString(profitRate, nFormat1, smallPercent)}</div>\r\n\t\t\t\t\t<div className=\"small\">{this.fString(profit, nFormat1)}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"d-none\">\r\n\t\t\t\t<div className=\"row mt-2 mx-0 pt-2 pb-1 align-items-center border-top\" \r\n\t\t\t\t\tonClick={()=>this.hideActionsElement()}>\r\n\t\t\t\t\t<div className=\"col-sm-3 col-auto px-0\">\r\n\t\t\t\t\t\t<button className=\"btn btn-sm btn-outline-info mr-1 mr-sm-3 \"\r\n\t\t\t\t\t\t\tonClick={() => showBuy(holding)}>买入</button>\r\n\t\t\t\t\t\t<button className=\"btn btn-sm btn-outline-info mr-1 mr-sm-3 \"\r\n\t\t\t\t\t\t\tonClick={() => showSell(holding)}>卖出</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"col-sm col-auto px-0 text-right ml-auto \">{vBuyable}</div>\r\n\t\t\t\t\t<div className=\"col-sm col-auto px-0 text-right ml-sm-0 ml-3\">\r\n\t\t\t\t\t\t<button className=\"btn btn-sm btn-link\"\r\n\t\t\t\t\t\t\tonClick={() => showHolding(holding)}>分析</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"col-sm col-auto px-0 text-right\">\r\n\t\t\t\t\t\t<button className=\"btn btn-sm btn-link\"\r\n\t\t\t\t\t\t\tonClick={() => showChangeCost(holding)}>改成本</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"col-sm col-auto px-0 text-right\">\r\n\t\t\t\t\t\t<button className=\"btn btn-sm btn-link\"\r\n\t\t\t\t\t\t\tonClick={() => showTransactionDetail(holding)}>明细</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderValue(caption:string, value: number, format: Intl.NumberFormatOptions, suffix:string, cn: string) {\r\n\t\treturn <>\r\n\t\t\t<div className={'text-right pl-2 d-block d-sm-none'}>\r\n\t\t\t\t<div className=\"d-inline-block small text-muted\">{caption}:&nbsp;</div>\r\n\t\t\t\t<div className={'d-inline-block w-min-6c'}>{value?.toLocaleString(undefined, format)}{suffix}</div>\r\n\t\t\t</div>\r\n\t\t\t<div className={'text-right pl-3 d-sm-block d-none ' + cn}>\r\n\t\t\t\t<div className=\"small text-muted\">{caption}</div>\r\n\t\t\t\t<div>{value?.toLocaleString(undefined, format)}{suffix}</div>\r\n\t\t\t</div>\r\n\t\t</>;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { IntSchema, ButtonSchema, UiNumberItem, UiButton, Form, Schema, VPage, UiSchema, Context, NumSchema, IdSchema, UiIdItem, ItemSchema, FA } from \"tonva-react\";\r\nimport { formatNumber } from \"tool\";\r\nimport { Stock } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CAccount } from \"./CAccount\";\r\n\r\nabstract class VForm extends VPage<CAccount> {\r\n\tprotected form: Form;\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tprotected onCheckValue(value:any): string[] | string {\r\n\t\treturn;\r\n    }\r\n\r\n\tprotected get valueLabel(): string {return '股票数量'}\r\n\tprotected get placeholder(): string {return '股票数量'}\r\n\tprotected get valueSchema(): ItemSchema {\r\n\t\treturn { name: 'value', type: 'integer', min: 0, required: true } as IntSchema;\r\n\t}\r\n\r\n\tprotected schema: Schema = [\r\n\t\tthis.valueSchema,\r\n\t\t{ name: 'submit', type: 'submit'} as ButtonSchema,\r\n\t];\r\n\r\n\tprotected uiSchema: UiSchema = {\r\n\t\titems: {\r\n\t\t\tvalue: {\r\n\t\t\t\twidget: 'number',\r\n\t\t\t\tmin: 0,\r\n\t\t\t\tstep: 1,\r\n\t\t\t\tlabel: this.valueLabel,\r\n\t\t\t\tplaceholder: this.placeholder,\r\n\t\t\t\trules: (value:any) => this.onCheckValue(value),\r\n\t\t\t} as UiNumberItem,\r\n\t\t\tsubmit: {\r\n\t\t\t\twidget: 'button', className: 'btn btn-primary w-25', label: '提交', disabled: false,\r\n\t\t\t} as UiButton,\r\n\t\t}\r\n\t}\r\n\r\n\tprotected renderStock(): JSX.Element {\r\n\t\tlet {holdingStock} = this.controller;\r\n\t\tif (!holdingStock) return null;\r\n\t\tlet {stockObj, quantity, miValue, market} = holdingStock;\r\n\t\tlet {name, no} = stockObj;\r\n\t\treturn <div className=\"py-2\">\r\n\t\t\t<div className=\"mr-auto px-3 mb-2\">\r\n\t\t\t\t<b>{name}</b> <span className=\"ml-2 small text-muted\">{no}</span>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"d-flex my-2 py-2 border-top border-bottom justify-content-center text-center bg-white\">\r\n\t\t\t\t{this.renderQuantity('股数', quantity)}\r\n\t\t\t\t{this.renderValue('米息', miValue, 2)}\r\n\t\t\t\t{this.renderValue('市值', market, 2)}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderValue(caption:string, value: number, dec: number = 0) {\r\n\t\treturn <div className=\"mx-1 border rounded w-min-5c px-1 py-2\">\r\n\t\t\t<small className=\"text-muted\">{caption}</small>\r\n\t\t\t<div>{formatNumber(value??0)}</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected renderQuantity(caption:string, value: number, dec: number = 0) {\r\n\t\treturn this.renderValue(caption, value, dec);\r\n\t}\r\n\r\n\tprotected beforeRender() {}\r\n\r\n\tprotected renderForm(): JSX.Element {\r\n\t\tthis.beforeRender();\r\n\t\treturn <Form ref={f => this.form = f} className=\"mx-3\"\r\n\t\t\tonButtonClick={this.onFormSubmit}\r\n\t\t\tonEnter={this.onFormSubmit}\r\n\t\t\tfieldLabelSize={3}\r\n\t\t\tfieldLabelAlign='right'\r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema} />;\r\n\t}\r\n\r\n\tprivate onFormSubmit = async (name:string, context: Context):Promise<void> => {\r\n\t\tcontext.setDisabled(name, true);\r\n\t\tawait this.onSubmit(context.data);\r\n\t\tcontext.setDisabled(name, false);\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tprotected renderFormTop():JSX.Element {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprotected abstract onSubmit(data:any): Promise<void>;\r\n\r\n\tcontent() {\r\n\t\treturn <div className=\"my-3\">\r\n\t\t\t{this.renderStock()}\r\n\t\t\t{this.renderFormTop()}\r\n\t\t\t{this.renderForm()}\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nabstract class VStock extends VForm {\r\n\tprotected beforeRender() {\r\n\t\tsuper.beforeRender();\r\n\t\tthis.schema.unshift(\r\n\t\t\t{ name: 'price', type: 'number', min: 0, required: true } as NumSchema,\r\n\t\t);\r\n\t\tthis.uiSchema.items['price'] = {\r\n\t\t\twidget: 'number',\r\n\t\t\tmin: 0,\r\n\t\t\tstep: 1,\r\n\t\t\tlabel: '价格',\r\n\t\t\tplaceholder: '股票价格',\r\n\t\t\tdefaultValue: this.controller.holdingStock?.stockObj.price\r\n\t\t\t//rules: (value:any) => this.onCheckValue(value),\r\n\t\t} as UiNumberItem;\r\n\t}\r\n}\r\n\r\nabstract class VBuy extends VStock {\r\n\tprotected beforeRender() {\r\n\t\tsuper.beforeRender();\r\n\t\tthis.uiSchema.rules = [this.checkCash];\r\n\t}\r\n\tprotected checkCash = (context:Context): string[] | string => {\r\n\t\tlet {holdingStock, miAccount} = this.controller;\r\n\t\tlet {cash} = miAccount;\r\n\t\tif (typeof cash !== 'number') return;\r\n\t\tlet stock = holdingStock?.stockObj || this.controller.stock;\r\n\t\tlet quantity = context.data.value;\r\n\t\tlet {price} = stock;\r\n\t\tif ((quantity as number) * (price as number) > (cash as number))\r\n\t\t\treturn `超过账户资金余额，无法买入`;\r\n    }\r\n\r\n\tprotected renderFormTop():JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {miAccount, holdingStock, stock} = this.controller;\r\n\t\t\tlet {portionAmount, cash} = miAccount;\r\n\t\t\tif (typeof cash !== 'number') return null;\r\n\t\t\tif (!portionAmount) return null;\r\n\t\t\tlet vComment: any;\r\n\t\t\tif (!stock && !holdingStock) {\r\n\t\t\t\tvComment = <>\r\n\t\t\t\t\t<FA name=\"bell-o mr-1 text-warning\" />\r\n\t\t\t\t\t建议不超过每份金额{portionAmount}\r\n\t\t\t\t</>;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!stock) {\r\n\t\t\t\t\tstock = holdingStock.stockObj;\r\n\t\t\t\t}\r\n\t\t\t\tlet {price} = stock;\r\n\t\t\t\tlet quantity: number;\r\n\t\t\t\tif (holdingStock) {\r\n\t\t\t\t\tquantity = portionAmount / price -  holdingStock.quantity;\r\n\t\t\t\t\tif (quantity < 0) quantity = 0;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tquantity = portionAmount / price;\r\n\t\t\t\t}\r\n\t\t\t\tvComment = quantity === 0?\r\n\t\t\t\t<>\r\n\t\t\t\t\t<FA name=\"times-circle-o mr-1 text-danger\" />\r\n\t\t\t\t\t每份金额{portionAmount}，已超单只股票份额，建议不要购买\r\n\t\t\t\t</>\r\n\t\t\t\t:\r\n\t\t\t\t<>\r\n\t\t\t\t\t<FA name=\"check-circle-o mr-1 text-warning\" />\r\n\t\t\t\t\t每份金额{portionAmount}，建议不超过：{Math.round(quantity)} 股\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn <div className=\"pb-3 px-3 text-center small text-muted\">\r\n\t\t\t\t{vComment}\r\n\t\t\t</div>;\r\n\t\t}));\t\t\r\n\t}\r\n}\r\n\r\nexport class VBuyNew extends VBuy {\r\n\theader() {return '新买股票'}\r\n\tprotected beforeRender() {\r\n\t\tsuper.beforeRender();\r\n\t\tthis.schema.unshift(\r\n\t\t\t{ name: 'stock', type: 'id', required: true } as IdSchema,\r\n\t\t);\r\n\t\tthis.uiSchema.items['stock'] = {\r\n\t\t\twidget: 'id',\r\n\t\t\tlabel: '股票',\r\n\t\t\tpickId: this.controller.createPickStockId(),\r\n\t\t\tplaceholder: '请选择股票',\r\n\t\t\tTemplet: this.renderStockPick,\r\n\t\t} as UiIdItem;\r\n\t}\r\n\r\n\tprivate renderStockPick = (values: Stock):JSX.Element => {\r\n\t\tlet {name, no} = values;\r\n\t\treturn <>{name} <small className=\"text-muted\">{no}</small></>;\r\n\t}\r\n\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {stock, price, value} = data;\r\n\t\tawait this.controller.submitBuyNew(stock.id, price, value);\r\n\t}\r\n}\r\n\r\nexport class VBuyExist extends VBuy {\r\n\theader() {return '加买股票'}\r\n\tprotected get placeholder(): string {return '加买数量'}\r\n\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {price, value} = data;\r\n\t\tawait this.controller.submitBuy(price, value);\r\n\t}\r\n}\r\n\r\nexport class VSell extends VStock {\r\n\theader() {return '卖出股票'}\r\n\tprotected get placeholder(): string {return '卖出数量'}\r\n\tprotected onCheckValue(value:any): string[] | string {\r\n\t\tlet {holdingStock} = this.controller;\r\n\t\tlet {quantity} = holdingStock;\r\n\t\tif (value > quantity)\r\n\t\t\treturn `现有持股${quantity}，卖出数量超出`;\r\n    }\r\n\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {price, value} = data;\r\n\t\tawait this.controller.submitSell(price, value);\r\n\t}\r\n\r\n\tprotected renderQuantity(caption:string, value: number, dec: number = 0) {\r\n\t\treturn <div className=\"mx-1 border border-info rounded w-min-5c px-1 py-2 cursor-pointer\"\r\n\t\t\tonClick={this.onClickQuantity}>\r\n\t\t\t<small className=\"text-muted\">{caption}</small>\r\n\t\t\t<div>{formatNumber(value??0)}</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onClickQuantity = () => {\r\n\t\tthis.form.formContext.setValue('value', this.controller.holdingStock.quantity);\r\n\t}\r\n}\r\n\r\nexport class VChangeCost extends VForm {\r\n\theader() {return '修改成本'}\r\n\tprotected get valueLabel(): string {return '新成本'}\r\n\tprotected get placeholder(): string {return '新股票成本'}\r\n\tprotected get valueSchema(): ItemSchema {\r\n\t\treturn { name: 'value', type: 'number', min: 0.01, required: true } as NumSchema;\r\n\t}\r\n\tprotected beforeRender() {\r\n\t\tlet {holdingStock} = this.controller;\r\n\t\tif (!holdingStock) return;\r\n\t\tlet {cost, quantity} = holdingStock;\r\n\t\tlet {value} = this.uiSchema.items;\r\n\t\tlet uiValue = value as UiNumberItem;\r\n\t\tuiValue.min = 0.01;\r\n\t\tuiValue.step = 0.01;\r\n\t\tlet oldPrice = cost/quantity;\r\n\t\tuiValue.defaultValue = oldPrice.toFixed(2);\r\n\t}\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitChangeCost(value);\r\n\t}\r\n}\r\n\r\nabstract class VCash extends VForm {\r\n\tprotected get valueLabel(): string {return '资金数量'}\r\n\tprotected renderStock(): JSX.Element {return null}\r\n}\r\n\r\nexport class VCashInit extends VCash {\r\n\theader() {return '期初资金'}\r\n\tprotected get placeholder(): string {return '期初金额'}\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitCashInit(value);\r\n\t}\r\n}\r\n\r\nexport class VCashIn extends VCash {\r\n\theader() {return '调入资金'}\r\n\tprotected get placeholder(): string {return '调入金额'}\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitCashIn(value);\r\n\t}\r\n}\r\n\r\nexport class VCashOut extends VCash {\r\n\theader() {return '调出资金'}\r\n\tprotected get placeholder(): string {return '调出金额'}\r\n\tprotected onCheckValue(value:any): string[] | string {\r\n\t\tlet {cash} = this.controller.miAccount; \r\n\t\tif (value > cash)\r\n\t\t\treturn `调出金额不能超过总现金${cash}`;\r\n    }\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitCashOut(value);\r\n\t}\r\n}\r\n\r\nexport class VCashAdjust extends VCash {\r\n\theader() {return '调整资金'}\r\n\tprotected beforeRender() {\r\n\t\t(this.schema[0] as IntSchema).min = undefined;\r\n\t}\r\n\tprotected get placeholder(): string {return '调整金额'}\r\n\tprotected onCheckValue(value:any): string[] | string {\r\n\t\tlet {cash} = this.controller.miAccount; \r\n\t\tif (value < 0 && -value > cash)\r\n\t\t\treturn `负向调整金额不能超过总现金${cash}`;\r\n    }\r\n\tprotected async onSubmit(data:any): Promise<void> {\r\n\t\tlet {value} = data;\r\n\t\tawait this.controller.submitCashAdjust(value);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { MiAccount } from \"store\";\r\nimport { FA, List, LMR, View } from \"tonva-react\";\r\nimport { nFormat1, smallPercent } from \"tool\";\r\nimport { Account, AccountValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CAccount } from \"./CAccount\";\r\n\r\nexport class VAccounts extends View<CAccount> {\r\n\trender():JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {cApp} = this.controller;\r\n\t\t\tlet {miAccounts} = cApp.store;\r\n\t\t\tlet listHeader = (caption:string) => <div className=\"small text-muted pt-2 pb-1 px-3\">{caption}</div>;\r\n\t\t\treturn <>\r\n\t\t\t\t{listHeader('持仓')}\r\n\t\t\t\t<List items={miAccounts.accounts} item={{render: this.renderAccount, onClick: this.onClickAccount}} />\r\n\t\t\t</>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate onClickAccount = (item: MiAccount) => {\r\n\t\tthis.controller.showAccount(item);\r\n\t}\r\n\r\n\tprivate renderAccount = (item:Account&AccountValue, index:number):JSX.Element => {\r\n\t\tfunction valueToString(value:number, suffix?:string|JSX.Element):JSX.Element {\r\n\t\t\treturn <>{(value??0).toLocaleString(undefined, nFormat1)}{suffix}</>\r\n\t\t}\r\n\t\tfunction renderValue(caption:string, content:JSX.Element, cn:string='') {\r\n\t\t\treturn <div className={'pr-3 ' + cn}>\r\n\t\t\t\t<small className=\"text-muted\">{caption}: </small>\r\n\t\t\t\t{content}\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\tlet {name, miValue, market, count} = item;\r\n\t\tlet miRate = market > 1? miValue*100/market : 0;\r\n\t\tlet left = <FA name=\"money\" className=\"text-warning align-self-start mt-3 ml-2 ml-sm-3\" size=\"lg\" fixWidth={true} />;\r\n\t\tlet right = <div className=\"px-2 d-flex align-items-center\">\r\n\t\t\t<FA className=\"align-\" name=\"angle-right\" />\r\n\t\t</div>;\r\n\t\treturn <LMR left={left} right={right}>\r\n\t\t\t<div className=\"px-2 px-sm-3 py-2 bg-white d-block\">\r\n\t\t\t{\r\n\t\t\t\tcount > 0?\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t{name}\r\n\t\t\t\t\t\t\t<small className=\"ml-3 text-danger\">{count}</small>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"mt-2 d-flex\">\r\n\t\t\t\t\t\t\t{renderValue('米息率', valueToString(miRate, smallPercent), 'w-min-8c')}\r\n\t\t\t\t\t\t\t{renderValue('米息', valueToString(miValue), 'd-none d-sm-block w-min-8c')}\r\n\t\t\t\t\t\t\t{renderValue('市值', valueToString(market))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</>\r\n\t\t\t\t\t:\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<div className=\"py-1\">\r\n\t\t\t\t\t\t\t{name}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t</div>\r\n\t\t</LMR>;\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { List, SearchBox, VPage } from \"tonva-react\";\r\nimport { renderStockName } from \"tool\";\r\nimport { Stock } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CAccount } from \"./CAccount\";\r\n\r\nexport class VPickStock extends VPage<CAccount> {\r\n\theader() {return '选择股票'}\r\n\tright() {\r\n\t\treturn <SearchBox \r\n\t\t\tclassName=\"mr-2\"\r\n\t\t\tonSearch={this.controller.onSearchStock} \r\n\t\t\tplaceholder=\"股票名称或代码\" />;\r\n\t}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\treturn <div>\r\n\t\t\t\t<List items={this.controller.stocks} item={{render: this.renderStock, onClick: this.onClickStock}} />\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate renderStock = (stock: Stock, index: number): JSX.Element => {\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{renderStockName(stock)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onClickStock = (stock: Stock) => {\r\n\t\tthis.returnCall(stock);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","import { IObservableArray, makeObservable, observable } from \"mobx\";\r\nimport { PickId, Context } from \"tonva-react\";\r\nimport { MiAccount, MGroup, HoldingStock } from \"../../store\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CApp, CUqSub, UQs } from \"../../uq-app\";\r\nimport { VAccount } from \"./VAccount\";\r\nimport { VBuyExist, VBuyNew, VCashAdjust, VCashInit, VCashIn, VCashOut, VSell, VChangeCost } from \"./VForm\";\r\nimport { CHome } from \"../CHome\";\r\nimport { VAccounts } from \"./VAccounts\";\r\nimport { VPickStock } from \"./VPickStock\";\r\n\r\nexport class CAccount extends CUqSub<CApp, UQs, CHome> {\r\n\tmiGroup: MGroup = null;\r\n\tstocks: IObservableArray<Stock & StockValue>;\r\n\tstock: Stock & StockValue;\r\n\tmiAccount: MiAccount = null;\r\n\tholdingStock: HoldingStock;\r\n\tlistCaption: string;\r\n\r\n\tconstructor(cHome: CHome) {\r\n\t\tsuper(cHome);\r\n\t\tmakeObservable(this, {\r\n\t\t\tmiGroup: observable,\r\n\t\t\tmiAccount: observable,\r\n\t\t\tstocks: observable,\r\n\t\t\tstock: observable,\r\n\t\t});\r\n\t}\r\n\r\n\tasync internalStart(param: any) {\r\n\t}\r\n\r\n\trenderAccounts() {\r\n\t\treturn this.renderView(VAccounts);\r\n\t}\r\n\r\n\tshowAccount = async (item: MiAccount) => {\r\n\t\tthis.miAccount = item;\r\n\t\tlet renderPageRight = () => {\r\n\t\t\tlet cID = this.cApp.cCommon.buildCIDUserAccount();\r\n\t\t\treturn cID.renderViewRight(item);\r\n\t\t}\r\n\t\tthis.openVPage(VAccount, {renderPageRight});\r\n\t\tawait item.loadItems();\r\n\t};\r\n\t\r\n\tshowHolding = async (item: HoldingStock) => {\r\n\t\tlet stock = item.stockObj;\r\n\t\tthis.cApp.cCommon.showStock(stock);\r\n\t}\r\n\r\n\tcreatePickStockId() {\r\n\t\tlet ret:PickId = async (context:Context, name: string, value: number) => {\r\n\t\t\tthis.stocks = this.cApp.store.stocksMyAll;\r\n\t\t\tlet v = await this.pickStock();\r\n\t\t\tif (!v) return;\r\n\t\t\tlet stock = await this.cApp.store.loadStock(v.id);\r\n\t\t\tthis.stock = stock;\r\n\t\t\tif (stock) {\r\n\t\t\t\tcontext.setValue('price', String(stock.price));\r\n\t\t\t}\r\n\t\t\treturn stock;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async pickStock() {\r\n\t\treturn this.vCall(VPickStock);\r\n\t}\r\n\r\n\tonSearchStock = async (key: string) => {\r\n\t\tlet ret = await this.cApp.store.searchStock({key}, undefined, 50);\r\n\t\tlet {$page} = ret;\r\n\t\tthis.stocks = observable($page);\r\n\t}\r\n\r\n\tshowBuy = async (item?: HoldingStock) => {\r\n\t\tif (item) {\r\n\t\t\tthis.holdingStock = item;\r\n\t\t\tthis.openVPage(VBuyExist);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.holdingStock = undefined;\r\n\t\t\tthis.openVPage(VBuyNew);\r\n\t\t}\r\n\t}\r\n\r\n\tsubmitBuyNew = async (stockId: number, price:number, quantity:number) => {\r\n\t\tawait this.miAccount.buyNewHolding(stockId, price, quantity);\r\n\t}\r\n\r\n\tsubmitBuy = async (price:number, quantity:number) => {\r\n\t\tawait this.miAccount.buyHolding(this.holdingStock.stock, price, quantity);\r\n\t}\r\n\r\n\tshowSell = async (item: HoldingStock) => {\r\n\t\tthis.holdingStock = item;\r\n\t\tthis.openVPage(VSell);\r\n\t}\r\n\r\n\tsubmitSell = async (price:number, quantity:number) => {\r\n\t\tawait this.miAccount.sellHolding(this.holdingStock.stock, price, quantity);\r\n\t}\r\n\t\r\n\tshowChangeCost = async (item: HoldingStock) => {\r\n\t\tthis.holdingStock = item;\r\n\t\tthis.openVPage(VChangeCost);\r\n\t}\r\n\t\r\n\tsubmitChangeCost = async (costPrice:number) => {\r\n\t\tawait this.miAccount.changeCost(this.holdingStock.stock, costPrice);\r\n\t}\r\n\r\n\tshowCashInit = async () => {\r\n\t\tthis.openVPage(VCashInit);\r\n\t}\r\n\r\n\tsubmitCashInit = async (value:number) => {\r\n\t\tawait this.miAccount.cashInit(value);\r\n\t}\r\n\r\n\tshowCashIn = async () => {\r\n\t\tthis.openVPage(VCashIn);\r\n\t}\r\n\r\n\tsubmitCashIn = async (value:number) => {\r\n\t\tawait this.miAccount.cashIn(value);\r\n\t}\r\n\t\r\n\tshowCashOut = async () => {\r\n\t\tthis.openVPage(VCashOut);\r\n\t}\r\n\r\n\tsubmitCashOut = async (value:number) => {\t\t\r\n\t\tawait this.miAccount.cashOut(value);\r\n\t}\r\n\t\r\n\tshowCashAdjust = async () => {\r\n\t\tthis.openVPage(VCashAdjust);\r\n\t}\r\n\r\n\tsubmitCashAdjust = async (value:number) => {\r\n\t\tawait this.miAccount.cashAdjust(value);\r\n\t}\r\n\r\n\tshowTransactionDetail = async (item: HoldingStock) => {\r\n\t\talert('detail');\r\n\t}\r\n}\r\n","import { EasyTime, List, LMR, VPage } from \"tonva-react\";\r\nimport { Blog } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CHome } from \"./CHome\";\r\n\r\nexport class VBlogs extends VPage<CHome> {\r\n\theader() {\r\n\t\treturn \"米投博客\";\r\n\t}\r\n\t/*\r\n\t<LMR className=\"d-flex px-3 py-2 my-1 cursor-pointer bg-white\"\r\n\tonClick={this.controller.showIntroduction}\r\n\tright={right}>\r\n\t<div className=\"\">\r\n\t\t米投体系概念\r\n\t</div>\r\n\t</LMR>\r\n\t*/\r\n\tcontent() {\r\n\t\tlet right = <small className=\"text-muted align-self-center\"><EasyTime date={new Date(2021, 1, 1, 12, 0, 0)} /></small>;\r\n\t\treturn <div className=\"pb-3\">\r\n\t\t\t<LMR className=\"d-flex px-3 py-2 mt-1 mb-3 cursor-pointer bg-white\"\r\n\t\t\t\tonClick={this.controller.cApp.cMe.showAbout}\r\n\t\t\t\tright={right}>\r\n\t\t\t\t<div className=\"\">\r\n\t\t\t\t\t关于本APP\r\n\t\t\t\t</div>\r\n\t\t\t</LMR>\r\n\r\n\t\t\t<List items={this.controller.blogs} item={{render: this.renderBlog, onClick: this.onClickBlog}} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderBlog = (blog: Blog, index: number) => {\r\n\t\tlet {caption, $create} = blog;\r\n\t\tlet right = <small className=\"text-muted\"><EasyTime date={$create} /></small>\r\n\t\treturn <LMR className=\"px-3 py-2\" right={right}>\r\n\t\t\t{caption}\r\n\t\t</LMR>;\r\n\t}\r\n\r\n\tprivate onClickBlog = (blog: Blog) => {\r\n\t\tthis.controller.onClickBlog(blog);\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport marked from 'marked';\r\nimport { CHome } from \"./CHome\";\r\n\r\nexport class VBlog extends VPage<CHome> {\r\n\theader() {return this.controller.blog.caption;}\r\n\tcontent() {\r\n\t\tlet {content} = this.controller.blog;\r\n\t\treturn <div className=\"p-4 bg-white\">\r\n\t\t\t<div dangerouslySetInnerHTML={{__html: marked(content)}}></div>\r\n\t\t</div>\r\n\t}\r\n}","import { IObservableArray, makeObservable, observable } from \"mobx\";\r\nimport { BruceYuMi, CApp, CUqBase } from \"uq-app\";\r\nimport { Blog, Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { VHome } from \"./VHome\";\r\nimport { CAccount } from \"./account\";\r\nimport { VBlogs } from \"./VBlogs\";\r\nimport { PageItems } from \"tonva-react\";\r\nimport { VBlog } from \"./VBlog\";\r\n\r\nexport class CHome extends CUqBase {\r\n\treadonly cAccount: CAccount;\r\n\tstocks: IObservableArray<Stock & StockValue> = null;\r\n\tlistCaption: string = null;\r\n\tblogs: BlogPageItems;\r\n\tblog: Blog;\r\n\r\n\tconstructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tmakeObservable(this, {\r\n\t\t\tstocks: observable.ref,\r\n\t\t\tlistCaption: observable,\r\n\t\t});\r\n\t\tthis.cAccount = this.newSub(CAccount);\r\n\t}\r\n\r\n\tprotected async internalStart(param: any) {\r\n\t\tthis.openVPage(VHome);\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.renderView(VHome);\r\n\t}\r\n\r\n\tonStockClick = async (stock: Stock) => {\r\n\t\tthis.cApp.cCommon.showStock(stock);\r\n\t}\r\n\r\n\tshowBlogs = async () => {\r\n\t\tthis.blogs = new BlogPageItems(this.uqs.BruceYuMi);\r\n\t\tthis.openVPage(VBlogs);\r\n\t\tawait this.blogs.first(undefined);\r\n\t}\r\n\r\n\tonClickBlog(blog: Blog) {\r\n\t\tthis.blog = blog;\r\n\t\tthis.openVPage(VBlog);\r\n\t}\r\n\r\n\tshowIntroduction = () => {\r\n\t\tthis.cApp.cMe.showFaq();\r\n\t}\r\n}\r\n\r\n\r\nexport class BlogPageItems extends PageItems<Blog> {\r\n\tprivate yumi: BruceYuMi.UqExt;\r\n\r\n\tconstructor(yumi: BruceYuMi.UqExt) {\r\n\t\tsuper(false);\r\n\t\tthis.yumi = yumi;\r\n\t\tthis.firstSize = 30;\r\n\t\tthis.pageSize = 10;\r\n\t}\r\n\t\r\n\tprotected getPageId(item:Blog):any {\r\n\t\treturn item?.id;\r\n\t}\r\n\r\n\tprotected async loadResults (param:undefined, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.yumi.ID<Blog>({\r\n\t\t\tIDX: this.yumi.Blog,\r\n\t\t\tid: undefined,\r\n\t\t\torder: 'desc',\r\n\t\t\tpage: {start: pageStart, size: pageSize},\r\n\t\t});\r\n\t\treturn {$page: ret};\r\n\t}\r\n}\r\n","import { Store } from \"store\";\r\nimport { PageItems } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { SearchParam } from './CFind';\r\n\r\nexport class StockPageItems extends PageItems<Stock & StockValue> {\r\n\tprivate store: Store;\r\n\r\n\tconstructor(store: Store) {\r\n\t\tsuper(false);\r\n\t\tthis.store = store;\r\n\t\tthis.firstSize = 50;\r\n\t\tthis.pageSize = 20;\r\n\t}\r\n\t\r\n\tprotected getPageId(item:Stock):any {\r\n\t\treturn (item as unknown as any)?.$order;\r\n\t}\r\n\r\n\tprotected async loadResults (param:SearchParam, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.store.searchStock(\r\n\t\t\t{...param, smooth: param.smooth + 1}\r\n\t\t\t, pageStart, pageSize);\r\n\t\treturn ret as any;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { DropdownAction, DropdownActions, FA, LMR, SearchBox, VPage } from \"tonva-react\";\r\nimport { CFind } from \"./CFind\";\r\n\r\nexport class VFind extends VPage<CFind> {\r\n\theader() { return '发现' }\r\n\tcontent() {\r\n\t\tlet { showA, showHK, showSH, showSZ, showUS, showAll, cGroup, cIndustries } = this.controller;\r\n\t\tlet buttons: [string, () => Promise<void>][] = [\r\n\t\t\t['A股', showA],\r\n\t\t\t['港股', showHK],\r\n\t\t\t['沪A', showSH],\r\n\t\t\t['深A', showSZ],\r\n\t\t\t['US', showUS],\r\n\t\t\t['全部', showAll],\r\n\t\t];\r\n\t\tlet renderButton = (caption: string, onClick: () => void) => <button key={caption}\r\n\t\t\tclassName=\"btn btn-outline-info m-1\"\r\n\t\t\tonClick={onClick}>\r\n\t\t\t{caption}\r\n\t\t</button>;\r\n\t\treturn <div className=\"bg-light\">\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t<SearchBox className=\"mb-0\" onSearch={this.controller.onSearch} placeholder=\"股票代码，名称\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"p-2 mb-2 d-flex flex-wrap bg-white border-top border-bottom\">\r\n\t\t\t\t{buttons.map(v => {\r\n\t\t\t\t\tlet [caption, show] = v;\r\n\t\t\t\t\treturn renderButton(caption, show);\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t{this.renderMyAll()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"small text-muted px-3 mb-1\">分组</div>\r\n\t\t\t<div className=\" mb-3 px-1 pb-1 bg-white border-top border-bottom\">\r\n\t\t\t\t{cGroup.renderGroups()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"small text-muted px-3 mt-2 mb-1\">行业</div>\r\n\t\t\t<div className=\" mb-3 px-1 pb-1 bg-white border-top border-bottom\">\r\n\t\t\t\t{cGroup.renderIndustries()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"small text-muted px-3 mt-2 mb-1\">门类</div>\r\n\t\t\t<div className=\" mb-3 px-1 pb-1 bg-white border-top border-bottom\">\r\n\t\t\t\t{cIndustries.renderRootIndustries()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t{this.renderMyBlock()}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderMyAll() {\r\n\t\tlet { cApp, cGroup } = this.controller;\r\n\t\tlet { showStocksAll } = cGroup;\r\n\t\tlet { stocksMyAll, myAllCaption } = cApp.store;\r\n\t\treturn this.renderSpec(stocksMyAll?.length, myAllCaption, 'home', 'text-primary', showStocksAll);\r\n\t}\r\n\r\n\tprivate renderMyBlock() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet { cApp, cGroup } = this.controller;\r\n\t\t\tlet { showStocksBlock } = cGroup;\r\n\t\t\tlet { stocksMyBlock, myBlockCaption } = cApp.store;\r\n\t\t\treturn this.renderSpec(stocksMyBlock?.length, <>\r\n\t\t\t\t<span className=\"mr-3\">{myBlockCaption}</span>\r\n\t\t\t\t<small className=\"text-muted\">选股时不列出</small>\r\n\t\t\t</>,\r\n\t\t\t\t'ban', 'text-black', showStocksBlock);\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate renderSpec(count: number, text: string | JSX.Element, icon: string, color: string, click: () => void) {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet right = count > 0 && <small className=\"align-self-center mx-3 text-muted\">{count}</small>;\r\n\t\t\tlet cn = \"align-self-center ml-3 \" + color;\r\n\t\t\treturn <div className=\"mt-2 bg-white cursor-pointer\" onClick={click}>\r\n\t\t\t\t<LMR left={<FA name={icon} className={cn} size=\"lg\" fixWidth={true} />} right={right}>\r\n\t\t\t\t\t<div className=\"px-3 py-2\">{text}</div>\r\n\t\t\t\t</LMR>\r\n\t\t\t</div>\r\n\t\t}));\r\n\t}\r\n\r\n\tright() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet { cCommon } = this.controller.cApp;\r\n\t\t\tlet actions: DropdownAction[] = [\r\n\t\t\t\t{\r\n\t\t\t\t\tcaption: '管理股票分组',\r\n\t\t\t\t\taction: cCommon.manageGroups,\r\n\t\t\t\t\ticon: 'object-group',\r\n\t\t\t\t},\r\n\t\t\t];\r\n\t\t\treturn <DropdownActions actions={actions} icon=\"bars\" className=\"mr-2 text-white bg-transparent border-0\" />;\r\n\t\t}));\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { FA, List, Scroller, SearchBox, VPage } from \"tonva-react\";\r\nimport { renderStockRow } from \"tool\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CFind } from \"./CFind\";\r\n\r\nconst cnStar = 'small border rounded py-1 px-2 mr-3 ';\r\n\r\nexport class VStocksPage extends VPage<CFind> {\r\n\theader() {return React.createElement(observer(() => <span className=\"\">{this.controller.header}</span>))}\r\n\tcontent() {\r\n\t\tlet { pageStocks, onClickStock } = this.controller;\r\n\t\treturn <div className=\"pt-1 pb-3\">\r\n\t\t\t{this.renderStars()}\r\n\t\t\t<List items={pageStocks} item={{render: this.renderStock, onClick: onClickStock}} />\r\n\t\t</div>\r\n\t}\r\n\tright():JSX.Element {\r\n\t\tlet {key} = this.controller.searchParam;\r\n\t\treturn <SearchBox className=\"mr-2 w-max-10c\"\r\n\t\t\tonSearch={this.searchInGroup} \r\n\t\t\tinitKey={key}\r\n\t\t\tplaceholder={key? '搜索' : this.controller.header+'中搜索'} />;\r\n\t}\r\n\r\n\tprivate searchInGroup = async (key: string) => {\r\n\t\tlet {searchParam} = this.controller;\r\n\t\tsearchParam.key = key;\r\n\t\tawait this.controller.research();\r\n\t}\r\n\r\n\tprivate renderStars():JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet { smooth } = this.controller;\r\n\t\t\tlet stars:number[] = [];\r\n\t\t\tfor (let i=0;i<5; i++) stars[i] = 4-i;\r\n\t\t\treturn <div className=\"px-3 py-1 d-sm-flex d-block\">\r\n\t\t\t\t<div className=\"d-flex py-1\">\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstars.map(v => {\r\n\t\t\t\t\t\t\tlet cn:string, icon:string;\r\n\t\t\t\t\t\t\tif (v === smooth) {\r\n\t\t\t\t\t\t\t\ticon = 'star';\r\n\t\t\t\t\t\t\t\tcn = cnStar + ' text-warning border-primary bg-white';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (v<smooth) {\r\n\t\t\t\t\t\t\t\tcn = cnStar + ' cursor-pointer text-muted ';\r\n\t\t\t\t\t\t\t\ticon = 'star-o';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tcn = cnStar + ' cursor-pointer text-warning bg-white';\r\n\t\t\t\t\t\t\t\ticon = 'star';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn <div key={v} className={cn} onClick={() => this.controller.changeSmooth(v)}>\r\n\t\t\t\t\t\t\t\t{v===0? '全部' : <>{v}<FA name={icon} /></>}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"text-muted small py-1 ml-auto align-self-center\">\r\n\t\t\t\t\t<FA name=\"star-o\" /> 近五年分红增长持续度\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\t//<button onClick={this.controller.cApp.cCommon.showEmptyPage}>test</button>\r\n\r\n\tprivate renderStock = (stock: Stock & StockValue): JSX.Element => {\r\n\t\tlet pinStock = this.controller.cApp.cCommon.renderPinStock(stock, 1);\r\n\t\tlet {$order} = stock as any;\r\n\t\treturn renderStockRow($order, stock, this.onClickName, pinStock);\r\n\t}\r\n\r\n\tprivate onClickName = (stock: Stock & StockValue) => {\r\n\t\tthis.controller.cApp.openStock(stock);\r\n\t}\r\n\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {\r\n\t\tawait this.controller.pageStocks.more();\r\n\t}\r\n}\r\n/*\r\n<button className=\"btn btn-sm btn-outline-primary\" \r\nonClick={() => this.controller.selectStock(stock)}>\r\n<FA name=\"cog\" className=\"text-warning small\" /> 设自选\r\n</button>\r\n*/","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { FA, List, View } from \"tonva-react\";\r\nimport { CGroup } from \"./CGroup\";\r\nimport { MGroup } from \"store/mGroup\";\r\n\r\nconst pos = {right:\"-1.0rem\", bottom:\"-0.3rem\"};\r\n\r\nexport class VGroups extends View<CGroup> {\r\n\trender(groups: MGroup[]):JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\treturn <List items={groups} \r\n\t\t\t\titem={{render: this.renderGroup, onClick:(group) => this.onGroupClick(group)}} \r\n\t\t\t\tclassName=\"d-flex flex-wrap bg-white p-1\" />;\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected onGroupClick(group: MGroup) {\r\n\t\tthis.controller.showMiGroup(group);\r\n\t}\r\n\r\n\tprotected renderGroup = (group:MGroup, index: number):JSX.Element => {\r\n\t\tlet {name, count, type} = group;\r\n\t\tlet left:any;\r\n\t\tswitch (type) {\r\n\t\t\tdefault:\r\n\t\t\tcase 'group':\r\n\t\t\t\tleft = <FA name=\"list-alt\" className=\"text-info align-self-center\" />;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'industry':\r\n\t\t\t\tleft = <FA name=\"leaf\" className=\"text-danger align-self-center\" />;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet fontStyle:React.CSSProperties;\r\n\t\tlet len = name.length;\r\n\t\tif (len >= 9) fontStyle = {fontSize: '50%'};\r\n\t\tif (len >= 8) fontStyle = {fontSize: '60%'};\r\n\t\telse if (len >= 7) fontStyle = {fontSize: '70%'};\r\n\t\telse if (len >= 6) fontStyle = {fontSize: '80%'};\r\n\t\tlet right = count > 0 && <small className=\"text-muted position-absolute\" style={pos}>{count}</small>;\r\n\t\treturn <div className=\"d-block w-min-6c w-max-6c text-center py-1 m-1 border rounded bg-white\">\r\n\t\t\t<span className=\"position-relative\">\r\n\t\t\t\t{left} {right}\r\n\t\t\t</span>\r\n\t\t\t<div className=\"\" style={fontStyle}>{name}</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { MGroup } from \"store/mGroup\";\r\nimport { VGroups } from './VGroups';\r\n\r\nexport class VRootIndustry extends VGroups {\r\n\tprotected onGroupClick(group: MGroup) {\r\n\t\tthis.controller.showRootIndustry(group);\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { List, VPage } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { renderStockRow } from \"tool\";\r\nimport { CGroup } from \"./CGroup\";\r\nimport { VRootIndustry } from \"./VRootIndustry\";\r\n\r\nexport class VStockList extends VPage<CGroup> {\r\n\tprivate renderRowRight: (stock: Stock & StockValue) => JSX.Element;\r\n\tprivate renderPageRight: () => JSX.Element;\r\n\tinit(param: {\r\n\t\trenderRowRight: (stock: Stock & StockValue) => JSX.Element;\r\n\t\trenderPageRight: () => JSX.Element;\r\n\t}) {\r\n\t\tlet {renderRowRight, renderPageRight} = param;\r\n\t\tthis.renderRowRight = renderRowRight;\r\n\t\tthis.renderPageRight = renderPageRight;\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn React.createElement(observer(() => <>{this.controller.listCaption}</>));\r\n\t}\r\n\tright(): JSX.Element {\r\n\t\treturn this.renderPageRight?.();\r\n\t}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {miGroup, stocks} = this.controller;\r\n\t\t\tlet vGroups: any;\r\n\t\t\tif (miGroup) {\r\n\t\t\t\tlet {groups} = miGroup;\r\n\t\t\t\tif (groups) {\r\n\t\t\t\t\tvGroups = this.renderVm(VRootIndustry, groups);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn <div>\r\n\t\t\t\t{vGroups}\r\n\t\t\t\t<List items={stocks} item={{render: this.renderStock}} />\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate onClickName = (stock:Stock) => {\r\n\t\tthis.controller.onStockClick(stock);\r\n\t}\r\n\r\n\tprivate renderStock = (stock:Stock & StockValue, index:number) => {\r\n\t\tlet right = this.renderRowRight?.(stock);\r\n\t\tlet {$order} = stock as unknown as any;\r\n\t\treturn renderStockRow($order, stock as Stock & StockValue, this.onClickName, right);\r\n\t}\r\n}\r\n","import { action, computed, IObservableArray, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { MiAccount, MGroup, HoldingStock } from \"../../store\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CApp, CUqSub, UQs } from \"../../uq-app\";\r\nimport { CFind } from \"../CFind\";\r\nimport { VGroups } from \"./VGroups\";\r\nimport { VStockList } from \"./VStockList\";\r\nimport { VRootIndustry } from \"./VRootIndustry\";\r\n\r\nexport class CGroup extends CUqSub<CApp, UQs, CFind> {\r\n\tmiGroup: MGroup = null;\r\n\tmiAccount: MiAccount = null;\r\n\tholdingStock: HoldingStock;\r\n\tstocks: IObservableArray<Stock & StockValue>;\r\n\r\n\tconstructor(cFind: CFind) {\r\n\t\tsuper(cFind);\r\n\t\tmakeObservable(this, {\r\n\t\t\tmiGroup: observable,\r\n\t\t\tmiAccount: observable,\r\n\t\t\tstocks: observable,\r\n\t\t\tlistCaption: computed,\r\n\t\t\tshowMiGroup: action,\r\n\t\t\tshowStocksAll: action,\r\n\t\t});\r\n\t}\r\n\r\n\tasync internalStart(param: any) {\r\n\t}\r\n\r\n\tprivate _listCaption: string;\r\n\tget listCaption(): string {\r\n\t\treturn this._listCaption?? this.miGroup?.name;\r\n\t}\r\n\r\n\trenderGroups() {\r\n\t\tlet {miGroups} = this.cApp.store;\r\n\t\tlet {groups } = miGroups;\r\n\t\treturn this.renderView(VGroups, groups);\r\n\t}\r\n\r\n\trenderIndustries() {\r\n\t\tlet {industries} = this.cApp.store;\r\n\t\tlet {groups} = industries;\r\n\t\treturn this.renderView(VGroups, groups);\r\n\t}\r\n\r\n\trenderRootIndustries() {\r\n\t\tlet {rootIndustries} = this.cApp.store;\r\n\t\tlet {groups} = rootIndustries;\r\n\t\treturn this.renderView(VRootIndustry, groups);\r\n\t}\r\n\r\n\tshowMiGroup = async (miGroup: MGroup) => {\r\n\t\tthis._listCaption = undefined;\r\n\t\tthis.miGroup = miGroup;\r\n\r\n\t\tlet renderPageRight: () => JSX.Element;\r\n\t\tif (miGroup.type === 'group') {\r\n\t\t\trenderPageRight = () => {\r\n\t\t\t\tlet cID = this.cApp.cCommon.buildCIDUserGroup();\r\n\t\t\t\treturn cID.renderViewRight(miGroup);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.openStocksList(undefined, renderPageRight);\r\n\t\tawait miGroup.loadItems();\r\n\t\tthis.setStocksList(miGroup.stocks);\r\n\t}\r\n\r\n\tshowRootIndustry = async (miGroup: MGroup) => {\r\n\t\tlet cGroup = this.owner.newSub(CGroup);\r\n\t\tawait cGroup.showMiGroup(miGroup); //.start();\r\n\t\t/*\r\n\t\tthis._listCaption = undefined;\r\n\t\tthis.openStocksList(undefined);\r\n\t\tawait miGroup.loadItems();\r\n\t\tthis.setStocksList(miGroup.stocks);\r\n\t\t*/\r\n\t}\r\n\r\n\tshowStocksAll = async () => {\r\n\t\tlet {store} = this.cApp;\r\n\t\tthis._listCaption = store.myAllCaption;\r\n\t\tthis.miGroup = undefined;\r\n\t\tthis.openStocksList();\r\n\t\tthis.setStocksList(store.stocksMyAll);\r\n\t}\r\n\r\n\tshowStocksBlock = async () => {\r\n\t\tlet {store} = this.cApp;\r\n\t\tlet renderRowRight = this.cApp.cCommon.renderBlockStock;\r\n\t\tthis._listCaption = store.myBlockCaption;\r\n\t\tthis.miGroup = undefined;\r\n\t\tthis.openStocksList(renderRowRight);\r\n\t\tawait this.cApp.store.loadMyBlock();\r\n\t\tthis.setStocksList(store.stocksMyBlock);\r\n\t}\r\n\r\n\tprivate openStocksList(renderRowRight?: (stock:Stock & StockValue) => JSX.Element, \r\n\t\trenderPageRight?: () => JSX.Element) {\r\n\t\trunInAction(() => {\r\n\t\t\t//this.listCaption = caption;\r\n\t\t\tthis.stocks = undefined;\r\n\t\t\tthis.openVPage(VStockList, {renderRowRight, renderPageRight});\r\n\t\t});\r\n\t}\r\n\r\n\tprivate setStocksList(stocks: IObservableArray<Stock&StockValue>) {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.stocks = stocks.sort((a, b) => {\r\n\t\t\t\tlet am = a.miRate;\r\n\t\t\t\tlet bm = b.miRate;\r\n\t\t\t\tif (am < bm) return 1;\r\n\t\t\t\tif (am > bm) return -1;\r\n\t\t\t\treturn 0;\r\n\t\t\t});\r\n\t\t\tlet len = this.stocks.length;\r\n\t\t\tfor (let i=0; i<len; i++) (this.stocks[i] as any).$order = i+1;\r\n\t\t})\r\n\t}\r\n\r\n\tonStockClick = async (stock: Stock) => {\r\n\t\tthis.cApp.cCommon.showStock(stock);\r\n\t}\r\n}\r\n","import { action, makeObservable, observable } from \"mobx\";\r\nimport { CApp, CUqBase } from \"uq-app\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { StockPageItems } from \"./stockPageItems\";\r\nimport { VFind } from \"./VFind\";\r\nimport { VStocksPage } from \"./VStocksPage\";\r\nimport { CGroup } from \"./group\";\r\n\r\ntype SearchOrder = 'miRateDesc' | 'miRateAsc' | 'dvRateDesc' | 'dvRateAsc' | 'roeDesc' | 'roeAsc';\r\nconst defaultSmooth = 0;\r\nexport interface SearchParam {\r\n\tkey: string;\r\n\tmarket: string;\r\n\t$orderSwitch: SearchOrder;\r\n\tsmooth: number;\r\n}\r\n\r\nexport class CFind extends CUqBase {\r\n\treadonly cGroup: CGroup;\r\n\treadonly cIndustries: CGroup;\r\n\theader: string = null;\r\n\tpageStocks: StockPageItems = null;\r\n\tsearchOrder: SearchOrder = 'miRateDesc';\r\n\tsearchParam: SearchParam;\r\n\tsmooth: number;\r\n\r\n\tconstructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tmakeObservable(this, {\r\n\t\t\theader: observable,\r\n\t\t\tsmooth: observable,\r\n\t\t\tloadSmooth: action,\r\n\t\t\tchangeSmooth: action,\r\n\t\t});\r\n\t\tthis.cGroup = this.newSub(CGroup);\r\n\t\tthis.cIndustries = this.newSub(CGroup);\r\n\t\tthis.loadSmooth();\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.renderView(VFind);\r\n\t}\r\n\r\n\tasync internalStart(param: any) {\r\n\t\tthis.openVPage(VFind);\r\n\t}\r\n\r\n\tloadSmooth() {\r\n\t\tlet t = localStorage.getItem('smooth');\r\n\t\tif (!t) this.smooth = defaultSmooth;\r\n\t\telse {\r\n\t\t\ttry {\r\n\t\t\t\tthis.smooth = Number.parseInt(t);\r\n\t\t\t}\r\n\t\t\tcatch {\r\n\t\t\t\tthis.smooth = defaultSmooth;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync changeSmooth(value: number) {\r\n\t\tif (this.smooth === value) return;\r\n\t\tthis.smooth = value;\r\n\t\tlocalStorage.setItem('smooth', String(value));\r\n\t\tthis.searchParam['smooth'] = value;\r\n\t\tawait this.research();\r\n\t}\r\n\r\n\tload = async () => { }\r\n\r\n\tasync research() {\r\n\t\tawait this.pageStocks.first(this.searchParam);\r\n\t}\r\n\r\n\tprivate async searchStock(header: string, market?: string[], key?: string) {\r\n\t\tthis.header = header;\r\n\t\tthis.searchParam = {\r\n\t\t\tkey,\r\n\t\t\tmarket: market?.join('\\n'),\r\n\t\t\t$orderSwitch: this.searchOrder,\r\n\t\t\tsmooth: key ? 0 : this.smooth,\r\n\t\t};\r\n\t\tthis.pageStocks = new StockPageItems(this.cApp.store);\r\n\t\tawait this.pageStocks.first(this.searchParam);\r\n\t\tthis.openVPage(VStocksPage);\r\n\t}\r\n\r\n\tonSearch = async (key: string) => {\r\n\t\tawait this.searchStock('搜索', ['sh', 'sz', 'hk', 'us'], key);\r\n\t}\r\n\r\n\tshowA = async () => {\r\n\t\tawait this.searchStock('A股', ['sh', 'sz']);\r\n\t}\r\n\tshowHK = async () => {\r\n\t\tawait this.searchStock('港股', ['hk']);\r\n\t}\r\n\tshowSH = async () => {\r\n\t\tawait this.searchStock('沪股', ['sh']);\r\n\t}\r\n\tshowSZ = async () => {\r\n\t\tawait this.searchStock('深股', ['sz']);\r\n\t}\r\n\tshowUS = async () => {\r\n\t\tawait this.searchStock('US', ['us']);\r\n\t}\r\n\tshowAll = async () => {\r\n\t\tawait this.searchStock('全部股票', ['sh', 'sz', 'hk', 'us']);\r\n\t}\r\n\r\n\tonClickStock = (stock: Stock & StockValue) => {\r\n\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { View } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VBlockStock extends View<CCommon> {\r\n\trender(stock: Stock & StockValue):JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet isBlock = this.controller.isMyBlock(stock);\r\n\t\t\tlet cn:string, content:string;\r\n\t\t\tif (isBlock === true) {\r\n\t\t\t\tcontent = '取消拉黑';\r\n\t\t\t\tcn = 'btn-outline-danger';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcontent = '拉黑';\r\n\t\t\t\tcn = 'btn-outline-secondary';\r\n\t\t\t}\r\n\t\t\treturn <button className={'btn btn-sm align-self-start ' + cn}\r\n\t\t\t\tonClick={() => this.controller.toggleBlock(stock)}>\r\n\t\t\t\t{content}\r\n\t\t\t</button>;\r\n\t\t}));\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VEmpty extends VPage<CCommon> {\r\n\theader() {\r\n\t\treturn 'Empty';\r\n\t}\r\n\tcontent() {\r\n\t\treturn <div>empty</div>;\r\n\t}\r\n}","import { MiAccount, MGroup } from \"store\";\r\nimport { FA, VPage } from \"tonva-react\";\r\nimport { Stock } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VKeepStock extends VPage<CCommon> {\r\n\tprivate param: {stock: Stock; miAccounts: MiAccount[]; miGroups: MGroup[]};\r\n\tinit(param: any) {\r\n\t\tthis.param = param;\r\n\t}\r\n\theader() {return '删除选股'}\r\n\tcontent() {\r\n\t\tlet {stock, miAccounts, miGroups} = this.param;\r\n\t\treturn <div className=\"py-3\">\r\n\t\t\t<div className=\"bg-white px-3 py-2 text-info\">\r\n\t\t\t\t<FA name=\"exclamation-circle\" className=\"mr-3 text-danger\" />\r\n\t\t\t\t<b className=\"text-primary\">{stock.name}</b> 无法从自选股删除\r\n\t\t\t</div>\r\n\t\t\t{\r\n\t\t\t\tmiAccounts.length > 0 && <>\r\n\t\t\t\t\t<div className=\"small px-3 mt-3 mb-1\">持仓</div>\r\n\t\t\t\t\t<div className=\"p-3 bg-white\">\r\n\t\t\t\t\t\t{miAccounts.map((v, index) => <span key={index} className=\"mr-3\">{v.name}</span>)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t{\r\n\t\t\t\tmiGroups.length > 0 && <>\r\n\t\t\t\t\t<div className=\"small px-3 mt-3 mb-1\">分组</div>\r\n\t\t\t\t\t<div className=\"p-3 bg-white\">\r\n\t\t\t\t\t\t{miGroups.map((v, index) => <span key={index} className=\"mr-3\">{v.name}</span>)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t</div>\r\n\t}\r\n}","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { FA, View } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VPinStock extends View<CCommon> {\r\n\trender(param: {stock: Stock & StockValue; closeLevelWhenRemoved: number}):JSX.Element {\r\n\t\tlet {stock, closeLevelWhenRemoved} = param;\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet isSelected = this.controller.isMyAll(stock);\r\n\t\t\tif (isSelected === true) {\r\n\t\t\t\t/*\r\n\t\t\t\treturn <DropdownActions actions={[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcaption: '修改分组',\r\n\t\t\t\t\t\taction: () => this.controller.setStockToGroup(stock),\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcaption: '删除自选',\r\n\t\t\t\t\t\taction: () => this.controller.removeMyAll(stock),\r\n\t\t\t\t\t},\r\n\t\t\t\t\tundefined,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcaption: '取消操作',\r\n\t\t\t\t\t\taction: () => {},\r\n\t\t\t\t\t}\r\n\t\t\t\t]} icon=\"cog\" content=\"分组\"\r\n\t\t\t\tclassName=\"cursor-pointer btn btn-sm btn-outline-info align-self-start\" />;\r\n\t\t\t\t*/\r\n\t\t\t\treturn <button className=\"btn btn-sm btn-outline-info align-self-start\" \r\n\t\t\t\t\tonClick={() => this.controller.setStockToGroup(stock, closeLevelWhenRemoved)}>\r\n\t\t\t\t\t<FA name=\"cog\" className=\"small mr-1\" fixWidth={true} />分组\r\n\t\t\t\t</button>;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn <button className=\"btn btn-sm btn-outline-primary align-self-start\" \r\n\t\t\t\t\tonClick={() => this.controller.toggleMyAll(stock)}>\r\n\t\t\t\t\t<FA name=\"plus\" className=\"small mr-1\" fixWidth={true} />自选\r\n\t\t\t\t</button>;\r\n\t\t\t}\t\r\n\t\t}));\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { LMR, VPage } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VStockInGroup extends VPage<CCommon> {\r\n\tprivate closeLevelWhenRemoved: number;\r\n\tinit(param: number) {\r\n\t\tthis.closeLevelWhenRemoved = param;\r\n\t}\r\n\r\n\theader() {return '设置分组'}\r\n\tright() {\r\n\t\treturn <button className=\"btn btn-sm btn-info mr-2\" onClick={this.controller.manageGroups}>管理分组</button>;\r\n\t}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {stock, cApp, setGroup, setStockToAccount, stockInAccounts} = this.controller;\r\n\t\t\tif (!stock) return <div>no stock, can set group</div>;\r\n\t\t\tlet {id:stockId, name, no} = stock;\r\n\t\t\tlet {store} = cApp;\r\n\t\t\tlet {miGroups, miAccounts} = store;\r\n\t\t\tlet {groups} = miGroups;\r\n\t\t\tlet {accounts} = miAccounts;\r\n\t\t\tlet inGroup = store.inAnyGroup(stockId);\r\n\t\t\t//let inAnyAccount = store.inAnyAccount(stockId);\r\n\t\t\tlet del = <button className=\"btn btn-sm btn-outline-info\"\r\n\t\t\t\tonClick={e => this.removeMyAll(stock, e.currentTarget)}>删除自选</button>;\r\n\t\t\treturn <div>\r\n\t\t\t\t<LMR className=\"p-3 align-items-center\" right={del}>\r\n\t\t\t\t\t<b>{name}</b> \r\n\t\t\t\t\t<span className=\"ml-3\">{no}</span>\r\n\t\t\t\t</LMR>\r\n\t\t\t\t<div className=\"px-3 mt-1 mb-1 text-muted small\">分组</div>\r\n\t\t\t\t<div className=\"d-flex flex-wrap py-1 border-top border-bottom bg-white\">\r\n\t\t\t\t\t{groups.length === 0 && <small className=\"px-3 py-2 text-muted\">[无分组]</small>}\r\n\t\t\t\t\t{groups.map(v => {\r\n\t\t\t\t\t\tlet {id, name} = v;\r\n\t\t\t\t\t\treturn <label key={id} className=\"mb-0 w-8c px-3 py-2\">\r\n\t\t\t\t\t\t\t<input className=\"mr-1\" \r\n\t\t\t\t\t\t\t\ttype=\"checkbox\" \r\n\t\t\t\t\t\t\t\tdefaultChecked={inGroup[id]}\r\n\t\t\t\t\t\t\t\tonChange={evt => setGroup(evt.currentTarget.checked, v)} />\r\n\t\t\t\t\t\t\t{name}\r\n\t\t\t\t\t\t</label>;\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{accounts?.length > 0 && <>\r\n\t\t\t\t\t<div className=\"px-3 mt-3 mb-1 text-muted small\">持仓账户</div>\r\n\t\t\t\t\t<div className=\"d-flex flex-wrap py-1 border-top border-bottom bg-white\">\r\n\t\t\t\t\t{accounts.map(v => {\r\n\t\t\t\t\t\tlet {id, name} = v;\r\n\t\t\t\t\t\tlet inAccount: boolean, everBought: boolean;\r\n\t\t\t\t\t\tlet iaa = stockInAccounts[id];\r\n\t\t\t\t\t\tif (iaa === undefined) {\r\n\t\t\t\t\t\t\tinAccount = false;\r\n\t\t\t\t\t\t\teverBought = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tinAccount = iaa[0];\r\n\t\t\t\t\t\t\teverBought = iaa[1];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn <label key={id} className=\"mb-0 w-8c px-3 py-2\">\r\n\t\t\t\t\t\t\t<input className=\"mr-1\" \r\n\t\t\t\t\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\t\t\t\t\tdisabled={everBought}\r\n\t\t\t\t\t\t\t\tdefaultChecked={inAccount}\r\n\t\t\t\t\t\t\t\tonChange={evt => setStockToAccount(evt.currentTarget.checked, v)} />\r\n\t\t\t\t\t\t\t{name}\r\n\t\t\t\t\t\t</label>;\r\n\t\t\t\t\t})}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t\t}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate async removeMyAll(stock: Stock & StockValue, btn: HTMLButtonElement) {\r\n\t\tbtn.disabled = true;\r\n\t\tlet callbackWhenRemoved = () => {\r\n\t\t\tthis.closePage(this.closeLevelWhenRemoved);\r\n\t\t}\r\n\t\tawait this.controller.removeMyAll(stock,  callbackWhenRemoved);\r\n\t\tbtn.disabled = false;\r\n\t}\r\n}","import { View } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CCommon } from \"./CCommon\";\r\n\r\nexport class VStockLink extends View<CCommon> {\r\n\trender(stock: Stock & StockValue):JSX.Element {\r\n\t\tlet {no} = stock;\r\n\t\tlet $market = (stock as any).$market;\r\n\t\tlet mn = $market.name;\r\n\t\tlet symbol = mn + no;\r\n\t\tlet url:string, title:string;\r\n\t\tswitch (mn) {\r\n            case 'us':\r\n\t\t\t\turl = `https://xueqiu.com/S/${no}`;\r\n\t\t\t\ttitle = '雪球';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'hk':\r\n\t\t\t\turl = `https://xueqiu.com/S/${no}`;\r\n\t\t\t\ttitle = '雪球';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\turl = `https://finance.sina.com.cn/realstock/company/${symbol}/nc.shtml`;\r\n\t\t\t\ttitle = '新浪财经';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn <a className=\"btn btn-sm btn-link d-sm-inline d-none\" href={url} target=\"_blank\" rel=\"noreferrer\">\r\n\t\t\t{title}\r\n\t\t</a>;\r\n\t}\r\n}\r\n","import { MiAccount, MiGroup } from \"store\";\r\nimport { IDUI } from \"tonva-react\";\r\nimport { CID, MidIXID } from \"tonva-uqui\";\r\nimport { renderGroup } from \"tool\";\r\nimport { CUqBase } from \"uq-app\";\r\nimport { Account, Group, Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { VBlockStock } from \"./VBlockStock\";\r\nimport { VEmpty } from \"./VEmpty\";\r\nimport { VKeepStock } from \"./VKeepStock\";\r\nimport { VPinStock } from \"./VPinStock\";\r\nimport { VStockInGroup } from \"./VStockInGroup\";\r\nimport { VStockLink } from \"./VStockLink\";\r\n\r\nexport class CCommon extends CUqBase {\r\n\tstock: Stock & StockValue;\r\n\tstockInAccounts: { [accountId: number]: [inAccount: boolean, everBought: boolean] };\r\n\r\n\tprotected async internalStart(param: any) {\r\n\t}\r\n\r\n\tisMyAll(stock: Stock & StockValue): boolean {\r\n\t\treturn this.cApp.store.isMyAll(stock);\r\n\t}\r\n\r\n\tasync addMyAll(stock: Stock & StockValue) {\r\n\t\tawait this.cApp.store.addMyAll(stock);\r\n\t}\r\n\r\n\tasync removeMyAll(stock: Stock & StockValue, callbackWhenRemoved?: () => any) {\r\n\t\tlet ret = await this.cApp.store.removeMyAll(stock);\r\n\t\tif (ret) {\r\n\t\t\t(ret as any).stock = stock;\r\n\t\t\tthis.openVPage(VKeepStock, ret);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcallbackWhenRemoved?.();\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleMyAll(stock: Stock & StockValue) {\r\n\t\tif (this.isMyAll(stock)) {\r\n\t\t\tthis.removeMyAll(stock);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.addMyAll(stock);\r\n\t\t}\r\n\t}\r\n\r\n\tisMyBlock(stock: Stock & StockValue): boolean {\r\n\t\treturn this.cApp.store.isMyBlock(stock);\r\n\t}\r\n\r\n\ttoggleBlock = async (stock: Stock & StockValue) => {\r\n\t\tlet { store } = this.cApp;\r\n\t\t// block 操作之前，确保载入。还有显示之前，确保载入\r\n\t\tawait store.toggleBlock(stock);\r\n\t}\r\n\r\n\tsetStockToGroup = async (stock: Stock & StockValue, closeLevelWhenRemoved: number) => {\r\n\t\tthis.stock = stock;\r\n\t\tlet { store } = this.cApp;\r\n\t\tthis.stockInAccounts = await store.loadStockInAccounts(stock.id);\r\n\t\tthis.openVPage(VStockInGroup, closeLevelWhenRemoved);\r\n\t}\r\n\r\n\tsetGroup = async (checked: boolean, group: MiGroup) => {\r\n\t\tlet { miGroups } = this.cApp.store;\r\n\t\tif (checked === true) {\r\n\t\t\tawait miGroups.addStockToGroup(this.stock, group);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait miGroups.removeStockFromGroup(this.stock, group);\r\n\t\t}\r\n\t}\r\n\r\n\tsetStockToAccount = async (checked: boolean, account: MiAccount) => {\r\n\t\tlet { miAccounts } = this.cApp.store;\r\n\t\tif (checked === true) {\r\n\t\t\tawait miAccounts.addStockToAccount(this.stock, account);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait miAccounts.removeStockFromAccount(this.stock, account);\r\n\t\t}\r\n\t}\r\n\r\n\tshowEmptyPage = () => {\r\n\t\tthis.openVPage(VEmpty);\r\n\t}\r\n\r\n\trenderPinStock = (stock: Stock & StockValue, closeLevelWhenRemoved: number) => {\r\n\t\tif (!stock) return null;\r\n\t\treturn this.renderView(VPinStock, { stock, closeLevelWhenRemoved });\r\n\t}\r\n\r\n\trenderBlockStock = (stock: Stock & StockValue) => {\r\n\t\tif (!stock) return null;\r\n\t\treturn this.renderView(VBlockStock, stock);\r\n\t}\r\n\r\n\tshowStock = async (stock: Stock) => {\r\n\t\tlet { id, name, no, rawId } = stock;\r\n\t\tlet market = (stock as any).$market;\r\n\t\tlet date = new Date();\r\n\t\t// let year = date.getFullYear();\r\n\t\t// let month = date.getMonth() + 1;\r\n\t\t// let dt = date.getDate();\r\n\t\tthis.cApp.showStock({\r\n\t\t\tid: id,\r\n            rawId: rawId, \r\n\t\t\tname,\r\n\t\t\tcode: no,\r\n\t\t\tmarket: market.name,\r\n\t\t\tsymbol: market.name + no,\r\n\t\t\tday: undefined, //year*10000 + month*100 + dt,\r\n\t\t\tstock\r\n\t\t} as any);\r\n\t}\r\n\r\n\tbuildCIDUserGroup(): CID<Group> {\r\n\t\tlet uq = this.uqs.BruceYuMi;\r\n\t\tlet IDUI: IDUI = {\r\n\t\t\tID: uq.Group,\r\n\t\t\tfieldCustoms: {\r\n\t\t\t\tno: { hiden: true },\r\n\t\t\t\ttype: { hiden: true, defaultValue: '0' }\r\n\t\t\t},\r\n\t\t\tt: this.t,\r\n\t\t}\r\n\t\tlet ix = undefined;\r\n\t\tlet mId = new MidIXID<Group>(uq, IDUI, uq.UserGroup, ix);\r\n\t\tmId.listHeader = '管理股票分组';\r\n\t\tmId.itemHeader = '股票分组';\r\n\t\tlet cID = new CID(mId);\r\n\t\treturn cID;\r\n\t}\r\n\r\n\tmanageGroups = async () => {\r\n\t\tlet cID = this.buildCIDUserGroup();\r\n\t\tlet { renderItem, onItemClick } = cID;\r\n\t\tcID.renderItem = (item: Group, index: number) => renderGroup(item, index, renderItem);\r\n\t\tcID.onItemClick = (item: Group): void => onItemClick(item);\r\n\t\tlet changed = await cID.call();\r\n\t\tif (changed === true) {\r\n\t\t\tawait this.cApp.store.miGroups.load();\r\n\t\t}\r\n\t}\r\n\r\n\tbuildCIDUserAccount(): CID<Account> {\r\n\t\tlet uq = this.uqs.BruceYuMi;\r\n\t\tlet IDUI: IDUI = {\r\n\t\t\tID: uq.Account,\r\n\t\t\tfieldCustoms: {\r\n\t\t\t\tno: { hiden: true },\r\n\t\t\t},\r\n\t\t\tt: this.t,\r\n\t\t}\r\n\t\tlet ix = undefined;\r\n\t\tlet mId = new MidIXID<Account>(uq, IDUI, uq.UserAccount, ix);\r\n\t\tmId.listHeader = '管理持仓账号';\r\n\t\tmId.itemHeader = '持仓账号';\r\n\t\tlet cID = new CID(mId);\r\n\t\treturn cID;\r\n\t}\r\n\r\n\tmanageAccounts = async () => {\r\n\t\tlet cID = this.buildCIDUserAccount();\r\n\t\tlet changed = await cID.call();\r\n\t\tif (changed === true) {\r\n\t\t\tawait this.cApp.store.miAccounts.load();\r\n\t\t}\r\n\t}\r\n\r\n\trenderStockLink(stock: Stock) {\r\n\t\treturn this.renderView(VStockLink, stock);\r\n\t}\r\n}\r\n","import { Store } from \"store\";\r\nimport { PageItems } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { SearchParam } from './CTrack';\r\n\r\nexport class StockPageItems extends PageItems<Stock & StockValue> {\r\n\tprivate store: Store;\r\n\r\n\tconstructor(store: Store) {\r\n\t\tsuper(false);\r\n\t\tthis.store = store;\r\n\t\tthis.firstSize = 50;\r\n\t\tthis.pageSize = 20;\r\n\t}\r\n\t\r\n\tprotected getPageId(item:Stock):any {\r\n\t\treturn (item as unknown as any)?.$order;\r\n\t}\r\n\r\n\tprotected async loadResults (param:SearchParam, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.store.searchTrackStock(\r\n\t\t\t{...param, smooth: param.smooth + 1}\r\n\t\t\t, pageStart, pageSize);\r\n\t\treturn ret as any;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { DropdownAction, DropdownActions, FA, LMR, SearchBox, VPage } from \"tonva-react\";\r\nimport { CTrack } from \"./CTrack\";\r\n\r\nexport class VTrack extends VPage<CTrack> {\r\n\theader() {return React.createElement(observer(() => <div className=\"ml-3\"> 回溯日期：{this.controller.trackDay}</div>))}\r\n\tcontent() {\r\n\t\tlet { showA, showSH, showSZ, showAll, cGroup, cIndustries } = this.controller;\r\n\t\tlet buttons: [string, () => Promise<void>][] = [\r\n\t\t\t['A股', showA],\r\n\t\t\t['沪A', showSH],\r\n\t\t\t['深A', showSZ],\r\n\t\t\t['全部', showAll],\r\n\t\t];\r\n\t\tlet renderButton = (caption: string, onClick: () => void) => <button key={caption}\r\n\t\t\tclassName=\"btn btn-outline-info m-1\"\r\n\t\t\tonClick={onClick}>\r\n\t\t\t{caption}\r\n\t\t</button>;\r\n\t\treturn <div className=\"bg-light\">\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t<SearchBox className=\"mb-0\" initKey={this.controller.trackDay.toString()} onSearch={this.controller.onSetTrackDay} placeholder=\"yyyymmdd\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t<SearchBox className=\"mb-0\" onSearch={this.controller.onSearch} placeholder=\"股票代码，名称\" />\r\n\t\t\t</div>\r\n\t\t\t<div className=\"p-2 mb-2 d-flex flex-wrap bg-white border-top border-bottom\">\r\n\t\t\t\t{buttons.map(v => {\r\n\t\t\t\t\tlet [caption, show] = v;\r\n\t\t\t\t\treturn renderButton(caption, show);\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t{this.renderMyAll()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"small text-muted px-3 mb-1\">分组</div>\r\n\t\t\t<div className=\" mb-3 px-1 pb-1 bg-white border-top border-bottom\">\r\n\t\t\t\t{cGroup.renderGroups()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t{this.renderMyBlock()}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderMyAll() {\r\n\t\tlet { cApp, cGroup } = this.controller;\r\n\t\tlet { showStocksAll } = cGroup;\r\n\t\tlet { stocksMyAll, myAllCaption } = cApp.store;\r\n\t\treturn this.renderSpec(stocksMyAll?.length, myAllCaption, 'home', 'text-primary', showStocksAll);\r\n\t}\r\n\r\n\tprivate renderMyBlock() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet { cApp, cGroup } = this.controller;\r\n\t\t\tlet { showStocksBlock } = cGroup;\r\n\t\t\tlet { stocksMyBlock, myBlockCaption } = cApp.store;\r\n\t\t\treturn this.renderSpec(stocksMyBlock?.length, <>\r\n\t\t\t\t<span className=\"mr-3\">{myBlockCaption}</span>\r\n\t\t\t\t<small className=\"text-muted\">选股时不列出</small>\r\n\t\t\t</>,\r\n\t\t\t\t'ban', 'text-black', showStocksBlock);\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate renderSpec(count: number, text: string | JSX.Element, icon: string, color: string, click: () => void) {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet right = count > 0 && <small className=\"align-self-center mx-3 text-muted\">{count}</small>;\r\n\t\t\tlet cn = \"align-self-center ml-3 \" + color;\r\n\t\t\treturn <div className=\"mt-2 bg-white cursor-pointer\" onClick={click}>\r\n\t\t\t\t<LMR left={<FA name={icon} className={cn} size=\"lg\" fixWidth={true} />} right={right}>\r\n\t\t\t\t\t<div className=\"px-3 py-2\">{text}</div>\r\n\t\t\t\t</LMR>\r\n\t\t\t</div>\r\n\t\t}));\r\n\t}\r\n\r\n\tright() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet { cCommon } = this.controller.cApp;\r\n\t\t\tlet actions: DropdownAction[] = [\r\n\t\t\t\t{\r\n\t\t\t\t\tcaption: '管理股票分组',\r\n\t\t\t\t\taction: cCommon.manageGroups,\r\n\t\t\t\t\ticon: 'object-group',\r\n\t\t\t\t},\r\n                {\r\n\t\t\t\t\tcaption: '跳到下一周',\r\n\t\t\t\t\taction: this.controller.onNextTrackDay,\r\n\t\t\t\t\ticon: 'calendar-plus-o',\r\n                },\r\n\t\t\t];\r\n\t\t\treturn <DropdownActions actions={actions} icon=\"bars\" className=\"mr-2 text-white bg-transparent border-0\" />;\r\n\t\t}));\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { FA, List, Scroller, SearchBox, VPage } from \"tonva-react\";\r\nimport { renderStockRow } from \"tool\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CTrack } from \"./CTrack\";\r\n\r\nconst cnStar = 'small border rounded py-1 px-2 mr-3 ';\r\n\r\nexport class VStocksPage extends VPage<CTrack> {\r\n    header() {\r\n        let { header, trackDay } = this.controller;\r\n        let str = header + ' - 日期: ';\r\n        str += trackDay !== undefined ? trackDay.toString() : '';\r\n\r\n        return React.createElement(observer(() => <span className=\"\">{str}</span>))\r\n    }\r\n    content() {\r\n        let { pageStocks, onClickStock } = this.controller;\r\n        return <div className=\"pt-1 pb-3\">\r\n            {this.renderStars()}\r\n            <List items={pageStocks} item={{ render: this.renderStock, onClick: onClickStock }} />\r\n        </div>\r\n    }\r\n    right(): JSX.Element {\r\n        let { key } = this.controller.searchParam;\r\n        return <SearchBox className=\"mr-2 w-max-10c\"\r\n            onSearch={this.searchInGroup}\r\n            initKey={key}\r\n            placeholder={key ? '搜索' : this.controller.header + '中搜索'} />;\r\n    }\r\n\r\n    private searchInGroup = async (key: string) => {\r\n        let { searchParam } = this.controller;\r\n        searchParam.key = key;\r\n        await this.controller.research();\r\n    }\r\n\r\n    private renderStars(): JSX.Element {\r\n        return React.createElement(observer(() => {\r\n            let { smooth } = this.controller;\r\n            let stars: number[] = [];\r\n            for (let i = 0; i < 5; i++) stars[i] = 4 - i;\r\n            return <div className=\"px-3 py-1 d-sm-flex d-block\">\r\n                <div className=\"d-flex py-1\">\r\n                    {\r\n                        stars.map(v => {\r\n                            let cn: string, icon: string;\r\n                            if (v === smooth) {\r\n                                icon = 'star';\r\n                                cn = cnStar + ' text-warning border-primary bg-white';\r\n                            }\r\n                            else if (v < smooth) {\r\n                                cn = cnStar + ' cursor-pointer text-muted ';\r\n                                icon = 'star-o';\r\n                            }\r\n                            else {\r\n                                cn = cnStar + ' cursor-pointer text-warning bg-white';\r\n                                icon = 'star';\r\n                            }\r\n                            return <div key={v} className={cn} onClick={() => this.controller.changeSmooth(v)}>\r\n                                {v === 0 ? '全部' : <>{v}<FA name={icon} /></>}\r\n                            </div>\r\n                        })\r\n                    }\r\n                </div>\r\n                <div className=\"text-muted small py-1 ml-auto align-self-center\">\r\n                    <FA name=\"star-o\" /> 近五年分红增长持续度\r\n                </div>\r\n            </div>;\r\n        }));\r\n    }\r\n    //<button onClick={this.controller.cApp.cCommon.showEmptyPage}>test</button>\r\n\r\n    private renderStock = (stock: Stock & StockValue): JSX.Element => {\r\n        let pinStock = this.controller.cApp.cCommon.renderPinStock(stock, 1);\r\n        let { $order } = stock as any;\r\n        return renderStockRow($order, stock, this.onClickName, pinStock);\r\n    }\r\n\r\n    private onClickName = (stock: Stock & StockValue) => {\r\n        this.controller.cApp.openStock(stock, this.controller.trackDay);\r\n    }\r\n\r\n    protected async onPageScrollBottom(scroller: Scroller): Promise<void> {\r\n        await this.controller.pageStocks.more();\r\n    }\r\n}\r\n/*\r\n<button className=\"btn btn-sm btn-outline-primary\" \r\nonClick={() => this.controller.selectStock(stock)}>\r\n<FA name=\"cog\" className=\"text-warning small\" /> 设自选\r\n</button>\r\n*/","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { FA, List, View } from \"tonva-react\";\r\nimport { CGroup } from \"./CGroup\";\r\nimport { MGroup } from \"store/mGroup\";\r\n\r\nconst pos = {right:\"-1.0rem\", bottom:\"-0.3rem\"};\r\n\r\nexport class VGroups extends View<CGroup> {\r\n\trender(groups: MGroup[]):JSX.Element {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\treturn <List items={groups} \r\n\t\t\t\titem={{render: this.renderGroup, onClick:(group) => this.onGroupClick(group)}} \r\n\t\t\t\tclassName=\"d-flex flex-wrap bg-white p-1\" />;\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected onGroupClick(group: MGroup) {\r\n\t\tthis.controller.showMiGroup(group);\r\n\t}\r\n\r\n\tprotected renderGroup = (group:MGroup, index: number):JSX.Element => {\r\n\t\tlet {name, count, type} = group;\r\n\t\tlet left:any;\r\n\t\tswitch (type) {\r\n\t\t\tdefault:\r\n\t\t\tcase 'group':\r\n\t\t\t\tleft = <FA name=\"list-alt\" className=\"text-info align-self-center\" />;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'industry':\r\n\t\t\t\tleft = <FA name=\"leaf\" className=\"text-danger align-self-center\" />;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet fontStyle:React.CSSProperties;\r\n\t\tlet len = name.length;\r\n\t\tif (len >= 9) fontStyle = {fontSize: '50%'};\r\n\t\tif (len >= 8) fontStyle = {fontSize: '60%'};\r\n\t\telse if (len >= 7) fontStyle = {fontSize: '70%'};\r\n\t\telse if (len >= 6) fontStyle = {fontSize: '80%'};\r\n\t\tlet right = count > 0 && <small className=\"text-muted position-absolute\" style={pos}>{count}</small>;\r\n\t\treturn <div className=\"d-block w-min-6c w-max-6c text-center py-1 m-1 border rounded bg-white\">\r\n\t\t\t<span className=\"position-relative\">\r\n\t\t\t\t{left} {right}\r\n\t\t\t</span>\r\n\t\t\t<div className=\"\" style={fontStyle}>{name}</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { MGroup } from \"store/mGroup\";\r\nimport { VGroups } from './VGroups';\r\n\r\nexport class VRootIndustry extends VGroups {\r\n\tprotected onGroupClick(group: MGroup) {\r\n\t\tthis.controller.showRootIndustry(group);\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport { observer } from \"mobx-react\";\r\nimport { List, VPage } from \"tonva-react\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { renderStockRow } from \"tool\";\r\nimport { CGroup } from \"./CGroup\";\r\nimport { VRootIndustry } from \"./VRootIndustry\";\r\n\r\nexport class VStockList extends VPage<CGroup> {\r\n\tprivate renderRowRight: (stock: Stock & StockValue) => JSX.Element;\r\n\tprivate renderPageRight: () => JSX.Element;\r\n\tinit(param: {\r\n\t\trenderRowRight: (stock: Stock & StockValue) => JSX.Element;\r\n\t\trenderPageRight: () => JSX.Element;\r\n\t}) {\r\n\t\tlet {renderRowRight, renderPageRight} = param;\r\n\t\tthis.renderRowRight = renderRowRight;\r\n\t\tthis.renderPageRight = renderPageRight;\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn React.createElement(observer(() => <>{this.controller.listCaption}</>));\r\n\t}\r\n\tright(): JSX.Element {\r\n\t\treturn this.renderPageRight?.();\r\n\t}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {miGroup, stocks} = this.controller;\r\n\t\t\tlet vGroups: any;\r\n\t\t\tif (miGroup) {\r\n\t\t\t\tlet {groups} = miGroup;\r\n\t\t\t\tif (groups) {\r\n\t\t\t\t\tvGroups = this.renderVm(VRootIndustry, groups);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn <div>\r\n\t\t\t\t{vGroups}\r\n\t\t\t\t<List items={stocks} item={{render: this.renderStock}} />\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate onClickName = (stock:Stock) => {\r\n\t\tthis.controller.onStockClick(stock);\r\n\t}\r\n\r\n\tprivate renderStock = (stock:Stock & StockValue, index:number) => {\r\n\t\tlet right = this.renderRowRight?.(stock);\r\n\t\tlet {$order} = stock as unknown as any;\r\n\t\treturn renderStockRow($order, stock as Stock & StockValue, this.onClickName, right);\r\n\t}\r\n}\r\n","import { action, computed, IObservableArray, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { MiAccount, MGroup, HoldingStock } from \"../../store\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { CApp, CUqSub, UQs } from \"../../uq-app\";\r\nimport { CTrack } from \"../CTrack\";\r\nimport { VGroups } from \"./VGroups\";\r\nimport { VStockList } from \"./VStockList\";\r\nimport { VRootIndustry } from \"./VRootIndustry\";\r\n\r\nexport class CGroup extends CUqSub<CApp, UQs, CTrack> {\r\n\tmiGroup: MGroup = null;\r\n\tmiAccount: MiAccount = null;\r\n\tholdingStock: HoldingStock;\r\n\tstocks: IObservableArray<Stock & StockValue>;\r\n\r\n\tconstructor(cTrack: CTrack) {\r\n\t\tsuper(cTrack);\r\n\t\tmakeObservable(this, {\r\n\t\t\tmiGroup: observable,\r\n\t\t\tmiAccount: observable,\r\n\t\t\tstocks: observable,\r\n\t\t\tlistCaption: computed,\r\n\t\t\tshowMiGroup: action,\r\n\t\t\tshowStocksAll: action,\r\n\t\t});\r\n\t}\r\n\r\n\tasync internalStart(param: any) {\r\n\t}\r\n\r\n\tprivate _listCaption: string;\r\n\tget listCaption(): string {\r\n\t\treturn this._listCaption?? this.miGroup?.name;\r\n\t}\r\n\r\n\trenderGroups() {\r\n\t\tlet {miGroups} = this.cApp.store;\r\n\t\tlet {groups } = miGroups;\r\n\t\treturn this.renderView(VGroups, groups);\r\n\t}\r\n\r\n\t// renderIndustries() {\r\n\t// \tlet {industries} = this.cApp.store;\r\n\t// \tlet {groups} = industries;\r\n\t// \treturn this.renderView(VGroups, groups);\r\n\t// }\r\n\r\n\t// renderRootIndustries() {\r\n\t// \tlet {rootIndustries} = this.cApp.store;\r\n\t// \tlet {groups} = rootIndustries;\r\n\t// \treturn this.renderView(VRootIndustry, groups);\r\n\t// }\r\n\r\n\tshowMiGroup = async (miGroup: MGroup) => {\r\n\t\tthis._listCaption = undefined;\r\n\t\tthis.miGroup = miGroup;\r\n\r\n\t\tlet renderPageRight: () => JSX.Element;\r\n\t\tif (miGroup.type === 'group') {\r\n\t\t\trenderPageRight = () => {\r\n\t\t\t\tlet cID = this.cApp.cCommon.buildCIDUserGroup();\r\n\t\t\t\treturn cID.renderViewRight(miGroup);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.openStocksList(undefined, renderPageRight);\r\n\t\tawait miGroup.loadItems();\r\n\t\tthis.setStocksList(miGroup.stocks);\r\n\t}\r\n\r\n\tshowRootIndustry = async (miGroup: MGroup) => {\r\n\t\tlet cGroup = this.owner.newSub(CGroup);\r\n\t\tawait cGroup.showMiGroup(miGroup); //.start();\r\n\t\t/*\r\n\t\tthis._listCaption = undefined;\r\n\t\tthis.openStocksList(undefined);\r\n\t\tawait miGroup.loadItems();\r\n\t\tthis.setStocksList(miGroup.stocks);\r\n\t\t*/\r\n\t}\r\n\r\n\tshowStocksAll = async () => {\r\n\t\tlet {store} = this.cApp;\r\n\t\tthis._listCaption = store.myAllCaption;\r\n\t\tthis.miGroup = undefined;\r\n\t\tthis.openStocksList();\r\n\t\tthis.setStocksList(store.stocksMyAll);\r\n\t}\r\n\r\n\tshowStocksBlock = async () => {\r\n\t\tlet {store} = this.cApp;\r\n\t\tlet renderRowRight = this.cApp.cCommon.renderBlockStock;\r\n\t\tthis._listCaption = store.myBlockCaption;\r\n\t\tthis.miGroup = undefined;\r\n\t\tthis.openStocksList(renderRowRight);\r\n\t\tawait this.cApp.store.loadMyBlock();\r\n\t\tthis.setStocksList(store.stocksMyBlock);\r\n\t}\r\n\r\n\tprivate openStocksList(renderRowRight?: (stock:Stock & StockValue) => JSX.Element, \r\n\t\trenderPageRight?: () => JSX.Element) {\r\n\t\trunInAction(() => {\r\n\t\t\t//this.listCaption = caption;\r\n\t\t\tthis.stocks = undefined;\r\n\t\t\tthis.openVPage(VStockList, {renderRowRight, renderPageRight});\r\n\t\t});\r\n\t}\r\n\r\n\tprivate setStocksList(stocks: IObservableArray<Stock&StockValue>) {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.stocks = stocks.sort((a, b) => {\r\n\t\t\t\tlet am = a.miRate;\r\n\t\t\t\tlet bm = b.miRate;\r\n\t\t\t\tif (am < bm) return 1;\r\n\t\t\t\tif (am > bm) return -1;\r\n\t\t\t\treturn 0;\r\n\t\t\t});\r\n\t\t\tlet len = this.stocks.length;\r\n\t\t\tfor (let i=0; i<len; i++) (this.stocks[i] as any).$order = i+1;\r\n\t\t})\r\n\t}\r\n\r\n\tonStockClick = async (stock: Stock) => {\r\n\t\tthis.cApp.cCommon.showStock(stock);\r\n\t}\r\n}\r\n","import { action, makeObservable, observable } from \"mobx\";\r\nimport { CApp, CUqBase } from \"uq-app\";\r\nimport { Stock, StockValue } from \"uq-app/uqs/BruceYuMi\";\r\nimport { StockPageItems } from \"./stockPageItems\";\r\nimport { VTrack } from \"./VTrack\";\r\nimport { VStocksPage } from \"./VStocksPage\";\r\nimport { CGroup } from \"./group\";\r\n\r\ntype SearchOrder = 'miRateDesc' | 'miRateAsc' | 'dvRateDesc' | 'dvRateAsc' | 'roeDesc' | 'roeAsc';\r\nconst defaultSmooth = 0;\r\nexport interface SearchParam {\r\n\tkey: string;\r\n\tmarket: string;\r\n\t$orderSwitch: SearchOrder;\r\n\tsmooth: number;\r\n    day: number;\r\n}\r\n\r\nexport class CTrack extends CUqBase {\r\n\treadonly cGroup: CGroup;\r\n\treadonly cIndustries: CGroup;\r\n\theader: string = null;\r\n\tpageStocks: StockPageItems = null;\r\n\tsearchOrder: SearchOrder = 'miRateDesc';\r\n\tsearchParam: SearchParam;\r\n\tsmooth: number;\r\n    trackDay: number = 20100108;\r\n\r\n\tconstructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tmakeObservable(this, {\r\n\t\t\theader: observable,\r\n\t\t\tsmooth: observable,\r\n            trackDay: observable,\r\n\t\t\tloadSmooth: action,\r\n\t\t\tchangeSmooth: action,\r\n\t\t});\r\n\r\n        let ltd = localStorage.getItem('_trackday');\r\n        if (ltd !== undefined && ltd !== null) {\r\n            let d = parseInt(ltd);\r\n            if (d >= 20050101 && d < 40000000) {\r\n                this.trackDay = d;\r\n            }\r\n        }\r\n        \r\n\t\tthis.cGroup = this.newSub(CGroup);\r\n\t\tthis.cIndustries = this.newSub(CGroup);\r\n\t\tthis.loadSmooth();\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.renderView(VTrack);\r\n\t}\r\n\r\n\tasync internalStart(param: any) {\r\n\t\tthis.openVPage(VTrack);\r\n\t}\r\n\r\n\tloadSmooth() {\r\n\t\tlet t = localStorage.getItem('smooth');\r\n\t\tif (!t) this.smooth = defaultSmooth;\r\n\t\telse {\r\n\t\t\ttry {\r\n\t\t\t\tthis.smooth = Number.parseInt(t);\r\n\t\t\t}\r\n\t\t\tcatch {\r\n\t\t\t\tthis.smooth = defaultSmooth;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync changeSmooth(value: number) {\r\n\t\tif (this.smooth === value) return;\r\n\t\tthis.smooth = value;\r\n\t\tlocalStorage.setItem('smooth', String(value));\r\n\t\tthis.searchParam['smooth'] = value;\r\n\t\tawait this.research();\r\n\t}\r\n\r\n\tload = async () => { }\r\n\r\n\tasync research() {\r\n\t\tawait this.pageStocks.first(this.searchParam);\r\n\t}\r\n\r\n\tprivate async searchStock(header: string, market?: string[], key?: string) {\r\n\t\tthis.header = header;\r\n\t\tthis.searchParam = {\r\n            day: this.trackDay,\r\n\t\t\tkey,\r\n\t\t\tmarket: market?.join('\\n'),\r\n\t\t\t$orderSwitch: this.searchOrder,\r\n\t\t\tsmooth: key ? 0 : this.smooth,\r\n\t\t};\r\n\t\tthis.pageStocks = new StockPageItems(this.cApp.store);\r\n\t\tawait this.pageStocks.first(this.searchParam);\r\n\t\tthis.openVPage(VStocksPage);\r\n\t}\r\n\r\n    onPickTrackDay = async (date: Date) => {\r\n        let day = date.getFullYear() * 10000 + (date.getMonth()+1) * 100 + date.getDate();\r\n        if (day === this.trackDay) {\r\n            return date;\r\n        }\r\n        if (day < 20050100) {\r\n            day = 20050101;\r\n        }\r\n        let days = await this.cApp.store.getNextTradedays(day) as {day: number}[];\r\n        if (Array.isArray(days) && days.length > 0) {\r\n            day = days[0].day;\r\n            let y = Math.floor(day / 10000);\r\n            let m = Math.floor((day % 10000) / 100);\r\n            let d = Math.floor(day % 100);\r\n            let date = new Date(y, m - 1, d);\r\n            let w = date.getDay();\r\n            let dif = 0;\r\n            if (w === 5) {\r\n            }\r\n            else {\r\n                if (w === 6) {\r\n                    dif = 6;\r\n                }\r\n                else {\r\n                    dif = 5 - w;\r\n                }\r\n                date.setTime(date.valueOf() + dif * 86400000);\r\n                y = date.getFullYear();\r\n                m = date.getMonth() + 1;\r\n                d = date.getDate();\r\n            }\r\n        \r\n            let fday = y * 10000 + m * 100 + d;\r\n            if (fday > day) {\r\n                let ni = 1;\r\n                let length = days.length;\r\n                while (ni < length) {\r\n                    let nitem = days[ni];\r\n                    let nday = nitem.day;\r\n                    if (nday > fday) {\r\n                        break;\r\n                    }\r\n                    day = nday;\r\n                    if (day === fday) {\r\n                        break;\r\n                    }\r\n                    ni++;\r\n                }\r\n            }\r\n                \r\n        }\r\n        this.trackDay = day;\r\n        localStorage.setItem('_trackday', String(this.trackDay));\r\n        let y = Math.floor(day / 10000);\r\n        let m = Math.floor((day % 10000) / 100);\r\n        let d = Math.floor(day % 100);\r\n        return new Date(y, m - 1, d);\r\n    }\r\n\r\n    onSetTrackDay = async (key: string) => {\r\n        let day = parseInt(key);\r\n        if (day === undefined || isNaN(day) || day < 20050100) {\r\n            day = 20050101;\r\n        }\r\n        let days = await this.cApp.store.getNextTradedays(day) as {day: number}[];\r\n        if (Array.isArray(days) && days.length > 0) {\r\n            day = days[0].day;\r\n            let y = Math.floor(day / 10000);\r\n            let m = Math.floor((day % 10000) / 100);\r\n            let d = Math.floor(day % 100);\r\n            let date = new Date(y, m - 1, d);\r\n            let w = date.getDay();\r\n            let dif = 0;\r\n            if (w === 5) {\r\n            }\r\n            else {\r\n                if (w === 6) {\r\n                    dif = 6;\r\n                }\r\n                else {\r\n                    dif = 5 - w;\r\n                }\r\n                date.setTime(date.valueOf() + dif * 86400000);\r\n                y = date.getFullYear();\r\n                m = date.getMonth() + 1;\r\n                d = date.getDate();\r\n            }\r\n        \r\n            let fday = y * 10000 + m * 100 + d;\r\n            if (fday > day) {\r\n                let ni = 1;\r\n                let length = days.length;\r\n                while (ni < length) {\r\n                    let nitem = days[ni];\r\n                    let nday = nitem.day;\r\n                    if (nday > fday) {\r\n                        break;\r\n                    }\r\n                    day = nday;\r\n                    if (day === fday) {\r\n                        break;\r\n                    }\r\n                    ni++;\r\n                }\r\n            }\r\n                \r\n        }\r\n        this.trackDay = day;\r\n        localStorage.setItem('_trackday', String(this.trackDay));\r\n    }\r\n\r\n    onNextTrackDay = async() => {\r\n        let keyDay = this.trackDay;\r\n        if (keyDay === undefined) {\r\n            keyDay = 20050101;\r\n        }\r\n        else {\r\n            keyDay = keyDay + 1;\r\n        }\r\n\r\n        await this.onSetTrackDay(keyDay.toString());\r\n    }\r\n\r\n\tonSearch = async (key: string) => {\r\n\t\tawait this.searchStock('搜索', ['sh', 'sz', 'bj'], key);\r\n\t}\r\n\r\n\tshowA = async () => {\r\n\t\tawait this.searchStock('A股', ['sh', 'sz']);\r\n\t}\r\n\tshowSH = async () => {\r\n\t\tawait this.searchStock('沪股', ['sh']);\r\n\t}\r\n\tshowSZ = async () => {\r\n\t\tawait this.searchStock('深股', ['sz']);\r\n\t}\r\n\tshowAll = async () => {\r\n\t\tawait this.searchStock('全部股票', ['sh', 'sz', 'bj']);\r\n\t}\r\n\r\n\tonClickStock = (stock: Stock & StockValue) => {\r\n\r\n\t}\r\n}\r\n","import { CBug } from \"./bug\";\r\nimport { CUqApp } from \"./CBase\";\r\nimport { res } from \"./res\";\r\nimport { VMain } from \"./VMain\";\r\nimport { CTester } from \"./test-uqui\";\r\nimport { setUI } from \"./uqs\";\r\nimport { CMe } from '../me';\r\nimport { Store } from 'store';\r\nimport { CHome } from '../home';\r\nimport { CStockInfo, NStockInfo } from \"stockinfo\";\r\nimport { CFind } from \"find\";\r\nimport { Stock, StockValue } from \"./uqs/BruceYuMi\";\r\nimport { CCommon } from \"../common\";\r\nimport { CTrack } from \"track\";\r\n\r\n//const gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport class CApp extends CUqApp {\r\n\t//cHome: CHome;\r\n\tcBug: CBug;\r\n\tcMe: CMe;\r\n\tcUI: CTester;\r\n\t//cGroup: CGroup;\r\n\tcHome: CHome;\r\n\tcFind: CFind;\r\n\tcCommon: CCommon;\r\n\tstore: Store;\r\n    cTrack: CTrack;\r\n\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tthis.setRes(res);\r\n\t\tsetUI(this.uqs);\r\n\t\tthis.store = new Store(this.uqs, this.user);\r\n\t\tawait this.store.load();\r\n\t\t\r\n\t\tthis.cHome = this.newC(CHome);\r\n\t\tthis.cFind = this.newC(CFind);\r\n\t\tthis.cMe = this.newC(CMe);\r\n\t\tthis.cCommon = this.newC(CCommon);\r\n        this.cTrack = this.newC(CTrack);\r\n\t\tif (this.isDev === true) {\r\n\t\t\tthis.cBug = this.newC(CBug);\r\n\t\t\tthis.cUI = this.newC(CTester) as CTester;\r\n\t\t}\r\n\r\n\t\tthis.openVPage(VMain, undefined, this.dispose);\r\n\t\t// 加上下面一句，可以实现主动页面刷新\r\n\t\t// this.timer = setInterval(this.callTick, 1000);\r\n\t\t// uq 里面加入这一句，会让相应的$Poked查询返回poke=1：\r\n\t\t// TUID [$User] ID (member) SET poke=1;\r\n\t}\r\n\r\n\tprivate timer:any;\r\n\tprotected onDispose() {\r\n\t\tclearInterval(this.timer);\r\n\t\tthis.timer = undefined;\r\n\t}\r\n\r\n\tprivate tick = 0;\r\n\tprivate gapIndex = 0;\r\n\t/*\r\n\tprivate callTick = async () => {\r\n\t\ttry {\r\n\t\t\tif (!this.user) return;\r\n\t\t\t++this.tick;\r\n\t\t\tif (this.tick<gaps[this.gapIndex]) return;\r\n\t\t\t//console.error('tick ', new Date());\r\n\t\t\tthis.tick = 0;\r\n\t\t\tif (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n\t\t\tlet ret = await this.uqs.BzHelloTonva.$poked.query(undefined, false);\r\n\t\t\tlet v = ret.ret[0];\r\n\t\t\tif (v === undefined) return;\r\n\t\t\tif (!v.poke) return;\r\n\t\t\tthis.gapIndex = 1;\r\n\r\n\t\t\t// 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n\t\t\t//this.cHome.refresh();\r\n\t\t}\r\n\t\tcatch {\r\n\t\t}\r\n\t}\r\n\t*/\r\n\r\n\tshowStock = async (item: NStockInfo) => {\r\n\t\tawait this.store.loadMyBlock();\r\n\t\tlet cStockInfo = this.newC(CStockInfo);\r\n\t\tcStockInfo.start(item);\r\n\t}\r\n\r\n\topenStock = (stock: Stock & StockValue, trackDay?: number) => {\r\n\t\tlet {id, name, no, rawId} = stock;\r\n        let market = (stock as any).$market;\r\n        let day = trackDay;\r\n        if (day === undefined) {\r\n\t\t    let date = new Date();\r\n            let year = date.getFullYear();\r\n            let month = date.getMonth() + 1;\r\n            let dt = date.getDate();\r\n            day = year*10000 + month*100 + dt;\r\n        }\r\n\t\tthis.showStock({\r\n\t\t\tid: id,\r\n            rawId: rawId, \r\n\t\t\tname,\r\n\t\t\tcode: no,\r\n            market: market.name,\r\n\t\t\tsymbol: market.name + no,\r\n\t\t\tday: day,\r\n            trackDay: trackDay,\r\n\t\t\tstock\r\n\t\t} as any);\r\n\t}\r\n}\r\n","//=== UqApp builder created on Thu Jan 06 2022 23:34:08 GMT-0500 (北美东部标准时间) ===//\r\nimport * as BruceYuMi from './BruceYuMi';\r\n\r\nexport interface UQs {\r\n\tBruceYuMi: BruceYuMi.UqExt;\r\n}\r\n\r\nexport * as BruceYuMi from './BruceYuMi';\r\n\r\nexport function setUI(uqs:UQs) {\r\n\tBruceYuMi.setUI(uqs.BruceYuMi);\r\n}\r\n","//=== UqApp builder created on Wed Mar 10 2021 16:02:48 GMT-0500 (GMT-05:00) ===//\r\nimport { NavView, start, nav } from 'tonva-react';\r\nimport { CApp } from './CApp';\r\nimport { appConfig } from './appConfig';\r\n\r\nexport const App: React.FC = () => {\r\n\tnav.setSettings(appConfig);\r\n\tconst onLogined = async (isUserLogin?:boolean) => {\r\n\t\tawait start(CApp, appConfig, isUserLogin);\r\n\t}\r\n\treturn <NavView onLogined={onLogined} />;\r\n}\r\n\r\n","export const consts = {\r\n    uqBasedata: \"bruce/mi\",\r\n    appIcon: 'https://tv.jkchemical.com/imgs/Bear-icon.png',\r\n    miApiHost: 'https://mi.jjol.cn/',\r\n    miApiHostDebug: 'http://localhost:6011/',\r\n}\r\n","import { FetchError } from './fetchError';\r\nimport { HttpChannelUI } from './httpChannelUI';\r\nimport { env, nav } from 'tonva-react';\r\n\r\nexport async function httpGet(url: string, params?: any): Promise<any> {\r\n    let channel = new HttpChannel(url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url: string, params?: any): Promise<any> {\r\n    let channel = new HttpChannel(url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n\r\nexport class HttpChannel {\r\n    private hostUrl: string;\r\n    private apiToken: string;\r\n    private ui?: HttpChannelUI;\r\n    private timeout: number;\r\n\r\n    constructor(hostUrl: string, apiToken: string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true ? 500000 : 20000;\r\n    }\r\n\r\n    private startWait = () => {\r\n        if (this.ui !== undefined) this.ui.startWait();\r\n    }\r\n\r\n    private endWait = (url?: string, reject?: (reason?: any) => void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error: FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async get(url: string, params: any = undefined): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetch(url, options);\r\n    }\r\n\r\n    async post(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetch(url, options);\r\n    }\r\n\r\n    async put(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetch(url, options);\r\n    }\r\n\r\n    async delete(url: string, params: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetch(url, options);\r\n    }\r\n    async fetch(url: string, options: any, resolve: (value?: any) => any, reject: (reason?: any) => void): Promise<void> {\r\n        let that = this;\r\n        this.startWait();\r\n        let path = url;\r\n        function buildError(err: string) {\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s %s', options.method, path);\r\n            let timeOutHandler = setTimeout(() => that.endWait(url, reject), this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                clearTimeout(timeOutHandler);\r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json') >= 0) {\r\n                return res.json().then(async retJson => {\r\n                    clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        return resolve(retJson.res);\r\n                    }\r\n                    if (retJson.error === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retJson.error));\r\n                        reject(retJson.error);\r\n                    }\r\n                    //throw retJson.error;\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error.message));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                clearTimeout(timeOutHandler);\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch (error) {\r\n            if (typeof error === 'string') {\r\n                if (error.toLowerCase().startsWith('unauthorized') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            await this.showError(buildError((error as any).message));\r\n        };\r\n    }\r\n\r\n    private async innerFetch(url: string, options: any): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, resolve, reject);\r\n        });\r\n    }\r\n\r\n    async callFetch(url: string, method: string, body: any): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, resolve, reject);\r\n        });\r\n    }\r\n\r\n    private buildOptions(): any {\r\n        let { language, culture } = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) {\r\n            headers.append('Authorization', this.apiToken);\r\n        }\r\n        let options = {\r\n            headers: headers,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n}\r\n","import {nav} from 'tonva-react';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:any):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:any):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n}\r\n\r\n","//import {isDevelopment} from '../local';\r\nimport {HttpChannel} from './httpChannel';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:any, options:any, resolve:any, reject:any) {\r\n    await channel.fetch(url, options, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { HttpChannel } from './httpChannel';\r\nimport { HttpChannelNavUI } from './httpChannelUI';\r\nimport { ApiBase } from './apiBase';\r\n\r\nlet channelUIs: { [name: string]: HttpChannel } = {};\r\nlet channelNoUIs: { [name: string]: HttpChannel } = {};\r\n\r\nclass MiApiChannel extends ApiBase {\r\n\tprivate apiName: string;\r\n\turl: string;\r\n\r\n\tconstructor(url: string, basePath: string, apiName: string, uqToken: string, showWaiting?: boolean) {\r\n\t\tsuper(basePath, showWaiting);\r\n\t\tthis.showWaiting = showWaiting;\r\n\t\tthis.apiName = apiName;\r\n\t\tthis.token = uqToken;\r\n\t\tthis.url = url;\r\n\t}\r\n\r\n\tprotected async getHttpChannel(): Promise<HttpChannel> {\r\n\t\tlet channels: { [name: string]: HttpChannel };\r\n\t\tlet channelUI: HttpChannelNavUI;\r\n\t\tif (this.showWaiting === true || this.showWaiting === undefined) {\r\n\t\t\tchannels = channelUIs;\r\n\t\t\tchannelUI = new HttpChannelNavUI();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannels = channelNoUIs;\r\n\t\t}\r\n\t\tlet channel = channels[this.apiName];\r\n\t\tif (channel !== undefined) return channel;\r\n\t\tchannel = new HttpChannel(this.url, this.token, channelUI);\r\n\t\treturn channels[this.apiName] = channel;\r\n\t}\r\n}\r\n\r\nexport class MiApi {\r\n\tprivate channel: MiApiChannel;\r\n\r\n\tconstructor(url: string, basePath: string, apiName: string, uqToken: string, showWaiting?: boolean) {\r\n\t\tthis.channel = new MiApiChannel(url, basePath, apiName, uqToken, showWaiting);\r\n\t}\r\n\r\n\tasync call(name: string, params: any[]): Promise<any> {\r\n\t\tlet pbody = { call: name, params: params };\r\n\t\treturn await this.channel.post('sql/call', pbody);\r\n\t}\r\n\r\n\tasync query(name: string, params: any[]): Promise<any> {\r\n\t\tlet pbody = { call: name, params: params };\r\n\t\treturn await this.channel.post('sql/call', pbody);\r\n\t}\r\n\r\n\tasync page(name: string, params: any[], pageStart: number, pageSize: number): Promise<any> {\r\n\t\tlet p: any[];\r\n\t\tswitch (typeof params) {\r\n\t\t\tcase 'undefined': p = []; break;\r\n\t\t\tdefault: p = _.clone(params); break;\r\n\t\t}\r\n\t\tp.push(pageStart);\r\n\t\tp.push(pageSize);\r\n\t\tlet pbody = { call: name, params: p };\r\n\t\treturn await this.channel.post('sql/call', pbody);\r\n\t}\r\n\r\n\tasync process(proc: any, params: any[]): Promise<any> {\r\n\t\tlet pbody = { proc: proc, params: params };\r\n\t\treturn await this.channel.post('sql/query', pbody);\r\n\t}\r\n}\r\n","import { consts } from \"net/consts\";\r\nimport { User } from \"tonva-react\";\r\nimport { MiApi } from \"./miApi\";\r\n\r\nexport class MiNet {\r\n\tprivate miApi: MiApi;\r\n\tprivate user: User;\r\n\r\n\tconstructor(user: User) {\r\n\t\tlet miHost = consts.miApiHost;\r\n\t\tif (document.baseURI.indexOf('localmiserver') > 0) {\r\n\t\t\tmiHost = consts.miApiHostDebug;\r\n\t\t}\r\n\t\tthis.user = user;\r\n\t\tthis.miApi = new MiApi(miHost, 'miscan/', 'miapi', user.token, false);\r\n\t}\r\n\r\n\tget userId():number {return this.user.id;}\r\n\r\n\tasync process(proc:any, params:any[]) {\r\n\t\treturn await this.miApi.process(proc, params);\r\n\t}\r\n\r\n\tasync q_marketpe(param:any):Promise<{day:number, pe:number, e:number}[]> {\r\n\t\tlet rets = await this.miApi.query('q_marketpe', param) as {day:number, pe:number, e:number}[];\r\n\t\treturn rets;\r\n\t}\r\n\r\n\tasync t_toppredictavg$query(day:any):Promise<any[]> {\r\n\t\tlet ret = await this.miApi.call('t_toppredictavg$query', [day]);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync q_stocks$page(p:any, pageStart:any, pageSize:any):Promise<any> {\r\n\t\tlet ret = await this.miApi.page('q_stocks$page', p, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync q_stockallinfo(id:any, day:any) {\r\n\t\treturn this.miApi.query('q_stockallinfo', [id, day]);\r\n\t}\r\n\r\n\tasync q_stockallinfotrack(id:any, day:any) {\r\n\t\treturn this.miApi.query('q_stockallinfo@track', [id, day]);\r\n\t}\r\n\r\n    async t_tagstock$query(tagId:any, id:any) {\r\n\t\treturn this.miApi.query('t_tagstock$query', [this.user.id, tagId, id]) //this.uqs.mi.TagStock.query({ user: nav.user.id, stock: id })\r\n\t}\r\n\r\n\tasync t_tag$all() {\r\n\t\treturn await this.miApi.query('t_tag$all', [this.user.id]);\r\n\t}\r\n\r\n\tasync t_tag$save(name:string) {\r\n\t\treturn await this.miApi.call('t_tag$save', [this.user.id, undefined, name]);\r\n\t}\r\n\r\n\tasync t_tagstock$add(tagId:any, baseId:any) {\r\n\t\treturn await this.miApi.call('t_tagstock$add', [this.user.id, tagId, baseId]); //.uqs.mi.TagStock.add(param);\r\n\t}\r\n\r\n\tasync t_tagstock$del(tagId:any, baseId:any) {\r\n\t\treturn await this.miApi.call('t_tagstock$del', [this.user.id, tagId, baseId]); // //await this.uqs.mi.TagStock.del(param);\r\n\t}\r\n\r\n\tasync t_stockwarning$all() {\r\n\t\treturn await this.miApi.call('t_stockwarning$all', [this.user.id]);//await this.uqs.mi.StockWarningAll.query(undefined);\r\n\t}\r\n\r\n\tasync t_stockwarning$add(id:any, type:any, price:any) {\r\n\t\treturn await this.miApi.call('t_stockwarning$add', [this.user.id, id, type, price]);\r\n\t}\r\n\r\n\tasync t_usersettings$save(v:string) {\r\n\t\treturn await this.miApi.call('t_usersettings$save', [this.user.id, 'config', v]);\r\n\t}\r\n\r\n\tasync t_usersettings$query() {\r\n\t\treturn await this.miApi.query('t_usersettings$query', [this.user.id, 'config']);\r\n\t}\r\n\r\n\t// async t_allaccounts() {\r\n\t// \treturn await this.miApi.query('t_allaccounts', [this.user.id]);\r\n\t// }\r\n\r\n\tasync q_getlasttradeday() {\r\n\t\treturn await this.miApi.call('q_getlasttradeday', []);\r\n\t}\r\n\r\n    async q_getnexttradedays(day: number) {\r\n        return await this.miApi.call(`q_tradedays`, [day]);\r\n    }\r\n\r\n    async q_searchstock(day: number, user: number, pageStart: any, pageSize: number, orderSwitch?: string, key?: string, market?: string, smooth?: number) {\r\n        let ret = await this.miApi.call(`tv_searchstock`, [user, pageStart, pageSize, orderSwitch, key, market, smooth, day]);\r\n        if (Array.isArray(ret)) {\r\n            return {$page: ret};\r\n        }\r\n        else {\r\n            return { $page: [] };\r\n        }\r\n    }\r\n}\r\n","import { capitalCase } from \"../../tool\";\r\nimport { FieldItem, FieldUIType } from \"../../ui\";\r\n\r\nexport function buildFieldItem(field:any, isKey:boolean):FieldItem {\r\n\tlet $FieldItemType: string, fieldItemType: string, widget:FieldUIType;\r\n\tlet {name, type} = field;\r\n\tswitch (type) {\r\n\t\tcase 'id':\r\n\t\t\t$FieldItemType = 'FieldItemId';\r\n\t\t\tfieldItemType = 'id';\r\n\t\t\tbreak;\r\n\t\tcase 'char':\r\n\t\t\t$FieldItemType = 'FieldItemString';\r\n\t\t\tfieldItemType = 'string';\r\n\t\t\twidget = 'string';\r\n\t\t\tbreak;\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\t\t$FieldItemType = 'FieldItemInt';\r\n\t\t\tfieldItemType = 'integer';\r\n\t\t\twidget = 'updown';\r\n\t\t\tbreak;\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\t\t$FieldItemType = 'FieldItemNum';\r\n\t\t\tfieldItemType = 'number';\r\n\t\t\twidget = 'number';\r\n\t\t\tbreak;\r\n\t}\r\n\treturn {\r\n\t\tname,\r\n\t\ttype: fieldItemType,\r\n\t\tisKey,\r\n\t\twidget,\r\n\t\tlabel: capitalCase(name),\r\n\t\t$FieldItemType,\r\n\t} as FieldItem;\r\n}\r\n","import React from 'react';\r\nimport { nav } from '../components';\r\nimport { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: ()=>void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() {return this.isWebNav === true? false : '安全退出';}\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={nav.resetAll}>升级软件</button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}>安全退出</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport {Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax, nav} from '../components';\r\nimport { tonvaTop, getSender } from './tools';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\n\r\nconst schema: Schema = [\r\n    {name: 'username', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'password', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'login', type: 'submit'},\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n    private onLogin: (un:string, pwd:string) => Promise<boolean>;\r\n    private withBack: boolean;\r\n\r\n\tinit({onLogin, withBack}:{onLogin: (un:string, pwd:string) => Promise<boolean>; withBack: boolean;}) {\r\n\t\tthis.onLogin = onLogin;\r\n\t\tthis.withBack = withBack;\r\n\t}\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            username: {placeholder: '手机/邮箱/用户名', label: '登录账号'} as UiTextItem,\r\n            password: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\r\n            login: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录'} as UiButton,\r\n        }\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let un = values['username'];\r\n        let pwd = values['password'];\r\n        if (pwd === undefined) {\r\n            return 'something wrong, pwd is undefined';\r\n\t\t}\r\n\t\tlet ret = await this.onLogin(un, pwd);\r\n\t\tif (ret === true) return;\r\n\r\n\t\tlet sender = getSender(un);\r\n\t\tlet type:string = sender !== undefined? sender.caption : '用户名';\r\n\t\treturn type + '或密码错！';\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'password') {\r\n            return await this.onSubmit('login', context);\r\n        }\r\n\t}\r\n\r\n\theader() {\r\n        if (this.withBack === true) {\r\n            return '登录';\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontent() {\r\n        return <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"w-20c\">\r\n\t\t\t\t{tonvaTop()}\r\n\t\t\t\t<div className=\"h-2c\" />\r\n\t\t\t\t<Form schema={schema} uiSchema={this.uiSchema} \r\n\t\t\t\t\tonButtonClick={this.onSubmit} \r\n\t\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\t\trequiredFlag={false} />\r\n\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t<Ax className=\"btn btn-link\" href=\"/forget\">\r\n\t\t\t\t\t\t忘记密码\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t\t<Ax href=\"/register\" className=\"btn btn-link\">\r\n\t\t\t\t\t\t注册账号\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t</div>\r\n\t\t\t\t{nav.privacyEntry()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t</div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton, nav } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        {name:'orgPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword1', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'submit', type: 'submit'} as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '原密码',\r\n                placeholder: '输入原来的密码'\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '新密码',\r\n                placeholder: '输入新设的密码'\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '确认密码', \r\n                placeholder: '再次输入新设密码'\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n\t};\r\n\t\r\n\tprivate onChange: (orgPassword:string, newPassword:string) => Promise<boolean>\r\n\tinit(onChange: (orgPassword:string, newPassword:string) => Promise<boolean>) {\r\n\t\tthis.onChange = onChange;\r\n\t}\r\n\r\n    private onSubmit = async (name:string, context: Context):Promise<any> => {\r\n        let {orgPassword, newPassword, newPassword1} = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '新密码错误，请重新输入');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t//let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\tlet ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '原密码错误');\r\n            return;\r\n        }\r\n        nav.replace(<Page header=\"修改密码\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                密码修改成功！\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n\theader() {return '修改密码'}\r\n\r\n    content() {\r\n        return <Form\r\n\t\t\tclassName=\"m-3\" \r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\tfieldLabelSize={2} />\r\n    }\r\n}\r\n","import { User } from '../tool';\r\nimport { nav, Login } from '../components';\r\nimport { Controller, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\nimport { VLogin } from './VLogin';\r\nimport { CenterAppApi, userApi } from '../net';\r\nimport { VChangePassword } from './VChangePassword';\r\n\r\nexport class CLogin extends Controller implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean):Promise<void> {\r\n\t\tlet onLogin = async (un:string, pwd:string):Promise<boolean> => {\r\n\t\t\tlet user = await userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: nav.guest,\r\n\t\t\t});\r\n\t\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait nav.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, {onLogin, withBack});\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tnav.logout(callback);\r\n\t\t});\r\n\t}\r\n\t/*\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new (await import('./register')).CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new (await import('./register')).CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\t*/\r\n\r\n\tprotected getVChangePassword():new (cLogin:CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword:string, newPassword:string):Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t\tlet ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\t\treturn ret;\r\n\t\t});\r\n    }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import * as React from 'react';\r\nimport { nav } from '../components';\r\nimport { mobileRegex, emailRegex } from '../tool';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport function tonvaTop() {\r\n    return nav.loginTop(<div className=\"d-flex align-items-center position-relative\">\r\n        <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n        <div className=\"h3 flex-fill text-center\"><span className=\"text-primary mr-3\">同</span>\r\n            <span className=\"text-danger\">花</span>\r\n        </div>\r\n    </div>);\r\n}\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders:Sender[] = [\r\n    {type:'mobile', caption:'手机号', regex: mobileRegex},\r\n    {type:'email', caption:'邮箱', regex: emailRegex}\r\n];\r\n\r\nexport function getSender(un: string):Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","export * from './page';\r\nexport * from './tabs';\r\nexport * from './scrollView';\r\nexport * from './pageHeader';","export * from './schema';\r\nexport * from './uiSchema';\r\nexport * from './toUiSelectItems';\r\nexport * from './IValuesView';","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n\taction?: () => void;\r\n\ticonClass?: string;\r\n\tcaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n\tcontent?: string|JSX.Element;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n\tclassName?: string;\r\n\tcontainerClass?: string;\r\n\titemIconClass?: string;\r\n\titemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n\t/*\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\t*/\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n\t\tdocument.removeEventListener('click', this.handleDocumentClick);\r\n\t\tdocument.removeEventListener('touchstart', this.handleDocumentClick);\r\n\t\tif (this.state.dropdownOpen === false) return;\r\n        //if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n\t\tlet {dropdownOpen} = this.state;\r\n\t\tdropdownOpen = !dropdownOpen;\r\n        this.setState({dropdownOpen});\r\n\t\tif (dropdownOpen === true) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdocument.addEventListener('click', this.handleDocumentClick);\r\n\t\t\t\tdocument.addEventListener('touchstart', this.handleDocumentClick);\t\r\n\t\t\t},10)\r\n\t\t}\r\n    }\r\n\r\n    render() {\r\n        let {icon, content, actions, isRight, className, containerClass, itemIconClass, itemCaptionClass} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => {\r\n\t\t\tif (!v) return false;\r\n\t\t\treturn v.icon !== undefined\r\n\t\t});\r\n        let {dropdownOpen} = this.state;\r\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n\t\tlet cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n\t\t//if (className) cn += className;\r\n        return <div className={classNames('dropdown', containerClass)}>\r\n\t\t\t<button ref={v=>this.button=v} \r\n\t\t\t\tclassName={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                {icon!==null && <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />}\r\n\t\t\t\t{content && <span className=\"ml-1\">{content}</span>}\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n\t\t\t\t\t\tif (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index}/>;\r\n\t\t\t\t\t\t}\r\n                        let {icon, caption, action, iconClass, captionClass} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n\t\t\t\t\t\t\tif (!iconClass) iconClass = 'text-info';\r\n\t\t\t\t\t\t\ti = <i className={classNames('mr-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n\t\t\t\t\t\t\t\taria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from '../../res';\r\n\r\nexport interface EasyDateProps {\r\n    date: Date | number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes:{[prop:string]:any} = {\r\n\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month:number, date:number) => `${month}月${date}日`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str:string):any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate:Date|number, withTime:boolean, always:boolean = false) {\r\n    if (!vDate) return null;\r\n    let date: Date;\r\n    switch (typeof vDate) {\r\n        default: date = vDate as Date; break;\r\n        case 'string': date = new Date(vDate); break;\r\n        case 'number': date = new Date((vDate as number)*1000); break;\r\n    }\r\n\r\n    let now = new Date();\r\n    let tick:number, nDate:number, _date:number, month:number, year:number, nowYear:number;\r\n    let d = date;\r\n    tick = now.getTime() - d.getTime();\r\n    let hour=d.getHours(), minute=d.getMinutes();\r\n    nDate=now.getDate();\r\n    _date=d.getDate();\r\n    month=d.getMonth()+1;\r\n    year=d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime:boolean = false;\r\n\tlet dPart:string = (function() {\r\n\t\tif (tick < -24*3600*1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24*3600*1000) {\r\n\t\t\tif (_date!==nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime===true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute<10?':0':':') + minute);\r\n\r\n\t/*\r\n    if (tick < -24*3600*1000) {\r\n        if (year === nowYear)\r\n            return tt('md')(month, _date) + ' ' + hm;\r\n        else\r\n            return tt('ymd')(year, month, _date) + ' ' + hm;\r\n    }\r\n    if (always === true || tick < 24*3600*1000) {\r\n        return _date!==nDate? \r\n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n            : withTime===true? hm : tt('today');\r\n    }\r\n    if (year === nowYear) {\r\n        return tt('md')(month, _date);\r\n    }\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true && always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, false);\r\n    }\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n    render() {\r\n\t\tlet {date, always} = this.props;\r\n        return renderDate(date, true, always);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from '.';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"mr-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { env } from '../tool';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key:string)=>Promise<void>;\r\n    onFocus?: ()=>void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n\tprivate button: HTMLButtonElement;\r\n    private key: string = null;\r\n\t\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n\t\tconsole.log('key = ' + this.key);\r\n        if (this.props.allowEmptySearch === true) {\r\n\t\t}\r\n\t\telse {\r\n            this.button.disabled = this.key === undefined || this.key.length === 0;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n\t\t\tif (this.button) this.button.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n\t\tif (this.button) this.button.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n\t\tlet {className, inputClassName, onFocus,\r\n\t\t\tlabel, placeholder, buttonText, maxLength, size} = this.props;\r\n\t\tlet inputSize:string;\r\n\t\tswitch (size) {\r\n\t\t\tdefault:\r\n\t\t\tcase 'sm': inputSize = 'input-group-sm'; break;\r\n\t\t\tcase 'md': inputSize = 'input-group-md'; break;\r\n\t\t\tcase 'lg': inputSize = 'input-group-lg'; break;\r\n\t\t}\r\n\t\tlet autoComplete:string;\r\n\t\tif (env.isMobile === true) autoComplete = 'off';\r\n\t\treturn <form className={className} onSubmit={this.onSubmit} autoComplete={autoComplete}>\r\n\t\t\t<div className={classNames(\"input-group\", inputSize)}>\r\n\t\t\t\t{label && <div className=\"input-group-addon align-self-center mr-2\">{label}</div>}\r\n\t\t\t\t<input ref={v=>this.input=v} onChange={this.onChange}\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tname=\"key\"\r\n\t\t\t\t\tonFocus={onFocus}\r\n\t\t\t\t\tclassName={classNames('form-control', inputClassName || 'border-primary')}\r\n\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\tdefaultValue={this.props.initKey}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t<div className=\"input-group-append\">\r\n\t\t\t\t\t<button ref={v=>this.button=v} className=\"btn btn-primary\"\r\n\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\tdisabled={this.props.allowEmptySearch !== true}>\r\n\t\t\t\t\t\t<i className='fa fa-search' />\r\n\t\t\t\t\t\t<i className=\"fa\"/>\r\n\t\t\t\t\t\t{buttonText}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</form>;\t\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { userApi } from '../net';\r\nimport { User } from '../tool';\r\n\r\nexport type UserLoader = (userId:number)=>Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate loader: UserLoader;\r\n\tprivate onLoaded: (user:User) => void;\r\n\tprivate map = observable(new Map<number, T|number>());\r\n\r\n\tconstructor(loader: UserLoader) {\r\n\t\tif (loader === undefined) loader = (userId:number)=>userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id:number|any, onLoaded?:(user:User)=>void) {\t\t\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id:number|any):any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof(id)) {\r\n\t\t\tcase 'object': \r\n\t\t\t\tid = id.id; \r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof(ret)) {\r\n\t\tdefault:\r\n\t\t\treturn ret;\r\n\t\tcase 'number':\r\n\t\t\tif (ret < 0) return id;\r\n\t\t\tthis.map.set(id, -id);\r\n\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\tif (!v) v = null;\r\n\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t}).catch(reason => {\r\n\t\t\t\tconsole.error(reason);\r\n\t\t\t});\r\n\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst userCache = new UserCache(undefined);\r\n\r\nexport interface UserIconProps {\r\n    id: number;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n    noneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\r\n    let {className, style, id, altImage, noneImage} = props;\r\n    let user = userCache.getValue(id);\r\n    switch (typeof user) {\r\n\tcase 'undefined':\r\n\tcase 'number':\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            {noneImage || <i className=\"fa fa-file-o\" />}\r\n        </div>;\r\n    }\r\n    let {icon} = user;\r\n    if (!icon) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (icon.startsWith(':') === true) {\r\n        icon = nav.resUrl + icon.substr(1);\r\n    }\r\n    return <img src={icon} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tid?: number;\r\n\tuser?: number|User;\r\n\trender: (user:User) => JSX.Element;\r\n\tonLoaded?: (user:User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\r\n\tlet {id:idProp, user, render, onLoaded} = props;\r\n\tif (user === null) return <>null</>;\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined': \r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object': \r\n\t\t\tlet {/*obj, */id} = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\t\tuseUser(id, onLoaded);\r\n\t\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n    switch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n        \treturn <>{user}</>;\r\n    }\r\n    return render(user);\r\n});\r\n\r\nexport function useUser(id: number|object, onLoaded?: (user:User)=>void) {\r\n\tif (!id) return;\r\n\tif (typeof(id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { nav } from \"../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet {href, children, className, onClick} = axProps;\r\n\tif (nav.isWebNav === true) {\r\n\t\tlet {aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret:boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnav.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet {naClassName} = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tif (nav.openSysPage(href) === false) {\r\n\t\t\t\t\tnav.navigate(href);\r\n\t\t\t   };\r\n\t\t\t   return false;\r\n\t\t   }\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet {children} = props;\r\n\tif (nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet {href} = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\tnav.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import React from 'react';\r\nimport { observer } from \"mobx-react\";\r\nimport { IObservableValue } from 'mobx';\r\n\r\nexport function autoHideTips(\r\n\ttips: IObservableValue<boolean|string|JSX.Element>, \r\n\ttemplet?:string|JSX.Element|((v:string|JSX.Element)=>JSX.Element), \r\n\ttimeout?:number):React.FunctionComponentElement<any> \r\n{\r\n\tlet timer:any;\r\n\treturn React.createElement(observer(():JSX.Element => {\r\n\t\tif (timer) {\r\n\t\t\tclearTimeout(timer);\r\n\t\t\ttimer = undefined;\r\n\t\t}\r\n\t\tlet t = tips.get();\r\n\t\tif (!t) return null;\r\n\t\tif (timeout === undefined) timeout = 3000;\r\n\r\n\t\tif (timeout > 0) {\r\n\t\t\ttimer = setTimeout(() => {\r\n\t\t\t\ttips.set(null);\r\n\t\t\t}, timeout);\r\n\t\t}\r\n\t\tswitch (typeof templet) {\r\n\t\t\tcase 'undefined': return <>{t}</>;\r\n\t\t\tcase 'function': return templet(t as string);\r\n\t\t\tcase 'string': return <>{templet}</>;\r\n\t\t\tdefault: return templet;\r\n\t\t}\r\n\t}));\r\n};\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","export * from './ui';\r\nexport * from './fieldItem';\r\nexport * from './fieldUI';\r\nexport * from './IDUI';\r\n","/*eslint @typescript-eslint/no-unused-vars: [\"off\", { \"vars\": \"all\" }]*/\r\nimport { observable, IObservableArray, computed, makeObservable } from 'mobx';\r\nimport { CUqBase } from \"../uq-app\";\r\nimport { GFunc } from './GFunc';\r\nimport { VStockInfo } from './VStockInfo'\r\nimport { NStockInfo, StockPrice, StockCapitalearning, StockBonus, StockDivideInfo } from './StockInfoType';\r\nimport { Stock, StockValue } from 'uq-app/uqs/BruceYuMi';\r\nimport { ErForEarning } from './ErForEarning';\r\nimport { SlrForEarning } from './SlrForEarning';\r\nimport { MiNet } from '../net';\r\n\r\nexport class CStockInfo extends CUqBase {\r\n    stock: Stock & StockValue;\r\n    @observable baseItem: NStockInfo;\r\n    @observable protected loaded: boolean = false;\r\n\r\n    @observable price: StockPrice;\r\n    //@observable stockTags: any[];\r\n    selectedTags: any[];\r\n\r\n    @observable seasonData: { season: number, c: number, corg: number, shares: number, revenue: number, profit: number, netprofit: number }[] = [];\r\n    @observable predictSeasonData: { season: number, c: number, shares: number, revenue: number, profit: number, netprofit: number }[] = [];\r\n    @observable predictSeasonDataFull: { season: number, c: number, shares: number, revenue: number, profit: number, netprofit: number }[] = [];\r\n    @observable predictData: { e: number, b: number, r2: number, epre: number, l: number, lr2: number, lpre: number };\r\n    @observable predictBonusData: { year: number, bonus: number }[] = [];\r\n    @observable ypredict: number[] = [];\r\n\r\n    @observable mirates: {day: number, mirate: number, price: number}[] = [];\r\n    @observable mivalues: {season: number, mivalue: number}[] = [];\r\n\r\n    protected _capitalearning: IObservableArray<StockCapitalearning> = observable.array<StockCapitalearning>([], { deep: true });\r\n    protected _bonus: IObservableArray<StockBonus> = observable.array<StockBonus>([], { deep: true });\r\n    protected _divideInfo: IObservableArray<StockDivideInfo> = observable.array<StockDivideInfo>([], { deep: true });\r\n    protected _sharesArr: { day: number, shares: number }[] = [];\r\n\r\n    @computed get capitalearning(): IObservableArray<StockCapitalearning> {\r\n        if (this.loaded === false) return undefined;\r\n        return this._capitalearning;\r\n    }\r\n\r\n    @computed get bonus(): IObservableArray<StockBonus> {\r\n        if (this.loaded === false) return undefined;\r\n        return this._bonus;\r\n    }\r\n\r\n    @computed get divideInfo(): IObservableArray<StockDivideInfo> {\r\n        if (this.loaded === false) return undefined;\r\n        return this._divideInfo;\r\n    }\r\n\r\n    private miNet: MiNet;\r\n    constructor(cApp: any) {\r\n        super(cApp);\r\n        makeObservable(this);\r\n        this.miNet = new MiNet(this.user);\r\n    }\r\n    initLoad = () => {\r\n        this.load();\r\n    }\r\n\r\n    private load = async () => {\r\n        if (!this.baseItem) return;\r\n\r\n        let { rawId, day, trackDay } = this.baseItem;\r\n        let rets;\r\n        if (trackDay !== undefined) {\r\n            rets = await Promise.all([\r\n                this.miNet.q_stockallinfotrack(rawId, trackDay)\r\n            ]);\r\n        }\r\n        else {\r\n            rets = await Promise.all([\r\n                this.miNet.q_stockallinfo(rawId, day)\r\n            ]);\r\n        }\r\n        let ret = rets[0];\r\n        if (Array.isArray(ret[0])) {\r\n            let arr1 = ret[1];\r\n            if (Array.isArray(arr1)) {\r\n                this.price = arr1[0];\r\n            }\r\n\r\n            this._bonus.clear();\r\n            this._divideInfo.clear();\r\n            this._capitalearning.clear();\r\n            let arr3 = ret[3];\r\n            if (Array.isArray(arr3)) {\r\n                this._divideInfo.push(...arr3);\r\n                let barr = arr3.filter((v: any) => {\r\n                    return v.派息 as number > 0;\r\n                }).map((v: any) => {\r\n                    return { day: v.day, bonus: v.派息, shares: v.shares };\r\n                })\r\n                this._bonus.push(...barr);\r\n            }\r\n            this._sharesArr = ret[5];\r\n\r\n            this.mivalues.splice(0);\r\n            let mvArr = ret[7] as {season: number, mivalue: number, volume: number}[];\r\n            let mvr: {season: number, mivalue: number}[] = [];\r\n            if (mvArr.length > 0) {\r\n                let vlast = mvArr[0].volume;\r\n                if (vlast !== undefined) {\r\n                    mvArr.forEach(v=> {\r\n                        let { season, mivalue, volume } = v;\r\n                        if (mivalue != undefined && volume != null) {\r\n                            let miv = mivalue * volume / vlast;\r\n                            mvr.unshift({season: season, mivalue: miv });\r\n                        }\r\n                    })\r\n                    this.mivalues.push(...mvr);\r\n                }\r\n            }\r\n\r\n            let mlen = mvr.length;\r\n            let getMivalue = (day:number) => {\r\n                let season = GFunc.SeasonnoFromDay(day) - 1;\r\n                for (let i = 0; i < mlen; i++) {\r\n                    let mi = mvr[i];\r\n                    if (mi.season == season) {\r\n                        return mi.mivalue;\r\n                    }\r\n                    else if (mi.season > season) {\r\n                        break;\r\n                    }\r\n                }\r\n                return undefined;\r\n            }\r\n\r\n            let ratesArr = ret[6] as {day: number, mirate: number}[];\r\n            let rates: {day: number, mirate: number, price: number}[] = []\r\n            ratesArr.forEach(v =>{\r\n                let {day, mirate} = v;\r\n                let mv = getMivalue(day);\r\n                let price: number = undefined;\r\n                if (mv !== undefined && mirate !== null && mirate !== undefined) {\r\n                    price = mv * 100 / mirate;\r\n                }\r\n\r\n                rates.unshift({day: day, mirate: mirate, price: price});\r\n            });\r\n            this.mirates.splice(0);\r\n            this.mirates.push(...rates);\r\n\r\n            await this.loadTTMEarning(ret[2]);\r\n            this.LoadBonusData();\r\n        }\r\n\r\n        this.loaded = true;\r\n    }\r\n\r\n    protected getTotalShares(day: number): number {\r\n        let ret: number = undefined;\r\n        for (let i = 0; i < this._sharesArr.length; ++i) {\r\n            let item = this._sharesArr[i];\r\n            ret = item.shares;\r\n            if (day >= item.day) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        return ret;\r\n    }\r\n\r\n    protected async loadTTMEarning(list: { seasonno: number, capital: number, revenue: number, profit: number, netprofit: number, shares: number }[]) {\r\n        this.seasonData.splice(0);\r\n        let seasonlist: { [index: number]: { season: number, c: number, corg: number, shares: number, revenue: number, profit: number, netprofit: number } } = {};\r\n        let len = list.length;\r\n        if (len <= 0) return;\r\n        let minNo = list[len - 1].seasonno;\r\n        let lastItem = list[0];\r\n        let lastShares = lastItem.shares;\r\n        let maxNo = lastItem.seasonno;\r\n\r\n        for (let item of list) {\r\n            let no = item.seasonno;\r\n            let sItem = {\r\n                season: no, c: item.capital * item.shares / lastShares, \r\n                corg: item.capital, shares: item.shares, revenue: item.revenue, profit: item.profit, netprofit: item.netprofit\r\n            }\r\n            seasonlist[no] = sItem;\r\n\r\n            let yearmonth = GFunc.GetSeasonnoYearMonth(no);\r\n            if (yearmonth.month === 12) {\r\n                let ci = { year: yearmonth.year, capital: item.capital, earning: item.netprofit / item.shares };\r\n                this._capitalearning.push(ci);\r\n            }\r\n        }\r\n\r\n        let i = 0;\r\n        for (let seasonno = minNo; seasonno <= maxNo; ++seasonno, ++i) {\r\n            let si = seasonlist[seasonno];\r\n            if (si === undefined) {\r\n                continue;\r\n            }\r\n            this.seasonData.splice(0, 0, si);\r\n        }\r\n\r\n        let noBegin = maxNo - 19;\r\n        this.predictData = undefined;\r\n        this.predictSeasonData.splice(0);\r\n        this.predictSeasonDataFull.splice(0);\r\n        if (noBegin < minNo) return;\r\n        noBegin += 3;\r\n        this.ypredict = [];\r\n        for (let x = noBegin; x <= maxNo; x += 4) {\r\n            let item = seasonlist[x];\r\n            if (item === undefined) break;\r\n            this.predictSeasonData.splice(0, 0, item);\r\n            this.ypredict.push(item.netprofit / lastShares);\r\n        }\r\n\r\n        for (let x = maxNo; x >= minNo; x -= 4) {\r\n            let item = seasonlist[x];\r\n            if (item === undefined) break;\r\n            this.predictSeasonDataFull.push(item);\r\n        }\r\n\r\n        if (this.ypredict.length === 5) {\r\n            let er = new ErForEarning(this.ypredict);\r\n            let lr = new SlrForEarning(this.ypredict);\r\n            this.predictData = { e: this.ypredict[4], b: er.B, r2: er.r2, epre: er.predict(4), l: lr.slopeR, lr2: lr.r2, lpre: lr.predict(4) };\r\n        }\r\n        else {\r\n            this.predictSeasonData.splice(0);\r\n        }\r\n    }\r\n\r\n    protected LoadBonusData() {\r\n        this.predictBonusData.splice(0);\r\n        if (this._sharesArr === undefined || this._sharesArr.length <= 0) return;\r\n        let maxNo: number;\r\n        let trackDay =  this.baseItem.trackDay;\r\n        if (trackDay === undefined) {\r\n            let dt = new Date();\r\n            maxNo = GFunc.SeasonnoFromYearMonth(dt.getFullYear(), dt.getMonth() + 1) - 2;\r\n        }\r\n        else {\r\n            let y = \r\n            maxNo = GFunc.SeasonnoFromYearMonth(Math.floor(trackDay / 10000), Math.floor((trackDay % 10000) / 100));\r\n        }\r\n        let minNo = -1;\r\n        let dataOrg: { [index: number]: { bonus: number, shares: number } } = {};\r\n        let seasonData: { [index: number]: { bonus: number, shares: number, bs: number } } = {};\r\n        for (let item of this._bonus) {\r\n            let { day, bonus, shares } = item as { day: number, bonus: number, shares: number };\r\n            if (shares <= 0 || bonus <= 0) continue;\r\n            if (day < 19950101) continue;\r\n            let sno = GFunc.SeasonnoFromDayForBonus(day);\r\n            dataOrg[sno] = { bonus: bonus, shares: shares };\r\n            if (minNo < 0) {\r\n                minNo = sno;\r\n            }\r\n            else {\r\n                if (sno < minNo)\r\n                    minNo = sno;\r\n            }\r\n            if (sno > maxNo) {\r\n                maxNo = sno;\r\n            }\r\n        }\r\n\r\n        let getBonusPrev3 = (sno: number) => {\r\n            let r = 0;\r\n            for (let n = sno - 3; n < sno; ++n) {\r\n                let item = dataOrg[n];\r\n                if (item === undefined) continue;\r\n                r += item.bonus * item.shares;\r\n            }\r\n            return r;\r\n        }\r\n\r\n\r\n        for (let no = minNo; no <= maxNo; ++no) {\r\n            let item = dataOrg[no];\r\n            let bsum = 0;\r\n            if (item === undefined) {\r\n                let { end } = GFunc.SeasonnoToBeginEnd(no);\r\n                item = { bonus: 0, shares: this.getTotalShares(end) };\r\n            }\r\n            else {\r\n                bsum = item.bonus * item.shares;\r\n            }\r\n\r\n            bsum += getBonusPrev3(no);\r\n            bsum = bsum / item.shares;\r\n            seasonData[no] = { bonus: bsum, bs: item.bonus, shares: item.shares };\r\n        }\r\n\r\n        let lastItem = seasonData[maxNo];\r\n        if (lastItem === undefined) {\r\n            return;\r\n        }\r\n\r\n        let lastShares = lastItem.shares;\r\n        if (lastShares === undefined || lastShares <= 0) {\r\n            return;\r\n        }\r\n\r\n        for (let i = maxNo; i >= maxNo - 16; i -= 4) {\r\n            let ni = seasonData[i];\r\n            if (ni === undefined) break;\r\n            let b = 0;\r\n            if (ni.bonus > 0 && ni.shares > 0) {\r\n                b = ni.bonus * ni.shares / lastShares;\r\n            }\r\n            let ym = GFunc.GetSeasonnoYearMonth(i);\r\n            this.predictBonusData.unshift({ year: ym.year, bonus: b });\r\n        }\r\n    }\r\n\r\n    async internalStart(param: any) {\r\n        this.baseItem = param as NStockInfo;\r\n        this.stock = param.stock;\r\n        //this.isMySelect = this.cApp.store.isMyAll(this.stock);\r\n        this.initLoad();\r\n        this.openVPage(VStockInfo);\r\n    }\r\n\r\n    openMetaView = () => {\r\n    }\r\n\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CID } from \"./CID\";\r\n\r\nexport class VEdit extends VPage<CID<any>> {\r\n\theader() {return  this.controller.editHeader}\r\n\tcontent() {\r\n\t\tlet {cFormView, item} = this.controller;\r\n\t\t//let {IDUI} = midID;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{cFormView.renderForm(item)}\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, PropGrid, View, VPage } from \"tonva-react\";\r\nimport { CID } from \"./CID\";\r\n\r\nexport class VContent extends VPage<CID<any>> {\r\n\theader() {return this.controller.midID.itemHeader}\r\n\tright() {\r\n\t\treturn this.controller.renderViewRight();\r\n\t}\r\n\tcontent() {\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {item, midID} = this.controller;\r\n\t\t\tlet {props} = midID;\r\n\t\t\treturn <div className=\"py-3\">\r\n\t\t\t\t<PropGrid rows={props}\r\n\t\t\t\t\tvalues={item} />\r\n\t\t\t</div>;\t\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n}\r\n\r\nexport class VViewRight extends View<CID<any>> {\r\n\trender() {\r\n\t\treturn <button\r\n\t\t\tclassName=\"btn btn-sm btn-primary mr-2\" \r\n\t\t\tonClick={() => this.controller.onItemEdit()}>\r\n\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t</button>;\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\tnew: '新建',\r\n\tedit: '修改',\r\n\tlist: '列表',\r\n}","export const en = {\r\n\tnew: 'New',\r\n\tedit: 'Edit',\r\n\tlist: 'List',\r\n}\r\n","import { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { Context, Controller } from \"tonva-react\";\r\nimport { renderItem } from \"../../tools\";\r\nimport { IDBase } from \"../../base\";\r\nimport { CList } from '../list';\r\nimport { CFormView, FormUI } from \"../../form\";\r\nimport { MidID } from \"./MidID\";\r\nimport { MidIDList } from \"./MidIDList\";\r\nimport { VEdit } from \"./VEdit\";\r\nimport { VContent, VViewRight } from \"./VContent\";\r\nimport { res } from \"./res\";\r\n\r\nexport class CID<T extends IDBase> extends Controller {\r\n\titem:T = null;\r\n\tmidID: MidID<T>;\r\n\tcFormView: CFormView<T>;\r\n\tprivate cList: CList<T>;\r\n\tprivate midIDList: MidIDList<T>;\r\n\tprivate valueChanged: boolean;\r\n\r\n\tconstructor(midID: MidID<T>) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\titem: observable,\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t\tthis.setRes(midID.res);\r\n\t\tthis.midID = midID;\r\n\t}\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n\t\tawait this.midID.init();\r\n\t\tthis.createFormView();\r\n\t\tthis.midIDList =  this.midID.createMidIDList();\r\n\t\tthis.midIDList.onRightClick = this.onItemNew;\r\n\t\tthis.midIDList.renderItem = this.renderItem;\r\n\t\tthis.midIDList.onItemClick = this.onItemClick;\r\n\t\tthis.midIDList.renderRight = this.renderListRight;\r\n\t\tthis.midIDList.renderTop = this.renderListTop;\r\n\t\tthis.midIDList.renderBottom = this.renderListBottom;\r\n\t\tthis.cList = this.createCList();\r\n        return true;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.valueChanged = false;\r\n\t\tawait this.cList.call();\r\n\t\tthis.returnCall(this.valueChanged);\r\n\t}\r\n\r\n\tprotected createFormView() {\r\n\t\tlet {ID, IDUI} = this.midID;\r\n\t\tlet {fieldCustoms} = IDUI;\r\n\t\tlet formUI = new FormUI(ID.ui, fieldCustoms, ID.t);\r\n\t\tthis.cFormView = new CFormView(formUI);\r\n\t\tthis.cFormView.onSubmit = this.onSubmit;\r\n\t}\r\n\r\n\tprotected createCList() {\r\n\t\treturn new CList(this.midIDList);\r\n\t}\r\n\r\n\tprotected renderListRight: () => JSX.Element;\r\n\tprotected renderListTop: () => JSX.Element;\r\n\tprotected renderListBottom: () => JSX.Element;\r\n\r\n\tprivate onSubmit = async (name:string, context: Context) => {\r\n\t\tawait this.saveID(context.data);\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\trenderItem: (item:T, index:number) => JSX.Element = (item:T, index:number) => {\r\n\t\tlet {ID } = this.midID;\r\n\t\tif (ID) return ID.render(item);\r\n\t\treturn renderItem(item, index);\r\n\t}\r\n\tonItemClick: (item: T) => void = (item:any) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.item = item;\r\n\t\t\tthis.onItemView();\r\n\t\t});\r\n\t}\r\n\r\n\tonItemEdit = async (): Promise<void> => {\r\n\t\tthis.valueChanged = false;\r\n\t\tawait this.midID.init();\r\n\t\tthis.createFormView();\r\n\t\tthis.openVPage(VEdit);\r\n\t}\r\n\r\n\tasync onItemView():Promise<void> {\r\n\t\tthis.openVPage(VContent);\r\n\t}\r\n\r\n\tonItemNew = async (): Promise<void> => {\r\n\t\tawait this.cFormView.setNO(this.midID.ID);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.item = undefined;\r\n\t\t\tthis.openVPage(VEdit);\r\n\t\t});\r\n\t}\r\n\r\n\tasync saveID(itemProps:any) {\r\n\t\tlet id = this.item?.id;\r\n\t\tlet item = {\r\n\t\t\t...itemProps,\r\n\t\t\tid,\r\n\t\t}\r\n\t\tlet ret = await this.midID.saveID(item);\r\n\t\tif (ret) id = ret;\r\n\t\tthis.midIDList?.update(id, item);\r\n\t\trunInAction(() => {\r\n\t\t\tif (this.item)\r\n\t\t\t\tObject.assign(this.item, item);\r\n\t\t\telse\r\n\t\t\t\tthis.item = item;\r\n\t\t});\r\n\t\tthis.valueChanged = true;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tget itemHeader() {\r\n\t\treturn (this.midID.itemHeader as string ?? this.midID.ID.ui.label as string)\r\n\t}\r\n\r\n\tget editHeader() {\r\n\t\treturn this.t(this.item? 'edit' : 'new') + ' ' + this.itemHeader;\r\n\t}\r\n\r\n\trenderViewRight(item?: T) {\r\n\t\tif (item) this.item = item;\r\n\t\treturn this.renderView(VViewRight);\r\n\t}\r\n}\r\n","import { ID, IX, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../../base\";\r\nimport { MidIDListBase } from \"../list\";\r\n\r\nexport class MidIDList<T extends IDBase> extends MidIDListBase<T> {\r\n\treadonly ID:ID;\r\n\t\r\n\tconstructor(uq:Uq, ID:ID) {\r\n\t\tsuper(uq);\r\n\t\tthis.ID = ID;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\t//await this.ID.loadSchema();\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tupdate(id:number, item:any) {\r\n\t\titem.id = id;\r\n\t\tthis.listPageItems.update(item);\r\n\t}\r\n}\r\n\r\nexport class MidIXIDList<T extends IDBase> extends MidIDList<T> {\r\n\treadonly IX:IX;\r\n\tprivate ix?:number|(number[]);\r\n\tconstructor(uq:Uq, ID:ID, IX:IX, ix:number|(number[])) {\r\n\t\tsuper(uq, ID);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ix = ix;\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.IX<T>({\r\n\t\t\tIX: this.IX,\r\n\t\t\tIDX: [this.ID],\r\n\t\t\tix: this.ix,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\t/*\r\n\t\tfor (let item of ret) {\r\n\t\t\titem.id = item.id;\r\n\t\t\tdelete item.id;\r\n\t\t}\r\n\t\t*/\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { ID, Schema, UiSchema, Uq, Prop, UiButton, UiItemCollection, IDUI, IX, ParamActIX } from \"tonva-react\";\r\nimport { IDBase, Mid } from \"../../base\";\r\nimport { MidIDList, MidIXIDList } from \"./MidIDList\";\r\n\r\nexport class MidID<T extends IDBase> extends Mid {\r\n\treadonly IDUI: IDUI;\r\n\treadonly ID: ID;\r\n\r\n\tconstructor(uq: Uq, IDUI: IDUI) {\r\n\t\tsuper(uq);\r\n\t\tthis.IDUI = IDUI;\r\n\t\tthis.ID = IDUI.ID;\r\n\t}\r\n\r\n\tlistHeader: string|JSX.Element;\r\n\titemHeader: string|JSX.Element;\r\n\r\n\tasync init():Promise<void> {\r\n\t\tawait this.loadSchema();\r\n\t\tthis._itemSchema = await this.buildItemSchema(this.IDUI);\r\n\t\tthis._uiSchema = this.buildUISchema(this.IDUI);\r\n\t}\r\n\r\n\tcreateMidIDList():MidIDList<T> {\r\n\t\tlet ret = new MidIDList<T>(this.uq, this.ID);\r\n\t\tret.header = this.listHeader;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected buildUISchema(IDUI:IDUI):UiSchema {\r\n\t\tlet {ID} = IDUI;\r\n\t\tlet items:UiItemCollection = {};\r\n\t\tthis._uiSchema = {items};\r\n\t\tlet {fields} = ID.ui;\r\n\t\tif (fields) {\r\n\t\t\tfor (let f of this._itemSchema) {\r\n\t\t\t\tlet {name} = f;\r\n\t\t\t\tObject.assign(f, (fields as any)[name]);\r\n\t\t\t\t(items as any)[name] = f;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet uiButton: UiButton = {\r\n\t\t\tlabel: '提交',\r\n\t\t\tclassName: 'btn btn-primary',\r\n\t\t\twidget: 'button',\r\n\t\t};\r\n\t\titems['submit'] = uiButton;\r\n\t\treturn this._uiSchema;\r\n\t}\r\n\tprotected async loadSchema() {\r\n\t\tawait this.ID.loadSchema();\r\n\t}\r\n\r\n\tasync load(id:number): Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid,\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet param: any = {};\r\n\t\tparam[this.ID.name] = [data];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\tlet id = ret[this.ID.name];\r\n\t\tif (!id) return;\r\n\t\treturn id[0];\r\n\t}\r\n\r\n\tprivate _itemSchema: Schema;\r\n\tget itemSchema(): Schema {\r\n\t\t//if (this._itemSchema !== undefined) \r\n\t\treturn this._itemSchema;\r\n\t\t//return this._itemSchema = this.buildItemSchema(this.ID);\r\n\t}\r\n\r\n\tprivate _uiSchema: UiSchema;\r\n\tget uiSchema(): UiSchema {\r\n\t\t//if (this._uiSchema !== undefined) \r\n\t\treturn this._uiSchema;\r\n\t\t//return this._uiSchema = this.buildUISchema(this.ID);\r\n\t}\r\n\r\n\tprivate _props: Prop[];\r\n\tget props():Prop[] {\r\n\t\tif (this._props !== undefined) return this._props;\r\n\t\treturn this._props = this.buildGridProps(this.IDUI.ID);\r\n\t}\r\n}\r\n\r\nexport class MidIXID<T extends IDBase> extends MidID<T> {\r\n\tprivate readonly IX: IX;\r\n\tprivate readonly ix:number;\r\n\tprivate readonly IXs?:{IX:IX, ix:number}[];\r\n\tconstructor(uq: Uq, IDUI: IDUI, IX: IX, ix:number, IXs?:{IX:IX, ix:number}[]) {\r\n\t\tsuper(uq, IDUI);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ix = ix;\r\n\t\tthis.IXs = IXs;\r\n\t}\r\n\r\n\tcreateMidIDList():MidIDList<T> {\r\n\t\tlet ret = new MidIXIDList<any>(this.uq, this.ID, this.IX, this.ix);\r\n\t\tret.header = this.listHeader;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet param: ParamActIX<T> = {\r\n\t\t\tID: this.ID,\r\n\t\t\tIX: this.IX,\r\n\t\t\tIXs: this.IXs,\r\n\t\t\tvalues: [\r\n\t\t\t\t{ix:this.ix, xi:data}\r\n\t\t\t],\r\n\t\t};\r\n\t\tlet ret = await this.uq.ActIX(param);\r\n\t\tlet id = ret[0];\r\n\t\tif (!id) return;\r\n\t\treturn id;\r\n\t}\r\n}\r\n","import { ID, IDX, Uq } from \"tonva-react\";\r\nimport { IDBase } from \"../../base\";\r\nimport { MidIDListBase } from \"../list\";\r\n\r\nexport class MidIDXList<T extends IDBase> extends MidIDListBase<T> {\r\n\treadonly ID:ID;\r\n\treadonly IDX: IDX;\r\n\tconstructor(uq:Uq, ID:ID, IDX:IDX) {\r\n\t\tsuper(uq, undefined);\r\n\t\tthis.ID = ID;\r\n\t\tthis.IDX = IDX;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait Promise.all([\r\n\t\t\tthis.ID.loadSchema(),\r\n\t\t\tthis.IDX.loadSchema(),\r\n\t\t]);\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.ID<T>({\r\n\t\t\tIDX: this.ID,\r\n\t\t\tid: undefined,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\tday: '日',\r\n\tweek: '周',\r\n\tmonth: '月',\r\n\tyear: '年',\r\n}","export const en = {\r\n\tday: 'Day',\r\n\tweek: 'Week',\r\n\tmonth: 'Month',\r\n\tyear: 'Year',\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { FA, left0, LMR, NumberProp, StringProp, VPage } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nexport class VEdit extends VPage<CIDX> {\r\n\theader() {return 'Edit'}\r\n\tcontent() {\r\n\t\tlet {midIDX} = this.controller;\r\n\t\tlet {props} = midIDX;\r\n\t\treturn <div className=\"py-3\">\r\n\t\t\t{props.map((v, index) => {\r\n\t\t\t\tlet {type} = v as any;\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tdefault: return null;\r\n\t\t\t\t\tcase 'string': \r\n\t\t\t\t\t\treturn this.renderStringProp(v as StringProp);\r\n\t\t\t\t\tcase 'integer':\r\n\t\t\t\t\tcase 'number': \r\n\t\t\t\t\t\treturn this.renderNumberProp(v as NumberProp);\r\n\t\t\t\t}\r\n\t\t\t})}\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderStringProp(prop:StringProp) {\r\n\t\treturn <div key={prop.name} className=\"px-3 py-2 bg-white mb-1 cursor-pointer\">\r\n\t\t\t{JSON.stringify(prop)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderNumberProp(prop: NumberProp) {\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {name} = prop;\r\n\t\t\tlet {spanValues} = this.controller;\r\n\t\t\tif (!spanValues) return null;\r\n\t\t\treturn <div key={name} className=\"px-3 py-2 bg-white mb-1 cursor-pointer\" \r\n\t\t\t\tonClick={()=>this.openVPage(VEditNumberField, prop)}>\r\n\t\t\t\t<LMR left={<b>{prop.label}</b>} \r\n\t\t\t\t\tright={<FA name=\"pencil-square-o\" className=\"align-self-center\" />}>\r\n\t\t\t\t\t<div className=\"mr-5 text-right\">{this.controller.spanValues[name]}</div>\r\n\t\t\t\t</LMR>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n}\r\n\r\nclass VEditNumberField extends VPage<CIDX> {\r\n\tprivate prop: NumberProp;\r\n\tprivate date: Date;\r\n\tprivate value: number;\r\n\tprivate dateInput: HTMLInputElement;\r\n\tprivate timeInput: HTMLInputElement;\r\n\tdisabled: boolean = true;\r\n\tconstructor(controller: CIDX) {\r\n\t\tsuper(controller);\r\n\t\tmakeObservable(this, {\r\n\t\t\tdisabled: observable\r\n\t\t});\r\n\t}\r\n\tinit(prop: NumberProp) {\r\n\t\tthis.prop = prop;\r\n\t\tthis.date = new Date();\r\n\t}\r\n\theader() {return this.prop.label}\r\n\tright() {\r\n\t\tlet V = observer(() => <button \r\n\t\t\tclassName=\"btn btn-sm btn-success mr-2\" \r\n\t\t\tdisabled={this.disabled}\r\n\t\t\tonClick={this.onSave}>\r\n\t\t\t{this.t('submit')}\r\n\t\t</button>);\r\n\t\treturn <V />;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {time} = this.prop;\r\n\t\tlet year = this.date.getFullYear();\r\n\t\tlet month = this.date.getMonth() + 1;\r\n\t\tlet day = this.date.getDate();\r\n\t\tlet hour = this.date.getHours();\r\n\t\tlet minute = this.date.getMinutes();\r\n\t\tlet defDate = `${year}-${left0(month, 2)}-${left0(day, 2)}`;\r\n\t\tlet vDateTime:any;\r\n\t\tif (time === true) {\r\n\t\t\tvDateTime = <div className=\"input-group mb-3\">\r\n\t\t\t\t<span className=\"w-8c input-group-text\">{this.t('date')}</span>\r\n\t\t\t\t<input ref={d => this.dateInput=d} type=\"date\" \r\n\t\t\t\t\tclassName=\"form-control\" defaultValue={defDate} />\r\n\t\t\t\t<input ref={t => this.timeInput=t} type=\"time\" className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={`${left0(hour, 2)}:${left0(minute, 2)}`} />\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{vDateTime}\r\n\t\t\t<div className=\"input-group\">\r\n\t\t\t\t<span className=\"w-8c input-group-text\">{this.t('value')}</span>\r\n\t\t\t\t<input type=\"number\" className=\"form-control\" \r\n\t\t\t\t\tonChange={this.onValueChange} />\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onValueChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet v = evt.currentTarget.value.trim();\r\n\t\tthis.disabled = v.length === 0;\r\n\t\tlet n = Number(v);\r\n\t\tif (Number.isNaN(n) === false) this.value = n;\r\n\t}\r\n\r\n\tprivate onSave = async () => {\r\n\t\tlet t: number;\r\n\t\tif (this.dateInput) {\r\n\t\t\tlet date = this.dateInput.valueAsDate;\r\n\t\t\tlet dateTicks = this.dateInput?.valueAsNumber;\r\n\t\t\tlet timeTicks = this.timeInput?.valueAsNumber;\r\n\t\t\tt = dateTicks + timeTicks + date.getTimezoneOffset()*60*1000;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tt = Date.now();\r\n\t\t}\r\n\t\tawait this.controller.saveFieldValue(this.prop.name, t, this.value);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { VPage, List, LMR, EasyTime, UserView, User, View } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nexport class VHistory extends View<CIDX> {\r\n\trender() {\r\n\t\treturn <div>\r\n\t\t\t<List items={this.controller.historyItems} item={{render: this.renderItem, key:(item)=>item.t}} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderItem = (item:any, index:number) => {\r\n\t\tlet {t, v, u} = item;\r\n\t\tlet left = <div className=\"w-12c\"><EasyTime date={new Date(t)} /></div>;\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <small className=\"text-muted\">{nick || name}</small>\r\n\t\t}\r\n\t\tlet right = <UserView user={u} render={renderUser} />;\r\n\t\treturn <div className=\"px-3 py-2\">\t\t\t\r\n\t\t\t<LMR className=\"w-100\" left={left} right={right}>{v}</LMR>\r\n\t\t</div>\r\n\t}\r\n}\r\n\r\nexport class VHistoryPage extends VPage<CIDX> {\r\n\theader() {return this.controller.field}\r\n\tcontent() {\r\n\t\treturn this.renderVm(VHistory);\r\n\t}\r\n\r\n}\r\n","import { makeObservable, observable, runInAction, toJS } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { CSSProperties } from \"react\";\r\nimport { Bar } from \"react-chartjs-2\";\r\nimport { FA, LMR, NumberProp, Prop, VPage } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nconst spans = ['week', 'month'];\r\n\r\nconst graphOptions = {\r\n\ttitle: {\r\n\t\tdisplay: false,\r\n\t},\r\n\tmaintainAspectRatio: false,\r\n}\r\n\r\nexport class VView extends VPage<CIDX> {\r\n\tcurrentIndex: number = 0;\r\n\tconstructor(controller:CIDX) {\r\n\t\tsuper(controller);\r\n\t\tmakeObservable(this, {\r\n\t\t\tcurrentIndex: observable,\r\n\t\t});\r\n\t}\r\n\r\n\theader() {return 'View'}\r\n\tright() {\r\n\t\treturn <button\r\n\t\t\tclassName=\"btn btn-sm btn-primary mr-2\" \r\n\t\t\tonClick={() => this.controller.onItemEdit()}>\r\n\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\t\t\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {spanValues, midIDX, timeSpan, prevTimeSpan, nextTimeSpan, dayValues} = this.controller;\r\n\t\t\tif (spanValues === null) return null; \r\n\t\t\tlet {props} = midIDX;\r\n\t\t\tconst data = {\r\n\t\t\t\tlabels: timeSpan.labels,\r\n\t\t\t\tdatasets: [{\r\n\t\t\t\t\tlabel: '',\r\n\t\t\t\t\tdata: toJS(dayValues),\r\n\t\t\t\t\tbackgroundColor: 'lightgreen',\r\n\t\t\t\t\tborderWidth: 1\r\n\t\t\t\t}],\r\n\t\t\t};\r\n\t\t\tlet curProp = props[this.currentIndex] as NumberProp;\r\n\t\t\tlet {label, name} = curProp;\r\n\t\t\tlet moveStep = (icon:string, spanStep: ()=>Promise<void>) => <div \r\n\t\t\t\tclassName={'p-3 ' + (spanStep? 'cursor-pointer' : 'text-muted')} \r\n\t\t\t\tonClick={spanStep}>\r\n\t\t\t\t\t<FA name={icon} />\r\n\t\t\t\t</div>;\r\n\t\t\tlet left = moveStep('chevron-left', prevTimeSpan);\r\n\t\t\tlet right = timeSpan.canNext === true?\r\n\t\t\t\tmoveStep('chevron-right', nextTimeSpan)\r\n\t\t\t\t:\r\n\t\t\t\tmoveStep('square-o', undefined);\r\n\t\t\t\t//<div><FA className=\"text-muted\" name=\"square-o\" /></div>;\r\n\t\t\treturn <div className=\"py-3\">\r\n\t\t\t\t<div className=\"container\">\r\n\t\t\t\t\t<div className=\"row\">\r\n\t\t\t\t\t\t{spans.map(v => {\r\n\t\t\t\t\t\t\tlet cn = 'col text-center p-2 cursor-pointer ';\r\n\t\t\t\t\t\t\tlet style:CSSProperties = {\r\n\t\t\t\t\t\t\t\tborderBottomWidth: '0.15rem',\r\n\t\t\t\t\t\t\t\tborderBottomStyle: 'solid',\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tif (timeSpan.type === v) {\r\n\t\t\t\t\t\t\t\tcn += 'text-primary font-weight-bold';\r\n\t\t\t\t\t\t\t\tstyle.borderBottomColor = 'blue';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tcn += 'text-muted';\r\n\t\t\t\t\t\t\t\tstyle.borderBottomColor = 'lightgray';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn <div key={v} className={cn} style={style} \r\n\t\t\t\t\t\t\t\tonClick={()=>this.tabClick(v as any)}>{this.t(v)}</div>;\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<LMR className=\"text-center align-items-center\" left={left} right={right} >\r\n\t\t\t\t\t{timeSpan.title}\r\n\t\t\t\t</LMR>\r\n\t\t\t\t<div className=\"mt-3 mx-3 text-center cursor-pointer\"\r\n\t\t\t\t\tonClick={() => this.onFieldHistory(name)}>\r\n\t\t\t\t\t<h4 className=\"d-inline\">{label}</h4>\r\n\t\t\t\t\t<span className=\"text-info small\"> <FA name=\"angle-double-right\" /> 查看明细</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"p-3 h-12c\">\r\n\t\t\t\t\t<Bar data={data} width={100} height={50} options={graphOptions} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"d-flex flex-wrap p-1\"> \r\n\t\t\t\t\t{props.map((v, index) => {\r\n\t\t\t\t\t\tlet {name, label} = v as any;\r\n\t\t\t\t\t\tlet sv = spanValues[name];\r\n\t\t\t\t\t\tlet val = sv?\r\n\t\t\t\t\t\t\t<b className=\"h3 mb-0\">{sv}</b>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t<small className=\"text-muted\">0</small>\r\n\t\t\t\t\t\tlet cn = 'm-1 w-8c h-8c d-flex flex-column align-items-center justify-content-center bg-white px-3 cursor-pointer border rounded ';\r\n\t\t\t\t\t\tcn += (index === this.currentIndex)? ' border-primary' : ' ';\r\n\t\t\t\t\t\treturn <div key={index} className={cn} onClick={() => this.onFieldClick(v, index)}>\r\n\t\t\t\t\t\t\t<div className=\"my-3 h-4c d-flex align-items-center\">{val}</div>\r\n\t\t\t\t\t\t\t<div className=\"mb-3\">{label}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n\r\n\tprivate tabClick(span:'day'|'week'|'month'|'year') {\r\n\t\tthis.controller.setTimeSpan(span);\r\n\t}\r\n\r\n\tprivate async onFieldClick(prop:Prop, index:number) {\r\n\t\tlet {midIDX} = this.controller;\r\n\t\tlet {props} = midIDX;\r\n\t\tif (this.currentIndex === index) {\r\n\t\t\tlet curProp = props[this.currentIndex] as NumberProp;\r\n\t\t\tlet {name} = curProp;\r\n\t\t\tawait this.controller.showFieldHistory(name);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trunInAction(() => {\r\n\t\t\tthis.currentIndex = index;\r\n\t\t\tlet curProp = props[this.currentIndex] as NumberProp;\r\n\t\t\tlet {name} = curProp;\r\n\t\t\tthis.controller.setCurrentField(name);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async onFieldHistory(field:string) {\r\n\t\tawait this.controller.showFieldHistory(field);\r\n\t}\r\n}\r\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { runInAction } from \"mobx\";\r\nimport { ID, IX, Uq } from \"tonva-react\";\r\nimport { CList, MidIDListBase } from \"../list\";\r\nimport { IXBase } from \"../../base\";\r\n\r\nexport class CIXXList<T extends IXBase> extends CList<T> {\r\n\tprotected midIXList: MidIXList<T>;\r\n\tconstructor(midIXList: MidIXList<T>) {\r\n\t\tsuper(midIXList);\r\n\t\tthis.setRes(midIXList.res);\r\n\t\tthis.midIXList = midIXList;\r\n\t}\r\n\r\n\tupdate(item:any) {\r\n\t\tthis.midIXList.update(item);\r\n\t}\r\n}\r\n\r\nexport class MidIXList<T extends IXBase> extends MidIDListBase<T> {\r\n\treadonly IX:IX;\r\n\treadonly ID:ID;\r\n\treadonly id: number;\r\n\tconstructor(uq:Uq, IX:IX, ID:ID, id:number) {\r\n\t\tsuper(uq, undefined);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ID = ID;\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.IX.loadSchema();\r\n\t}\r\n\r\n\t//key:((item:T) => number|string) = item => item.id 2;\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet ret = await this.uq.IX<T>({\r\n\t\t\tIX: this.IX,\r\n\t\t\tIDX: this.ID? [this.ID] : undefined,\r\n\t\t\tix: this.id,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tupdate(item:T) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet {_items} = this.listPageItems;\r\n\t\t\tif (!_items) return;\r\n\t\t\tlet {ix, xi} = item;\r\n\t\t\tif (xi < 0) {\r\n\t\t\t\tlet index = _items.findIndex(v => v.xi === -xi && v.xi === xi);\r\n\t\t\t\tif (index >= 0) _items.splice(index, 1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet ret = _items.find(v => v.xi === xi && v.xi === xi);\r\n\t\t\t\tif (!ret) {\r\n\t\t\t\t\t_items.unshift({ix, xi} as T);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import { action, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { Controller, PageItems } from \"tonva-react\";\r\nimport { HistoryPageItems, TimeSpan } from \"../../tools\";\r\nimport { CList } from \"../list\";\r\nimport { MidIDX } from \"./MidIDX\";\r\nimport { MidIDXList } from \"./MidIDXList\";\r\nimport { res } from \"./res\";\r\nimport { VEdit } from \"./VEdit\";\r\nimport { VHistory, VHistoryPage } from \"./VHistory\";\r\nimport { VView } from \"./VView\";\r\n\r\nexport class CIDX extends Controller {\r\n\ttimeSpan:TimeSpan = null;\r\n\tspanValues: any = null;\r\n\tdayValues: number[] = null;\r\n\tmidIDX: MidIDX;\r\n\tprivate cList: CList<any>;\r\n\tprivate historyPageItems: HistoryPageItems<any>\r\n\tconstructor(midIDX: MidIDX) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\ttimeSpan: observable,\r\n\t\t\tspanValues: observable,\r\n\t\t\tdayValues: observable.ref,\r\n\t\t\tsetTimeSpan: action,\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t\tthis.setRes(midIDX.res);\r\n\t\tthis.midIDX = midIDX;\r\n\t\tthis.historyPageItems = new HistoryPageItems<any>(midIDX.historyLoader);\r\n\t}\r\n\r\n\tprotected async beforeStart():Promise<boolean> {\r\n\t\tawait this.midIDX.init();\r\n\t\tlet {uq, ID, IDX} = this.midIDX;\r\n\t\tlet midIDXList = new MidIDXList(uq, ID, IDX);\r\n\t\tmidIDXList.onItemClick = this.onItemClick;\r\n\t\tthis.cList = new CList(midIDXList);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.cList.start();\r\n\t}\r\n\r\n\tasync showItemView(item: any) {\r\n\t\tawait this.midIDX.init();\r\n\t\tthis.item = item;\r\n\t\tawait this.setTimeSpan('month');\r\n\t\tthis.openVPage(VView);\r\n\t}\r\n\r\n\titem:any;\r\n\tonItemClick: (item:any) => void = async (item:any) => {\r\n\t\tthis.item = item;\r\n\t\tawait this.setTimeSpan('month');\r\n\t\tthis.openVPage(VView);\r\n\t}\r\n\r\n\tonItemEdit = async ():Promise<void> => {\r\n\t\tthis.openVPage(VEdit);\r\n\t}\r\n\r\n\tasync setTimeSpan(span: 'day'|'week'|'month'|'year') {\r\n\t\tlet timeSpan = TimeSpan.create(span);\r\n\t\tthis.timeSpan = timeSpan;\r\n\t\tawait this.loadSum(timeSpan);\r\n\t}\r\n\r\n\tprivate async loadSum(timeSpan?: TimeSpan) {\r\n\t\tlet {far, near} = timeSpan ?? this.timeSpan;\r\n\t\tlet ret = await this.midIDX.loadSum(this.item.id, far, near);\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet [values, sums] = ret;\r\n\t\tlet sum = sums[0];\r\n\t\trunInAction(() => {\r\n\t\t\tthis.spanValues = sum ?? {};\r\n\t\t});\r\n\t\tawait this.loadDayValues();\r\n\t}\r\n\r\n\tprevTimeSpan = async () => {\r\n\t\tthis.timeSpan.prev();\r\n\t\tawait this.loadSum();\r\n\t}\r\n\r\n\tnextTimeSpan = async () => {\r\n\t\tthis.timeSpan.next();\r\n\t\tawait this.loadSum();\r\n\t}\r\n\r\n\tget historyItems():PageItems<any> {return this.historyPageItems;}\r\n\tfield:string;\r\n\r\n\tasync startFieldHistory(item: any, field:string) {\r\n\t\tthis.item = item;\r\n\t\tthis.field = field;\r\n\t\tawait this.midIDX.init();\r\n\t\t//await this.setTimeSpan('year');\r\n\t\tlet timeSpan = TimeSpan.create('year');\r\n\t\tthis.historyPageItems.first({\r\n\t\t\tid: this.item.id,\r\n\t\t\tfar: timeSpan.far,\r\n\t\t\tnear: 1817507137000, //this.timeSpan.near,\r\n\t\t\tfield\r\n\t\t});\r\n\t}\r\n\r\n\trenderFieldHistory() {\r\n\t\treturn this.renderView(VHistory);\r\n\t}\r\n\r\n\tasync showFieldHistory(field:string) {\r\n\t\tawait this.startFieldHistory(this.item, field);\r\n\t\tthis.openVPage(VHistoryPage);\r\n\t}\r\n\r\n\tasync loadDayValues() {\r\n\t\tlet {far, near} = this.timeSpan;\r\n\t\tlet ret = await this.midIDX.loadDayValues(this.item.id, this.field, far, near);\r\n\t\tlet dayValues = this.timeSpan.getDayValues(ret);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.dayValues = dayValues;\r\n\t\t});\r\n\t}\r\n\r\n\tsetCurrentField(field:string) {\r\n\t\tthis.field = field;\r\n\t\tthis.loadDayValues();\r\n\t}\r\n\r\n\tasync saveFieldValue(field:string, t:number, value:number|string) {\r\n\t\tlet {id} = this.item;\r\n\t\tawait this.midIDX.saveFieldValue(id, field, t, value);\r\n\t\tlet ret = await this.midIDX.loadFieldSum(id, field, this.timeSpan);\r\n\t\tlet v= ret[field];\r\n\t\tthis.spanValues[field] = v;\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { ID, Schema, UiSchema, Uq, Prop, IDX } from \"tonva-react\";\r\nimport { TimeSpan } from \"../../tools\";\r\nimport { Mid } from \"../../base\";\r\n\r\nexport class MidIDX extends Mid {\r\n\treadonly IDX: IDX;\r\n\treadonly ID: ID;\r\n\treadonly timeZone: number;\r\n\tconstructor(uq: Uq, IDX: IDX, ID: ID, timeZone:number) {\r\n\t\tsuper(uq);\r\n\t\tthis.IDX = IDX;\r\n\t\tthis.ID = ID;\r\n\t\tthis.timeZone = timeZone;\r\n\t}\r\n\t\r\n\tasync init():Promise<void> {\r\n\t\tawait this.loadSchema();\r\n\t}\r\n\r\n\tprotected async loadSchema() {\r\n\t\tawait Promise.all([\r\n\t\t\tthis.IDX.loadSchema(),\r\n\t\t\tthis.ID.loadSchema(),\r\n\t\t]);\r\n\t\tlet IDUI = {ID: this.ID};\r\n\t\tthis._itemSchema = await this.buildItemSchema(IDUI);\r\n\t\tthis._uiSchema = this.buildUISchema(IDUI);\r\n\t\tthis._props = this.buildGridProps(this.IDX);\r\n\t\tlet {exFields} = this.IDX.schema;\r\n\t\tfor (let prop of this._props) {\r\n\t\t\tlet {name} = prop as any;\r\n\t\t\tif (!name) continue;\r\n\t\t\tlet ex = (exFields as any[])?.find(v => v.field === name);\r\n\t\t\tlet time = ex?.time;\r\n\t\t\tif (!time) continue;\r\n\t\t\t(prop as any).time = time;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tasync load(id:number): Promise<any[]> {\r\n\t\tlet ret = await this.uq.ID({\r\n\t\t\tIDX: [this.ID, this.IDX],\r\n\t\t\tid,\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\thistoryLoader = async (id:number, field:string, far:number, near:number, pageStart:any, pageSize:number):Promise<any[]> => {\r\n\t\tlet ret = await this.uq.IDLog({\r\n\t\t\tIDX: this.IDX,\r\n\t\t\tfield,\r\n\t\t\tid,\r\n\t\t\tlog: 'each',\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: pageStart,\r\n\t\t\t\tsize: pageSize,\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet param: any = {};\r\n\t\tparam[this.ID.name] = [data];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\tlet id = ret[this.ID.name];\r\n\t\treturn id[0];\r\n\t}\r\n\r\n\tasync saveFieldValue(id:number, fieldName:string, t:any, value:string|number):Promise<void> {\r\n\t\tlet param: any = {};\r\n\t\tlet val: any = {id};\r\n\t\tval[fieldName] = {\r\n\t\t\t$time: t,\r\n\t\t\tvalue,\r\n\t\t}\r\n\t\tparam[this.IDX.name] = [val];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadFieldSum(id:number, field:string, timeSpan:TimeSpan):Promise<any> {\r\n\t\tlet {far, near} = timeSpan;\r\n\t\tlet retSum = await this.uq.IDSum({\r\n\t\t\tIDX: this.IDX,\r\n\t\t\tfield: [field],\r\n\t\t\tid,\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t});\r\n\t\tlet ret = retSum[0];\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadSum(id:number, far:number, near:number):Promise<[any[], any[]]> {\r\n\t\tlet valueFields:string[] = [];\r\n\t\tlet {fields, exFields} = this.IDX.schema;\r\n\t\tif (exFields === undefined) {\r\n\t\t\tthrow new Error('no valid sum field in exFields');\r\n\t\t}\r\n\t\tfor (let ex of exFields) {\r\n\t\t\tlet {field, log} =  ex;\r\n\t\t\tif (log !== true) continue;\r\n\t\t\tlet f = (fields as any[]).find(v => v.name === field);\r\n\t\t\tif (f === undefined) continue;\r\n\t\t\tlet {name, type} = f;\r\n\t\t\tif (['int', 'tinyint', 'smallint', 'bigint', 'dec', 'float', 'double'].indexOf(type) < 0) continue;\r\n\t\t\tvalueFields.push(name);\r\n\t\t}\r\n\t\treturn await Promise.all([\r\n\t\t\tthis.uq.ID({\r\n\t\t\t\tIDX: this.IDX,\r\n\t\t\t\tid,\r\n\t\t\t}),\r\n\t\t\tthis.uq.IDSum({\r\n\t\t\t\tIDX: this.IDX,\r\n\t\t\t\tfield: valueFields,\r\n\t\t\t\tid,\r\n\t\t\t\tfar,\r\n\t\t\t\tnear,\r\n\t\t\t}),\r\n\t\t]);\r\n\t}\r\n\r\n\tasync loadDayValues(id:number, field: string, far:number, near:number):Promise<any[]> {\r\n\t\tif (!field) {\r\n\t\t\tfield = (this._props[0] as any)?.name;\r\n\t\t\tif (!field) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\talert('no field in loadDayValues');\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.uq.IDLog({\r\n\t\t\tIDX: this.IDX,\r\n\t\t\tfield,\r\n\t\t\tlog: 'day',\r\n\t\t\ttimeZone: this.timeZone,\r\n\t\t\tid,\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: near,\r\n\t\t\t\tend: far,\r\n\t\t\t\tsize: 100,\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate _itemSchema: Schema;\r\n\tget itemSchema(): Schema { return this._itemSchema; }\r\n\r\n\tprivate _uiSchema: UiSchema;\r\n\tget uiSchema(): UiSchema { return this._uiSchema; }\r\n\r\n\tprivate _props: Prop[];\r\n\tget props():Prop[] { return this._props; }\r\n}\r\n","import { Controller, ID, IX, Uq } from \"tonva-react\";\r\nimport { Mid } from \"../../base\";\r\nimport { CIXXList, MidIXList } from \"./CIXXList\";\r\n\r\nexport class MidIX extends Mid {\r\n\treadonly IX: IX;\r\n\treadonly ID: ID;\r\n\treadonly id: number;\r\n\tconstructor(uq:Uq, IX:IX, ID:ID, id:number, res?:any) {\r\n\t\tsuper(uq, res);\r\n\t\tthis.IX = IX;\r\n\t\tthis.ID = ID;\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tasync init(): Promise<void> {\r\n\t}\r\n}\r\n\r\nexport class CIXX<P extends MidIX> extends Controller {\r\n\tprotected readonly midIX: P;\r\n\r\n\tconstructor(midIX: P) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midIX.res);\r\n\t\tthis.midIX = midIX;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tlet {uq, IX, ID, id} = this.midIX;\r\n\t\tlet midIXList = new MidIXList(uq, IX, ID, id);\r\n\t\tmidIXList.onRightClick = this.onItemEdit;\r\n\t\tmidIXList.renderItem = undefined;\r\n\t\tmidIXList.onItemClick = this.onItemClick;\r\n\t\tmidIXList.renderRight = undefined;\r\n\t\tlet idList = new CIXXList(midIXList);\r\n\t\tawait idList.start();\r\n\t}\r\n\r\n\tprivate onItemEdit = () => {\r\n\r\n\t}\r\n\r\n\tprivate onItemClick = (item:any) => {\r\n\t\t\r\n\t}\r\n}\r\n","import { ID } from \"tonva-react\";\r\nimport { CIXX, MidIX } from \"./CIXX\";\r\nimport { CIXXList, MidIXList} from \"./CIXXList\";\r\nimport { CIXSelect, MidIXSelectList } from \"../select\";\r\n\r\nexport interface IXEditProps extends MidIX {\r\n\tID: ID;\r\n}\r\n\r\nexport class CIXXEdit extends CIXX<IXEditProps> {\r\n\tprivate cIXList: CIXXList<any>;\r\n\tprotected async internalStart() {\r\n\t\tlet {uq, IX, ID, id} = this.midIX;\r\n\t\tlet midIXList = new MidIXList(uq, IX, ID, id);\r\n\t\tmidIXList.onRightClick = this.onListRightClick;\r\n\t\tmidIXList.renderItem = undefined;\r\n\t\tmidIXList.onItemClick = undefined;\r\n\t\tmidIXList.renderRight = undefined;\r\n\t\tthis.cIXList = new CIXXList(midIXList);\r\n\t\tawait this.cIXList.start();\r\n\t}\r\n\r\n\tprivate onListRightClick = async () => {\r\n\t\tlet {uq, ID, IX, id} = this.midIX;\r\n\t\tlet midIXList = new MidIXSelectList(uq, ID, IX, id);\r\n\t\tmidIXList.renderItem = undefined;\r\n\t\tmidIXList.onSelectChange = this.onSelectChange;\r\n\t\tlet cSelect = new CIXSelect(midIXList);\r\n\t\tawait cSelect.start();\r\n\t}\r\n\r\n\tprivate onSelectChange = async (item:any, isSelected:boolean) => {\r\n\t\tlet param:any = {};\r\n\t\tlet {IX, id} = this.midIX;\r\n\t\tif (isSelected === false) {\r\n\t\t\t// id negtive means delete\r\n\t\t\tid = -id;\r\n\t\t}\r\n\t\tlet idItem = {ix:id, id: item.id};\r\n\t\tparam[IX.name] = [idItem];\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet ret = await this.midIX.uq.Acts(param);\r\n\t\tthis.cIXList.update(idItem);\r\n\t} \r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CSelect } from \"./CSelect\";\r\nimport { Tag } from '../MidTag';\r\nimport { ItemTags } from '../CIDTagList';\r\n\r\ninterface TagGroup {\r\n\tid: number;\r\n\tname:string;\r\n\tchecks: {tag: Tag, selected: boolean}[];\r\n}\r\n\r\nexport class VSelect extends VPage<CSelect> {\r\n\tprivate tagGroups:TagGroup[];\r\n\tinit() {\r\n\t\tlet {midTag, itemTags} = this.controller;\r\n\t\tlet {typeColl} = itemTags as ItemTags<any>;\r\n\t\tthis.tagGroups = [];\r\n\t\tfor (let midType of midTag.typeArr) {\r\n\t\t\tlet {id, name} = midType;\r\n\t\t\tlet type = typeColl[id];\r\n\t\t\tlet checks: {tag:Tag; selected: boolean}[] = [];\r\n\t\t\tlet tagGroup = {id, name, checks};\r\n\t\t\tfor (let s of midType.sub) {\r\n\t\t\t\tlet {id: tagId} = s;\r\n\t\t\t\tlet selected = \r\n\t\t\t\t\ttype === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t:\r\n\t\t\t\t\ttype.sub.findIndex(v => v.id === tagId) >= 0;\r\n\t\t\t\tchecks.push({tag:s, selected});\r\n\t\t\t}\r\n\t\t\tthis.tagGroups.push(tagGroup);\r\n\t\t}\r\n\t}\r\n\r\n\theader() {return 'select'}\r\n\tcontent() {\r\n\t\tlet {midTag, itemTags} = this.controller;\r\n\t\tlet {item} = itemTags;\r\n\t\t//let {tags} = midTag;\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\t<div className=\"my-3\">{midTag.ID.render(item)}</div>\r\n\t\t\t{this.tagGroups.map(v => this.renderType(v))}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderType(group: TagGroup) {\r\n\t\tlet {id, name, checks}  = group;\r\n\t\treturn <div key={id} className=\"my-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div className=\"form-check form-check-inline mt-1\">\r\n\t\t\t{checks.map(v => {\r\n\t\t\t\tlet {tag, selected} = v;\r\n\t\t\t\tlet {id, name} = tag;\r\n\t\t\t\treturn <>\r\n\t\t\t\t\t<label key={id} className=\"form-check-label mr-3\">\r\n\t\t\t\t\t<input type=\"checkbox\" className=\"form-check-input\"\r\n\t\t\t\t\t\tonChange={(evt) => this.controller.onTagSelectChanged(tag, evt.currentTarget.checked)}\r\n\t\t\t\t\t\tdefaultChecked={selected} />\r\n\t\t\t\t\t{name}</label>\r\n\t\t\t\t</>\r\n\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n}","import { IDUI, Uq } from \"tonva-react\";\r\nimport { Detail, Master, Mid } from \"../../base\";\r\n\r\nexport interface SheetUI {\r\n\tmaster: IDUI;\r\n\tdetail: IDUI;\r\n}\r\n\r\nexport class MidSheet<M extends Master, D extends Detail> extends Mid {\r\n\treadonly master: IDUI;\r\n\treadonly detail: IDUI;\r\n\r\n\tconstructor(uq:Uq, ui: SheetUI, res?:any) {\r\n\t\tsuper(uq, res);\r\n\t\tlet {master, detail} = ui;\r\n\t\tthis.master = master;\r\n\t\tthis.detail = detail;\r\n\t}\r\n\r\n\tasync init(): Promise<void> {\r\n\t}\r\n\r\n\tasync load(id:number):Promise<[M[],D[]]> {\r\n\t\treturn [[], []];\r\n\t}\r\n\r\n\tasync save(master:M, details:D[]):Promise<any> {\r\n\t\tlet ret = await this.uq.ActDetail({\r\n\t\t\tmaster: {\r\n\t\t\t\tID: this.master.ID,\r\n\t\t\t\tvalue: master,\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tID: this.detail.ID,\r\n\t\t\t\tvalues: details,\r\n\t\t\t},\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n};\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { Context, Controller } from \"tonva-react\";\r\nimport { createPickId } from \"../select\";\r\nimport { CFormPage, FormUI } from \"../../form\";\r\nimport { Detail, Master } from \"../../base\";\r\nimport { MidSheet } from \"./MidSheet\";\r\n\r\nexport abstract class CSheet<M extends Master, D extends Detail> extends Controller {\r\n\treadonly midSheet: MidSheet<M, D>;\r\n\tid: number;\r\n\tmaster: M = null;\r\n\tdetails: D[] = [];\r\n\tdetail: D = null;\r\n\r\n\tconstructor(mid: MidSheet<M, D>) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\tmaster: observable,\r\n\t\t\tdetails: observable,\r\n\t\t});\r\n\t\tthis.setRes(mid.res);\r\n\t\tthis.midSheet = mid;\r\n\t}\r\n\r\n\tprotected async load(id:number) {\r\n\t\tthis.id = id;\r\n\t\tlet [master, details] = await this.midSheet.load(id);\r\n\t\tthis.master = master[0];\r\n\t\tthis.details = details;\r\n\t}\r\n\r\n\tasync saveSheet() {\r\n\t\tlet ret = await this.midSheet.save(this.master, this.details);\r\n\t\treturn ret;\r\n\t}\r\n\t\r\n\tafterMasterNew() {\r\n\r\n\t}\r\n\r\n\tprivate serial:number = 1;\r\n\teditDetail = async (detail: D) => {\r\n\t\tlet {uq, detail:detailFormUI} = this.midSheet;\r\n\t\tlet {ID, fieldCustoms} = detailFormUI;\r\n\t\tlet uiForm = new FormUI(ID.ui, fieldCustoms);\r\n\t\tif (fieldCustoms) {\r\n\t\t\tfor (let i in fieldCustoms) {\r\n\t\t\t\tlet field = fieldCustoms[i];\r\n\t\t\t\tlet {ID} = field;\r\n\t\t\t\tif (ID) {\r\n\t\t\t\t\tuiForm.setIDUi(i, createPickId(uq, ID), ID.render);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tuiForm.hideField('master', 'row');\r\n\t\tlet cForm = new CFormPage(uiForm, detail);\r\n\t\tcForm.onSubmit = async (name:string, context: Context) => {\r\n\t\t\tlet values = context.data;\r\n\t\t\tlet serial = values['#'];\r\n\t\t\tif (!serial) {\r\n\t\t\t\tvalues['#'] = this.serial++;\r\n\t\t\t\tthis.details.push(values);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet index = this.details.findIndex(v => (v as any)['#'] === serial);\r\n\t\t\t\tif (index >= 0) {\r\n\t\t\t\t\tObject.assign(this.details[index], values);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.closePage();\r\n\t\t\tif (detail === undefined) {\r\n\t\t\t\tlet cForm = new CFormPage(uiForm, detail);\r\n\t\t\t\tawait cForm.start();\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait cForm.start();\r\n\t}\r\n}\r\n","import { FA, List, LMR, Page, VPage } from \"tonva-react\";\r\nimport { CSheet } from \"./CSheet\";\r\n\r\nexport class VSheetEdit extends VPage<CSheet<any, any>> {\r\n\theader() {return 'sheet';}\r\n\tright() {\r\n\t\treturn <button className=\"btn btn-primary btn-sm mr-2\"\r\n\t\t\tonClick={this.saveSheet}>\r\n\t\t\t整单完成\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {midSheet: mid, master, details} = this.controller;\r\n\t\tlet {ID} = mid.master;\r\n\t\tlet right = <button className=\"btn btn-success btn-sm\"\r\n\t\t\tonClick={() => this.controller.editDetail(undefined)}>\r\n\t\t\t<FA name=\"plus\" />\r\n\t\t</button>;\r\n\t\treturn <div className=\"my-3\">\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{ID.render(master)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"mt-3 pb-1 mb-1 px-3 small text-muted border-bottom\">\r\n\t\t\t\t<LMR right={right} className=\"align-items-end\">明细</LMR>\r\n\t\t\t</div>\r\n\t\t\t<List items={details} item={{render: this.renderDetail, onClick: this.onDetailClick}} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onDetailClick = (item: any) => {\r\n\t\tthis.controller.editDetail(item);\r\n\t}\r\n\r\n\tprivate renderDetail = (item:any, index:number) => {\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{this.controller.midSheet.detail.ID.render(item)}\r\n\t\t</div>\r\n\t}\r\n//\t{JSON.stringify(item)}\r\n\r\n\tprivate saveSheet = async () => {\r\n\t\tlet ret = await this.controller.saveSheet();\r\n\t\tthis.closePage();\r\n\t\tthis.openPageElement(<Page header=\"单据完成\">\r\n\t\t\t<div className=\"p-3 text-center\">\r\n\t\t\t\t<div className=\"my-3\">单据保存成功！</div>\r\n\t\t\t\t<div className=\"my-3\">{ret.master}</div>\r\n\t\t\t\t<button className=\"btn btn-primary\" onClick={()=>this.closePage()}>返回</button>\r\n\t\t\t</div>\r\n\t\t</Page>)\r\n\t}\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CSheet } from \"./CSheet\";\r\n\r\nexport class VSheetView extends VPage<CSheet<any, any>> {\r\n\theader() {return this.controller.midSheet.master.ID.ui.label}\r\n\tcontent() {\r\n\t\tlet {midSheet: mid, master} = this.controller;\r\n\t\tlet {ID} = mid.master;\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{ID.render(master)}\r\n\t\t</div>;\r\n\t}\r\n}","import { ID, IX, Uq } from \"tonva-react\";\r\nimport { Mid } from \"../../base\";\r\n\r\ninterface TagTree {\r\n\tid: number;\r\n\tparent: number;\r\n\tname: string;\r\n\tsub: {[id:number]: TagTree};\r\n\tcount: number;\r\n}\r\n\r\ninterface TagItem {\r\n\tid: number;\r\n\tparent: number;\r\n\tname: string;\r\n}\r\n\r\nexport interface Tag {\r\n\tid: number;\r\n\tname: string;\r\n\tparent: number;\r\n\tsub: Tag[];\r\n}\r\n\r\nexport class MidTag extends Mid {\r\n\treadonly ID: ID;\r\n\treadonly IX: IX;\r\n\treadonly tag: ID;\r\n\treadonly type: string;\r\n\t\r\n\ttypeArr: Tag[];\r\n\ttypeColl: {[id:number]: Tag};\r\n\r\n\tconstructor(uq: Uq, ID:ID, IX:IX, tag:ID, type: string) {\r\n\t\tsuper(uq);\r\n\t\tthis.ID = ID;\r\n\t\tthis.IX = IX;\r\n\t\tthis.tag = tag;\r\n\t\tthis.type = type;\r\n\t}\r\n\r\n\tasync init():Promise<void> {\r\n\t\tawait this.load();\r\n\t}\r\n\r\n\tprotected async load(): Promise<void> {\r\n\t\tif (this.typeArr) return;\r\n\t\tlet ret = await Promise.all([\r\n\t\t\tthis.ID.loadSchema(),\r\n\t\t\tthis.IX.loadSchema(),\r\n\t\t\tthis.tag.loadSchema(),\r\n\t\t\tthis.uq.IDTree<TagItem>({\r\n\t\t\t\tID: this.tag,\r\n\t\t\t\tparent: 0,\r\n\t\t\t\tkey: this.type,\r\n\t\t\t\tlevel: 3,\r\n\t\t\t\tpage: {start:0, size:1000},\r\n\t\t\t})\r\n\t\t]);\r\n\t\tthis.buildTagTypes(ret[3]);\r\n\t}\r\n\r\n\tprivate buildTagTypes(items: TagItem[]) {\r\n\t\tlet root:TagTree;\r\n\t\tlet tree:TagTree = {id:0, parent:-1, name:undefined, sub:{}, count:0};\r\n\t\tfor (let item of items) {\r\n\t\t\tlet {id, parent, name} = item;\r\n\t\t\tif (parent === 0) {\r\n\t\t\t\ttree.sub[id] = root = {id, parent, name, sub: {}, count:0};\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet p = tree.sub[parent];\r\n\t\t\tlet tag:TagTree = {id, parent, name, sub: {}, count:0};\r\n\t\t\ttree.sub[id] = tag;\r\n\t\t\tif (p !== undefined) {\r\n\t\t\t\tp.sub[id] = tag;\r\n\t\t\t\tp.count++;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let i in tree.sub) {\r\n\t\t\tlet tag = tree.sub[i];\r\n\t\t\tlet {parent} = tag;\r\n\t\t\tif (parent > 0) {\r\n\t\t\t\tlet p = tree.sub[parent];\r\n\t\t\t\tif (p) p.sub[Number(i)] = tag;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.typeArr = [];\r\n\t\tthis.typeColl = {};\r\n\t\tif (!root) return;\r\n\t\tfor (let i in root.sub) {\r\n\t\t\tlet tree = root.sub[i];\r\n\t\t\tlet {id, name} = tree;\r\n\t\t\tlet type:Tag = {id, name, sub:[], parent: undefined};\r\n\t\t\tthis.typeArr.push(type);\r\n\t\t\tthis.typeColl[id] = type;\r\n\t\t\tfor (let j in tree.sub) {\r\n\t\t\t\tlet s = tree.sub[j];\r\n\t\t\t\tlet {id, name} = s;\r\n\t\t\t\ttype.sub.push({id, name, sub:undefined, parent:type.id})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { Controller } from \"tonva-react\";\r\nimport { MidTag, Tag } from \"../MidTag\";\r\nimport { CIDTagList } from '../CIDTagList';\r\nimport { VSelect } from \"./VSelect\";\r\n\r\nexport class CSelect extends Controller {\r\n\tprivate cIDTagList: CIDTagList<any>;\r\n\titemTags: any;\r\n\tmidTag: MidTag;\r\n\tconstructor(cIDTagList: CIDTagList<any>, itemTags:any, midTag: MidTag) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midTag.res);\r\n\t\tthis.cIDTagList = cIDTagList;\r\n\t\tthis.itemTags = itemTags;\r\n\t\tthis.midTag = midTag;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VSelect);\r\n\t}\r\n\r\n\tprotected onItemClick(item:any):void {\r\n\t\treturn; //this.props.onItemClick(item);\r\n\t}\r\n\r\n\tprotected renderRight():JSX.Element {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tonTagSelectChanged = async (tag:Tag, selected:boolean) => {\r\n\t\tawait this.cIDTagList.onTagSelectChanged(this.itemTags, tag, selected);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA } from \"tonva-react\";\r\nimport { IDBase } from \"../../base\";\r\nimport { MidIDTagList, ItemTags } from \"./CIDTagList\";\r\nimport { Tag } from \"./MidTag\";\r\n\r\nexport function renderRight(onClick: () => void) {\r\n\treturn <button className=\"btn btn-sm btn-primary mr-2\" onClick={onClick}>\r\n\t\t<FA name=\"plus\" />\r\n\t</button>;\r\n}\r\n\r\nexport function renderItemTags<T extends IDBase>(midIDTagList: MidIDTagList<T>, itemTags:ItemTags<T>, index:number):JSX.Element {\r\n\tlet V = observer(() => {\r\n\t\tlet {midTag, renderItem, renderTags} = midIDTagList;\r\n\t\t//let {renderItem} = midTag;\r\n\t\tlet {ID} = midTag;\r\n\t\tlet {item, typeArr} = itemTags;\r\n\t\treturn <div className=\"d-block\">\r\n\t\t\t<div>{(renderItem ??  ID.render)(item as any, index)}</div>\r\n\t\t\t<div className=\"text-muted mt-1\">{(renderTags ?? defaultRenderTags)(typeArr)}</div>\r\n\t\t</div>;\t\r\n\t});\r\n\treturn <V />;\r\n}\r\n\r\nfunction defaultRenderTags(typeArr:Tag[]):JSX.Element {\r\n\treturn <>\r\n\t\t{\r\n\t\t\ttypeArr.map(type => {\r\n\t\t\t\tlet {id, name} = type;\r\n\t\t\t\treturn <span key={id} className=\"mr-3\">\r\n\t\t\t\t\t<b>{name}</b>: {renderType(type)}\r\n\t\t\t\t</span>;\r\n\t\t\t})\r\n\t\t}\r\n\t</>;\r\n}\r\n\r\nfunction renderType(type:Tag):JSX.Element {\r\n\tlet V = observer(() => {\r\n\t\tlet {sub} = type;\r\n\t\treturn <>{sub.map(tag => {\r\n\t\t\tlet {id, name} = tag;\r\n\t\t\treturn <span className=\"mr-1\" key={id}>{name}</span>\r\n\t\t})}</>;\r\n\t});\r\n\treturn <V />;\r\n}","import { CList, MidList } from \"../list\";\r\nimport { IXBase, IDBase } from \"../../base\";\r\nimport { ListPageItems } from \"../../tools\";\r\nimport { CSelect } from \"./select\";\r\nimport { MidTag, Tag } from \"./MidTag\";\r\nimport { renderItemTags } from \"./parts\";\r\nimport { observable } from \"mobx\";\r\n\r\nexport interface ItemTags<T> {\r\n\titem: T;\r\n\ttypeArr: Tag[];\r\n\ttypeColl: {[id:number]:Tag};\r\n}\r\n\r\nexport class CIDTagList<T extends IDBase> extends CList<ItemTags<T>> {\r\n\tprivate midIDTagList: MidIDTagList<T>;\r\n\tconstructor(midIDTagList: MidIDTagList<T>) {\r\n\t\tsuper(midIDTagList);\r\n\t\tthis.setRes(midIDTagList.res);\r\n\t\tthis.midIDTagList = midIDTagList;\r\n\t}\r\n\r\n\tasync beforeStart():Promise<boolean> {\r\n\t\tawait this.midIDTagList.midTag.init();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected onItemClick(item:any):void {\r\n\t\tlet {midTag} = this.midIDTagList;\r\n\t\tlet cSelect = new CSelect(this, item, midTag);\r\n\t\tcSelect.start();\r\n\t}\r\n\r\n\tprotected renderItem(itemTags:ItemTags<T>, index:number):JSX.Element {\r\n\t\treturn renderItemTags(this.midIDTagList, itemTags, index);\r\n\t}\r\n\r\n\tasync onTagSelectChanged(item:any, tag:Tag, selected:boolean) {\r\n\t\tawait this.midIDTagList.onTagSelectChanged(item, tag, selected);\r\n\t}\r\n}\r\n\r\nexport class MidIDTagList<T extends IDBase> extends MidList<ItemTags<T>> {\r\n\treadonly midTag: MidTag;\r\n\tprivate itemTagsColl:{[id:number]:ItemTags<T>};\r\n\trenderTags: (types:Tag[]) => JSX.Element;\r\n\tconstructor(midTag:MidTag) {\r\n\t\tsuper(midTag.uq, undefined);\r\n\t\tthis.midTag = midTag;\r\n\t\tthis.createPageItems();\r\n\t}\r\n\r\n\tasync init() {\r\n\t\tawait this.midTag.IX.loadSchema();\r\n\t}\r\n\r\n\tprotected createPageItems():ItemTagsListPageItems<T> {\r\n\t\tlet listPageItems = new ItemTagsListPageItems<T>(\r\n\t\t\t(pageStart:any, pageSize:number) => this.loadPageItems(pageStart, pageSize)\r\n\t\t);\r\n\t\treturn listPageItems;\r\n\t}\r\n\r\n\tkey:((item:ItemTags<T>) => number|string) = item => item.item.id;\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<ItemTags<T>[]> {\r\n\t\tlet result = await this.uq.IDxID<T, any>({\r\n\t\t\tID: this.midTag.ID,\r\n\t\t\tIX: this.midTag.IX,\r\n\t\t\tID2: this.midTag.tag,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\tlet [ret, ret2] = result;\r\n\t\tlet itemTagsList:ItemTags<T>[] = [];\r\n\t\tthis.itemTagsColl = {}\r\n\t\tfor (let item of ret) {\r\n\t\t\tlet p:ItemTags<T> = {item, typeArr:[], typeColl:{}};\r\n\t\t\tthis.itemTagsColl[item.id] = p;\r\n\t\t\titemTagsList.push(p);\r\n\t\t}\r\n\t\tfor (let tagItem of ret2) {\r\n\t\t\tlet {$xid, parent, id} = tagItem;\r\n\t\t\tlet itemTags = this.itemTagsColl[$xid];\r\n\t\t\tthis.addTag(itemTags, parent, id);\r\n\t\t\t/*\r\n\t\t\tlet {typeColl, typeArr} = itemTags;\r\n\t\t\tlet type = typeColl[parent];\r\n\t\t\tlet midType = this.midTag.typeColl[parent];\r\n\t\t\tif (type === undefined) {\r\n\t\t\t\ttype = {id:midType.id, name:midType.name, sub:[], parent:undefined};\r\n\t\t\t\ttypeColl[parent] = type;\r\n\t\t\t\ttypeArr.push(type);\r\n\t\t\t}\r\n\t\t\ttype.sub.push(midType.sub.find(v => v.id === id));\r\n\t\t\t*/\r\n\t\t}\r\n\t\treturn itemTagsList;\r\n\t}\r\n\r\n\tprivate addTag(itemTags:ItemTags<T>, typeId:number, tagId:number) {\r\n\t\tlet {typeColl, typeArr} = itemTags;\r\n\t\tlet midType = this.midTag.typeColl[typeId];\r\n\t\tlet type = typeColl[typeId];\r\n\t\tlet tag = midType.sub.find(v => v.id === tagId);\r\n\t\tif (type === undefined) {\r\n\t\t\ttype = observable.object({id:midType.id, name:midType.name, sub:[tag], parent:undefined});\r\n\t\t\ttypeColl[typeId] = type;\r\n\t\t\ttypeArr.push(type);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttype.sub.push(tag);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate delTag(itemTags:ItemTags<T>, typeId:number, tagId:number) {\r\n\t\tlet {typeColl, typeArr} = itemTags;\r\n\t\tlet type = typeColl[typeId];\r\n\t\tif (type === undefined) return;\r\n\t\tlet {sub} = type;\r\n\t\tlet index = sub.findIndex(v => v.id === tagId);\r\n\t\tif (index < 0) return;\r\n\t\tsub.splice(index, 1);\r\n\t\tif (sub.length === 0) {\r\n\t\t\tlet typeIndex = typeArr.findIndex(v => v.id === type.id);\r\n\t\t\tif (typeIndex >= 0) typeArr.splice(typeIndex, 1);\r\n\t\t\tdelete typeColl[typeId];\r\n\t\t}\r\n\t}\r\n\r\n\tonTagSelectChanged = async (itemTags:ItemTags<T>, tag:Tag, selected:boolean) => {\r\n\t\tlet {item} = itemTags;\r\n\t\tlet {id:itemId} = item;\r\n\t\tlet {id, parent} = tag;\r\n\t\tlet ix:IXBase = {ix:undefined, xi:id};\r\n\t\tlet acts:{[name:string]: IXBase[]} = {};\r\n\t\tacts[this.midTag.tag.name] = [ix];\r\n\t\tif (selected === true) {\r\n\t\t\tix.id = itemId;\r\n\t\t\tawait this.uq.Acts(acts);\r\n\t\t\tthis.addTag(itemTags, parent, id);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tix.id = -itemId;\r\n\t\t\tawait this.uq.Acts(acts);\r\n\t\t\tthis.delTag(itemTags, parent, id);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass ItemTagsListPageItems<T extends IDBase> extends ListPageItems<ItemTags<T>> {\r\n\titemId(item:ItemTags<T>):number {return item.item.id}\r\n\tnewItem(id:number, itemTags:ItemTags<T>):ItemTags<T> {\r\n\t\tlet {item, typeArr, typeColl} = itemTags;\r\n\t\treturn {\r\n\t\t\titem: {...item, id},\r\n\t\t\ttypeArr,\r\n\t\t\ttypeColl,\r\n\t\t}\r\n\t}\r\n\tupdate(item: ItemTags<T>):Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { LMR, VPage } from \"tonva-react\";\r\nimport { CTagIDList } from \"./CTagIDList\";\r\nimport { Tag } from \"./MidTag\";\r\n\r\nexport class VTags extends VPage<CTagIDList<any>> {\r\n\tprivate tags: Tag[] = [];\r\n\r\n\theader() {return 'tags'}\r\n\tcontent() {\r\n\t\tlet {midTag} = this.controller;\r\n\t\tlet {typeArr} = midTag;\r\n\t\tlet left = <button className=\"btn btn-primary\" \r\n\t\t\tonClick={() => this.controller.showID(this.tags)}>\r\n\t\t\t查看\r\n\t\t</button>;\r\n\t\tlet right = <>\r\n\t\t\t<button className=\"btn btn-sm btn-outline-primary mr-3\" onClick={()=>this.allTags(true)}>全选</button>\r\n\t\t\t<button className=\"btn btn-sm btn-outline-info\" onClick={()=>this.allTags(false)}>全清</button>\r\n\t\t</>;\r\n\t\treturn <div className=\"px-3\" id=\"$all$tags$\">\r\n\t\t\t{typeArr.map(v => this.renderType(v))}\r\n\t\t\t<div className=\"border-top py-3\">\r\n\t\t\t\t<LMR left={left} right={right} />\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate allTags = (selected:boolean) => {\r\n\t\tlet el = document.getElementById('$all$tags$');\r\n\t\tlet checkInputs = el.getElementsByTagName('input');\r\n\t\tfor (let i=0; i<checkInputs.length; i++) {\r\n\t\t\tlet checkInput = checkInputs[i];\r\n\t\t\tcheckInput.checked = selected;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderType(type: Tag) {\r\n\t\tlet {id, name, sub}  = type;\r\n\t\treturn <div key={id} className=\"my-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div className=\"form-check form-check-inline mt-1\">\r\n\t\t\t{sub.map(v => {\r\n\t\t\t\tlet {id, name} = v;\r\n\t\t\t\treturn <>\r\n\t\t\t\t\t<label key={id} className=\"form-check-label mr-3\">\r\n\t\t\t\t\t<input type=\"checkbox\" className=\"form-check-input\"\r\n\t\t\t\t\t\tonChange={(evt) => this.onTagSelectChanged(evt, v)}\r\n\t\t\t\t\t\t />\r\n\t\t\t\t\t{name}</label>\r\n\t\t\t\t</>\r\n\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate onTagSelectChanged(evt: React.ChangeEvent<HTMLInputElement>, tag:Tag) {\r\n\t\tif (evt.currentTarget.checked === true) {\r\n\t\t\tthis.tags.push(tag);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet index = this.tags.findIndex(v => v === tag);\r\n\t\t\tif (index >= 0) this.tags.splice(index, 1);\r\n\t\t}\r\n\t}\r\n}\r\n","import { Controller } from \"tonva-react\";\r\nimport { IDBase } from \"../../base\";\r\nimport { listRight } from \"../../tools\";\r\nimport { CList } from \"../list\";\r\nimport { MidTag, Tag } from \"./MidTag\";\r\nimport { CID, MidID, MidIDList } from \"../ID\";\r\nimport { VTags } from \"./VTags\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class CTagIDList<T extends IDBase> extends  Controller {\r\n\treadonly midTag: MidTag;\r\n\tconstructor(midTag: MidTag) {\r\n\t\tsuper();\r\n\t\tthis.setRes(midTag.res);\r\n\t\tthis.midTag = midTag;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tawait this.midTag.init();\r\n\t\tthis.openVPage(VTags);\r\n\t}\r\n\r\n\tasync showID(tags: Tag[]) {\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet midIDList: MidTagIDList<T> = new MidTagIDList<any>(\r\n\t\t\tthis.midTag, tags.map(v => v.id)\r\n\t\t);\r\n\t\tlet cShowTagIDList = new CShowTagIDList(midIDList);\r\n\t\tawait cShowTagIDList.start();\r\n\t}\r\n}\r\n\r\nclass CShowTagIDList<T extends IDBase> extends CList<T> {\r\n\tprotected midIDList: MidTagIDList<T>;\r\n\tconstructor(midIDList: MidTagIDList<T>) {\r\n\t\tsuper(midIDList);\r\n\t\tthis.midIDList = midIDList;\r\n\t}\r\n\r\n\tasync beforeStart():Promise<boolean> {\r\n\t\tawait this.midIDList.midTag.init();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprotected async onItemClick(item:any):Promise<void> {\r\n\t\tlet {midTag} = this.midIDList;\r\n\t\tlet mid = new MidID(midTag.uq, {ID: midTag.ID});\r\n\t\tawait mid.init();\r\n\t\tlet cID = new CID(mid);\r\n\t\tcID.onItemClick(item);\r\n\t\t//let cSelect = new CSelect(this, item, midTag, this.res);\r\n\t\t//cSelect.start();\r\n\t}\r\n\t\r\n\r\n\tprotected renderRight():JSX.Element {\r\n\t\tlet {onRightClick, renderRight} = this.midIDList;\r\n\t\tif (!onRightClick) return null;\r\n\t\treturn (renderRight ?? listRight)(onRightClick);\r\n\t}\r\n\r\n\tprotected renderItem(item:T, index:number):JSX.Element {\r\n\t\tlet {midTag, renderItem} = this.midIDList;\r\n\t\tlet {ID} = midTag;\r\n\t\t//let {item, typeArr} = itemTags;\r\n\t\treturn (renderItem ??  ID.render)(item, index);\r\n\t\t//return renderItemTags(this.props, itemTags, index);\r\n\t}\r\n}\r\n\r\nexport class MidTagIDList<T extends IDBase> extends MidIDList<T> {\r\n\treadonly midTag: MidTag;\r\n\treadonly ids: number[];\r\n\tconstructor(midTag:MidTag, ids:number[]) {\r\n\t\tlet {uq, ID} = midTag;\r\n\t\tsuper(uq, ID);\r\n\t\tthis.ids = ids;\r\n\t}\r\n \r\n\tasync init() {\r\n\t\tawait this.midTag.IX.loadSchema();\r\n\t}\r\n\r\n\tprotected async loadPageItems(pageStart:any, pageSize:number):Promise<T[]> {\r\n\t\tlet result = await this.uq.IXr<T>({\r\n\t\t\tIX: this.midTag.IX,\r\n\t\t\tIDX: [this.ID],\r\n\t\t\tix: this.ids,\r\n\t\t\tpage: {start:pageStart, size:pageSize},\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CRoles } from \"./CRoles\";\r\n\r\ninterface RoleItem {\r\n\tcaption: string;\r\n\tonClick: () => Promise<void>;\r\n}\r\n\r\nexport class VRoles extends VPage<CRoles> {\r\n\tprivate onRoleAdmin = async () => {\r\n\t\tthis.controller.showRoleAdmin();\r\n\t}\r\n\tprivate onAccountant = async () => {\r\n\t\t//this.openVPage(VAccountant);\r\n\t}\r\n\r\n\tprivate onManager = async () => {\r\n\t\t//this.openVPage(VManager);\r\n\t}\r\n\tprivate roleItems:{[role:string]: RoleItem} = {\r\n\t\t$: {\r\n\t\t\tcaption: '设置用户角色',\r\n\t\t\tonClick: this.onRoleAdmin,\r\n\t\t},\r\n\t\taccountant: {\r\n\t\t\tcaption: '会计',\r\n\t\t\tonClick: this.onAccountant,\r\n\t\t},\r\n\t\tmanager: {\r\n\t\t\tcaption: '经理',\r\n\t\t\tonClick: this.onManager,\r\n\t\t},\r\n\t};\r\n\r\n\theader() {\r\n\t\treturn this.t('backend')\r\n\t}\r\n\tcontent() {\r\n\t\tlet VContent = observer(() => {\r\n\t\t\tlet {roles} = this.controller;\r\n\t\t\treturn <div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{roles.map(this.renderRoleItem)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\t\r\n\t\t});\r\n\t\treturn <VContent />;\r\n\t}\r\n\r\n\tprivate renderRoleItem = (role:string, index:number):JSX.Element => {\r\n\t\tlet item = this.roleItems[role];\r\n\t\tif (!item) return null;\r\n\t\tlet {caption, onClick} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={onClick}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{caption}</div>\r\n\t\t</LMR>;\r\n\t}\r\n}","import { Form, ItemSchema, VPage, StringSchema, ButtonSchema, UiButton, UiTextItem, Context } from \"tonva-react\";\r\nimport { CRoleAdmin } from \"./CRoleAdmin\";\r\n\r\nexport class VAddUser extends VPage<CRoleAdmin> {\r\n\theader() {return '新增角色用户'}\r\n\tcontent() {\r\n\t\tlet schema:ItemSchema[] = [\r\n\t\t\t{ name: 'userName', required: true, type: 'string', maxLength: 60 } as StringSchema,\r\n\t\t\t{ name: 'ok', type: 'button' } as ButtonSchema,\r\n\t\t];\r\n\t\tlet uiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tuserName: { widget: 'text', label:'用户账号', placeholder: '请输入用户的账号' } as UiTextItem,\r\n\t\t\t\tok: { widget: 'button', className: 'btn btn-primary', label: '提交' } as UiButton,\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t<Form schema={schema} uiSchema={uiSchema} onButtonClick={this.onClick} onEnter={this.onEnter} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate onClick = async (name:string, context: Context) => {\r\n\t\tlet error = await this.controller.newUser(context.data['userName']);\r\n\t\tif (error) {\r\n\t\t\tcontext.setError('userName', error);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tprivate onEnter = async (name:string, context: Context) => {\r\n\t\tawait this.onClick(name, context);\r\n\t}\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport { FA, LMR, VPage } from \"tonva-react\";\r\nimport { CRoleAdmin, UserRole } from \"./CRoleAdmin\";\r\nimport { VAddUser } from \"./VAddUser\";\r\n\r\nexport class VRoleAdmin extends VPage<CRoleAdmin> {\r\n\theader() {return '设置用户角色'}\r\n\tcontent() {\r\n\t\tlet {userRoles} = this.controller;\r\n\t\tlet VItem = observer((v:{userRole:UserRole;isMe:boolean}) => this.renderItem(v.userRole, v.isMe));\r\n\t\tlet VUserRoles = observer(() => <>{\r\n\t\t\tuserRoles.map(v => {\r\n\t\t\t\treturn <VItem key={v.user} userRole={v} isMe={false} />;\r\n\t\t\t})\r\n\t\t}</>);\r\n\t\tlet MeItem = observer(() => <VItem userRole={this.controller.meRoles} isMe={true} />);\r\n\t\treturn <div>\r\n\t\t\t<div className=\"mx-3 mt-3 mb-1 d-flex align-items-end\">\r\n\t\t\t\t<div className=\"mr-auto\">用户角色</div>\r\n\t\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={()=>this.openVPage(VAddUser)}><FA name=\"plus\" /> 增加</button>\r\n\t\t\t</div>\r\n\t\t\t<MeItem />\r\n\t\t\t<VUserRoles />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (userRole: UserRole, isMe: boolean) => {\r\n\t\tif (!userRole) return null;\r\n\t\tlet {user, roles, isDeleted} = userRole;\r\n\t\tlet {roleCaptions, ixOfUsers} = this.controller;\r\n\t\tlet onUndo = () => this.controller.restoreUser(userRole);\r\n\t\tlet onDelete = () => this.controller.deleteUser(userRole);\r\n\t\tlet onRightClick: () => void;\r\n\t\tlet rightIcon:string;\r\n\t\tlet vUser = this.renderUser(user);\r\n\t\tlet cn = 'bg-white border-top ';\r\n\t\tif (isMe === true) {\r\n\t\t\tcn += 'mb-1';\r\n\t\t\tvUser = <>{vUser}<small className=\"ml-1 text-success\">[自己]</small></>;\r\n\t\t}\r\n\t\tif (isDeleted === true) {\r\n\t\t\tonRightClick = onUndo;\r\n\t\t\trightIcon = 'undo';\r\n\t\t\tvUser = <del>{vUser}</del>\r\n\t\t}\r\n\t\telse {\r\n\t\t\tonRightClick = onDelete;\r\n\t\t\trightIcon = 'times';\r\n\t\t}\r\n\t\tlet right = <div className=\"p-3 cursor-pointer text-info\" onClick={onRightClick}><FA name={rightIcon} /></div>;\r\n\t\treturn <LMR key={user} \r\n\t\t\tclassName={cn}\r\n\t\t\tleft = {<div className=\"p-3 w-12c\">{vUser}</div>}\r\n\t\t\tright = {right}\r\n\t\t\t>\t\t\t\r\n\t\t\t<div className=\"d-flex flex-wrap\">\r\n\t\t\t\t{roles.map((v, i) => {\r\n\t\t\t\t\tlet vCap:any = roleCaptions[i];\r\n\t\t\t\t\tif (isDeleted === true) vCap = <del>{vCap}</del>\r\n\t\t\t\t\treturn <label className=\"m-3\" key={i}>\r\n\t\t\t\t\t\t<input className=\"mr-2\" type='checkbox' \r\n\t\t\t\t\t\t\tdisabled={isDeleted} defaultChecked={v} \r\n\t\t\t\t\t\t\tonChange={e => this.onRoleChange(e, i, userRole)} />\r\n\t\t\t\t\t\t{vCap}\r\n\t\t\t\t\t</label>;\r\n\t\t\t\t})}\r\n\t\t\t\t{\r\n\t\t\t\t\tixOfUsers?.map(v => {\r\n\t\t\t\t\t\treturn <button key={v} onClick={() => this.controller.ixUserBind(user, v)}\r\n\t\t\t\t\t\t\tclassName=\"btn btn-sm btn-outline-info mx-3 my-2\">\r\n\t\t\t\t\t\t\t<small>关联</small> {v}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t</LMR>;\r\n\t}\r\n\r\n\tprivate async onRoleChange(event: React.ChangeEvent<HTMLInputElement>, iRole: number, userRole:UserRole) {\r\n\t\tlet {target} = event;\r\n\t\ttarget.disabled = true;\r\n\t\tawait this.controller.setUserRole(target.checked, iRole, userRole);\r\n\t\ttarget.disabled = false;\r\n\t}\r\n}\r\n","import { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { centerApi, Controller, UqApi, Uq } from \"tonva-react\";\r\nimport { CIXXEdit, MidIX } from \"../../IX\";\r\nimport { VRoleAdmin } from \"./VRoleAdmin\";\r\n\r\nexport interface UserRole {\r\n\tuser:number; \r\n\troles:boolean[];\r\n\tisDeleted?: boolean;\r\n}\r\n\r\nexport class CRoleAdmin extends Controller {\r\n\tprivate readonly uq:Uq;\r\n\tprivate readonly uqApi: UqApi;\r\n\treadonly allRoles: string[];\r\n\treadonly roleCaptions: string[];\r\n\tmeRoles: UserRole = null;\r\n\tuserRoles: UserRole[] = null;\r\n\tixOfUsers: string[];\r\n\tprivate myRolesChanged:(roles:string[])=>void;\r\n\r\n\tconstructor(uq:Uq, myRolesChanged?:(roles:string[])=>void, roleCaptionMap?:{[role:string]:string}) {\r\n\t\tsuper();\r\n\t\tmakeObservable(this, {\r\n\t\t\tmeRoles: observable,\r\n\t\t\tuserRoles: observable,\r\n\t\t});\r\n\t\tthis.uq = uq;\r\n\t\tlet {$:uqMan} = uq;\r\n\t\tthis.uqApi = uqMan.uqApi;\r\n\t\tthis.allRoles = uqMan.allRoles;\r\n\t\tif (!this.allRoles || this.allRoles.length === 0) {\r\n\t\t\tthrow new Error(`uq ${uqMan.name} allRoles not defined. No RoleAdmin needed.`);\r\n\t\t}\r\n\t\tthis.myRolesChanged = myRolesChanged;\r\n\t\tif (roleCaptionMap) {\r\n\t\t\tthis.roleCaptions = this.allRoles.map(v => roleCaptionMap[v] || v);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.roleCaptions = this.allRoles;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tlet allUserRoles = await this.uqApi.getAllRoleUsers();\r\n\t\trunInAction(() => {\r\n\t\t\tlet r0 = allUserRoles.shift();\r\n\t\t\tlet {roles} = r0;\r\n\t\t\tif (roles) {\r\n\t\t\t\tthis.ixOfUsers = roles.split('|');\r\n\t\t\t}\r\n\t\t\tlet arr:string[] = this.allRoles.map(v => `|${v}|`);\r\n\t\t\tfunction rolesBool(t:string): boolean[] {\r\n\t\t\t\tif (!t) return arr.map(v => false);\r\n\t\t\t\treturn arr.map(v => t.indexOf(v) >= 0);\r\n\t\t\t}\r\n\t\t\tthis.userRoles = [];\r\n\t\t\tlet meId = this.user.id;\r\n\t\t\tfor (let ur of allUserRoles) {\r\n\t\t\t\tlet {user, roles} = ur;\r\n\t\t\t\tlet item:UserRole = ur as any;\r\n\t\t\t\titem.roles = rolesBool(roles);\r\n\t\t\t\tif (user === meId)\r\n\t\t\t\t\tthis.meRoles = item;\r\n\t\t\t\telse\r\n\t\t\t\t\tthis.userRoles.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.openVPage(VRoleAdmin);\r\n\t}\r\n\t\r\n\tasync setUserRole(checked:boolean, iRole:number, userRole:UserRole) {\r\n\t\tlet {roles} = userRole;\r\n\t\tlet len = roles.length;\r\n\t\tlet text:string = '';\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet yes = i===iRole? checked : roles[i];\r\n\t\t\tif (yes === true) text += '|' + this.allRoles[i];\r\n\t\t}\r\n\t\ttext += '|';\r\n\t\tawait this.uqApi.setUserRoles(userRole.user, text);\r\n\t\troles[iRole] = checked;\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n\r\n\tprivate fireMyRolesChanged(userRole: UserRole, newRoles?:boolean[]) {\r\n\t\tif (!this.myRolesChanged) return;\r\n\t\tif (userRole !== this.meRoles) return;\r\n\t\tlet {roles} = userRole;\r\n\t\tif (newRoles) roles = newRoles;\r\n\t\tlet roleNames:string[] = ['$'];\r\n\t\tfor (let i=0; i<roles.length; i++) {\r\n\t\t\tif (roles[i] === true) roleNames.push(this.allRoles[i]);\r\n\t\t}\r\n\t\tthis.myRolesChanged(roleNames);\r\n\t}\r\n\r\n\tprivate buildRolesText(userRole:UserRole) {\r\n\t\tlet ret = userRole.roles.map((v, index) => v===true? this.allRoles[index]:'').join('|');\r\n\t\treturn `|${ret}|`;\r\n\t}\r\n\r\n\tasync newUser(userName: string): Promise<string> {\r\n\t\tlet ret = await centerApi.userFromKey(userName);\r\n\t\tif (!ret) {\r\n\t\t\treturn '这个用户名没有注册';\r\n\t\t}\r\n\t\tlet user = ret.id;\r\n\t\tlet roles: string;\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tif (this.meRoles) {\r\n\t\t\t\tthis.meRoles.isDeleted = false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.meRoles = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles:  this.allRoles.map(v => false)\r\n\t\t\t\t};\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet userRole = this.userRoles.find(v => v.user === user);\r\n\t\t\tif (userRole) {\r\n\t\t\t\tif (userRole.isDeleted === true) {\r\n\t\t\t\t\tuserRole.isDeleted = false;\r\n\t\t\t\t\troles = this.buildRolesText(userRole);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturn '这个用户已经是角色用户了';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuserRole = {\r\n\t\t\t\t\tuser,\r\n\t\t\t\t\troles: this.allRoles.map(v => false),\r\n\t\t\t\t};\r\n\t\t\t\tthis.userRoles.push(userRole);\r\n\t\t\t\troles = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tif (this.isMe(user) === true) {\r\n\t\t\tthis.fireMyRolesChanged(this.meRoles);\r\n\t\t}\r\n\t}\r\n\r\n\tasync deleteUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = true; \r\n\t\tawait this.uqApi.deleteUserRoles(user);\r\n\t\tthis.fireMyRolesChanged(userRole, this.allRoles.map(v => false));\r\n\t}\r\n\r\n\tasync restoreUser(userRole: UserRole) {\r\n\t\tlet {user} = userRole;\r\n\t\tuserRole.isDeleted = false; \r\n\t\tlet roles = this.buildRolesText(userRole)\r\n\t\tawait this.uqApi.setUserRoles(user, roles);\r\n\t\tthis.fireMyRolesChanged(userRole);\r\n\t}\r\n\r\n\tixUserBind = async (user:number, ixName:string) => {\r\n\t\tlet IX = this.uq.$.getIX(ixName);\r\n\t\tawait IX.loadSchema();\r\n\t\tlet {id2Name} = IX.schema;\r\n\t\tlet ID = this.uq.$.getID(id2Name);\r\n\t\tlet midIX = new MidIX(this.uq, IX, ID, user);\r\n\t\tlet cIXEdit = new CIXXEdit(midIX);\r\n\t\tawait cIXEdit.start();\r\n\t}\r\n}\r\n","import { Controller, nav, Uq } from \"tonva-react\";\r\nimport { VRoles } from \"./VRoles\";\r\nimport { CRoleAdmin } from './roleAdmin';\r\n\r\nconst roleCaptionMap:{[role:string]: string} = {\r\n\taccountant: '会计',\r\n\tmanager: '经理',\r\n}\r\n\r\nexport class CRoles extends Controller {\r\n\tprivate uq: Uq;\r\n\troles: string[] = null;\r\n\tconstructor(uq:Uq) {\r\n\t\tsuper();\t\t\r\n\t\tthis.uq = uq;\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.roles = await this.uq.$.getRoles();\r\n\t\tif (!this.roles) this.roles = [];\r\n\t\tthis.openVPage(VRoles)\r\n\t}\r\n\r\n\tasync showRoleAdmin() {\r\n\t\tlet  uqMan = this.uq.$;\r\n\t\tlet {allRoles} = uqMan;\r\n\t\tif (!allRoles || allRoles.length === 0) {\r\n\t\t\talert(`uq ${uqMan.name} has not defined roles`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet cRoleAdmin = new CRoleAdmin(this.uq, this.myRolesChanged, roleCaptionMap);\r\n\t\tcRoleAdmin.setRes(this.getRes());\r\n\t\tawait cRoleAdmin.start();\r\n\t}\r\n\r\n\tprivate myRolesChanged = (roles:string[]) => {\r\n\t\tthis.roles = roles;\r\n\t\tthis.user.roles[this.uq.$.name] = roles;\r\n\t\tnav.saveLocalUser();\r\n\t}\r\n}","import _ from 'lodash';\r\nimport { Context } from '../context';\r\nimport { FormRes } from '../../../res/formRes';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: FormRes;\r\n    constructor(res: FormRes) {\r\n        super();\r\n        this.res = res;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: FormRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(res.min);\r\n        this.maxMsg = _.template(res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../../schema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n\tprotected defaultValue: any;\r\n    protected rules: Rule[];\r\n    protected readOnly:boolean;\r\n\t\r\n\tdisabled:boolean = false;\r\n    errors: string[] = [];\r\n    contextErrors: string[] = [];\r\n    get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    visible:boolean = null;\r\n\tvalue: any = null;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\tcontextErrors: observable,\r\n\t\t\thasError: computed,\r\n\t\t\tvisible: observable,\r\n\t\t\tvalue: observable,\r\n\t\t\tdisabled: observable,\r\n\t\t\tisOk: computed,\r\n\t\t});\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);\r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema {return this._itemSchema};\r\n    protected get ui(): UiItem {return this._ui};\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {\r\n\t\tthis.disabled = value;\r\n\t}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    protected renderBody():JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let {discription, discriptionClassName} = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer(():JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label():string {\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ml-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { UiTextItem, StringSchema, ItemSchema } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\nimport { Widget } from './widget';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    hasFocus: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\thasFocus: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {\r\n\t\tif (this.ui) {\r\n\t\t\tlet {placeholder} = this.ui;\r\n\t\t\tif (placeholder) return placeholder;\r\n\t\t\tlet {label} = this.ui;\r\n\t\t\tif (label) return label;\r\n\t\t}\r\n\t\treturn this.name\r\n\t}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.onInputChange(evt);\r\n\t\t\tthis.checkRules();\r\n\t\t\tthis.context.checkContextRules();\r\n\t\t\tthis.hasFocus = false;\r\n\t\t});\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.context.removeErrorWidget(this);\r\n\t\t\tthis.context.clearErrors();\r\n\t\t\tthis.hasFocus = true;\t\r\n\t\t});\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n\t\tthis.onInputChange(evt);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={typeof this.placeholder === 'string'? this.placeholder : undefined}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { RuleNum, RuleInt } from '../rules';\r\nimport { NumBaseSchema } from '../../schema';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n\t\t\t\tnew RuleInt(res, min, max) :\r\n\t\t\t\tnew RuleNum(res, min, max)\r\n        );\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n\t\tswitch (typeof value) {\r\n\t\t\tdefault: return;\r\n\t\t\tcase 'undefined': return;\r\n\t\t\tcase 'number': return value;\r\n\t\t\tcase 'string':\r\n\t\t\t\tif ((value as string).trim().length === 0) return;\r\n\t\t\t\treturn Number(value);\r\n\t\t}\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiSelect } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    readOnly: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\treadOnly: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { runInAction } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n\t\tlet id = await pickId(this.context, this.name, this.value);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.setDataValue(id);\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t\tthis.checkRules();\t\r\n\t\t});\r\n    }\r\n\r\n\tsetValue(value:any) {\r\n\t\tsuper.setValue(value);\r\n\t}\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\nimport { runInAction } from 'mobx';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t})\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n\t\t\tawait this.context.submit(name);\r\n\t\t\treturn;\r\n        }\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.context.setError(name, ret);\r\n\t\t});\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string|JSX.Element;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = (type==='submit' && hasError) || this.disabled;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed, makeObservable, runInAction } from 'mobx';\r\nimport { ContextRule } from './rules';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n\treadonly isRow: boolean;\r\n\t\r\n    errors: string[] = [];\r\n    errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\terrorWidgets: observable,\r\n\t\t\thasError: computed,\r\n\t\t});\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet widget = this.widgets[itemName];\r\n\t\t\tif (widget === undefined) return;\r\n\t\t\twidget.setContextError(error);\r\n\t\t\tthis.addErrorWidget(widget);\t\r\n\t\t})\r\n    }\r\n\r\n    clearContextErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearContextError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.errors.splice(0);\r\n\t\t\tthis.errorWidgets.splice(0);\r\n\t\t\tthis.clearContextErrors();\t\r\n\t\t});\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ml-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel:string|JSX.Element = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n\r\n\timageSrc: string = null;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\timageSrc: observable,\r\n\t\t})\r\n\t}\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\ninterface WidgetFactory {\r\n\twidget?: TypeWidget;\r\n\tdataTypes?: DataType[];\r\n};\r\n\r\nconst stringWidget: WidgetFactory = {\r\n\tdataTypes: ['integer', 'number', 'string'],\r\n\twidget: TextWidget\r\n};\r\n\r\nconst widgetFactories: {[type: string]: WidgetFactory} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: stringWidget,\r\n\tstring: stringWidget,\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\t\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType, hiden} = ui;\r\n\t\tif (hiden === true) return null;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetFactories[widgetType];\r\n\t\t\t\tif (!widgetFactory) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tthrow new Error(`unknown widget ${widgetType}`);\r\n\t\t\t\t}\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n\tlet {widgets} = context;\r\n\tlet widget = widgets[name];\r\n\tif (!widget) {\r\n\t\twidget = new typeWidget(context, itemSchema, fieldProps, children);\r\n\t\twidget.init();\r\n\t\twidgets[name] = widget;\r\n\t}\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema, UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\nimport { FormRes, formRes, resLang } from '../../res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n\tfieldLabelAlign?: 'left'|'center'|'right';\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: FormRes;\r\n    formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n\t\t} = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n\t\tif (!this.formContext) {\r\n\t\t\tthis.formContext = new FormContext(this, false);\r\n\t\t}\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize, fieldLabelAlign} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n\t\t\t\tlet cnAlign: string;\r\n\t\t\t\tswitch (fieldLabelAlign) {\r\n\t\t\t\t\tcase 'right': cnAlign = 'text-sm-right'; break;\r\n\t\t\t\t\tcase 'center': cnAlign = 'text-sm-center'; break;\r\n\t\t\t\t}\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label', cnAlign)}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport interface InputOptions {\r\n\ttype: string;\r\n\tmin?: number;\r\n\tmax?: number;\r\n\tstep?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n\t}\r\n\t\r\n\tprotected inputOptions():InputOptions {\r\n\t\treturn {\r\n\t\t\ttype: 'text',\r\n\t\t}\r\n\t}\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (!this.error) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tlet {type, max, min, step} = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<input type={type}\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {name} = this.itemSchema;\r\n        let {list} = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (!this.error) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value} \r\n                        onClick={()=>this.onChange(value)} \r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n    get uiItem(): UiTag {return this._uiItem as UiTag};\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n\t}\r\n\t\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs():JSX.Element;\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (!this.error) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {name:itemName, id} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n        return <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType:'radio'|'checkbox' = 'radio';\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet {currentTarget} = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n        this.newValue = Number(currentTarget.value);\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\t\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.newValue = values.join('|');\r\n        //this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (!this.error) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n\t\t\t// if (evt.keyCode === 13) onSave();\r\n\t\t}\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\trows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import React from 'react';\r\nimport { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {stopEdit} = this.props;\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string|JSX.Element, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n\t\t\t\tlet rowContainerClassName = this.rowContainerClassName;\r\n\t\t\t\tlet {editInRow} = itemEdit;\r\n\t\t\t\tif (editInRow === false) {\r\n\t\t\t\t\tif (stopEdit !== true) editInRow = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{editInRow === false && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tasync onItemChanged(itemEdit:ItemEdit, newValue:any) {\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n\t\tthis.props.data[itemSchema.name] = newValue;\r\n        let {onItemChanged, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n\t\tif (onItemChanged === undefined) {\r\n\t\t\talert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n\t\t\t//this.props.data[itemSchema.name] = changeValue;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait onItemChanged(itemSchema, newValue, value);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value, editInRow} = itemEdit;\r\n\t\tif (editInRow === true) return;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\r\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\r\n\t\t\tcase 'range': itemEdit = RangeItemEdit; break;\r\n\t\t\tcase 'number':\r\n\t\t\tcase 'updown': itemEdit = NumberItemEdit; break;\r\n\t\t\tcase 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t\tcase 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n\t\t\t\tcase 'number':\r\n\t\t\t\tcase 'integer': itemEdit = RangeItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","import { VPage } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nexport class VIDX extends VPage<CIDX<any>> {\r\n\theader() {return 'VIDX'};\r\n\tcontent() {\r\n\t\treturn <div>\r\n\t\t\tIDX\r\n\t\t</div>\r\n\t}\r\n}","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\tday: '日',\r\n\tweek: '周',\r\n\tmonth: '月',\r\n\tyear: '年',\r\n}","export const en = {\r\n\tday: 'Day',\r\n\tweek: 'Week',\r\n\tmonth: 'Month',\r\n\tyear: 'Year',\r\n}\r\n","import { makeObservable, observable, runInAction, toJS } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { CSSProperties } from \"react\";\r\nimport { Bar } from \"react-chartjs-2\";\r\nimport { FA, LMR, NumberProp, Prop, VPage } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nconst spans = ['week', 'month'];\r\n\r\nconst graphOptions = {\r\n\ttitle: {\r\n\t\tdisplay: false,\r\n\t},\r\n\tmaintainAspectRatio: false,\r\n}\r\n\r\nexport class VView extends VPage<CIDX<any>> {\r\n\tcurrentIndex: number = 0;\r\n\tconstructor(controller:CIDX<any>) {\r\n\t\tsuper(controller);\r\n\t\tmakeObservable(this, {\r\n\t\t\tcurrentIndex: observable,\r\n\t\t});\r\n\t}\r\n\r\n\theader() {return 'View'}\r\n\tright() {\r\n\t\treturn <button\r\n\t\t\tclassName=\"btn btn-sm btn-primary mr-2\" \r\n\t\t\tonClick={() => this.controller.onItemEdit()}>\r\n\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t</button>;\r\n\t}\r\n\tcontent() {\t\t\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {spanValues, gridProps, timeSpan, prevTimeSpan, nextTimeSpan, dayValues} = this.controller;\r\n\t\t\tif (spanValues === null) return null; \r\n\t\t\tconst data = {\r\n\t\t\t\tlabels: timeSpan.labels,\r\n\t\t\t\tdatasets: [{\r\n\t\t\t\t\tlabel: '',\r\n\t\t\t\t\tdata: toJS(dayValues),\r\n\t\t\t\t\tbackgroundColor: 'lightgreen',\r\n\t\t\t\t\tborderWidth: 1\r\n\t\t\t\t}],\r\n\t\t\t};\r\n\t\t\tlet curProp = gridProps[this.currentIndex] as NumberProp;\r\n\t\t\tlet {label, name} = curProp;\r\n\t\t\tlet moveStep = (icon:string, spanStep: ()=>Promise<void>) => <div \r\n\t\t\t\tclassName={'p-3 ' + (spanStep? 'cursor-pointer' : 'text-muted')} \r\n\t\t\t\tonClick={spanStep}>\r\n\t\t\t\t\t<FA name={icon} />\r\n\t\t\t\t</div>;\r\n\t\t\tlet left = moveStep('chevron-left', prevTimeSpan);\r\n\t\t\tlet right = timeSpan.canNext === true?\r\n\t\t\t\tmoveStep('chevron-right', nextTimeSpan)\r\n\t\t\t\t:\r\n\t\t\t\tmoveStep('square-o', undefined);\r\n\t\t\t\t//<div><FA className=\"text-muted\" name=\"square-o\" /></div>;\r\n\t\t\treturn <div className=\"py-3\">\r\n\t\t\t\t<div className=\"container\">\r\n\t\t\t\t\t<div className=\"row\">\r\n\t\t\t\t\t\t{spans.map(v => {\r\n\t\t\t\t\t\t\tlet cn = 'col text-center p-2 cursor-pointer ';\r\n\t\t\t\t\t\t\tlet style:CSSProperties = {\r\n\t\t\t\t\t\t\t\tborderBottomWidth: '0.15rem',\r\n\t\t\t\t\t\t\t\tborderBottomStyle: 'solid',\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tif (timeSpan.type === v) {\r\n\t\t\t\t\t\t\t\tcn += 'text-primary font-weight-bold';\r\n\t\t\t\t\t\t\t\tstyle.borderBottomColor = 'blue';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tcn += 'text-muted';\r\n\t\t\t\t\t\t\t\tstyle.borderBottomColor = 'lightgray';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn <div key={v} className={cn} style={style} \r\n\t\t\t\t\t\t\t\tonClick={()=>this.tabClick(v as any)}>{this.t(v)}</div>;\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<LMR className=\"text-center align-items-center\" left={left} right={right} >\r\n\t\t\t\t\t{timeSpan.title}\r\n\t\t\t\t</LMR>\r\n\t\t\t\t<div className=\"mt-3 mx-3 text-center cursor-pointer\"\r\n\t\t\t\t\tonClick={() => this.onFieldHistory(name)}>\r\n\t\t\t\t\t<h4 className=\"d-inline\">{label}</h4>\r\n\t\t\t\t\t<span className=\"text-info small\"> <FA name=\"angle-double-right\" /> 查看明细</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"p-3 h-12c\">\r\n\t\t\t\t\t<Bar data={data} width={100} height={50} options={graphOptions} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"d-flex flex-wrap p-1\"> \r\n\t\t\t\t\t{gridProps.map((v, index) => {\r\n\t\t\t\t\t\tlet {name, label} = v as any;\r\n\t\t\t\t\t\tlet sv = spanValues[name];\r\n\t\t\t\t\t\tlet val = sv?\r\n\t\t\t\t\t\t\t<b className=\"h3 mb-0\">{sv}</b>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t<small className=\"text-muted\">0</small>\r\n\t\t\t\t\t\tlet cn = 'm-1 w-8c h-8c d-flex flex-column align-items-center justify-content-center bg-white px-3 cursor-pointer border rounded ';\r\n\t\t\t\t\t\tcn += (index === this.currentIndex)? ' border-primary' : ' ';\r\n\t\t\t\t\t\treturn <div key={index} className={cn} onClick={() => this.onFieldClick(v, index)}>\r\n\t\t\t\t\t\t\t<div className=\"my-3 h-4c d-flex align-items-center\">{val}</div>\r\n\t\t\t\t\t\t\t<div className=\"mb-3\">{label}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n\r\n\tprivate tabClick(span:'day'|'week'|'month'|'year') {\r\n\t\tthis.controller.setTimeSpan(span);\r\n\t}\r\n\r\n\tprivate async onFieldClick(prop:Prop, index:number) {\r\n\t\tlet {gridProps} = this.controller;\r\n\t\tif (this.currentIndex === index) {\r\n\t\t\tlet curProp = gridProps[this.currentIndex] as NumberProp;\r\n\t\t\tlet {name} = curProp;\r\n\t\t\tawait this.controller.showFieldHistory(name);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trunInAction(() => {\r\n\t\t\tthis.currentIndex = index;\r\n\t\t\tlet curProp = gridProps[this.currentIndex] as NumberProp;\r\n\t\t\tlet {name} = curProp;\r\n\t\t\tthis.controller.setCurrentField(name);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate async onFieldHistory(field:string) {\r\n\t\tawait this.controller.showFieldHistory(field);\r\n\t}\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport { FA, left0, LMR, NumberProp, StringProp, VPage } from \"tonva-react\";\r\nimport { CIDX } from \"./CIDX\";\r\n\r\nexport class VEdit extends VPage<CIDX<any>> {\r\n\theader() {return 'Edit'}\r\n\tcontent() {\r\n\t\tlet {gridProps} = this.controller;\r\n\t\treturn <div className=\"py-3\">\r\n\t\t\t{gridProps.map((v, index) => {\r\n\t\t\t\tlet {type} = v as any;\r\n\t\t\t\tswitch (type) {\r\n\t\t\t\t\tdefault: return null;\r\n\t\t\t\t\tcase 'string': \r\n\t\t\t\t\t\treturn this.renderStringProp(v as StringProp);\r\n\t\t\t\t\tcase 'integer':\r\n\t\t\t\t\tcase 'number': \r\n\t\t\t\t\t\treturn this.renderNumberProp(v as NumberProp);\r\n\t\t\t\t}\r\n\t\t\t})}\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderStringProp(prop:StringProp) {\r\n\t\treturn <div key={prop.name} className=\"px-3 py-2 bg-white mb-1 cursor-pointer\">\r\n\t\t\t{JSON.stringify(prop)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderNumberProp(prop: NumberProp) {\r\n\t\tlet V = observer(() => {\r\n\t\t\tlet {name} = prop;\r\n\t\t\tlet {spanValues} = this.controller;\r\n\t\t\tif (!spanValues) return null;\r\n\t\t\treturn <div key={name} className=\"px-3 py-2 bg-white mb-1 cursor-pointer\" \r\n\t\t\t\tonClick={()=>this.openVPage(VEditNumberField, prop)}>\r\n\t\t\t\t<LMR left={<b>{prop.label}</b>} \r\n\t\t\t\t\tright={<FA name=\"pencil-square-o\" className=\"align-self-center\" />}>\r\n\t\t\t\t\t<div className=\"mr-5 text-right\">{this.controller.spanValues[name]}</div>\r\n\t\t\t\t</LMR>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn <V />;\r\n\t}\r\n}\r\n\r\nclass VEditNumberField extends VPage<CIDX<any>> {\r\n\tprivate prop: NumberProp;\r\n\tprivate date: Date;\r\n\tprivate value: number;\r\n\tprivate dateInput: HTMLInputElement;\r\n\tprivate timeInput: HTMLInputElement;\r\n\tdisabled: boolean = true;\r\n\tconstructor(controller: CIDX<any>) {\r\n\t\tsuper(controller);\r\n\t\tmakeObservable(this, {\r\n\t\t\tdisabled: observable\r\n\t\t});\r\n\t}\r\n\tinit(prop: NumberProp) {\r\n\t\tthis.prop = prop;\r\n\t\tthis.date = new Date();\r\n\t}\r\n\theader() {return this.prop.label}\r\n\tright() {\r\n\t\tlet V = observer(() => <button \r\n\t\t\tclassName=\"btn btn-sm btn-success mr-2\" \r\n\t\t\tdisabled={this.disabled}\r\n\t\t\tonClick={this.onSave}>\r\n\t\t\t{this.t('submit')}\r\n\t\t</button>);\r\n\t\treturn <V />;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {time} = this.prop;\r\n\t\tlet year = this.date.getFullYear();\r\n\t\tlet month = this.date.getMonth() + 1;\r\n\t\tlet day = this.date.getDate();\r\n\t\tlet hour = this.date.getHours();\r\n\t\tlet minute = this.date.getMinutes();\r\n\t\tlet defDate = `${year}-${left0(month, 2)}-${left0(day, 2)}`;\r\n\t\tlet vDateTime:any;\r\n\t\tif (time === true) {\r\n\t\t\tvDateTime = <div className=\"input-group mb-3\">\r\n\t\t\t\t<span className=\"w-8c input-group-text\">{this.t('date')}</span>\r\n\t\t\t\t<input ref={d => this.dateInput=d} type=\"date\" \r\n\t\t\t\t\tclassName=\"form-control\" defaultValue={defDate} />\r\n\t\t\t\t<input ref={t => this.timeInput=t} type=\"time\" className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={`${left0(hour, 2)}:${left0(minute, 2)}`} />\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t{vDateTime}\r\n\t\t\t<div className=\"input-group\">\r\n\t\t\t\t<span className=\"w-8c input-group-text\">{this.t('value')}</span>\r\n\t\t\t\t<input type=\"number\" className=\"form-control\" \r\n\t\t\t\t\tonChange={this.onValueChange} />\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onValueChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet v = evt.currentTarget.value.trim();\r\n\t\tthis.disabled = v.length === 0;\r\n\t\tlet n = Number(v);\r\n\t\tif (Number.isNaN(n) === false) this.value = n;\r\n\t}\r\n\r\n\tprivate onSave = async () => {\r\n\t\tlet t: number;\r\n\t\tif (this.dateInput) {\r\n\t\t\tlet date = this.dateInput.valueAsDate;\r\n\t\t\tlet dateTicks = this.dateInput?.valueAsNumber;\r\n\t\t\tlet timeTicks = this.timeInput?.valueAsNumber;\r\n\t\t\tt = dateTicks + timeTicks + date.getTimezoneOffset()*60*1000;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tt = Date.now();\r\n\t\t}\r\n\t\tawait this.controller.saveFieldValue(this.prop.name, t, this.value);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","import { action, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { IDBase } from \"../base\";\r\nimport { TimeSpan } from \"../tools\";\r\nimport { CUqUi, IDXUiProps } from \"../props\";\r\nimport { VIDX } from \"./VIDX\";\r\nimport { res } from './res';\r\nimport { VView } from \"./VView\";\r\nimport { VEdit } from \"./VEdit\";\r\nimport { Prop, Schema, UiSchema } from \"tonva-react\";\r\n\r\nexport class CIDX<T extends IDBase> extends CUqUi<IDXUiProps<T>> {\r\n\ttimeSpan:TimeSpan = null;\r\n\tspanValues: any = null;\r\n\tdayValues: number[] = null;\r\n\r\n\tconstructor(props: IDXUiProps<T>) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\ttimeSpan: observable,\r\n\t\t\tspanValues: observable,\r\n\t\t\tdayValues: observable.ref,\r\n\t\t\tsetTimeSpan: action,\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t}\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VIDX);\r\n\t}\r\n\r\n\tasync showItemView(item: any) {\r\n\t\tawait this.loadSchema();\r\n\t\tthis.item = item;\r\n\t\tawait this.setTimeSpan('month');\r\n\t\tthis.openVPage(VView);\r\n\t}\r\n\r\n\titem:any;\r\n\tonItemClick: (item:any) => void = async (item:any) => {\r\n\t\tthis.item = item;\r\n\t\tawait this.setTimeSpan('month');\r\n\t\tthis.openVPage(VView);\r\n\t}\r\n\r\n\tonItemEdit = async ():Promise<void> => {\r\n\t\tthis.openVPage(VEdit);\r\n\t}\r\n\r\n\tasync setTimeSpan(span: 'day'|'week'|'month'|'year') {\r\n\t\tlet timeSpan = TimeSpan.create(span);\r\n\t\tthis.timeSpan = timeSpan;\r\n\t\tawait this.loadSum(timeSpan);\r\n\t}\r\n\r\n\tprivate async loadSum(timeSpan?: TimeSpan) {\r\n\t\tlet {far, near} = timeSpan ?? this.timeSpan;\r\n\t\tlet ret = await this.uqLoadSum(this.item.id, far, near);\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet [values, sums] = ret;\r\n\t\tlet sum = sums[0];\r\n\t\trunInAction(() => {\r\n\t\t\tthis.spanValues = sum ?? {};\r\n\t\t});\r\n\t\tawait this.loadDayValues();\r\n\t}\r\n\r\n\tprevTimeSpan = async () => {\r\n\t\tthis.timeSpan.prev();\r\n\t\tawait this.loadSum();\r\n\t}\r\n\r\n\tnextTimeSpan = async () => {\r\n\t\tthis.timeSpan.next();\r\n\t\tawait this.loadSum();\r\n\t}\r\n\r\n\tfield:string;\r\n\tasync loadDayValues() {\r\n\t\tlet {far, near} = this.timeSpan;\r\n\t\tlet ret = await this.uqLoadDayValues(this.item.id, this.field, far, near);\r\n\t\tlet dayValues = this.timeSpan.getDayValues(ret);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.dayValues = dayValues;\r\n\t\t});\r\n\t}\r\n\r\n\tsetCurrentField(field:string) {\r\n\t\tthis.field = field;\r\n\t\tthis.loadDayValues();\r\n\t}\r\n\r\n\tasync saveFieldValue(field:string, t:number, value:number|string) {\r\n\t\tlet {id} = this.item;\r\n\t\tawait this.uqSaveFieldValue(id, field, t, value);\r\n\t\tlet ret = await this.uqLoadFieldSum(id, field, this.timeSpan);\r\n\t\tlet v= ret[field];\r\n\t\tthis.spanValues[field] = v;\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tprotected async loadSchema() {\r\n\t\tlet {ID, IDX} = this.props;\r\n\t\tawait Promise.all([\r\n\t\t\tIDX.loadSchema(),\r\n\t\t\tID.loadSchema(),\r\n\t\t]);\r\n\t\tlet IDUI = {ID};\r\n\t\tthis._itemSchema = await this.buildItemSchema(IDUI);\r\n\t\tthis._uiSchema = this.buildUISchema(IDUI);\r\n\t\tthis._props = this.buildGridProps(IDX);\r\n\t\tlet {exFields} = IDX.schema;\r\n\t\tfor (let prop of this._props) {\r\n\t\t\tlet {name} = prop as any;\r\n\t\t\tif (!name) continue;\r\n\t\t\tlet ex = (exFields as any[])?.find(v => v.field === name);\r\n\t\t\tlet time = ex?.time;\r\n\t\t\tif (!time) continue;\r\n\t\t\t(prop as any).time = time;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tasync load(id:number): Promise<any[]> {\r\n\t\tlet {ID, IDX} = this.props;\r\n\t\tlet ret = await this.uq.ID({\r\n\t\t\tIDX: [ID, IDX],\r\n\t\t\tid,\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\t\r\n\tasync showFieldHistory(field:string) {\r\n\t\talert(field);\r\n\t}\r\n\r\n\thistoryLoader = async (id:number, field:string, far:number, near:number, pageStart:any, pageSize:number):Promise<any[]> => {\r\n\t\tlet {ID, IDX} = this.props;\r\n\t\tlet ret = await this.uq.IDLog({\r\n\t\t\tIDX,\r\n\t\t\tfield,\r\n\t\t\tid,\r\n\t\t\tlog: 'each',\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: pageStart,\r\n\t\t\t\tsize: pageSize,\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync saveID(data:any):Promise<number> {\r\n\t\tlet {ID} = this.props;\r\n\t\tlet param: any = {};\r\n\t\tparam[ID.name] = [data];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\tlet id = ret[ID.name];\r\n\t\treturn id[0];\r\n\t}\r\n\r\n\tasync uqSaveFieldValue(id:number, fieldName:string, t:any, value:string|number):Promise<void> {\r\n\t\tlet param: any = {};\r\n\t\tlet val: any = {id};\r\n\t\tval[fieldName] = {\r\n\t\t\t$time: t,\r\n\t\t\tvalue,\r\n\t\t}\r\n\t\tlet {IDX} = this.props;\r\n\t\tparam[IDX.name] = [val];\r\n\t\tlet ret = await this.uq.Acts(param);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync uqLoadFieldSum(id:number, field:string, timeSpan:TimeSpan):Promise<any> {\r\n\t\tlet {far, near} = timeSpan;\r\n\t\tlet {IDX} = this.props;\r\n\t\tlet retSum = await this.uq.IDSum({\r\n\t\t\tIDX,\r\n\t\t\tfield: [field],\r\n\t\t\tid,\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t});\r\n\t\tlet ret = retSum[0];\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync uqLoadSum(id:number, far:number, near:number):Promise<[any[], any[]]> {\r\n\t\tlet {IDX} = this.props;\r\n\t\tlet valueFields:string[] = [];\r\n\t\tlet {fields, exFields} = IDX.schema;\r\n\t\tif (exFields === undefined) {\r\n\t\t\tthrow new Error('no valid sum field in exFields');\r\n\t\t}\r\n\t\tfor (let ex of exFields) {\r\n\t\t\tlet {field, log} =  ex;\r\n\t\t\tif (log !== true) continue;\r\n\t\t\tlet f = (fields as any[]).find(v => v.name === field);\r\n\t\t\tif (f === undefined) continue;\r\n\t\t\tlet {name, type} = f;\r\n\t\t\tif (['int', 'tinyint', 'smallint', 'bigint', 'dec', 'float', 'double'].indexOf(type) < 0) continue;\r\n\t\t\tvalueFields.push(name);\r\n\t\t}\r\n\t\treturn await Promise.all([\r\n\t\t\tthis.uq.ID({\r\n\t\t\t\tIDX,\r\n\t\t\t\tid,\r\n\t\t\t}),\r\n\t\t\tthis.uq.IDSum({\r\n\t\t\t\tIDX,\r\n\t\t\t\tfield: valueFields,\r\n\t\t\t\tid,\r\n\t\t\t\tfar,\r\n\t\t\t\tnear,\r\n\t\t\t}),\r\n\t\t]);\r\n\t}\r\n\r\n\tasync uqLoadDayValues(id:number, field: string, far:number, near:number):Promise<any[]> {\r\n\t\tif (!field) {\r\n\t\t\tfield = (this._props[0] as any)?.name;\r\n\t\t\tif (!field) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\talert('no field in loadDayValues');\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet {IDX} = this.props;\r\n\t\tlet ret = await this.uq.IDLog({\r\n\t\t\tIDX,\r\n\t\t\tfield,\r\n\t\t\tlog: 'day',\r\n\t\t\ttimeZone: this.timeZone,\r\n\t\t\tid,\r\n\t\t\tfar,\r\n\t\t\tnear,\r\n\t\t\tpage: {\r\n\t\t\t\tstart: near,\r\n\t\t\t\tend: far,\r\n\t\t\t\tsize: 100,\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate _itemSchema: Schema;\r\n\tget itemSchema(): Schema { return this._itemSchema; }\r\n\r\n\tprivate _uiSchema: UiSchema;\r\n\tget uiSchema(): UiSchema { return this._uiSchema; }\r\n\r\n\tprivate _props: Prop[];\r\n\tget gridProps():Prop[] { return this._props; }\r\n}\r\n","//import * as React from 'react';\r\nimport { Page, nav, LMR } from \"../components\";\r\nimport { VPage } from '../vm';\r\n//import { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\n//import { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase<any>> {\r\n\tprivate params: {predefinedUnit:number, uqsLoadErrors:string[]};\r\n    async open(params: {predefinedUnit:number, uqsLoadErrors:string[]}) {\r\n\t\tthis.params = params;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = () => {\r\n\t\tlet {predefinedUnit, uqsLoadErrors} = this.params;\r\n        let {user} = nav;\r\n\t\tlet userName:string = user? user.name : '[未登录]';\r\n\t\t//let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n\t\t\t\t{\r\n\t\t\t\t\tuqsLoadErrors && uqsLoadErrors.map(v => {\r\n\t\t\t\t\t\treturn <div className=\"form-group row\">\r\n\t\t\t\t\t\t\t<div className=\"col-sm-3 font-weight-bold\">App</div>\r\n\t\t\t\t\t\t\t<div className=\"col-sm text-body\">{v}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br/>\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t</Page>;\t\t\r\n\t}\r\n\t/*\r\n\t<div className=\"form-group row\">\r\n\t\t<div className=\"col-sm-3 font-weight-bold\">\r\n\t\t\t可能原因<FA name=\"exclamation-triangle\" />\r\n\t\t</div>\r\n\t\t<div className=\"col-sm text-body\">\r\n\t\t\t<ul className=\"p-0\">\r\n\t\t\t\t<li>没有小号运行 {appName}</li>\r\n\t\t\t\t<li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n\t\t\t\t{\r\n\t\t\t\t\tpredefinedUnit && \r\n\t\t\t\t\t<li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n\t\t\t\t}\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t</div>\r\n\t*/\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase<any>> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n\t\t//appInFrame.unit = appUnit.id; // 25;\r\n\t\t//this.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n\t\t\t<div>this.controller.appUnits appUnits removed</div>\r\n        </Page>\r\n        // <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n\t}\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase<any>> {\r\n    async open(errors:string[]) {\r\n        this.openPage(this.page, {errors:errors});\r\n    }\r\n\r\n    private page = (errors:{errors:string[]}) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={nav.resetAll}>重启网页</button>\r\n\t\t\t\t</div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase<any>> {\r\n    async open(error:any) {\r\n        this.openPage(this.page, {error:error});\r\n    }\r\n\r\n    private page = ({error}:{error:any}) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string'? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { nav, RouteFunc, Hooks, Navigo, NamedRoute } from \"../components\";\r\nimport { t, setGlobalRes } from '../res';\r\nimport { Controller } from '../vm';\r\nimport { UQsMan, TVs } from \"../uq\";\r\nimport { centerApi, logoutApis } from \"../net\";\r\nimport { VErrorsPage, VStartError } from \"./vMain\";\r\nimport { User } from \"../tool\";\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n}\r\n\r\nexport interface DevConfig {\r\n\tname: string;\r\n\talias?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqConfig {\r\n\tdev: DevConfig;\r\n\tname: string;\r\n\talias?: string;\t\r\n\tversion?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqsConfig {\r\n\tapp?: {\r\n\t\tdev: DevConfig;\r\n\t\tname: string;\r\n\t\tversion?: string;\r\n\t};\r\n\t//devs?: DevConfig[];\r\n\tuqs?: UqConfig[];\r\n}\r\n\r\nexport interface AppConfig extends UqsConfig {\r\n\t/*\r\n\tapp?: {\r\n\t\tname: string;\r\n\t\tversion: string;\r\n\t\townerMap?: {[key:string]: string};\r\n\t};\r\n\t*/\r\n    //appName: string;        // 格式: owner/appName\r\n    version: string;        // 版本变化，缓存的uqs才会重载\r\n    tvs?: TVs;\r\n    //uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase<U> extends Controller {\r\n\tprivate appConfig: AppConfig;\r\n    protected _uqs: U;\r\n\r\n    constructor(config?: AppConfig) {\r\n\t\tsuper();\r\n\t\tthis.appConfig = config || (nav.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet {app, uqs} = this.appConfig;\r\n\t\t\tif (app === undefined && uqs === undefined) {\r\n\t\t\t\tthrow new Error('app or uqs must be defined in AppConfig');\r\n\t\t\t}\r\n\t\t}\r\n    }\r\n\r\n    get uqs(): U {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tsetRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\tprotected afterBuiltUQs(uqs: any) {}\r\n\r\n\tprivate uqsUser: any = '';\r\n\tprotected async initUQs():Promise<any> {\r\n\t\tif (!this.appConfig) return;\r\n\t\tlet {user} = nav;\r\n\t\tif (user === this.uqsUser) return;\r\n\t\tthis.uqsUser = user;\r\n\t\tlogoutApis();\r\n\t\t//let {appName, version, tvs} = this.appConfig;\r\n\t\tlet retErrors = await UQsMan.build(this.appConfig);\r\n\t\tthis._uqs = UQsMan._uqs;\r\n\t\tthis.afterBuiltUQs(this._uqs);\r\n\t\treturn retErrors;\r\n\t\t//let retErrors = await this.load();\r\n\t\t//let app = await loadAppUqs(this.appOwner, this.appName);\r\n\t\t// if (isDevelopment === true) {\r\n\t\t// 这段代码原本打算只是在程序员调试方式下使用，实际上，也可以开放给普通用户，production方式下\r\n\t\t//let retErrors = UQsMan.errors;\r\n\t\t/*\r\n\t\tif (user !== undefined && user.id > 0) {\r\n\t\t\tlet uqAppId = UQsMan.value.id;\r\n\t\t\tlet result = await centerApi.userAppUnits(uqAppId);\r\n\t\t\tthis.appUnits = result;\r\n\t\t\t//if (this.noUnit === true) return true;\r\n\t\t}\r\n\t\t*/\r\n\t}\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\t/*\r\n\t\t\tif (!this.appConfig) return true;\r\n\t\t\tlet retErrors = await UQsMan.build(this.appConfig);\r\n\t\t\t*/\r\n\t\t\tlet retErrors = await this.initUQs();\r\n\t\t\t// UQsMan.errors;\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n\t\t\t//this._uqs = UQsMan._uqs;\r\n\t\t\t//this.afterBuiltUQs(this._uqs);\r\n            //let retErrors = await this.load();\r\n            //let app = await loadAppUqs(this.appOwner, this.appName);\r\n            // if (isDevelopment === true) {\r\n\t\t\t// 这段代码原本打算只是在程序员调试方式下使用，实际上，也可以开放给普通用户，production方式下\r\n\t\t\t//let retErrors = UQsMan.errors;\r\n            //let {predefinedUnit} = appInFrame;\r\n\t\t\t/*\r\n            let {user} = nav;\r\n            if (user !== undefined && user.id > 0) {\r\n            }\r\n\t\t\t*/\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\tprotected async afterStart():Promise<void> {\r\n\t\tnav.resolveRoute();\r\n\t\tnav.onChangeLogin = (user:User) => this.onChangeLogin(user);\r\n\t\tthis.onChangeLogin(this.user);\r\n\t}\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await centerApi.userFromId(userId);\r\n    }\r\n\r\n\tprotected on(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\tprotected on(...args:any[]):Navigo {\r\n\t\treturn nav.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() {return;}\r\n\r\n\tasync getUqRoles(uqName:string):Promise<string[]> {\r\n\t\tlet {user} = nav;\r\n\t\tif (!user) return null;\r\n\t\tlet {roles:userRoles} = nav.user;\r\n\t\tlet uq = uqName.toLowerCase();\r\n\t\tlet roles:string[];\r\n\t\tif (userRoles) {\r\n\t\t\troles = userRoles[uq];\r\n\t\t}\r\n\t\tif (roles) return roles;\r\n\r\n\t\troles = await UQsMan.getUqUserRoles(uq);\r\n\t\tif (!roles) roles = null;\r\n\t\tnav.setUqRoles(uq, roles);\r\n\t\treturn roles;\r\n\t}\r\n\r\n\tisAdmin(roles:string[]):boolean {\r\n\t\treturn this.isRole(roles, '$');\r\n\t}\r\n\r\n\tisRole(roles:string[], role:string):boolean {\r\n\t\tif (!roles) return false;\r\n\t\trole = role.toLowerCase();\r\n\t\treturn roles.indexOf(role) >= 0;\r\n\t}\r\n\r\n\tprotected onChangeLogin(user: User):Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (config: AppConfig) => CAppBase<any>, appConfig: AppConfig, isUserLogin?:boolean) {\r\n\tif (appConfig) {\r\n\t\tlet {htmlTitle} = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(appConfig);\r\n    await cApp.start(isUserLogin);\r\n}\r\n","import _ from 'lodash';\r\nimport { Controller, WebNav } from \"../vm\";\r\nimport { CAppBase, IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase<A extends CAppBase<U>, U> extends Controller {\r\n    protected readonly _uqs: U;\r\n    protected readonly _cApp: A;\r\n\r\n    constructor(cApp: any) {\r\n        super();\r\n        this._cApp = cApp;\r\n        this._uqs = cApp?.uqs;\r\n\t}\r\n\r\n    get uqs(): U {return this._uqs}\r\n\tget cApp(): A {return this._cApp}\r\n\tasync getUqRoles(uqName:string):Promise<string[]> {\r\n\t\treturn this._cApp?.getUqRoles(uqName);\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase<A,U>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.init(param);\r\n\t\treturn c;\r\n    }\r\n\r\n    newSub<O extends CBase<A,U>, T extends CSub<A,U,O>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet s = new type(this);\r\n\t\ts.init(param);\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = _.clone(wn);\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<A extends CAppBase<U>, U, T extends CBase<A, U>> extends CBase<A,U> {\r\n    protected _owner: T;\r\n\r\n    constructor(owner: T) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): T {return this._owner}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this._cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs:WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p!==undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = _.clone(wn);\r\n\t\tfor (;;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\t_.merge(ret, own);\r\n\t\t}\r\n\t\t_.merge(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { IObservableArray, computed, makeObservable } from 'mobx';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport {List} from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n\t\tmakeObservable(this, {\r\n\t\t\tloading: computed,\r\n\t\t});\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as PageItems<any>).items;\r\n    }\r\n    get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as PageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { ListBase } from './base';\r\nimport { uid } from '../../tool/uid';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key} = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable, IObservableArray, isObservableArray, observe, makeObservable} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\nimport {uid} from '../../tool/uid';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport { List } from './index';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    _items: SelectableItem[] = null;\r\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\r\n\r\n    constructor(list: List) {\r\n\t\tsuper(list);\r\n\t\tmakeObservable(this, {\r\n\t\t\t_items: observable\r\n\t\t})\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }    \r\n\r\n    private listenArraySplice() {\r\n        let {items} = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray:any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {                \r\n                if (change.type === 'splice') {\r\n                    let {index, removedCount, added} = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false, \r\n                            item: v, \r\n                            labelId:uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let {items, isItemSelected, selectedItems, compare} = this.list.props;\r\n        let itemsArray:any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n        \r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n\r\n\t\tif (isItemSelected) {\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: isItemSelected(v),\r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet comp: ((item:any, selectItem:any)=>boolean);\r\n\t\t\tif (compare === undefined) {\r\n\t\t\t\tcomp = (item:any, selectItem:any) => item === selectItem;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcomp = compare;\r\n\t\t\t}\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\t//let isObserved = isObservable(v);\r\n\t\t\t\t//let obj = isObserved === true? toJS(v) : v;\r\n\t\t\t\t//let obj = v;\r\n\t\t\t\tlet selected = selectedItems === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t: selectedItems.find(si => comp(v, si)) !== undefined;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: selected, \r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n\r\n\tprivate get anySelected():boolean {return this._items.some(v => v.selected)}\r\n    private onSelect(item:SelectableItem, selected:boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n    \r\n    get selectedItems():any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n\r\n\trender = (item:SelectableItem, index:number):JSX.Element => {\r\n        let {key} = this.list.props.item;\r\n\t\treturn React.createElement(this.row, {item, index, key:key===undefined?index:key(item)});\r\n    }\r\n\r\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\r\n        let {item, index} = props;\r\n        let {className} = this.list.props.item;\r\n        let {labelId, selected, item:obItem} = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e)=>{\r\n                        this.onSelect(item, e.target.checked)} \r\n                    }/>\r\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport _ from 'lodash';\r\nimport {PageItems} from '../../tool/pageItems';\r\nimport {ListBase} from './base';\r\nimport {Clickable} from './clickable';\r\nimport {Static} from './static';\r\nimport {Selectable} from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { resLang } from '../../res/res';\r\nimport { ListRes, listRes } from '../../res';\r\n\r\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\r\ninterface ItemProps {\r\n\tclassName?: string|string[];\r\n\trender?: (item:any, index:number) => JSX.Element;\r\n\tonSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\r\n\tonClick?: (item:any)=>void;\r\n\tkey?: (item:any)=>string|number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string|string[];\r\n    items: any[] | IObservableArray<any> | PageItems<any>;\r\n    item: ItemProps;\r\n\tisItemSelected?: (item:any) => boolean;\r\n    compare?: (item:any, selectItem:any) => boolean;\r\n\tselectedItems?:any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n\tnone?: StaticRow;\r\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\r\n\r\n\tprivate listBase: ListBase;\r\n\tprivate selectable: Selectable;\r\n    constructor(props:ListProps) {\r\n\t\tsuper(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top'|'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let {item} = this.props;\r\n        let {onClick, onSelect} = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n\t}\r\n\tcomponentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n\t\tif (_.isEqual(this.props.item, prevProps.item) === false) {\r\n\t\t\tthis.buildBase();\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t}\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems():any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        let {items, loading:isLoading} = this.listBase;\r\n        function staticRow(row:StaticRow, type:string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            } \r\n        }\r\n        let content:any, waitingMore:any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n\t\t}\r\n\t\tlet tabIndex:number;\r\n\t\tif (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n\tisInt: boolean;\t\t// 整数\r\n\ttime: boolean;\t\t// 字段log的time可以客户端输入\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import { VPage, List, LMR, EasyTime, UserView, User, View } from \"tonva-react\";\r\nimport { CIDXHistory } from \"./CIDXHistory\";\r\n\r\nexport class VIDXHistory extends VPage<CIDXHistory<any>> {\r\n\theader() {return this.controller.field}\r\n\tcontent() {\r\n\t\treturn this.renderVm(VHistory);\r\n\t}\r\n}\r\n\r\nexport class VHistory extends View<CIDXHistory<any>> {\r\n\trender() {\r\n\t\treturn <div>\r\n\t\t\t<List items={this.controller.historyItems} item={{render: this.renderItem, key:(item)=>item.t}} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderItem = (item:any, index:number) => {\r\n\t\tlet {t, v, u} = item;\r\n\t\tlet left = <div className=\"w-12c\"><EasyTime date={new Date(t)} /></div>;\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <small className=\"text-muted\">{nick || name}</small>\r\n\t\t}\r\n\t\tlet right = <UserView user={u} render={renderUser} />;\r\n\t\treturn <div className=\"px-3 py-2\">\t\t\t\r\n\t\t\t<LMR className=\"w-100\" left={left} right={right}>{v}</LMR>\r\n\t\t</div>\r\n\t}\r\n}\r\n","import { PageItems } from \"tonva-react\";\r\nimport { TimeSpan } from \"tonva-uqui/tools\";\r\nimport { IDBase } from \"../base\";\r\nimport { CUqUi, IDXHistoryUiProps } from \"../props\";\r\nimport { VIDXHistory, VHistory } from \"./VIDXHistory\";\r\n\r\nexport class CIDXHistory<T> extends CUqUi<IDXHistoryUiProps<T>> {\r\n\titem: any;\r\n\tfield: string;\r\n\thistoryItems: HistoryPageItems<any>\r\n\t\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VIDXHistory);\r\n\t}\r\n\r\n\tasync startFieldHistory(item: any, field:string) {\r\n\t\tlet {ID, IDX} = this.props;\r\n\t\tawait Promise.all([\r\n\t\t\tIDX.loadSchema(),\r\n\t\t\tID.loadSchema(),\r\n\t\t]);\r\n\t\tthis.item = item;\r\n\t\tthis.field = field;\r\n\t\tlet timeSpan = TimeSpan.create('year');\r\n\t\tthis.historyItems.first({\r\n\t\t\tid: this.item.id,\r\n\t\t\tfar: timeSpan.far,\r\n\t\t\tnear: 1817507137000, //this.timeSpan.near,\r\n\t\t\tfield\r\n\t\t});\r\n\t}\r\n\r\n\trenderFieldHistory() {\r\n\t\treturn this.renderView(VHistory);\r\n\t}\r\n\r\n\tasync showFieldHistory(field:string) {\r\n\t\tawait this.startFieldHistory(this.item, field);\r\n\t\tthis.openVPage(VIDXHistory);\r\n\t}\r\n\r\n}\r\n\r\nclass HistoryPageItems<T extends IDBase> extends PageItems<T> {\r\n\tprivate readonly props: IDXHistoryUiProps<T>;\r\n\tconstructor(props: IDXHistoryUiProps<T>) {\r\n\t\tsuper(true);\r\n\t\tthis.props = props;\r\n\t}\r\n\r\n\tasync loadResults(param:any, pageStart:any, pageSize:number): Promise<{[name:string]:any[]}> {\r\n\t\tlet {id, field, far, near} = param;\r\n\t\tlet {uq, IDX} = this.props;\r\n\t\tlet ret = await uq.IDLog({\r\n\t\t\tfield,\r\n\t\t\tid,\r\n\t\t\tIDX,\r\n\t\t\tlog: 'each',\r\n\t\t\tpage: {\r\n\t\t\t\tstart: pageStart,\r\n\t\t\t\tsize: pageSize,\r\n\t\t\t}\r\n\t\t})\r\n\t\t//let ret = await this.pageLoader(id, field, far, near, pageStart, pageSize);\r\n\t\treturn {$page:ret};\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, nav, UiImageItem } from '../components';\r\nimport { userApi } from '../net';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema:ItemSchema[] = [\r\n        {name:'nick', type:'string'} as StringSchema,\r\n        {name:'icon', type:'image'} as ImageSchema\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'别名', placeholder:'好的别名更方便记忆'} as UiTextItem,\r\n            icon: {widget:'image', label:'头像'} as UiImageItem,\r\n        }\r\n    }\r\n    data:any;\r\n\r\n    constructor(props:any) {\r\n        super(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tdata: observable,\r\n\t\t})\r\n        let {nick, icon} = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        let {name} = itemSchema;        \r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","import { observable } from 'mobx';\r\nimport _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 1000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];               // 每次使用，都排到队头\r\n\tprivate cache = observable.map({}, {deep: false});    // 已经缓冲的\r\n\t//private loading:boolean = false;\r\n\t//private loadingIds: number[];\r\n\r\n    protected localArr:LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (!id) return;\r\n        if (typeof id !== 'number') {\r\n\t\t\tconsole.error('id cache ' + id + ' is not number');\r\n\t\t\treturn;\r\n\t\t}\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer===true?70:20);\r\n        this.cache.set(id, id);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            //let rKey = String(r);\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n\t\treturn;\r\n    }\r\n\t/*\r\n\tprotected removeWaiting(id:number) {\r\n\t\tlet index = this.waitingIds.findIndex(v => v === id);\r\n\t\tthis.waitingIds.splice(index, 1);\r\n\t}\r\n\t\r\n\tprotected clearWaiting() {\r\n\t\tthis.waitingIds.splice(0, this.waitingIds.length);\r\n\t}\r\n\t\r\n\tprotected removeLoading(id:number) {\r\n\t\tif (this.loadingIds === undefined) return;\r\n\t\tlet index = this.loadingIds.findIndex(v => v === id);\r\n\t\tthis.loadingIds.splice(index, 1);\r\n\t}\r\n\t*/\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id:number) {\r\n\t\treturn this.cache.get(id);\r\n    }\r\n\r\n    remove(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id:number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n\t\t/*\r\n        let index = this.waitingIds.findIndex(v => v === id);\r\n        if (index>=0) this.waitingIds.splice(index, 1);\r\n\t\t*/\r\n\t\t//this.removeWaiting(id);\r\n\t\t//this.removeLoading(id);\r\n        this.cache.set(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\r\n\r\n    async cacheIds():Promise<void> {\r\n        //if (this.waitingIds.length === 0) return;\r\n\t\tlet tuidValues = await this.loadIds();\r\n\t\t/*\r\n\t\tif (tuidValues === undefined || tuidValues.length === 0) {\r\n\t\t\t//this.waitingIds.splice(0, this.waitingIds.length);\r\n\t\t\tthis.clearWaiting();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t*/\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    protected cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === false) continue;\r\n            this.cacheTuidFieldValues(tuidValue);\r\n        }\r\n    }\r\n    async modifyIds(ids:any[]):Promise<void> {\r\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p<0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected async loadIds(): Promise<any[]> {\r\n\t\tif (this.waitingIds.length === 0) return;\r\n\t\t//if (this.loading === true) return;\r\n\t\t//this.loading = true;\r\n\t\tlet loadingIds = [...this.waitingIds];\r\n\t\t//this.clearWaiting();\r\n\t\tthis.waitingIds = [];\r\n\t\tlet ret = await this.loadTuidIdsOrLocal(loadingIds);\r\n\t\t//this.loading = false;\r\n\t\t//this.loadingIds = undefined;\r\n        return ret;\r\n    }\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id:number):Promise<void> {\r\n        let val = this.cache.get(id);\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            case 'number': this.cache.set(id, id); break;\r\n        }\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n\tprotected async loadTuidIds(netIds: number[]):Promise<any[]> {\r\n\t\tlet netRet = await this.tuidInner.loadTuidIds(undefined, netIds);\r\n\t\treturn netRet;\r\n\t}\r\n\r\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\r\n        let ret:string[] = [];        \r\n        let netIds:number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len === 0) return ret;\r\n\r\n\t\tlet netRet = await this.loadTuidIds(netIds);\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t//有些id可能没有内容，不会返回\r\n\t\t\t//let id = netIds[i]; \r\n\t\t\tlet row:string = netRet[i];\r\n\t\t\tif (!row) continue;\r\n\t\t\tlet p = row.indexOf('\\t');\r\n\t\t\tif (p < 0) p = row.length;\r\n\t\t\tlet id = Number(row.substr(0, p));\r\n\t\t\t_.remove(netIds, v => v === id);\r\n\t\t\tret.push(row);\r\n\t\t\tthis.localArr.setItem(id, row);\r\n\t\t}\r\n\t\tlen = netIds.length;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tthis.localArr.setItem(netIds[i], '');\r\n\t\t}\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName:string;\r\n\r\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.cache.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\tprotected async loadTuidIds(netIds: number[]):Promise<any[]> {\r\n\t\tlet netRet = await this.tuidInner.loadTuidIds(this.divName, netIds);\r\n\t\treturn netRet;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    cached: boolean;\r\n    unique: string[];\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tlet t = typeof id;\r\n\t\tswitch (t) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id type: ' + t);\r\n\t\t\tcase 'undefined': return undefined;\r\n\t\t\tcase 'object': return (id as any).id;\r\n\t\t\tcase 'number': return id as number;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, ix:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (ix === undefined || ix === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(ix);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof ix === 'object'? id1Id === ix.id : id1Id === ix;\r\n        }\r\n        if (typeof ix === 'object') {\r\n\t\t\tlet id2Id = ix.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === ix;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.cache.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        let {createBoxId} = this.uq;\r\n        if (!createBoxId) return {id: id} as BoxId;\r\n        return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadTuidIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, false).request();\r\n        if (ret.length > 0) this.cached = true;\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        //val = new Date(val).toISOString();\r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = _.clone(props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    useId(id:number) {this.tuidLocal.useId(id);}\r\n    boxId(id:number):BoxId {return this.tuidLocal.boxId(id);}\r\n    valueFromId(id:number) {return this.tuidLocal.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal?.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal?.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner /* Entity*/ {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    //ui: React.StatelessComponent<any>;\r\n    //res: any;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    /*\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n    }*/\r\n\r\n    /*\r\n    setUIRes(ui:any, res:any) {\r\n        this.ui = ui && ui.content;\r\n        this.res = res;\r\n    }\r\n    */\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    /*\r\n    boxId(id:number):BoxId {\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //return new BoxDivId(this.tuid, this, id);\r\n        return this.tuid.boxDivId(this, id);\r\n    }\r\n    */\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import { IDBase } from \"../base\";\r\nimport { CIDList } from \"../CIDList\";\r\nimport { CIXList } from \"../CIXList\";\r\nimport { CUqUi, IXUiProps } from \"../props\";\r\n\r\nexport class CIX<TIX extends IDBase, TXI extends IDBase>  extends CUqUi<IXUiProps<TIX, TXI>> {\r\n\tprotected async internalStart() {\r\n\t\tlet ixProps = {\r\n\t\t\t...this.props.ixProps, \r\n\t\t\tonClickItem: async (item:TIX) => {\r\n\t\t\t\tlet xiProps = {\r\n\t\t\t\t\t...this.props.xiProps,\r\n\t\t\t\t\tix: item,\r\n\t\t\t\t};\r\n\t\t\t\tlet cXIList = new CIXList(xiProps);\r\n\t\t\t\tawait cXIList.start();\r\n\t\t\t}\r\n\t\t};\r\n\t\tlet cIXList = new CIDList(ixProps);\t\t\r\n\t\tawait cIXList.start();\r\n\t}\r\n}\r\n","import { IDBase } from \"../base\";\r\nimport { CIDList } from \"../CIDList\";\r\nimport { CXIList } from \"../CXIList\";\r\nimport { CUqUi, IDListUiProps, XIListUiProps, XIUiProps } from \"../props\";\r\n\r\nexport class CXI<TIX extends IDBase, TXI extends IDBase>  extends CUqUi<XIUiProps<TIX, TXI>> {\r\n\tprotected async internalStart() {\r\n\t\tlet xiProps:IDListUiProps<TXI> = {\r\n\t\t\t...this.props.xiProps, \r\n\t\t\tonClickItem: async (item:TXI) => {\r\n\t\t\t\tlet xiProps:XIListUiProps<TIX, TXI> = {\r\n\t\t\t\t\t...this.props.ixProps,\r\n\t\t\t\t\txi: item,\r\n\t\t\t\t};\r\n\t\t\t\tlet cXIList = new CXIList(xiProps);\r\n\t\t\t\tawait cXIList.start();\r\n\t\t\t},\r\n\t\t\trenderItem: null,\r\n\t\t\tonAddItem: null,\r\n\t\t};\r\n\t\tlet cXIList = new CIDList(xiProps);\r\n\t\tawait cXIList.start();\r\n\t}\r\n}\r\n","import fs from \"fs\";\r\nimport { capitalCase } from \"../../tool\";\r\nimport { FieldItem } from \"../../ui\";\r\nimport { ID, IDX, IX } from \"../ID\";\r\nimport { UqMan } from \"../uqMan\";\r\nimport { buildUQ } from \"./buildUQ\";\r\nimport { buildFieldItem } from \"./fieldItem\";\r\nimport { buildTsHeader, overrideTsFile, saveTsFileIfNotExists } from \"./tools\";\r\n\r\nexport function buildTsUqFolder(uq: UqMan, uqsFolder:string, uqAlias:string) {\r\n\tlet uqFolder = uqsFolder + '/' + uqAlias;\r\n\tif (fs.existsSync(uqFolder) === false) {\r\n\t\tfs.mkdirSync(uqFolder);\r\n\t}\r\n\tlet tsUq = buildTsHeader();\r\n\ttsUq += buildUQ(uq, uqAlias);\r\n\toverrideTsFile(`${uqFolder}/${uqAlias}.ts`, tsUq);\r\n\tsaveTsIndexAndRender(uqFolder, uq, uqAlias);\r\n}\r\n\r\nfunction saveTsIndexAndRender(uqFolder:string, uq: UqMan, uqAlias:string) {\r\n\tlet imports = '', sets = '';\r\n\tlet {idArr, idxArr, ixArr} = uq;\r\n\tfor (let i of [...idArr, ...idxArr, ...ixArr]) {\r\n\t\tlet cName = capitalCase(i.name);\r\n\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\tsets += `\\n\tObject.assign(uq.${cName}, ${cName});`;\r\n\r\n\t\tlet tsUI = `import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { ${cName} } from \"./${uqAlias}\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"${cName}\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\t$zh: {\r\n\t},\r\n\t$en: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: ${cName}):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n`;\r\n\r\n\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\r\n\t\tlet fields = buildFields(i);\r\n\t\tlet tsFieldArr:string = buildFieldArr(i);\r\n\r\n\t\treplaceTsFileFields(path, fields);\r\n\t\tlet tsImportFieldItemsBegin = 'import { FieldItem, ';\r\n\t\tlet tsImportFieldItemsEnd = ' } from \"tonva-react\";';\r\n\t\tlet tsImportFieldItems = 'FieldItemInt, FieldItemNum, FieldItemString, FieldItemId';\r\n\t\treplaceTsFileString(path, \r\n\t\t\t{\r\n\t\t\t\tbegin: tsImportFieldItemsBegin, \r\n\t\t\t\tend: tsImportFieldItemsEnd, \r\n\t\t\t\tcontent: tsImportFieldItemsBegin + tsImportFieldItems + tsImportFieldItemsEnd,\r\n\t\t\t}\r\n\t\t);\r\n\t\treplaceTsFileString(path, \r\n\t\t\t{begin:'\\nconst fieldArr: FieldItem[] = [\\n', end: '\\n];\\n', content:tsFieldArr}\r\n\t\t);\r\n\t}\r\n\r\n\tlet tsIndex = `import { UqExt as Uq } from './${uqAlias}';${imports}\r\n\r\nexport function setUI(uq: Uq) {${sets}\r\n}\r\nexport * from './${uqAlias}';\r\n`;\r\n\toverrideTsFile(`${uqFolder}/index.ts`, tsIndex);\r\n}\r\n\r\nfunction buildFields(i:ID|IDX|IX):{[name:string]:FieldItem} {\r\n\tswitch (i.typeName) {\r\n\t\tcase 'id': return buildIDFields(i as ID);\r\n\t\tcase 'idx': return buildIDXFields(i);\r\n\t\tcase 'ix': return buildIXFields(i);\r\n\t}\r\n};\r\n\r\nfunction buildIDFields(ID:ID):{[name:string]:FieldItem} {\r\n\tlet ret:{[name:string]:FieldItem} = {};\r\n\tlet {schema} = ID;\r\n\tlet {keys, fields} = schema;\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\tret[name] = buildFieldItem(f, isKey);\r\n\t}\r\n\treturn ret;\r\n}\r\nfunction buildIDXFields(IDX:IDX):{[name:string]:FieldItem} {\r\n\tlet ret:{[name:string]:FieldItem} = {};\r\n\tlet {schema} = IDX;\r\n\tlet {keys, fields} = schema;\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\tret[name] = buildFieldItem(f, isKey);\r\n\t}\r\n\treturn ret;\r\n};\r\n\r\nfunction buildIXFields(IX:IX):{[name:string]:FieldItem} {\r\n\tlet ret:{[name:string]:FieldItem} = {};\r\n\tlet {schema} = IX;\r\n\tlet {keys, fields} = schema;\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\tret[name] = buildFieldItem(f, isKey);\r\n\t}\r\n\treturn ret;\r\n};\r\n\r\nfunction buildFieldArr(i:ID|IDX|IX):string {\r\n\tlet ts = '\\nconst fieldArr: FieldItem[] = [\\n\\t';\r\n\tswitch (i.typeName) {\r\n\t\tcase 'id': ts += buildIDFieldArr(i as ID); break;\r\n\t\tcase 'idx': ts += buildIDXFieldArr(i); break;\r\n\t\tcase 'ix': ts += buildIXFieldArr(i); break;\r\n\t}\r\n\treturn ts += '\\n];\\n';\r\n}\r\nfunction buildIDFieldArr(i:ID):string {\r\n\tlet {schema} = i;\r\n\tlet ts = '';\r\n\tfor (let f of schema.fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'id') continue;\r\n\t\tts += `fields.${name}, `;\r\n\t}\r\n\treturn ts;\r\n}\r\nfunction buildIDXFieldArr(i:IDX):string {\r\n\tlet {schema} = i;\r\n\tlet ts = '';\r\n\tfor (let f of schema.fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'id') continue;\r\n\t\tts += `fields.${name}, `;\r\n\t}\r\n\treturn ts;\r\n}\r\nfunction buildIXFieldArr(i:IX):string {\r\n\tlet {schema} = i;\r\n\tlet ts = '';\r\n\tfor (let f of schema.fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'ix') continue;\r\n\t\tif (name === 'id') continue;\r\n\t\tts += `fields.${name}, `;\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction replaceTsFileFields(path: string, fields:{[name:string]:FieldItem}) {\r\n\tlet text = fs.readFileSync(path).toString();\r\n\tlet startStr = '\\n/*--fields--*/';\r\n\tlet endStr = '\\n/*==fields==*/\\n';\r\n\tlet start = text.indexOf(startStr);\r\n\tif (start > 0) {\r\n\t\tlet end = text.indexOf(endStr, start + startStr.length);\r\n\t\tif (end > 0) {\r\n\t\t\tlet lBrace = text.indexOf('{', start + startStr.length);\r\n\t\t\tlet rBrace = text.lastIndexOf('}', end);\r\n\t\t\tlet oldText = text.substring(lBrace, rBrace+1);\r\n\t\t\tlet fieldsText = buildFieldsFromOldText(fields, oldText);\r\n\t\t\ttext = text.substring(0, start)\r\n\t\t\t\t+ startStr + '\\nconst fields = {'\r\n\t\t\t\t+ fieldsText\r\n\t\t\t\t+ '\\n};'\r\n\t\t\t\t+ text.substring(end);\r\n\t\t\tfs.writeFileSync(path, text);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst fieldItemReplaceProps = ['label', 'placeholder', 'widget', 'type'];\r\nfunction buildFieldsFromOldText(fields:{[name:string]:FieldItem}, oldText:string):string {\r\n\tlet ret = '';\r\n\tfor (let i in fields) {\r\n\t\tlet field = fields[i];\r\n\t\tsetFieldOldProp(field, oldText);\r\n\t\tret += buildFieldText(field);\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nfunction setFieldOldProp(field:FieldItem, text:string) {\r\n\tlet fieldStart = field.name + ':';\r\n\tlet start = text.indexOf('\\t' + fieldStart);\r\n\tif (start < 0) start = text.indexOf('\\n' + fieldStart);\r\n\tif (start < 0) start = text.indexOf(' ' + fieldStart);\r\n\tif (start < 0) return;\r\n\t++start;\r\n\tlet end = text.indexOf('}', start + fieldStart.length);\r\n\tif (end < 0) return;\r\n\tlet fieldText = text.substring(start + fieldStart.length, end + 1);\r\n\t/* eslint no-eval: 0 */\r\n\tlet obj = eval('(' + fieldText + ')');\r\n\tfieldItemReplaceProps.forEach(v => {\r\n\t\tlet prop = obj[v];\r\n\t\tif (!prop) return;\r\n\t\tif (v === 'type') return; // 这个是由新的schema决定的\r\n\t\t(field as any)[v] = prop;\r\n\t});\r\n}\r\n\r\nfunction buildFieldText(field:FieldItem):string {\r\n\tlet {$FieldItemType} = field as any;\r\n\tdelete (field as any).$FieldItemType;\r\n\tlet ret = '\\n\\t' + field.name + ': ';\r\n\tlet json = JSON.stringify(field, null, '\\t\\t');\r\n\tjson = json.replace('}', '\\t}');\r\n\tret += json;\r\n\treturn ret + ' as ' + $FieldItemType + ',';\r\n}\r\n\r\ninterface ReplaceSection {\r\n\tbegin: string;\r\n\tend: string;\r\n\tcontent: string;\r\n};\r\nfunction replaceTsFileString(path:string, sec:ReplaceSection) {\r\n\tlet text = fs.readFileSync(path).toString();\r\n\tlet {begin, end, content} = sec;\r\n\tlet b = text.indexOf(begin);\r\n\tif (b < 0) return;\r\n\tlet e = text.indexOf(end, b + begin.length - 1);\r\n\tif (e < 0) return;\r\n\ttext = text.substring(0, b) + content + text.substr(e + end.length);\r\n\tfs.writeFileSync(path, text);\r\n}\r\n","import { camelCase, capitalCase } from \"../../tool\";\r\nimport { UqMan } from \"../uqMan\";\r\nimport { Action } from '../action';\r\nimport { Book } from '../book';\r\nimport { Query } from '../query';\r\nimport { Sheet } from '../sheet';\r\nimport { Tuid } from '../tuid';\r\nimport { UqEnum } from '../enum';\r\nimport { Map } from '../map';\r\nimport { History } from '../history';\r\nimport { Tag } from '../tag';\r\nimport { Pending } from '../pending';\r\nimport { Entity } from '../entity';\r\nimport { ID, IX, IDX } from '../ID';\r\nimport { ArrFields, Field } from '../uqMan';\r\nimport { entityName } from \"./tools\";\r\n\r\nexport function buildUQ(uq:UqMan, uqAlias:string) {\r\n\tlet tsImport = `\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { IDXValue, Uq`;\r\n\tlet ts:string = `\\n\\n`;\r\n\tts += '\\n//===============================';\r\n\tts += `\\n//======= UQ ${uq.name} ========`;\r\n\tts += '\\n//===============================';\r\n\tts += '\\n';\r\n\t\r\n\tuq.enumArr.forEach(v => ts += uqEntityInterface<UqEnum>(v, buildEnumInterface));\r\n\r\n\tuq.tuidArr.forEach(v => ts += uqEntityInterface<Tuid>(v, buildTuidInterface));\r\n    uq.actionArr.forEach(v => ts += uqEntityInterface<Action>(v, buildActionInterface));\r\n    uq.sheetArr.forEach(v => ts += uqEntityInterface<Sheet>(v, buildSheetInterface));\r\n    uq.queryArr.forEach(v => ts += uqEntityInterface<Query>(v, buildQueryInterface));\r\n    uq.bookArr.forEach(v => ts += uqEntityInterface<Book>(v, buildBookInterface));\r\n    uq.mapArr.forEach(v => ts += uqEntityInterface<Map>(v, buildMapInterface));\r\n    uq.historyArr.forEach(v => ts += uqEntityInterface<History>(v, buildHistoryInterface));\r\n    uq.pendingArr.forEach(v => ts += uqEntityInterface<Pending>(v, buildPendingInterface));\r\n\tuq.tagArr.forEach(v => ts += uqEntityInterface<Tag>(v, buildTagInterface));\r\n\tuq.idArr.forEach(v => ts += uqEntityInterface<ID>(v, buildIDInterface));\r\n\tuq.idxArr.forEach(v => ts += uqEntityInterface<IDX>(v, buildIDXInterface));\r\n\tuq.idxArr.forEach(v => ts += uqEntityInterface<IDX>(v, buildIDXActParamInterface));\t\r\n\tuq.ixArr.forEach(v => ts += uqEntityInterface<IX>(v, buildIXInterface));\r\n\r\n\tts += buildActsInterface(uq);\r\n\r\n\tts += `\r\n\\nexport interface UqExt extends Uq {\r\n\tActs(param:ParamActs): Promise<any>;\r\n`;\r\n\tfunction appendArr<T extends Entity>(arr:T[], type:string, tsBuild: (v:T) => string) {\r\n\t\tif (arr.length === 0) return;\r\n\t\tlet tsLen = ts.length;\r\n\t\tarr.forEach(v => ts += tsBuild(v));\r\n\t\tif (ts.length - tsLen > 0) {\r\n\t\t\ttsImport += ', Uq' + type;\r\n\t\t}\r\n\t}\r\n\tappendArr<Tuid>(uq.tuidArr, 'Tuid', v => uqBlock<Tuid>(v, buildTuid));\r\n\tappendArr<Action>(uq.actionArr, 'Action', v => uqBlock<Action>(v, buildAction));\r\n\tappendArr<Sheet>(uq.sheetArr, 'Sheet', v => uqBlock<Sheet>(v, buildSheet));\r\n\tappendArr<Book>(uq.bookArr, 'Book', v => uqBlock<Book>(v, buildBook));\r\n\tappendArr<Query>(uq.queryArr, 'Query', v => uqBlock<Query>(v, buildQuery));\r\n\tappendArr<Map>(uq.mapArr, 'Map', v => uqBlock<Map>(v, buildMap));\r\n\tappendArr<History>(uq.historyArr, 'History', v => uqBlock<History>(v, buildHistory));\r\n\tappendArr<Pending>(uq.pendingArr, 'Pending', v => uqBlock<Pending>(v, buildPending));\r\n\tappendArr<Tag>(uq.tagArr, 'Tag', v => uqBlock<Tag>(v, buildTag));\r\n\tappendArr<ID>(uq.idArr, 'ID', v => uqBlock<ID>(v, buildID));\r\n\tappendArr<IDX>(uq.idxArr, 'IDX', v => uqBlock<IDX>(v, buildIDX));\r\n\tappendArr<IX>(uq.ixArr, 'IX', v => uqBlock<IX>(v, buildIX));\r\n\tts += '\\n}\\n';\r\n\ttsImport += ' } from \"tonva-react\";';\r\n\treturn tsImport + ts;\r\n}\r\n\r\nfunction uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T)=>string) {\r\n\tlet {name} = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = buildInterface(entity);\r\n\tif (!entityCode) return '';\r\n\treturn '\\n' + entityCode + '\\n';\r\n}\r\n\r\nfunction uqBlock<T extends Entity>(entity: T, build: (entity: T)=>string) {\r\n\tlet {name} = entity;\r\n\tif (name.indexOf('$') > 0) return '';\r\n\tlet entityCode = build(entity);\r\n\tif (!entityCode) return '';\r\n\treturn '\\n' + entityCode;\r\n}\r\n\r\n\r\nfunction buildFields(fields: Field[], isInID:boolean = false, indent:number = 1) {\r\n\tif (!fields) return '';\r\n\tlet ts = '';\r\n\tfor (let f of fields) {\r\n\t\tts += buildField(f, isInID, indent);\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nconst fieldTypeMap:{[type:string]:string} = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"textid\": \"string\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n\t\"dec\": \"number\",\r\n\t\"float\": \"number\",\r\n\t\"double\": \"number\",\r\n};\r\nconst sysFields = ['id', 'master', 'row', 'no', '$create', '$update', '$owner'];\r\nfunction buildField(field: Field, isInID:boolean, indent:number = 1) {\r\n\tlet {name, type} = field;\r\n\tlet s = fieldTypeMap[type];\r\n\tif (!s) s = 'any';\r\n\tlet q:string = (isInID === true && sysFields.indexOf(name) >= 0)? '?' : '';\r\n\treturn `\\n${'\\t'.repeat(indent)}${name}${q}: ${s};`;\r\n}\r\n\r\nfunction buildArrs(arrFields: ArrFields[]):string {\r\n\tif (!arrFields) return '';\r\n\tlet ts = '\\n';\r\n\tfor (let af of arrFields) {\r\n\t\tts += `\\t${camelCase(af.name)}: {`;\r\n\t\tts += buildFields(af.fields, false, 2);\r\n\t\tts += '\\n\\t}[];\\n';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\n/*\r\nconst typeMap:{[type:string]:string} = {\r\n\taction: 'Action',\r\n\tquery: 'Query',\r\n}\r\n*/\r\nfunction buildReturns(entity:Entity, returns:ArrFields[]):string {\r\n\tif (!returns) return;\r\n\t//let {typeName} = entity;\r\n\t//let type = typeMap[typeName] || typeName;\r\n\tlet {sName} = entity;\r\n\tsName = capitalCase(sName);\r\n\tlet ts = '';\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCase(ret.name);\r\n\t\tts += `interface Return${sName}${retName} {`;\r\n\t\tts += buildFields(ret.fields);\r\n\t\tts += '\\n}\\n';\r\n\t}\r\n\r\n\tts += `interface Result${sName} {\\n`;\r\n\tfor (let ret of returns) {\r\n\t\tlet retName = capitalCase(ret.name);\r\n\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t}\r\n\tts += '}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuid(tuid: Tuid) {\r\n\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCase(tuid.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTuidInterface(tuid: Tuid) {\r\n\tlet ts = `export interface Tuid${capitalCase(tuid.sName)} {`;\r\n\tts += buildFields(tuid.fields);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildAction(action: Action) {\r\n\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCase(action.sName)}, Result${capitalCase(action.sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildActionInterface(action: Action) {\r\n\tlet ts = `export interface Param${capitalCase(action.sName)} {`;\r\n\tts += buildFields(action.fields);\r\n\tts += buildArrs(action.arrFields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(action, action.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildEnumInterface(enm: UqEnum) {\r\n\tlet {schema} = enm;\r\n\tif (!schema) return;\r\n\tlet {values} = schema;\r\n\tlet ts = `export enum ${capitalCase(enm.sName)} {`;\r\n\tlet first:boolean = true;\r\n\tfor (let i in values) {\r\n\t\tif (first === false) {\r\n\t\t\tts += ',';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfirst = false;\r\n\t\t}\r\n\t\tlet v = values[i];\r\n\t\tts += '\\n\\t' + i + ' = ';\r\n\t\tif (typeof v === 'string') {\r\n\t\t\tts += '\"' + v + '\"';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tts += v;\r\n\t\t}\r\n\t}\r\n\treturn ts += '\\n}'\r\n}\r\n\r\nfunction buildQuery(query: Query) {\r\n\tlet {sName} = query;\r\n\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildQueryInterface(query: Query) {\r\n\tlet ts = `export interface Param${capitalCase(query.sName)} {`;\r\n\tts += buildFields(query.fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(query, query.returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheet(sheet: Sheet) {\r\n\tlet {sName, verify} = sheet;\r\n\tlet cName = capitalCase(sName);\r\n\tlet v = verify? `Verify${cName}` : 'any';\r\n\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildSheetInterface(sheet: Sheet) {\r\n\tlet {sName, fields, arrFields, verify} = sheet;\r\n\tlet ts = `export interface Sheet${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += buildArrs(arrFields);\r\n\tts += '}';\r\n\r\n\tif (verify) {\r\n\t\tlet {returns} = verify;\r\n\t\tts += `\\nexport interface Verify${capitalCase(sName)} {`;\r\n\t\tfor (let item of returns) {\r\n\t\t\tlet {name:arrName, fields} = item;\r\n\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\tts += buildFields(fields, false, 2);\r\n\t\t\tts += '\\n\\t}[];';\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t}\r\n\treturn ts;\r\n}\r\n\r\nfunction buildBook(book: Book):string {\r\n\tlet {sName} = book;\r\n\tlet ts = `\\t${entityName(sName)}: UqBook<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildBookInterface(book: Book):string {\r\n\tlet {sName, fields, returns} = book;\r\n\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(book, returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildMap(map: Map):string {\r\n\tlet {sName} = map;\r\n\tlet ts = `\\t${entityName(sName)}: UqMap;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildMapInterface(map: Map):string {\r\n\t/*\r\n\tlet {sName, fields, returns} = map;\r\n\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(map, returns);\r\n\treturn ts;\r\n\t*/\r\n\treturn '';\r\n}\r\n\r\nfunction buildHistory(history: History):string {\r\n\tlet {sName} = history;\r\n\tlet ts = `\\t${entityName(sName)}: UqHistory<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildHistoryInterface(history: History):string {\r\n\tlet {sName, fields, returns} = history;\r\n\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(history, returns);\r\n\treturn ts;\r\n}\r\n\r\nfunction buildPending(pending: Pending):string {\r\n\tlet {sName} = pending;\r\n\tlet ts = `\\t${entityName(sName)}: UqPending<any, any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildPendingInterface(pending: Pending):string {\r\n\t/*\r\n\tlet {sName, fields, returns} = pending;\r\n\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}\\n';\r\n\tts += buildReturns(pending, returns);\r\n\treturn ts;\r\n\t*/\r\n\treturn '';\r\n}\r\n\r\nfunction buildTag(tag: Tag):string {\r\n\tlet {sName} = tag;\r\n\tlet ts = `\\t${entityName(sName)}: UqTag;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildID(id: ID):string {\r\n\tlet {sName} = id;\r\n\tlet ts = `\\t${entityName(sName)}: UqID<any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIDX(idx: IDX):string {\r\n\tlet {sName} = idx;\r\n\tlet ts = `\\t${entityName(sName)}: UqIDX<any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIX(ix: IX):string {\r\n\tlet {sName} = ix;\r\n\tlet ts = `\\t${entityName(sName)}: UqIX<any>;`;\r\n\treturn ts;\r\n}\r\n\r\nfunction buildTagInterface(tag: Tag):string {\r\n\treturn;\r\n}\r\n\r\nfunction buildIDInterface(idEntity: ID):string {\r\n\tlet {sName, fields, schema} = idEntity;\r\n\tlet {keys:schemaKeys} = schema;\r\n\tlet keys:Field[] = [], others:Field[] = [];\r\n\tfor (let f of fields) {\r\n\t\tlet {name} = f;\r\n\t\tif (name === 'id') continue;\r\n\t\tif ((schemaKeys as any[]).find(v => v.name === name)) keys.push(f);\r\n\t\telse others.push(f);\r\n\t}\r\n\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\tts += `\\n\\tid?: number;`;\r\n\tts += buildFields(keys, true);\r\n\tts += buildFields(others, true);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIDXInterface(idx: IDX):string {\r\n\tlet {sName, fields, schema} = idx;\r\n\tlet {exFields} = schema;\r\n\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\tlet indent = 1;\r\n\tfor (let field of fields) {\r\n\t\tlet {name, type} = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\tif (name !== 'id') ts += '?';\r\n\t\tts += `: ${s};`;\r\n\t}\r\n\r\n\tts += `\\n\\t$act?: number;`;\r\n\r\n\tlet hasTrack:boolean = false;\r\n\tlet hasMemo:boolean = false;\r\n\tif (exFields) {\r\n\t\tfor (let exField of exFields) {\r\n\t\t\tlet {track, memo} = exField;\r\n\t\t\tif (track === true) hasTrack = true;\r\n\t\t\tif (memo === true) hasMemo = true;\r\n\t\t}\r\n\t}\r\n\tif (hasTrack === true) {\r\n\t\tts += `\\n\\t$track?: number;`;\r\n\t}\r\n\tif (hasMemo === true) {\r\n\t\tts += `\\n\\t$memo?: string;`;\r\n\t}\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIDXActParamInterface(idx: IDX):string {\r\n\tlet {sName, fields, schema} = idx;\r\n\tlet {exFields} = schema;\r\n\tlet ts = `export interface ActParam${capitalCase(sName)} {`;\r\n\tlet indent = 1;\r\n\tfor (let field of fields) {\r\n\t\tlet {name, type} = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\tif (name !== 'id') ts += '?';\r\n\t\tts += `: ${s}|IDXValue;`;\r\n\t}\r\n\r\n\tts += `\\n\\t$act?: number;`;\r\n\r\n\tlet hasTrack:boolean = false;\r\n\tlet hasMemo:boolean = false;\r\n\tif (exFields) {\r\n\t\tfor (let exField of exFields) {\r\n\t\t\tlet {track, memo} = exField;\r\n\t\t\tif (track === true) hasTrack = true;\r\n\t\t\tif (memo === true) hasMemo = true;\r\n\t\t}\r\n\t}\r\n\tif (hasTrack === true) {\r\n\t\tts += `\\n\\t$track?: number;`;\r\n\t}\r\n\tif (hasMemo === true) {\r\n\t\tts += `\\n\\t$memo?: string;`;\r\n\t}\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildIXInterface(ix: IX):string {\r\n\tlet {sName, fields} = ix;\r\n\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\tts += buildFields(fields);\r\n\tts += '\\n}';\r\n\treturn ts;\r\n}\r\n\r\nfunction buildActsInterface(uq: UqMan) {\r\n\tlet ts = `\\nexport interface ParamActs {`;\r\n\tuq.idArr.forEach(v => {\r\n\t\tlet {sName} = v;\r\n\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t});\r\n\tuq.idxArr.forEach(v => {\r\n\t\tlet {sName} = v;\r\n\t\tts += `\\n\\t${camelCase(sName)}?: ActParam${capitalCase(sName)}[];`;\r\n\t});\r\n\tuq.ixArr.forEach(v => {\r\n\t\tlet {sName} = v;\r\n\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t});\r\n\tts += '\\n}\\n';\r\n\treturn ts;\r\n}\r\n","import { Res, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Market } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tname: {\r\n\t\t\"name\": \"name\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": true,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Name\"\r\n\t} as FieldItemString,\r\n\tcurrency: {\r\n\t\t\"name\": \"currency\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Currency\"\r\n\t} as FieldItemString,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\tfields.name, fields.currency, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"Market\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const res: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\n\r\nexport function render(item: Market):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Transaction } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tholding: {\r\n\t\t\"name\": \"holding\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": true,\r\n\t\t\"label\": \"Holding\"\r\n\t} as FieldItemId,\r\n\ttick: {\r\n\t\t\"name\": \"tick\",\r\n\t\t\"isKey\": true,\r\n\t\t\"label\": \"Tick\"\r\n\t} as undefined,\r\n\tprice: {\r\n\t\t\"name\": \"price\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Price\"\r\n\t} as FieldItemInt,\r\n\tquantity: {\r\n\t\t\"name\": \"quantity\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Quantity\"\r\n\t} as FieldItemInt,\r\n\tamount: {\r\n\t\t\"name\": \"amount\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Amount\"\r\n\t} as FieldItemInt,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\tfields.holding, fields.tick, fields.price, fields.quantity, fields.amount, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"Transaction\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const res: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\n\r\nexport function render(item: Transaction):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Group } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tno: {\r\n\t\t\"name\": \"no\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": true,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"No\"\r\n\t} as FieldItemString,\r\n\tname: {\r\n\t\t\"name\": \"name\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Name\"\r\n\t} as FieldItemString,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.no, fields.name, \r\n];\r\n\r\nconst resRaw: Res<any> = {\r\n\t$zh: {\r\n\t\tGroup: '股票组',\r\n\t\tNo: '编号',\r\n\t\tName: '组名',\r\n\t},\r\n\t$en: {\r\n\t}\r\n};\r\n\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: Group):JSX.Element {\r\n\tlet {name} = item;\r\n\treturn <>{t(name)}</>;\r\n};\r\n\r\nexport const ui: UI = {\r\n\tlabel: t(\"Group\"),\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Account } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tno: {\r\n\t\t\"name\": \"no\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": true,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"No\"\r\n\t} as FieldItemString,\r\n\tname: {\r\n\t\t\"name\": \"name\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Name\"\r\n\t} as FieldItemString,\r\n\tportion: {\r\n\t\t\"name\": \"portion\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Portion\"\r\n\t} as FieldItemInt,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\tfields.no, fields.name, fields.portion, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"Account\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const resRaw: Res<any> = {\r\n\t$zh: {\r\n\t\tNo: '编号',\r\n\t\tName: '名称',\r\n\t\tPortion: '份数',\r\n\t},\r\n\t$en: {\r\n\t}\r\n};\r\n\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: Account):JSX.Element {\r\n\tlet {name} = item;\r\n\treturn <>{t(name)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Holding } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\taccount: {\r\n\t\t\"name\": \"account\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": true,\r\n\t\t\"label\": \"Account\"\r\n\t} as FieldItemId,\r\n\tstock: {\r\n\t\t\"name\": \"stock\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": true,\r\n\t\t\"label\": \"Stock\"\r\n\t} as FieldItemId,\r\n\teverBought: {\r\n\t\t\"name\": \"everBought\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"EverBought\"\r\n\t} as undefined,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.account, fields.stock, fields.everBought, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"Holding\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: Holding):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Stock } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tmarket: {\r\n\t\t\"name\": \"market\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": true,\r\n\t\t\"label\": \"Market\"\r\n\t} as FieldItemId,\r\n\tno: {\r\n\t\t\"name\": \"no\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": true,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Code\"\r\n\t} as FieldItemString,\r\n\tname: {\r\n\t\t\"name\": \"name\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Name\"\r\n\t} as FieldItemString,\r\n\trawId: {\r\n\t\t\"name\": \"rawId\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"RawId\"\r\n\t} as FieldItemId,\r\n\tuno: {\r\n\t\t\"name\": \"uno\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Uno\"\r\n\t} as FieldItemString,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\tfields.market, fields.no, fields.name, fields.rawId, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"Stock\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const res: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\n\r\nexport function render(item: Stock):JSX.Element {\r\n\tlet {name, no} = item;\r\n\treturn <><span>{name}</span> <span>{no}</span></>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Blog } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tno: {\r\n\t\t\"name\": \"no\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": true,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"No\"\r\n\t} as FieldItemString,\r\n\tcaption: {\r\n\t\t\"name\": \"caption\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Caption\"\r\n\t} as FieldItemString,\r\n\tcontent: {\r\n\t\t\"name\": \"content\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Content\"\r\n\t} as undefined,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.no, fields.caption, fields.content, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"Blog\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: Blog):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Industry } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tname: {\r\n\t\t\"name\": \"name\",\r\n\t\t\"type\": \"string\",\r\n\t\t\"isKey\": true,\r\n\t\t\"widget\": \"string\",\r\n\t\t\"label\": \"Name\"\r\n\t} as FieldItemString,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.name, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"Industry\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: Industry):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { StockValue } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tearning: {\r\n\t\t\"name\": \"earning\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Earning\"\r\n\t} as FieldItemNum,\r\n\tdivident: {\r\n\t\t\"name\": \"divident\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Divident\"\r\n\t} as FieldItemNum,\r\n\tprice: {\r\n\t\t\"name\": \"price\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Price\"\r\n\t} as FieldItemNum,\r\n\tpvolumn: {\r\n\t\t\"name\": \"pvolumn\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Pvolumn\"\r\n\t} as FieldItemNum,\r\n\troe: {\r\n\t\t\"name\": \"roe\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Roe\"\r\n\t} as FieldItemNum,\r\n\tvolumn: {\r\n\t\t\"name\": \"volumn\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Volumn\"\r\n\t} as FieldItemNum,\r\n\tdate: {\r\n\t\t\"name\": \"date\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Date\"\r\n\t} as undefined,\r\n\tdvRate: {\r\n\t\t\"name\": \"dvRate\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"DvRate\"\r\n\t} as FieldItemNum,\r\n\tttm: {\r\n\t\t\"name\": \"ttm\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Ttm\"\r\n\t} as FieldItemNum,\r\n\tmiRate: {\r\n\t\t\"name\": \"miRate\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"MiRate\"\r\n\t} as FieldItemNum,\r\n\tmiValue: {\r\n\t\t\"name\": \"miValue\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"MiValue\"\r\n\t} as FieldItemNum,\r\n\tincValue: {\r\n\t\t\"name\": \"incValue\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"IncValue\"\r\n\t} as FieldItemNum,\r\n\tinc1: {\r\n\t\t\"name\": \"inc1\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Inc1\"\r\n\t} as FieldItemNum,\r\n\tinc2: {\r\n\t\t\"name\": \"inc2\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Inc2\"\r\n\t} as FieldItemNum,\r\n\tinc3: {\r\n\t\t\"name\": \"inc3\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Inc3\"\r\n\t} as FieldItemNum,\r\n\tinc4: {\r\n\t\t\"name\": \"inc4\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Inc4\"\r\n\t} as FieldItemNum,\r\n\tpreInc: {\r\n\t\t\"name\": \"preInc\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"PreInc\"\r\n\t} as FieldItemNum,\r\n\tsmoothness: {\r\n\t\t\"name\": \"smoothness\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Smoothness\"\r\n\t} as undefined,\r\n\tgMiRate: {\r\n\t\t\"name\": \"gMiRate\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"GMiRate\"\r\n\t} as FieldItemNum,\r\n\tgMiValue: {\r\n\t\t\"name\": \"gMiValue\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"GMiValue\"\r\n\t} as FieldItemNum,\r\n\tgIncValue: {\r\n\t\t\"name\": \"gIncValue\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"GIncValue\"\r\n\t} as FieldItemNum,\r\n\tgInc1: {\r\n\t\t\"name\": \"gInc1\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"GInc1\"\r\n\t} as FieldItemNum,\r\n\tgInc2: {\r\n\t\t\"name\": \"gInc2\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"GInc2\"\r\n\t} as FieldItemNum,\r\n\tgInc3: {\r\n\t\t\"name\": \"gInc3\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"GInc3\"\r\n\t} as FieldItemNum,\r\n\tgInc4: {\r\n\t\t\"name\": \"gInc4\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"GInc4\"\r\n\t} as FieldItemNum,\r\n\tgPreInc: {\r\n\t\t\"name\": \"gPreInc\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"GPreInc\"\r\n\t} as FieldItemNum,\r\n\tgSmoothness: {\r\n\t\t\"name\": \"gSmoothness\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"GSmoothness\"\r\n\t} as undefined,\r\n\trMiRate: {\r\n\t\t\"name\": \"rMiRate\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"RMiRate\"\r\n\t} as FieldItemNum,\r\n\trMiValue: {\r\n\t\t\"name\": \"rMiValue\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"RMiValue\"\r\n\t} as FieldItemNum,\r\n\trIncValue: {\r\n\t\t\"name\": \"rIncValue\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"RIncValue\"\r\n\t} as FieldItemNum,\r\n\trInc1: {\r\n\t\t\"name\": \"rInc1\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"RInc1\"\r\n\t} as FieldItemNum,\r\n\trInc2: {\r\n\t\t\"name\": \"rInc2\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"RInc2\"\r\n\t} as FieldItemNum,\r\n\trInc3: {\r\n\t\t\"name\": \"rInc3\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"RInc3\"\r\n\t} as FieldItemNum,\r\n\trInc4: {\r\n\t\t\"name\": \"rInc4\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"RInc4\"\r\n\t} as FieldItemNum,\r\n\trPreInc: {\r\n\t\t\"name\": \"rPreInc\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"RPreInc\"\r\n\t} as FieldItemNum,\r\n\trSmoothness: {\r\n\t\t\"name\": \"rSmoothness\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"RSmoothness\"\r\n\t} as undefined,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\tfields.miValue, fields.incValue, fields.earning, fields.divident, fields.price, fields.pvolumn, fields.roe, fields.inc1, fields.inc2, fields.inc3, fields.inc4, fields.preInc, fields.volumn, fields.smoothness, fields.date, fields.miRate, fields.dvRate, fields.ttm, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"StockValue\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const res: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\n\r\nexport function render(item: StockValue):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { AccountValue } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tmiValue: {\r\n\t\t\"name\": \"miValue\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"MiValue\"\r\n\t} as FieldItemNum,\r\n\tmarket: {\r\n\t\t\"name\": \"market\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Market\"\r\n\t} as FieldItemNum,\r\n\tcount: {\r\n\t\t\"name\": \"count\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Count\"\r\n\t} as FieldItemInt,\r\n\tcash: {\r\n\t\t\"name\": \"cash\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Cash\"\r\n\t} as FieldItemNum,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\tfields.miValue, fields.market, fields.count, fields.cash, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"AccountValue\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const res: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\n\r\nexport function render(item: AccountValue):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { Portfolio } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tid: {\r\n\t\t\"name\": \"id\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Id\"\r\n\t} as FieldItemId,\r\n\tquantity: {\r\n\t\t\"name\": \"quantity\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Quantity\"\r\n\t} as FieldItemInt,\r\n\tcost: {\r\n\t\t\"name\": \"cost\",\r\n\t\t\"type\": \"number\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"number\",\r\n\t\t\"label\": \"Cost\"\r\n\t} as FieldItemNum,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\tfields.quantity, fields.cost, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"Portfolio\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const res: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\n\r\nexport function render(item: Portfolio):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { UserBlockStock } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tix: {\r\n\t\t\"name\": \"ix\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Ix\"\r\n\t} as FieldItemId,\r\n\txi: {\r\n\t\t\"name\": \"xi\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Xi\"\r\n\t} as FieldItemId,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.xi, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"UserBlockStock\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: UserBlockStock):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { UserAccount } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tix: {\r\n\t\t\"name\": \"ix\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Ix\"\r\n\t} as FieldItemId,\r\n\txi: {\r\n\t\t\"name\": \"xi\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Xi\"\r\n\t} as FieldItemId,\r\n\tsort: {\r\n\t\t\"name\": \"sort\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Sort\"\r\n\t} as FieldItemInt,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\tfields.sort, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"UserAccount\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const res: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\n\r\nexport function render(item: UserAccount):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { UserGroup } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tix: {\r\n\t\t\"name\": \"ix\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Ix\"\r\n\t} as FieldItemId,\r\n\txi: {\r\n\t\t\"name\": \"xi\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Xi\"\r\n\t} as FieldItemId,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\t\r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"UserGroup\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const res: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\n\r\nexport function render(item: UserGroup):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { UserAllStock } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tix: {\r\n\t\t\"name\": \"ix\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Ix\"\r\n\t} as FieldItemId,\r\n\txi: {\r\n\t\t\"name\": \"xi\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Xi\"\r\n\t} as FieldItemId,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.xi, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"UserAllStock\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: UserAllStock):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { AccountHolding } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tix: {\r\n\t\t\"name\": \"ix\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Ix\"\r\n\t} as FieldItemId,\r\n\txi: {\r\n\t\t\"name\": \"xi\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Xi\"\r\n\t} as FieldItemId,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.xi, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"AccountHolding\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: AccountHolding):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { GroupStock } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tix: {\r\n\t\t\"name\": \"ix\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Ix\"\r\n\t} as FieldItemId,\r\n\txi: {\r\n\t\t\"name\": \"xi\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Xi\"\r\n\t} as FieldItemId,\r\n\torder: {\r\n\t\t\"name\": \"order\",\r\n\t\t\"type\": \"integer\",\r\n\t\t\"isKey\": false,\r\n\t\t\"widget\": \"updown\",\r\n\t\t\"label\": \"Order\"\r\n\t} as FieldItemInt,\r\n};\r\n/*==fields==*/\r\n\r\nexport const fieldArr: FieldItem[] = [\r\n\tfields.order, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"GroupStock\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nexport const res: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\n\r\nexport function render(item: GroupStock):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","import { Res, setRes, TFunc, UI } from \"tonva-react\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { FieldItem, FieldItemInt, FieldItemNum, FieldItemString, FieldItemId } from \"tonva-react\";\r\nimport { IXIndustry } from \"./BruceYuMi\";\r\n\r\n/*--fields--*/\r\nconst fields = {\r\n\tix: {\r\n\t\t\"name\": \"ix\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Ix\"\r\n\t} as FieldItemId,\r\n\txi: {\r\n\t\t\"name\": \"xi\",\r\n\t\t\"type\": \"id\",\r\n\t\t\"isKey\": false,\r\n\t\t\"label\": \"Xi\"\r\n\t} as FieldItemId,\r\n};\r\n/*==fields==*/\r\n\r\nconst fieldArr: FieldItem[] = [\r\n\tfields.xi, \r\n];\r\n\r\nexport const ui: UI = {\r\n\tlabel: \"IXIndustry\",\r\n\tfieldArr,\r\n\tfields,\r\n};\r\n\r\nconst resRaw: Res<any> = {\r\n\tzh: {\r\n\t},\r\n\ten: {\r\n\t}\r\n};\r\nconst res: any = {};\r\nsetRes(res, resRaw);\r\n\r\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\r\n\treturn res[str as string] ?? str;\r\n}\r\n\r\nexport function render(item: IXIndustry):JSX.Element {\r\n\treturn <>{JSON.stringify(item)}</>;\r\n};\r\n","export * from './StockInfoType';\r\nexport { CStockInfo } from './CStockInfo';\r\nexport { VStockInfo } from './VStockInfo';\r\nexport * from './GFunc';","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport './index.css';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport { App } from 'uq-app';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}